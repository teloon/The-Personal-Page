<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 4, revision: 3, date: new Date("Jan 9, 2009"), extensions: {}};
//]]>
</script>
<script id="jsheadArea" type="text/javascript">
//<![CDATA[

//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) UnaMesa Association 2004-2009

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->
<!--PRE-HEAD-END-->
<title> Teloon's TiddlyWiki - Wiki as fun; Wiki as note; Wiki as study </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.checkUnsavedChanges) checkUnsavedChanges(); if(window.scrubNodes) scrubNodes(document.body);">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected{color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}
.sparktick {background:[[ColorPalette::PrimaryDark]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity:60)';}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0em 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0em 1em 1em; left:0px; top:0px;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0em 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 .3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0em 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0em 0em 0em; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0em;}
.wizardFooter .status {padding:0em 0.4em 0em 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em 0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0em; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em 0.2em 0.2em 0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em 0.2em 0.2em 0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em 1em 1em 1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0em;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0em 0em 0.5em;}
.tab {margin:0em 0em 0em 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0em 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0em 1em;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0em 0.25em; padding:0em 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0em; font-size:.9em;}
.editorFooter .button {padding-top:0px; padding-bottom:0px;}

.fieldsetFix {border:0; padding:0; margin:1px 0px 1px 0px;}

.sparkline {line-height:1em;}
.sparktick {outline:0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0em; right:0em;}
#backstageButton a {padding:0.1em 0.4em 0.1em 0.4em; margin:0.1em 0.1em 0.1em 0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin:0em 3em 0em 3em; padding:1em 1em 1em 1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em 0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none ! important;}
#displayArea {margin: 1em 1em 0em 1em;}
/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
noscript {display:none;}
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:
* SiteTitle &amp; SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* MainMenu: The menu (usually on the left)
* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These InterfaceOptions for customising TiddlyWiki are saved in your browser

Your username for signing your edits. Write it as a WikiWord (eg JoeBloggs)

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; SaveBackups
&lt;&lt;option chkAutoSave&gt;&gt; AutoSave
&lt;&lt;option chkRegExpSearch&gt;&gt; RegExpSearch
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; CaseSensitiveSearch
&lt;&lt;option chkAnimate&gt;&gt; EnableAnimations

----
Also see AdvancedOptions</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;</pre>
</div>
</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="++操作及其效率" modifier="wy" created="200906120745" modified="200906120746" tags="++ c" changecount="2">
<pre>!!!i=i+1 i++ ++i的实现过程
计算机内部实现过程有别，详细如下：
i=i+1的过程相当：
&gt;{{{　　temp=i+1;　i=temp;}}}
i++的过程相当：
&gt;{{{　　temp=i;　i=temp+1;　return temp;}}}
++i的过程最简单：
&gt;{{{　　i增1然后return i 的值，一步完成，没有给任何temp变量赋值：）}}}

!!!++操作的效率
i++;是一个右值.而++i是一个左值.而且''尽量去用++i'',因为对于类类型或大型的数据类型来做相关操作时会提高效率.
简单的说是右值是放在=(赋值运算符)右边的操作数.
而左值是可以放在其左边的操作数.
左值可以取地址,而右值不行.</pre>
</div>
<div title="32位Ubuntu支持超过4G内存的方法" modifier="YourName" created="201102110602" changecount="1">
<pre>&gt;Ubuntu 32位内核默认开启了CONFIG_HIGHMEM4G，但PAE模式是关闭的，这样32位内核在系统配置4GB内存的时候会有1GB保留给内核虚拟空间，用户实际可用的只有3GB，而Ubuntu PAE内核使用的是CONFIG_HIGHMEM64G，能处理最多64GB内存。
*方法
安装server版内核（他应该是打开PAE的）
*命令
&lt;code shell&gt;
sudo apt-get install ubuntu-restricted-extras(网上很多教程是 linux-restricted-modules-server)
sudo apt-get install linux-headers-server 
sudo apt-get install linux-image-server linux-server 
&lt;/code&gt;</pre>
</div>
<div title="A systematic study on parameter correlations in large scale duplicate document detection" modifier="wy" created="200907080757" modified="200907090142" changecount="27">
<pre>//Shaozhi Ye , Ji-Rong Wen and Wei-Ying Ma //
//Department of Computer Science, University of California, Davis, CA, USA;//
//Microsoft Research Asia, Beijing, P.R.China//

''Time:'' Proceedings of the 10th Paciﬁc-Asia Conference on Knowledge Discovery and Data Mining, Singapore, April ''2006''
!!!Abstract
This paper explores the correlations among ''several most important parameters'' in DDD and the impact of ''sampling ratio'' is of most interest
since it heavily aﬀects the accuracy and scalability of DDD algorithms.
''Parameters:''
*similarity threshold
*precision/recall requirement
*sampling ratio  {{{   (most interest)}}}
*document size 

!!!Related Concept
*''adaptive sampling method''
&gt;use dynamic sampling ratio for diﬀerent document size with the constraint of given precision requirements. 
*''shingle''
&gt;A contiguous subsequence in a document
*''false positive'' {{{？}}}
&gt;hash collision

focus on the content similarity
!!!Prior Work
*''Shingle Based Algorithms''
&gt;widely used in ''large scale DDD''
&gt;''Border' Algorithm''：''O(N log (N/m))''(Broder et al., 1997) {{{ &lt;m denotes the size of the main memory;N denotes the number of documents&gt;}}}
&gt;''Improvement:''sampling strategies proposed to reduce the ''number of shingles''  (//Refer to the paper in details//)
*''Term Based Algorithms''
&gt;work well for ''small-scale'' IR systems and most of them also achieve good performance when used ''online''
&gt;use ''individual terms'' (words) as the basic unit
&gt;Many ''information retrieval'' (IR) techniques, especially feature selection, are used in these algorithms{{{   ---&gt;&gt;more complex}}}

!!!Equations
*Document Similarity
&gt;r(A,B) ={{{ (|S(A) ∩ S(B)|) / (|S(A)∪S(B)|)}}}
*Precision
&gt;Precision={{{|P's ∩ Ps| / |P's|}}}
*Recall
&gt;Recall = {{{|P's ∩ Ps| / |Ps|}}}
&gt;&gt;Given a dataset S, Ps denotes the duplicate document pairs detected by non-sampling DDD, and P's denotes the duplicate document pairs detected by sampling DDD
.
!!!Summary
*''Similarity Threshold''
&gt;precision drops with the increase of similarity threshold, especially when the threshold is higher than 0.95. When high similarity threshold, greater than 0.95, is required, sampling ratio should be increased to achieve a good precision.
*''Sampling Ratio''
&gt;precision drops with the decrease of sampling ratio, especially for small documents containing fewer than 500 words.When dealing with small documents, either similarity threshold should be decreased or sampling ratio should be raised.
*''Document Size''
&gt;small documents are more sensitive to similarity threshold and sampling ratio than large documents. Sampling ratio can be decreased when dealing with large documents to reduce the shingles to compare.

!!!Adaptive Sampling Strategy
*''Basic idea'' 
&gt;apply small sampling ratio to large documents and large sampling ratio to small documents</pre>
</div>
<div title="AES算法加密与解密" modifier="teloon" created="200911211503" modified="200911211504" changecount="2">
<pre>&gt;对于''CBC模式''的AES加密，下面的代码decrypt后无法得到原始的data(输出乱码)，具体原因见[[这个|http://groups.google.com/group/comp.lang.python/browse_thread/thread/d2a30ba90f4e7982?pli=1]]帖子，可以理解为加密过程中obj对象的状态会变化，导致直接用它来解密的话会失效
&lt;code python&gt;
from Crypto.Cipher import AES

PADDING = '\0'
pad_it = lambda s: s+(16 - len(s)%16)*PADDING
	
if __name__ == &quot;__main__&quot;:
	key = '1234567890123456'
	data = 'qwertyuiopasdfgh'
	obj = AES.new(key, AES.MODE_CBC)
	crypt = obj.encrypt(data)
	print crypt
	recovery = obj.decrypt(crypt)  #有问题
	print recovery
&lt;/code&gt;
&gt;需要改成如下代码：
&lt;code python&gt;
from Crypto.Cipher import AES

PADDING = '\0'
pad_it = lambda s: s+(16 - len(s)%16)*PADDING	
if __name__ == &quot;__main__&quot;:
	key = '1234567890123456'
	data = 'qwertyuiopasdfgh'
	obj = AES.new(key, AES.MODE_CBC)
	crypt = obj.encrypt(data)
	print crypt
	obj2 = AES.new(key, AES.MODE_CBC)
	recovery = obj2.decrypt(crypt)
	print recovery
&lt;/code&gt;
&gt;而''ECB''模式没有这个问题，因为他不是block chaining的</pre>
</div>
<div title="About this" modifier="wy" created="200902091059" modified="201110110639" changecount="27">
<pre>*日渐感觉博客作为学习记录的不足，零碎的知识需要系统、有机地管理、存储才有记录的价值。wiki以其得天独厚的''索引''、''检索''、''组织''、''共享''功能而特别适合学习的记录、资料的整理。特别是TiddlyWiki，__无需特别安装环境__，__无需数据库__，__方便携带__，特别适合我这种__个人知识管理__。
*--美中不足的是本身不提供通过网络同步功能，但有人已经hack出方法了，以后可以试试。不过只要本机有备份，在U盘中编辑，每天用TC同步一下就好了。--已经解决，在tiddlyspot注册个帐号，可以直接点击的''update''上传了。相关配置见[[这里|http://faq.tiddlyspot.com/]]
**目前由于浏览器安全策略的变化，在chrome和firefox中都无法import和upgrade了
*TiddlyWiki自己的编辑语法还是要熟悉一下，具体可以看[[TiddlyWiki说明书|http://web.nlhs.tyc.edu.tw/~lss/wiki/TiddlyWikiTutorialTW.html]]，或者[[相关链接]]
*插件安装：导入对方的html文件即可，选择要安装的插件：见[[这里|http://tiddlyvault.tiddlyspot.com/]]和[[这里|http://www.tiddlytools.com/]]插件介绍</pre>
</div>
<div title="Algorithm&amp;DS" modifier="wy" created="200908111005" modified="201005251654" changecount="24">
<pre>!!!Algorithm
[[心得]]
[[汉诺塔(tower of hanoi)]]
[[pascal三角（杨辉三角）]]
[[背包问题]]
[[字符串匹配]]
[[最小代价生成树]]
[[单源最短路径]]
[[装箱算法bin-packing]]
[[排序]]
[[寻找单个数]]
*''Books''
#Digraphs: Theory, Algorithms and Applications：[[相关讨论|http://bbs.sjtu.edu.cn/bbstcon?board=Algorithm&amp;reid=1274717050]]
!!!Data Structure
*图
1、相关概念及其用处（自想）：''邻接表''、''逆邻接表''、''邻接多重表''、''十字链表''
2、''DFS''、''BFS''遍历的思路（数据结构与算法交大版和Introduction to Algorithm分别有不同实现形式，但思路是一样的）
3、''最小代价生成树''：''prim''算法和''Kruscal''算法，一个是考虑''点''，一个是考虑''边''，由于算法复杂度不一样，使用情况也不一样；
4、''最短路径问题''：''Dijkstra''算法，实现、复杂度、使用情况和Prim算法差不多。
!!!框架、模板
[[STL容器和算法的选择]]
!!!密码
1、[[AES算法加密与解密]]</pre>
</div>
<div title="Blog" modifier="YourName" created="200902140744" modified="201102111259" changecount="9">
<pre>&lt;html&gt;&lt;font size=4 color=purple&gt;&lt;b&gt;This page is a collect of pages about records of my life&lt;/b&gt;&lt;/font&gt;&lt;/html&gt;
*[[Junior（2ed）Extra Reading List]]
*[[Junior（2ed）OutLines]]
*[[Blogger和WordPress互相导入]]</pre>
</div>
<div title="Blogger和WordPress互相导入" modifier="YourName" created="201102111301" modified="201102111303" changecount="3">
<pre>[[wordpress2blogger|http://wordpress2blogger.appspot.com/]]
[[blogger2wordpress|http://blogger2wordpress.appspot.com/]]
[[livejournal2blogger|http://livejournal2blogger.appspot.com/]]
[[movabletype2blogger|http://movabletype2blogger.appspot.com/]]
[[google-blog-converters-appengine|http://code.google.com/p/google-blog-converters-appengine/]]</pre>
</div>
<div title="Book" modifier="YourName" created="200902150714" modified="200902150714" changecount="2">
<pre>!会议
*罗伯特议事原则</pre>
</div>
<div title="C&amp;C++中关于void的一些原则" modifier="teloon" created="200904161029" modified="200904161033" tags="void" changecount="3">
<pre>''Reference：''[[here|http://c.chinaitlab.com/cckaifa/interface/200808/758701_4.html]]
1、任何类型都可以赋给void类型的，相反需要强制转换
2、C语言中，凡不加''返回类型''的，''都当作int类型''。所以函数如果没有返回值，那么应该显式声明为void类型的（有些编译器也能通过，如VC6.0，但建议一般都写上以统一）
3、若函数''没有参数''，那应显式地声明为void（若不声明，在C中若传任何参数给函数都不会报错，但这实际上是不对的）
4、按照ANSI标准，不能对''void指针''，进行任何''算法操作''；但按照GNU标准，void*的算法操作与char*的算法操作一样
5、如果函数参数是任意类型指针的，那应声明为void *类型
6、void不能用来表示真实的变量，它只是体现类型的''抽象''，故不能声明{{{void  a}}}</pre>
</div>
<div title="CPP中指针与引用" modifier="wy" created="200908070230" modified="200908070233" tags="指针 引用" changecount="5">
<pre>!!!向函数中传递指针和传递指针的引用的区别
*如果是传递指针，那么会先复制该指针，在函数内部使用的是复制后的指针，这个指针与原来的指针指向相同的地址，如果在函数内部将复制后的指针指向了另外的新的对象，那么不会影响原有的指针；
*但是对于传递指针应用，如果将传递进来的指针指向了新的对象，那么原始的指针也就指向了新的对象，这样就会造成内存泄漏，因为原来指针指向的地方已经不能再引用了，即使没有将传递进来的指针指向新的对象，而是在函数结束的时候释放了指针，那么在函数外部就不能再使用原有的指针了，因为原来的内存已经被释放
!!!指向类的成员的指针
指向数据成员的指针格式如下：
&gt;{{{    &lt;类型说明符&gt; &lt;类名&gt;::*&lt;指针名&gt;}}}
指向成员函数的指针格式如下：
&gt;{{{    &lt;类型说明符&gt; (&lt;类名&gt;::*&lt;指针名&gt;)(&lt;参数表&gt;)}}}

更详细的解释和例子见[[这里|http://www.cnblogs.com/netqer/archive/2008/10/20/1315396.html]]</pre>
</div>
<div title="Commands" modifier="YourName" created="201003230735" modified="201004220641" changecount="26">
<pre>!!!MySQL
*数据库中存的是中文，以MySQL默认的latin1为编码，将之导出，转换成UTF8，再以UTF8导入MySQL
&gt;{{{(mysqldump -u root -plinux123 --default-character-set=latin1 crawlqzone | sed -e 's/CHARSET=latin1/CHARSET=utf8/g' -e &quot;s/NAMES latin1/NAMES utf8/g&quot; | gzip -9 &gt; crawlqzone.2010_3_21.benjamin.utf8.sql.gz ) &amp;&amp; (gunzip &lt; crawlqzone.2010_3_21.benjamin.utf8.sql.gz | mysql -u root -plinux123 crawlqzone2)}}}
*[[MySQL命令行常用命令]]

!!!Shell
*处理大文件
&gt;{{{grep -i &quot;^a&quot; filename.txt}}}
&gt;&gt;列出filename.txt中以字母a（包括A）开头的行
&gt;{{{sed &quot;s/ //g&quot; filename.txt}}}
&gt;&gt;去掉filename.txt中所有的空格
&gt;{{{grep -v &quot;^SKYPE_ID&quot; filename.txt}}}
&gt;&gt;显示不包括SKYPE_ID的行
&gt;{{{grep -c &quot;^$&quot; filename.txt}}}
&gt;&gt;统计filename.txt中空行的数量
&gt;{{{grep -c &quot;$&quot; filename.txt}}}
&gt;&gt;统计filename.txt一共有多少行</pre>
</div>
<div title="Core Python学习笔记" modifier="YourName" created="201102151448" modified="201105210823" changecount="67">
<pre>*{{{作者}}}：''Guido van Rossum''
*''{{{decimal}}}''：10进制浮点数，用于''准确表达精度''
*''{{{module}}}''：a logic way to physically organize and distinguish related pieces of Python code into individual files
*''{{{;}}}''：将几个命令连接放在一行
*''{{{built-ins}}}''：All built-ins are members of {{{__builtins__}}} module, which is automatically imported by the interpreter before programs are executed or {{{&lt;&lt;&lt;}}} prompted
*''{{{_}}}''(underscore)
&gt;''{{{_xxx}}}''：Do ''not'' import with ''from module import *''
&gt;''{{{__xxx__}}}''：System-defined name
&gt;''{{{__xxx}}}''：类的私有属性
*''{{{内存管理}}}''
**reference count增加的情况
***对象被创建（create）
***增加一个别名（alias）
***函数调用的参数（function call）
***加入序列中（Sequence）
**reference count减少的情况
***对象或别名被销毁（del）
***别名被赋于另外一个对象
***函数调用退出
***序列中被删除或者序列被销毁（del）
*''{{{python 对象}}}''
**''{{{type}}}''类型
***an object's set of ''inherent behaviors'' and ''characteristics'' is stored in object's ''type''
***the ''{{{type}}}'' type is mother of all types and default ''metaclass'' for all standard Python classes.
*''{{{Object Identity}}}''
**a ''is not'' b
**''id(''a'')'' ''=='' ''id(''b'')''
&gt;&gt;对于''整数''或者''字符串''（immutable），编译器可能会''缓存''这些对象，造成两次赋值（同样的值），它们的object identify是一样的
*''{{{Type Operators}}}'' and ''{{{Built-in Functions}}}''
**''{{{cmp}}}''(obj1, obj2)
**''{{{type}}}''(obj).{{{__name__}}}
**''{{{isinstance}}}''(obj1, obj2)
**''{{{str}}}''(obj), ''{{{repr}}}''(obj), ''{{{`}}}''obj''{{{`}}}'' operator
***''{{{repr}}}''(obj) is equal to ''{{{`}}}''obj''{{{`}}}''
***''{{{repr}}}''(obj) is Python-friendly(如直接给eval()运行) while ''{{{str}}}''(obj) is Human-friendly
***why need both  ''{{{repr}}}''(obj) and ''{{{`}}}''obj''{{{`}}}''? 
&gt;&gt;useful when ''passing executable objects'' like function and where ''different functions'' may be called depending on the data item.
*''{{{type factory function}}}''
&gt;{{{list(), dict(), int()....}}}, behave like functions, actually ''class names'', when called, it actually ''initiating an instance'' of that type, like a factory
*''{{{除法}}}''
**Classic Division：
&gt;1/2：返回''整数''0（floor division）
&gt;1.0/2：返回''浮点数''0.5
**''{{{True Division}}}''：{{{from __future__ import division}}}
**''{{{Floor Division}}}''：''{{{//}}}''
*''{{{Bit Operator}}}''
&gt;''Negative'' numbers are treated as their ''2's complement'' value
&gt;Left or Right ''shift'' of N bits are equivalent to multiplication or division by ''(2**N)'' without overflow checking
&gt;For longs, the bit operators use a &quot;modified&quot; form of 2's complement, acting as if the sign bit were extended infinitely to the left.
**优先级：{{{~, &lt;&lt; and &gt;&gt;, &amp;, ^, |}}}
*''{{{Built-in Number Function}}}''
**''coerce''(num1, num2)
**''divmod''(num1, num2)
**''round''(flt, ndig=0)
**''chr''(num)
**''unichr''(num)
**''ord''(chr)
*''{{{random}}}''
**''{{{randint}}}''(num1, num2)
**''{{{uniform}}}''(num1, num2)：up-bound exclusive, return ''float''
**''{{{random}}}''()：0.0~1.0, return ''float''
**''{{{choice}}}''(seq)
*String Concatenation
{{{
&gt;&gt;&gt; f = urllib.urlopen('http://'  # protocol
... 'localhost'                   # hostname
... ':8000'                       # port
... '/cgi-bin/friends2.py')       # file
}}}
*String Format Operator
{{{
&gt;&gt;&gt; 'There are %(howmany)d %(lang)s Quotation Symbols' % \
...     {'lang': 'Python', 'howmany': 3}
'There are 3 Python Quotation Symbols'
}}}
*String Template
{{{
&gt;&gt;&gt; from string import Template
&gt;&gt;&gt; s = Template('There are ${howmany} ${lang} Quotation Symbols')
&gt;&gt;&gt;
&gt;&gt;&gt; print s.substitute(lang='Python', howmany=3)
There are 3 Python Quotation Symbols
}}}
*Raw String Operator
{{{
&gt;&gt;&gt; '\n'
'\n'
&gt;&gt;&gt; print '\n'

&gt;&gt;&gt; r'\n'
'\\n'
&gt;&gt;&gt; print r'\n'
\n

&gt;&gt;&gt; import re
&gt;&gt;&gt; m = re.search('\\[rtfvn]', r'Hello World!\n')
&gt;&gt;&gt; if m is not None: m.group()
...
&gt;&gt;&gt; m = re.search(r'\\[rtfvn]', r'Hello World!\n')
&gt;&gt;&gt; if m is not None: m.group()
...
'\\n'
}}}
*特殊字符和控制字符
|                  | !ASCII | !ASCII | !ASCII |
| //Decimal// | 0 | 65 | 255 |
| //Octal// | \000 | \101 | \177 |
| //Hex// | \x00 | \x41 | \xFF |
&gt;''控制字符''的一个''作用''是：在''数据库''或者''网络数据流''中充当''限定符''（delimiter）。
*字典dict
**''dict''大小''比较''
&gt;顺序：dict长度-&gt;Key大小(按照key的排序顺序比较)-&gt;若该''key对''相同则比较该''key对''对应的value值
**''hash()''
&gt;可用来判断某个对象是否可以用作key
**//dict//.get(//key//, default=None)
&gt;当不确定是否含有此//key//时可用该方法
**//dict//.setdefault(//key//, //value//)
&gt;用途同get，不过它的效果是不存在的话直接插入该key-value对
*循环
**while....else...
*map()和filter()
*文件操作
**UNS
&gt;当使用''U''标志打开文件时，所有行分隔符都被替换为''NEWLINE(\n)''；
&gt;newlines保存每种换行格式的tuple
**writelines()
&gt;''不会''自动加入行结束符
**分隔符(系统相关：''os''模块)
&gt;linesep, sep, pathsep(如环境变量), curdir, pardir
**truncate(size=//file//.tell())
&gt;将文件截取到size指定的位置
&gt;默认截取到文件当前所读到的位置
*命令行参数
**sys.argv
**getopt模块（原始、简单）
**optparse模块（复杂选项）
*文件系统
**os.getcwd()
**os.chdir()
**os.listdir()
*持久化（序列化）
**''pickle''(cPickle),marshal
**anydbm,dbm...
**''shelve''
*错误和异常
&lt;code python&gt;
try:
    a = int(b)
    c = 1/a
except (ValueError, TypeError, ZeroDivisionError), reason:
    print &quot;error reasion is &quot;, reason
else:
    print &quot;WaHa! No Error!&quot;
finally:
    print &quot;everything is ok&quot;
&lt;/code&gt;
&gt;''except'',''finally''常用来''释放系统资源''（如文件操作符）
**with
&gt;目前支持上下文协议的对象：file, decimal.Context, thread.LockType, threading.Lock...
**自定义异常（user-defined exception）
&gt;参照[[官方文档|http://docs.python.org/library/exceptions.html#exceptions.Exception]]
&gt;&gt;All built-in, non-system-exiting exceptions are derived from this class. All user-defined exceptions should also be derived from this class.
**''sys.exc_info()''
&gt;返回tuple:异常类、异常类的实例、跟踪记录对象
*函数与函数式编程
**函数调用完整语法
&gt;&gt;func(//positional_args//, //keyword_args//, *//tuple_grp_nonkw_args//, **//dict_grp_kw_args//)
**变长参数对象与函数式编程
**''函数''可以''被引用''，因此可以赋值、作为参数传递等等
**''偏函数应用''(''PFA'': Partial Function Application)
***提出的''动机''(motivation)
&gt;&gt;&gt;可以理解为''部分实例化函数''，提供''函数模板''(部分参数已经指定)
***与默认参数的函数的区别
&gt;&gt;&gt;每次调用偏函数都可以调用不同的参数组合（或许与''默认参数+不定长参数''等价）
***见P295的GUI例子
**''装饰器''
***提出的''动机''(motivation)
&gt;&gt;面向对象编程，静态类方法等问题，执行函数之前和之后的处理（清理）工作的需求，等等
***过程
###被装饰的函数作为参数传给装饰器
###装饰器(函数)返回一个''修改过的函数对象''
###将返回的函数对象''重新''赋给''原来的标识符''（''永久失去''对原始对象的访问）
***语法与例子
&lt;code python&gt;
def dec1(args):
    def wrappedFunc():
        print &quot;wa ha ha&quot;
        return func()
    return wappedFunc
def dec2:
    .......

@dec2
@dec1(args)
def func():
    ......
&lt;/code&gt;
相当于
&lt;code python&gt;
def func():.......
func = dec2(dec1(args)(func))   //修改原来的函数对象，赋给原来的标识符
&lt;/code&gt;
***应用
****引入日志；
****增加计时逻辑来检测性能；
****给函数加入事务的能力；
**''闭包''(closure)
***基本理念：根据传给函数的参数（或无参数）生成（并返回）一个函数或对象，这个函数或对象在该函数调用结束时仍存在（包括''自由变量''）
****闭包也是''函数''，不够携带了''额外的作用域''（作用域中的自由变量）
****闭包强调的''不是生命周期''，而是''运行环境''
***''自由变量''
****它定义在''外部''函数中（但''非全局变量''）但由''内部''函数引用或使用
****自由变量的引用存储在''单元对象''中，他是上层作用域结束后仍能存活的原因。它是独立的一块内存区域，故上层函数或对象的''栈空间''得以''释放''
***''用处''
****安装计算、隐藏状态、在函数对象和作用域中随意切换
****GUI或支持回调函数的事件驱动编程
**加强生成器
&gt;&gt;send(), close()
*''命名空间''
**加载顺序
&gt;&gt;内建名称空间 -&gt; 全局名称空间 -&gt; 局部名称空间
**查找顺序
&gt;&gt;局部名称空间 -&gt; 全局名称空间 -&gt; 内建名称空间
**{{{__buildin__}}}与{{{__buildins__}}}区别
&gt;&gt;参照[[官网|http://docs.python.org/library/{{{__builtin__}}}.html]]，{{{__buildin__}}}是内置的模块，包含内建的对象（函数、异常等），而{{{__buildins__}}}是几乎每个模块都有的全局属性，他是{{{__buildin__}}}的超集
**无限制的名字空间
&gt;&gt;可以在''任何''（函数、类等）需要放置数据的地方获得命名空间，并放置数据
*''导入模块''
**模块被import时就被执行
**同样的模块即使import多次，也只load一次（第一次）
**从ZIP文件中导入模块：python将ZIP文件当作一个目录来处理
**''globals()''和''locals()''
**导入子包时需要在目录中加上{{{__init__.py}}}文件，用来初始化，可以为空
**默认是''绝对导入''；相对目录：用''{{{.}}}''表示当前目录，用''{{{..}}}''表示上一层目录，一次类推；
**阻止属性被{{{from module import *}}}导入：在不想导入的属性名称前加一个下滑下{{{_}}}
**''循环导入''问题
&gt;&gt;改变一个导入方式：只在需要导入的地方导入
*''执行环境''
**''Function''和''Method''的区别（另''BIF''和''BIM''的区别类似）
&gt;&gt;Method的''{{{__self__}}}''属性''指向''一个''Python对象''，Function的指向‘’None‘’。（从字面理解：Method&lt;方法&gt;属于某个对象，function只是某个''功能''）
**创建''可调用''的对象实例
&gt;&gt;对象实例：''obj''；可做如下调用：''obj()''
&gt;&gt;只需在类中实现''{{{__call__}}}''函数
**''代码对象''
***''函数(function)对象''是对''代码对象(code object)''的包装（wrapper），''方法(method)''是对''函数对象''的包装（wrapper）
***''代码对象''是执行环境的''核心''(核心代码)，但它不是可调用(''callable'')的（它不含有任何''关于它执行环境的信息''），故需要上面这些''wrapper''，wrapper即callable(的对象)
***''代码对象''的真正''存在方式''是''字节码''
**‘’可执行对象‘’(''callable'')的''声明''
***''callable''
***''compile''
***''exec''：可用''文件对象''作为参数，此时类似''execfile()''，但是''execfile()''提供加入''全局和局部名称空间的集合''的参数
***''eval''
***''input''：等价于''eval(raw_input())''
**''模块作为脚本执行''
&gt;&gt;''python -c &quot;....&quot;''（命令行执行python语句）
&gt;&gt;''python -m CGIHTTPServer''（命令行执行模块）
**''执行非Python程序''
***''os.system()''
&gt;&gt;&gt;输出到标准输出，对某些程序（如CGI程序）可能会有影响，故常与''不产生输出''的程序一起使用
***''os.popen()''
&gt;&gt;&gt;system+''文件操作方式''
***''os.fork'', ''os.exec()'', ''os.wait()''
***''os.spawn''：''os.fork''+''os.exec()''
***''subprocess''模块：可替代os.system和os.popen

*''miscellaneous''
**''dir()''
&gt;&gt;没有参数时，return ''list'' of names in current ''local'' scope；相当于''locals().keys()''
</pre>
</div>
<div title="C语言指针" modifier="wy" created="200904260907" modified="201011261102" tags="c 指针" changecount="3">
<pre>一般采用‘'right-left‘’原则来解决:
&gt;The right-left rule: Start reading the declaration from the innermost parentheses, go right, and then go left. 
&gt;When you encounter parentheses, the direction should be reversed. Once everything in the parentheses
&gt;has been parsed, jump out of it. Continue till the whole declaration has been parsed.
比较详细的解释和例子可以参考[[西邮wiki|http://xiyoulinux.org/wiki/index.php?title=%E6%B7%B1%E5%85%A5C%E8%AF%AD%E8%A8%80]]

补充：
根据西邮wiki上的这个例子：
&gt;''int (*(*func)(int *p))[5];''
''解释：''func是个指针，指向一个函数，这个函数的参数是int类型的指针（p），它的返回值是个指针，指向的是有5个int元素的数组

可以推出：
&gt;''void (*signal(int signo, void (*func)(int)))(int);''
''解释是：''signal是一个指针，指向一个函数，这个函数的一个参数是int，另一个参数是个函数指针（具体不解释了），signal指向的函数返回的是个指针，指针指向的是一个函数，函数的参数是int，返回值是void</pre>
</div>
<div title="DefaultTiddlers" modifier="teloon" created="200902081502" modified="200902091104" changecount="8">
<pre>[[About this]]
[[GettingStarted]]</pre>
</div>
<div title="Design and Implementation of a High-Performance Distributed Web Crawler" modifier="wy" created="200907120710" modified="200907120730" changecount="8">
<pre>//Vladislav Shkapenyuk Torsten Suel//

!!!Abstract
In this paper, we describe the design and implementation of a distributed web crawler that runs on a network of workstations. The crawler scales to (at least) several hundred pages per second, is resilient against system crashes and other events, and can be adapted to various crawling applications.
!!!Introduction
A crawler for a large search engine has to address two issues:
#It has to have a ''good crawling strategy'', i.e., a strategy for deciding which pages to download next;
#It needs to have a highly optimized system architecture that can ''download a large number of pages per second'' while being ''robust'' against crashes,''manageable'', and considerate of resources and web servers
!!!!Crawling Applications
*Breadth-First Crawler
*Recrawling Pages for Updates
*Focused Crawling
*Random Walking and Sampling
*Crawling the “Hidden Web”
!!!!Basic Crawler Structure
For simplicity, we separate our crawler design into two main components, referred to as ''crawling application'' and ''crawling system''.
''Crawling application:'' 
&gt;Decides what page to request next given the current state and the previously crawled pages, and issues a stream of requests (URLs) to the crawling system.
''Crawling system:''
&gt;''Download'' the requested pages and supplies them to the crawling application for analysis and storage. The crawling system is in charge of tasks such as ''robot exclusion'', ''speed control'', and ''DNS resolution'' that are common to most scenarios, while the application implements crawling strategies such as “breadth-ﬁrst” or ”focused“
!!!!Requirements for a Crawler
*Flexibility
*Low Cost and High Performance
*Robustness
*Etiquette and Speed Control
*Manageability and Reconﬁgurability
!!!System Architecture
#''Small crawler configuration''  [img[Small crawler configuration|111.png]]
#'' Large configuration''  [img[ Large configuration|22.png]]
#'' Manager Data Structures''  [img[Manager Data Structures|33.png]]
!!!Comparison with Other Systems
''Mercator'' was written completely in Java, which gives ﬂexibility through pluggable components
&gt;One major difference to our system is that we try to completely avoid ''random I/O'', while Mercator uses ''caching'' to catch most of the random I/O, and a'' fast disk system'' to handle the still signiﬁcant remaining accesses. An advantage of such a centralized system is that data can be ''directly parsed in memory'' and does not have to be written from disk as in our system.</pre>
</div>
<div title="Dive Into Python学习笔记" modifier="YourName" created="200910291141" modified="201102271121" tags="python" changecount="23">
<pre>*python是''动态''语言（不用显式声明数据类型），又是''强类型''语言（[[强制类型定义|http://en.wikipedia.org/wiki/Strong_typing]]）；
*并不是所有的模块都以.py结尾，进一步说，并不是所有模块都的源码都可以用，再进一步，这些模块是用C写的，如内置模块(sys等)；
*''sys.path''是个''list''对象；
*Python中''“一切皆对象”''，即都有''属性''和''方法''；如所有函数都有一个内置的{{{__doc__}}}属性，返回源码定义的doc stirng；
*Python用{{{==}}}作比较，用{{{=}}}做赋值；但是Python不支持行内赋值；
*Python中''list''可以是''负值''；list的''分片''：''li[1:-1]''（第''二''个元素到''最后第二个''，第二个索引(-1)位置''不包含''）、''li[3:]''（第''四''个到''最后一个''），它返回的还是list；
*list的''添加函数''：
&gt;''append''（末尾加''一个元素''）
&gt;''extend''（末尾加一个list的''所有元素''）
&gt;''区别''详见P33；
*list的''搜索函数''：
&gt;{{{list.index(&quot;c&quot;)}}}，返回位置；
&gt;{{{&quot;c&quot; in li}}}，返回''True''或''False''（大小写敏感）；
*list的''删除函数''：
&gt;''li.remove(&quot;c&quot;)''；
&gt;''li.pop()''（弹出最后一个元素）
*''list''的''运算符''：{{{+=,+,*}}}：
*''连接字符串''：''list''的''join''操作，将list中的所有字符串连成一个，并用某一字符串做分割：{{{&quot;;&quot;.join([&quot;aaa&quot;,&quot;bbb&quot;])}}}  =&gt; {{{'aaa;bbb'}}}
*''分割字符串''：与join正好相反，但可接受第二个可选参数，表示分割的次数；
*''tuple''是不可变的list，它是常量，故可用来作为dictionary的key；tuple没有添加、删除、索引函数，但{{{''c'' in tp}}}仍然成立；tuple和list可''相互转换''；
*''dictionary''用''大括号''，list用''方括号''，tuple用''小括号''；
*定义一个''只含一个元素''的tuple时，在元素后面必须加个逗号(P42)；
*字符串''之间''可以用''+''号连接，字符串和其他类型，如整数，不能用''+''连接，可以用''%s''格式化字符串；
*''and'',''or'':从左向右运算，当能判断真假是马上返回那个值，如对于''and''：
&gt;如果布尔环境中，所有值都为真，那么整个式子为真，返回''最后一个值''；
&gt;如果布尔环境中，某个值为假，那么整个式子为假，返回''第一个假值''；
*用and和or实现''bool?a:b''时，当不确定a是否为空时，尽量用{{{(x and [a] or [b])[0]}}}，其他确定a非空时，可简化为{{{x and a or b}}}；
&gt;另，python2.5及以上提供了语法支持
&lt;code python&gt;
a if X else b
&lt;/code&gt;</pre>
</div>
<div title="Eclipse：''Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space''错误" modifier="wy" created="201007220852" modified="201007220854" tags="eclipse" changecount="5">
<pre>主要是要设置xmx参数，在Project中单独设置：
选中被运行的类，点击菜单''‘run-&gt;run...’''，选择(x)=Argument标签页下的''vm arguments''框里，输入''-Xmx800m'', 保存运行。

参照：[[问题6：内存不足 java.lang.OutOfMemoryError: Java heap space|http://hi.baidu.com/xhero2008/blog/item/20b4fe1f95f602f0e1fe0b5b.html/cmtid/655ab4a141a3f3864610647e]]</pre>
</div>
<div title="Eclipse：''failed to create the java virtual machine''错误" modifier="wy" created="201007160338" modified="201007160425" changecount="4">
<pre>*解决方案
按照[[这里|http://empc.blog.hexun.com/52848017_d.html]]说的去掉''eclipse.ini''文件中''Xmx512m''的设置就好了

另：
*Eclipse.ini配置Sample
&gt;[[Eclipse Wiki|http://wiki.eclipse.org/Eclipse.ini]]
*Eclipse的参数选项设置
&gt;[[Eclipse的文档|http://help.eclipse.org/helios/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/misc/runtime-options.html]]
*JVM的参数设置选项
&gt;[[Oracle的文档|http://publib.boulder.ibm.com/infocenter/wasinfo/v4r0/index.jsp?topic=/com.ibm.websphere.v4.doc/olt_content/debugger/ref/rbcjvmar.htm]]</pre>
</div>
<div title="Finding Similar Files in Large Document Repositories" modifier="wy" created="200907111532" modified="200907111608" tags="hp chunk" changecount="5">
<pre>//George Forman  Hewlett-Packard Labs  1501 Page Mill Rd. MS 1143  Palo Alto, CA 94304 USA  george.forman@hp.com  
Kave Eshghi      Hewlett-Packard Labs   1501 Page Mill Rd. MS 1143  Palo Alto, CA 94304 USA  kave.eshghi@hp.com
Stephane Chiocchetti  Hewlett-Packard France  1 ave Du Canada, MS U215   91947 Courtaboeuf, France   stephane.chiocchetti@hp.com//

''Time:''KDD’05, August 21–24, 2005, Chicago, Illinois, USA. Copyright 2005 ACM 1-59593-135-X/05/0008 ...$5.00.

!!!ABSTRACT
It is based on chunk-ing the byte stream to ﬁnd unique signatures that may be shared in multiple ﬁles. An analysis of the ﬁle-chunk graph yields clusters of related ﬁles. An optional bipartite graph partitioning algorithm can be applied to greatly increase scalability.

!!!Framework
&gt;Break up each ﬁle into a ''sequence of chunks'' using a content-based chunking algorithm. 
&gt;&gt;Compute the ''hash of each chunk''. Thus each ﬁle is now represented by a list of hashes. 
&gt;&gt;&gt;''Find those ﬁles'' that share chunk hashes, reporting only those whose intersection is above some threshold

!!!!File Similarity Algorithm
#For each ﬁle in the repository, ''break its content into chunks'' and for each chunk, record its byte length and its ''hash code'';
#(Optional step for scalability) ''Prune and partition'' the above metadata into independent sub-problems, each small enough to ﬁt in memory.
#Load the ﬁle-chunk metadata into memory, constructing a bipartite graph with an edge between a ﬁle vertex and a chunk vertex i the chunk occurs in the ﬁle.
#Construct a separate ''ﬁle-ﬁle similarity graph'';
#Output the ﬁle-ﬁle similarity pairs as desired. (Use the well-known ''union-ﬁnd algorithm'' to determine clusters of interconnected ﬁles)

!!!!Bipartite Partitioning
#Have the ﬁle-chunk metadata stored in a ﬁle format that contains the ''chunk hash code'' and the'' ﬁlename'' on each line
#Perform a ''disk-based sort'' on this data, At the end of this step, all the ﬁles that refer to a given chunk will be in ''adjacent lines'' in the ﬁle
#Perform the highly eﬃcient ''union-ﬁnd algorithm'' on a graph where each ﬁle is represented by a vertex
#For connected components contain only a ''single ﬁle'', and these can be immediately ''discarded'' as not being similar to any other ﬁles
#(Optional) A standard ''bin-packing algorithm'' can be used to gather together'' multiple connected-components'' that can ﬁt in memory all at once
#Linearly ''scan the ﬁle-chunk metadata'' and output its lines into ''distinct sub-problem ﬁles'' by which partition the ﬁle has been assigned by the connected-components or optional bin-packing

!!!Some Problems
#For Bipartite Partitioning, the graph could not be partitioned. Because of one or a few chunks that represent a ubiquitous header in all the ﬁles
#the output can often include clusters of ﬁles that are similar simply because they contain a large template in common(''template similarity'')</pre>
</div>
<div title="GettingStarted" modifier="wy" created="200902090413" modified="200908111010" changecount="5">
<pre>To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:
* SiteTitle &amp; SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* MainMenu: The menu (usually on the left)
* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="Howto:Recover your username and password/Fix Grub 21 Error in Ubuntu" modifier="teloon" created="200903060250" modified="200903060253" tags="howto linux grub password" changecount="6">
<pre>From[[Ubuntu Geek|http://www.ubuntugeek.com/howtorecover-your-username-and-passwordfix-grub-21-error-in-ubuntu.html]]

!!Recovering Your forgotten username and password

If You just installed Ubuntu and forgot what password you selected during the installation process or one of your friend gave you ubuntu computer without giving username and password.This tutorial will help you to recover username and password

1) Turn on your computer, and as soon as you the Press Esc to enter grub message, press the escape key.

2) Select the option that says (recovery mode).

3) Your PC will boot into a shell. Once you get a command prompt, type “''passwd username''” where the username is your username. If you can’t remember your username, then you can type “''ls /home''” which should bring it up.

4) Enter a new password when prompted, and again when prompted again Type “''shutdown -r now''” to reboot your system,

That’s it. You should now be able to login with your new password.

!!Fix Grub 21 Error in Ubuntu

Problem

I’ve just tried installing Ubuntu but when it restert for the first time, GRUB returns an Error 21. I know this means that it can’t find the grub.conf file, but I don’t know how to fix this. I used Windows XP’s Recovery Console to get back into XP, but I can’t access the GRUB files.

Solution
1. Boot your computer up with Ubuntu CD

2. Open a terminal window or switch to a tty.

3. Go SuperUser (that is, type “sudo -s”). Enter root passwords as necessary.

4. Type “''grub''”

5. Type “''find /boot/grub/stage1''″. You’ll get a response like “''(hd0,1)''”.

Use whatever your computer spits out for the following lines.

6. Type “''root (hd0,1)''”, or whatever your hard disk + boot partition numbers are for Ubuntu.

7. Type “''setup (hd0)''”, to install GRUB to MBR, or “''setup (hd0,1)''” or whatever your hard disk + partition nr is, to install GRUB to a partition.

8. Quit grub by typing “''quit''”.

9. Reboot and remove the bootable CD.

Note:- In the above procedure hd0,1 is an example it might be different in your case.</pre>
</div>
<div title="IO类选择" modifier="wy" created="200910171621" modified="200910171630" tags="io java" changecount="5">
<pre>!!!一般使用
#''输入''
&gt;''java.util.Scanner''
&gt;''参数：''String（文件名），File对象，InputStream对象，Reader对象（实现了Readable接口）
#''输出''
&gt;''java.io.PrintWriter''
&gt;''参数：''String（文件名），File对象，OutputStream对象，Writer对象
&gt;它默认是有''缓存''的，故直接以String作为参数时，IO操作也是有buffer的；
#''tips''：
&gt;1. 输出时尽量将要输出的东西''转换成String''，再一起输出；
&gt;2. 他们的优点是：''可视化''，即打开文件即可查看内容；
!!!跨平台
#DataInputStream和DataOutputStream配对，写入字符串用writeUTF，读出的时候用readUTF，保证能读出，无论平台如何不同。
#''tips''
&gt;1. 还有writeDouble及类似的方法，真的是写“''data''”；
&gt;2. 由于采用JAVA''自己''的UTF编码，如字符串长度保存在字符串编码的前两个字节中，直接打开文件有可能是乱码；</pre>
</div>
<div title="Inspiration" modifier="YourName" created="200908141006" modified="201209040457" changecount="65">
<pre>!!!web
*拼接合成头像
##效果1，粉丝墙，见[[微博粉丝墙|http://fanswall.sinaapp.com/]]
###用微博账号登陆，获取粉丝的头像，拼接成特定尺寸即可
##效果2，参照[[这里|http://weibo.com/2359446855/xqo1c3Tt1]]，前景是一张主照片（大照片），背景是n张小照片（可以是大照片缩放）
###大照片来源：要求用户上传（因为对像素有要求）
###小照片来源：可以要求用户上传，也可以让用户用微博账号登陆，获取其好友头像
###算法：
####得到大照片的尺寸S
####根据S，拼接小照片照片P
#####resize到一定大小（可能以人眼舒服为准——即固定大小）
#####确定每行要用的照片数
#####确保第一轮每张照片都用一次，然后不够的再''随机''挑照片填满
####将自己的大照片和用小照片拼接后的大照片进行合并（每个像素的值为两者的像素求平均？）
##效果3，参照微博应用[[粉给面子|http://weibo.com/app/detail/5epHtj]]，即以某张图片（如博主头像）为模板，用n张小图片直接拼起来，通过挑选小图片的颜色来模拟模板的图案：
###该应用的效果还过得去，但感觉还是不是很美观，可以提高：
####每张小图片不是原色拼接上去，而是做一些平滑，或者和模板做一下均衡（如像素值求平均）
####或许也可以归结到效果2的问题，即用博主的小头像做前景（效果2和3的唯一区别就是前景图的大小）：
#####确定目标图像大小（如500*500）
#####生成前景图片：将博主图片拉伸至目标大小
#####剩下参考效果2的算法
*用gapp engine建一个类似--http://gist.github.com--(更好的例子是代码发芽网)的网站，用来''贴代码''
*做一个''Gallery网站''(比如wordpress主题Gallery)，可以参考帕兰印象[[这篇文章|http://paranimage.com/over-60-css-gallery-gallery-description-title-of/]]提到的网站做，也可以直接用[[这篇文章|http://paranimage.com/16-free-to-pay-wordpress-theme-download/]]提到的wordpress的CSS Gallery主题直接弄。再有[[这里|http://paranimage.com/27-open-source-image-manager/]]有一堆开源相册管理系统
*资源：真要做web开发时，参考[[这里|http://www.1stwebdesigner.com/resources/250-rss-feeds-for-every-graphic-web-designers-and-bloggers-to-subscribe-at/]]的blog资源。
*用GreaseMonkey做一个AlwaysSF的脚本，用来在留言显示的时候自己的留言总是SF
*做一个网站：用一个网页爬虫抓取相关信息，用Tokyo Cabinet保存，进行简单的处理，输出成网站。见这个[[视频|http://you.video.sina.com.cn/pg/topicdetail/topicPlay.php?tid=3421652&amp;uid=1267293610&amp;t=1#24265984]]中的介绍，他的代码在[[这里|http://github.com/hexuotzo/khufu/tree/5107c4ebc4848a27ab44c44ea9adbd9a13d75f0f]]
**或者就是个简单的新闻、图片网站，抓取各网站或者用户推荐的某一方面内容。见[[这里|http://www.douban.com/group/topic/7348717/]]
*在线拼音输入法，具体例子可见[[这里|http://www.imallen.com/pinyin/]]
*通过RSS将博客文章做成电子书：国外的例子见天涯海阁的[[介绍|http://www.web20share.com/2009/10/zinepal.html]]
&gt;目标：支持中文，支持feedsky和FeedBurner
*博客爬虫（并在自己网站上建立镜像）
**结构
***url feeder：用于分析分析页面，制定需要爬取的url规则，输出需要爬取的URL
***crawler：多线程+压缩传输+注意内存
&gt;&gt;参考：simplecd作者的[[使用python爬虫抓站的一些技巧总结：进阶篇|http://obmem.info/?p=753]]
***UI
***UI山寨工具：文章见[[山寨其他网站UI的一般性工具|http://obmem.info/?p=760]]，代码[[这里|http://fayaa.com/code/view/15377/]]
**特性
***支持增量：建立''索引''（文章url），或者爬取RSS
***支持参数配置：UI上配置，如代理（亦可自动切换），抓取间隔等等
**候选网站
***52NLP
***simplecd的[[作者|http://obmem.info/?tag=python]]，
*人人spider
&gt;发布博客模块（登陆+POST）
&gt;自动踩空间机（登陆+访问某人页面）
&gt;抓取校内某人的所有信息（个人资料、日志、状态、分享）
&gt;校内用户设置访问权限可能是一个需要找出和绕过的地方
*类似[[Daily Todo|http://www.dailytodo.org]]，但是提供轻重和缓急两个维度
*Google App Engine 
**抓取有意思的内容，如[[糗事百科|http://www.qiushibaike.com]]，定时推送到肉的手机上（可放在Google App Engine 上实现定时功能）
**模仿[[ohLife|http://ohlife.com/]]，定时向邮箱发一封邮件，内容为Blogger邮件发布文章的邮箱地址，回复即可记录每天心情、生活
**搞个自动跟新的网站IPv6地址文件，用于机器的代理自动配置文件调用（有V6地址的就不用挂代理了）
**NLTK的在线服务，参照[[这里|http://text-processing.com/demo/]]
*--在网页或者Blogger上放个计时器，20091130-now--
*类似玩聚SR，定制自己的推荐系统
**郑钧的思路
***《[[来，做一个社会化推荐引擎|http://www.cnblogs.com/zhengyun_ustc/archive/2008/12/22/ju690_sr.html]]》
***《[[一个想法从构思到实现只需7天|http://www.cnblogs.com/zhengyun_ustc/archive/2011/02/05/aboutidea.html]]》
***[[郑钧的博客文章|http://www.cnblogs.com/zhengyun_ustc/category/91013.html]]
***[[利用新浪微博API的Search接口做微博锐推榜|http://www.cnblogs.com/zhengyun_ustc/archive/2010/10/08/tBoard.html]]
**[[基于 Apache Mahout 构建社会化推荐引擎|http://www.ibm.com/developerworks/cn/java/j-lo-mahout/]]
*微博timeline信息重叠度分析与展示
**协助用户移除粉丝
**去重复信息，提高信息获取效率
*Phone Number to Words
**参照编程之美3.2
*github上参与项目
**如开源数据挖掘框架：[[pattern|http://www.clips.ua.ac.be/pages/pattern-en]]
!!!programming
*给DDD些一个前端，用python，或者直接CPP
*熟悉Unix Environment Programming，参考《卓有成效的程序员》，做一个''懒惰''、''傲慢''、''急躁''的程序员
*每日一句禅语(手机或电脑)，禅语集来自[[这里|http://docs.google.com/Doc?docid=0AXp8ETHQRmArZGc1OTVxczZfMjc1Y3BjNzc2aGY&amp;hl=en]]。或者是人生感悟之类的，如[[这里|http://docs.google.com/Doc?docid=0AXp8ETHQRmArZGc1OTVxczZfMzI4ZGs2cmJoYzc&amp;hl=en]]
*Constraints Programming
&gt;介绍：http://www.google.com.hk/search?sourceid=chrome&amp;ie=UTF-8&amp;q=constraints+programming
&gt;Google的工具：https://code.google.com/p/or-tools/wiki/Welcome
*构建自己的工具库（各种语言版本）：
**''profile''
**''Transcode''
**''common data structure''
*''SkyDrive Manager''
&gt;因为它不更新了，而且最新版也无法登陆了，故参照[[SkyDrive Manager|http://jinnsblog.blogspot.com/2009/08/skydrive-manager-file-downloader.html]]的界面，开发一个新的
*解数独问题
**参考[[Solving Every Sudoku Puzzle|http://norvig.com/sudoku.html]]，用Python
!!!Mobile APP
*语音日记
**单纯用语音所谓日记的缺点是：存储量大，检索不方便，查看不直观
**feature：语音识别（自动语音转文字），自动情感分类，加入图片
!!!语言学习
*用新语言来实现算法，既练习新语言，又复习算法
!!!思维体系
*工具：[[XMind|http://www.xmind.net]]
*例子：http://www.xmind.net/share/kenny_yuan/interview-bible/
!!!Algorithm
*货郎担(TSP)问题：很强大，很有用的算法，相信做map会用到不少这类算法。详见Delicious的tag(货郎担或TSP)
*Suffix Tree：字符串操作方面的算法发展到现在确实很强大，suffix tree就是其中一个，能解决不少问题。参照[[维基百科|http://en.wikipedia.org/wiki/Suffix_tree]]的资源以及硬盘上整理的论文即可；看到这个算法的缘由是做USACO上的一道题目，看[[网上的讨论|http://compsci.ca/v3/viewtopic.php?t=21923]]了解到的
!!!Love
Love letter：[[信纸完全折法|http://photo.renren.com/photo/261085754/album-359423184]]
!!!其他
*简历
**对于skills描述，可以以标签云或类似''微博关键字''的形式
**一些链接可以用二维码，如github的地址</pre>
</div>
<div title="Java与Python" modifier="teloon" created="201005261342" changecount="1">
<pre>参考[[python与java的链接嵌入互调|http://beijixuexiong.springnote.com/pages/2872534.xhtml]]
!!!Jython
所有资源（教程、文档、例子）：[[Jython Documentation and Learning|http://wiki.python.org/jython/DocumentationAndEducation]]</pre>
</div>
<div title="Java处理XML" modifier="wy" created="201007201449" modified="201009160807" changecount="14">
<pre>@@bgcolor(lightgreen):主要有三个选择：''DOM'', ''SAX'' and ''StAX''@@，见StackOverflow上的[[讨论|http://stackoverflow.com/questions/2446280/what-is-the-fastest-method-to-parse-xml]]
三篇介绍文章：
*[[Java API for XML Parsing(JAXP)演进[多图]|http://dev.firnow.com/course/3_program/java/javaxl/20100628/227641.html]]
*[[ JAXP(Java API for XML Parsing) |http://blog.csdn.net/sukyle/archive/2009/05/18/4199459.aspx]]
*IBM的文档：[[使用 SAX 处理 XML 文档|http://www.ibm.com/developerworks/cn/xml/x-saxhandle/index.html]]
&gt;对于SAX，其中的characters(char[] ch, int start, int length)函数，每次调用，参数ch的长度是有限的，所以可能content被分割成几部分，通过多次调用characters函数累加ch中需要的数据来得到，如上面IBM文档中程序的StringBuffer。

注：例子中依赖的解析包是xerces（即XMLReader所依赖的''org.apache.xerces.parsers.SAXParser''），在[[Apache主页|http://xerces.apache.org/]]下载，将压缩包中的''xercesImpl.jar''包导入项目即可。

@@bgcolor(lightgreen):其他开源项目@@
*[[apache common configuration|http://commons.apache.org/configuration/]]
&gt;[[使用apache common configuration读取配置文件或修改配置文件|http://www.suneca.com/article.asp?id=9]]

@@bgcolor(lightgreen):总结@@
|!需求|!选择|
| 读写XML配置文件 | apache common configuration |
| 解析XML内容（包括属性等） | SAX（可以用Properties类来保存得到的Attribute） |
| 解析超大XML文件 | SAX |</pre>
</div>
<div title="Java正则" modifier="wy" created="201007240823" modified="201007240853" changecount="16">
<pre>*基本的''查找''、''提取''、''替换''、''分割''操作见[[这里|http://java.chinaitlab.com/advance/350770.html]]
@@color(blue):注意@@：
提取操作的典型代码可以是这样的：
&lt;code Java&gt;
Pattern p = Pattern.compile(&quot;&lt;code&gt;(.+?)&lt;/code&gt;&quot;);
Matcher m = p.matcher(&quot;&lt;code&gt;xxxxxxxxo\noooooooooooo&lt;/code&gt;&quot;);
while(m.find()){
    for(int i=0; i&lt;m.groupCount(); i++)
	System.out.println(m.group(i+1));
}
&lt;/code&gt;
&gt;每次调用''m.find()''程序会在剩下的字符串中查找''pattern''；
&gt;''m.group()''和''m.group(0)''相同，代表匹配''@@color(red):整个@@''pattern的字符串；
&gt;''m.group(i)''，代表匹配第i个括号的字符串。其中i∈[1:groupCount()]，group是指pattern中括号包含的内容
*Greedy, Reluctant and Possessive
&gt;这几个模式都是针对数量词的，如{{{?、+、*}}}、{{{{m,n}}}}，参考[[JDK文档|http://download.oracle.com/docs/cd/E17476_01/javase/1.5.0/docs/api/index.html]]和[[Pattern Greedy, Reluctant, and Possessive 扫盲|http://www.javaeye.com/topic/690617]]
&gt;&gt;Greedy: 整个字符串开始匹配，然后慢慢的backs off，这样就能得到最大匹配串 
&gt;&gt;Reluctant: 从字符串的最开始开始匹配，慢慢的增加，所以匹配到的是最小字串 
&gt;&gt;Possessive: greeedy + no backs off，相当于整个字符串都塞进来看，结果.*就匹配了所有串

参考：
*[[regular-expressions.info|http://www.regular-expressions.info/tutorial.html]]</pre>
</div>
<div title="Junior（2ed）Extra Reading List" modifier="teloon" created="200902140824" modified="200902140840" changecount="7">
<pre>*《Computer Systems: A Progammer's Perspective》
*CPP:
**《CSAPP》
**《The C Programming Language》
**《Accelerated C++》 (if has time)
**《The C++ Programming Language》(if has more time)
*《你的灯亮着吗？》
*Algorithm
**《%教科书%》
**《Introduction To Algorithm, 2ed Edition》
**……（get more on [[douban|http://www.douban.com]]）</pre>
</div>
<div title="Junior（2ed）OutLine" modifier="teloon" created="200902140845" modified="200902140845" changecount="2">
<pre>Type the text for 'Junior（2ed）OutLine'</pre>
</div>
<div title="Junior（2ed）OutLines" modifier="teloon" created="200902140846" modified="200902140911" tags="outline plan todo" changecount="8">
<pre>*吸取大三上的教训：
##事倍功半，方法欠佳，没能抓住课程的特点
##要求不严格，目标不明确，得过且过
##计划性还不强，没有timestone
##心浮气躁
*需要保持：
##与同学多交流、合作
##学习时间增加了
*期望：
##保证分数的基础上，学好课程的核心东西。
##与时间为友，利用时间下脚料，勤思考、做笔记、多实践，不断审视自己花的时间是否值得
##养成良好的习惯，让理性占上风
##提升职业素养
##与实验室老师有一定接触，开始物色实习对象
*具体实施：(//总方针//： ''以分数为先决条件，课程为主线，附带学习巩固Java、CPP/C、算法'')
##每门课程孰轻孰重、孰难孰易，要花的时间孰多孰少都要心中有数
##每门课都有自己的学习、理解目标，在学的时候至少都要理解
##每个阶段、每个任务都应有timestone</pre>
</div>
<div title="Linux" modifier="wy" created="200902210756" modified="201304080910" tags="linux" changecount="36">
<pre>&lt;html&gt;&lt;font size=4 color=purple&gt;&lt;b&gt;About this: A collect of records about my road of Linux.&lt;/b&gt;&lt;/font&gt;&lt;/html&gt;
!!!Linux Kernel
*[[内核中针对proc文件系统的编程函数总结]]
*[[32位Ubuntu支持超过4G内存的方法]]
!!!Bash
*[[grep命令]]
*[[如何查找命令的源码]]
*[[重新(Reload)加载Bash环境变量]]
*[[ubuntu上对apt/bash加上代理（proxy）]]
!!!系统安装与配置
*[[硬盘安装Linux]]
*[[网络安装Linux]]
*[[用fstab挂载分区]]
*[[挂载大于2T硬盘]]
*[[Howto:Recover your username and password/Fix Grub 21 Error in Ubuntu]]
*[[配置vsftpd]]
*[[硬盘分区]]
!!!系统管理
*[[实时同步小文件]]
*[[Windows和Linux共享文件]]
[[Software]]中的Linux部分
</pre>
</div>
<div title="LoadRemoteFileThroughProxy" modifier="YourName" created="200703202229" modified="201110110509" tags="systemConfig" server.page.revision="201110110509" server.host="telooon.tiddlyspot.com" server.type="file">
<pre>/***
|''Name:''|LoadRemoteFileThroughProxy (previous LoadRemoteFileHijack)|
|''Description:''|When the TiddlyWiki file is located on the web (view over http) the content of [[SiteProxy]] tiddler is added in front of the file url. If [[SiteProxy]] does not exist &quot;/proxy/&quot; is added. |
|''Version:''|1.1.0|
|''Date:''|mar 17, 2007|
|''Source:''|http://tiddlywiki.bidix.info/#LoadRemoteFileHijack|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0|
***/
//{{{
version.extensions.LoadRemoteFileThroughProxy = {
 major: 1, minor: 1, revision: 0, 
 date: new Date(&quot;mar 17, 2007&quot;), 
 source: &quot;http://tiddlywiki.bidix.info/#LoadRemoteFileThroughProxy&quot;};

if (!window.bidix) window.bidix = {}; // bidix namespace
if (!bidix.core) bidix.core = {};

bidix.core.loadRemoteFile = loadRemoteFile;
loadRemoteFile = function(url,callback,params)
{
 if ((document.location.toString().substr(0,4) == &quot;http&quot;) &amp;&amp; (url.substr(0,4) == &quot;http&quot;)){ 
 url = store.getTiddlerText(&quot;SiteProxy&quot;, &quot;/proxy/&quot;) + url;
 }
 return bidix.core.loadRemoteFile(url,callback,params);
}
//}}}</pre>
</div>
<div title="MainMenu" modifier="teloon" created="200902091105" modified="201005230312" changecount="31">
<pre>!Catalog
[[Algorithm&amp;DS]]
[[code]]
[[Inspiration]]
[[Linux]]
[[OS]]
[[Project]]
[[Research]]
[[Software]]
[[WebApp]]
[[Others]]
!About Tiddly
[[About this]]
[[GettingStarted]]
@@color(blue):Version@@ @@&lt;&lt;version&gt;&gt;@@</pre>
</div>
<div title="MySQL命令行常用命令" modifier="YourName" created="201003230900" changecount="1">
<pre>**{{{mysql -h hostname -u root -p}}}
**mysql&gt;{{{create database [databasename];}}}
**mysql&gt;{{{show databases;}}}
**mysql&gt;{{{use [db name];}}}
**mysql&gt;{{{show databases;}}}
**mysql&gt;{{{show tables;}}}
**mysql&gt;{{{describe [table name];}}}&lt;//show structure of a database//&gt;
**mysql&gt;{{{drop database [database name];}}}&lt;//delete a database//&gt;
**mysql&gt;{{{drop table [table name];}}}
**mysql&gt;{{{SELECT * FROM [table name] WHERE name != &quot;Bob&quot; AND phone_number = '3444444' order by phone_number;}}}
**mysql&gt;{{{SELECT * FROM [table name] WHERE name like &quot;Bob%&quot; AND phone_number = '3444444' limit 1,5;}}}&lt;//limit to records 1 through 5.//&gt;
**mysql&gt;{{{SELECT * FROM [table name] WHERE rec RLIKE &quot;^a&quot;;}}}&lt;//Use &quot;REGEXP BINARY&quot; to force case-sensitivity. This finds any record beginning with a.//&gt;
**mysql&gt;{{{SELECT DISTINCT [column name] FROM [table name];}}}
**mysql&gt;{{{SELECT [col1],[col2] FROM [table name] ORDER BY [col2] DESC;}}}
**mysql&gt;{{{SELECT COUNT(*) FROM [table name];}}}&lt;{{{SUM}}}&gt;
**Creating a new user. Login as root. Switch to the MySQL db. Make the user. Update privs.
&gt;&gt;mysql&gt;{{{use mysql;}}}
&gt;&gt;mysql&gt;{{{INSERT INTO user (Host,User,Password) VALUES('%','username',PASSWORD('password'));}}}
&gt;&gt;mysql&gt;{{{flush privileges;}}}
**{{{mysqladmin -u username -h hostname.blah.org -p password 'new-password'}}}&lt;//Change a users password from unix shell.//&gt;
**Change a users password from MySQL prompt. Login as root. Set the password. Update privs.
&gt;&gt;mysql&gt;{{{SET PASSWORD FOR 'user'@'hostname' = PASSWORD('passwordhere');}}}
&gt;&gt;mysql&gt;{{{flush privileges;}}}
**{{{#mysqladmin -u root password newpassword}}} &lt;//Set a root password if there is on root password.//&gt;
**Allow the user &quot;bob&quot; to connect to the server from localhost using the password &quot;passwd&quot;. Login as root. Switch to the MySQL db. Give privs. Update privs.
&gt;&gt;mysql&gt;{{{use mysql}}}
&gt;&gt;mysql&gt;{{{grant usage on *.* to bob@localhost identified by 'passwd';}}}
&gt;&gt;mysql&gt;{{{flush privileges;}}}
**mysql&gt;{{{UPDATE [table name] SET Select_priv = 'Y',Insert_priv = 'Y',Update_priv = 'Y' where [field name] = 'user';}}}
**mysql&gt;{{{alter table [table name] drop column [column name];}}}&lt;//delete a column//&gt;
**mysql&gt;{{{alter table [table name] add column [new column name] varchar (20);}}}
**mysql&gt;{{{alter table [table name] change [old column name] [new column name] varchar (50);}}}
**mysql&gt;{{{alter table [table name] add unique ([column name]);}}}
**mysql&gt;{{{alter table [table name] modify [column name] VARCHAR(3);}}}
**mysql&gt;{{{alter table [table name] drop index [colmn name];}}}
**Load a CSV file into a table.
&gt;&gt;mysql&gt;{{{LOAD DATA INFILE '/tmp/filename.csv' replace INTO TABLE [table name] FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n' (field1,field2,field3);}}}
**mysql&gt;{{{mysqldump -c -u username -ppassword databasename tablename &gt; /tmp/databasename.tablename.sql}}}</pre>
</div>
<div title="OS" modifier="teloon" created="200904101423" modified="200905010445" tags="OS" changecount="6">
<pre>*[[不同文件系统的文件大小及分区大小限制]]
*[[分页 分段 缺页的通俗解释]]</pre>
</div>
<div title="On the Evolution of Clusters of Near-DuplicateWeb Pages" modifier="wy" created="200907110121" modified="200907110521" changecount="4">
<pre>Dennis Fetterly   Microsoft Research    1065 La Avenida     Mountain View, CA 94043     fetterly@microsoft.com
Mark Manasse   Microsoft Research    1065 La Avenida     Mountain View, CA 94043     manasse@microsoft.com
Marc Najork       Microsoft Research    1065 La Avenida     Mountain View, CA 94043     najork@microsoft.com

!!!Abstract
We found that ''29.2%'' of all web pages are ''very similar'' to other pages, and that ''22.2%'' are ''virtually identical'' to other pages.We also found that clusters of near-duplicate documents are ''fairly stable'': Two documents that are near-duplicates of one another are very likely to still be near-duplicates 10 weeks later.

!!!Concepts
''Similarity of two documents''
&gt;number of distinct shingles appearing in both documents divided by total number of distinct shingles

!!!Experimental Framework
&gt;Crawled HTML Documents
&gt;&gt;Remove HTML Tags, get pure text
&gt;&gt;&gt;Segment into 5-word shingles
&gt;&gt;&gt;&gt;Compute 64-bit checksum of each shingle(get ''pre-image''), using ''Robin's fingerprinting algorithm''
&gt;&gt;&gt;&gt;&gt;Apply 84 one-one function to each pre-image, get pre-images' ''images''
&gt;&gt;&gt;&gt;&gt;&gt;For each ''function'', get the ''pre-images'' whose image is numerically smallest; Thus get 84 pre-images.({{{Sampling}}})
&gt;&gt;&gt;&gt;&gt;&gt;&gt;Get 6 ''supershingles''(supershingle represents the concatenation of 14 adjacent pre-images)
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;To each document, concatenate all pairs of distinct supershingles, thus getting 6 choose 2(15) ''megashingles''
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;Using ''hashtable'', get &lt;megashingles ,DocumentID&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;Maintain cluster, build Union-Find data structure.</pre>
</div>
<div title="Others" modifier="YourName" created="200908111537" modified="201106080401" changecount="14">
<pre>[[Book]]
[[Blog]]
[[Commands]]
[[Wiki]]
[[数据库大作业]]
[[Tokyo Cabinet数据库]]
[[笔&amp;面试题]]
[[Word长篇文档排版技巧]]
[[iTouch指南]]
[[液晶电视(带网络功能)备选]]</pre>
</div>
<div title="PasswordOptionsPlugin" modifier="YourName" created="200704220851" modified="201110110509" tags="systemConfig" server.page.revision="201110110509" server.host="telooon.tiddlyspot.com" server.type="file">
<pre>/***
|''Name:''|PasswordOptionPlugin|
|''Description:''|Extends TiddlyWiki options with non encrypted password option.|
|''Version:''|1.0.2|
|''Date:''|Apr 19, 2007|
|''Source:''|http://tiddlywiki.bidix.info/#PasswordOptionPlugin|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0 (Beta 5)|
***/
//{{{
version.extensions.PasswordOptionPlugin = {
	major: 1, minor: 0, revision: 2, 
	date: new Date(&quot;Apr 19, 2007&quot;),
	source: 'http://tiddlywiki.bidix.info/#PasswordOptionPlugin',
	author: 'BidiX (BidiX (at) bidix (dot) info',
	license: '[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D]]',
	coreVersion: '2.2.0 (Beta 5)'
};

config.macros.option.passwordCheckboxLabel = &quot;Save this password on this computer&quot;;
config.macros.option.passwordInputType = &quot;password&quot;; // password | text
setStylesheet(&quot;.pasOptionInput {width: 11em;}\n&quot;,&quot;passwordInputTypeStyle&quot;);

merge(config.macros.option.types, {
	'pas': {
		elementType: &quot;input&quot;,
		valueField: &quot;value&quot;,
		eventName: &quot;onkeyup&quot;,
		className: &quot;pasOptionInput&quot;,
		typeValue: config.macros.option.passwordInputType,
		create: function(place,type,opt,className,desc) {
			// password field
			config.macros.option.genericCreate(place,'pas',opt,className,desc);
			// checkbox linked with this password &quot;save this password on this computer&quot;
			config.macros.option.genericCreate(place,'chk','chk'+opt,className,desc);			
			// text savePasswordCheckboxLabel
			place.appendChild(document.createTextNode(config.macros.option.passwordCheckboxLabel));
		},
		onChange: config.macros.option.genericOnChange
	}
});

merge(config.optionHandlers['chk'], {
	get: function(name) {
		// is there an option linked with this chk ?
		var opt = name.substr(3);
		if (config.options[opt]) 
			saveOptionCookie(opt);
		return config.options[name] ? &quot;true&quot; : &quot;false&quot;;
	}
});

merge(config.optionHandlers, {
	'pas': {
 		get: function(name) {
			if (config.options[&quot;chk&quot;+name]) {
				return encodeCookie(config.options[name].toString());
			} else {
				return &quot;&quot;;
			}
		},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	}
});

// need to reload options to load passwordOptions
loadOptionsCookie();

/*
if (!config.options['pasPassword'])
	config.options['pasPassword'] = '';

merge(config.optionsDesc,{
		pasPassword: &quot;Test password&quot;
	});
*/
//}}}</pre>
</div>
<div title="Project" modifier="YourName" created="201003200904" modified="201004221354" changecount="29">
<pre>!!!zhaoren.me
!!!!MySQL与的Django中文配置
编码要统一，由于Django默认是UTF8，所以MySQL最好也都统一成UTF8
1，MySQL配置
#在''建立数据库之前''，配置MySQL的配置文件，参考：[[这里|http://xanderzhang.javaeye.com/blog/465545]]，搜索其中的utf8配置项进行配置
#建立数据库（可用Django的''syncdb''命令自动创建）
#进入MySQL命令行，用命令：{{{SHOW VARIABLES LIKE &quot;chara%&quot;}}}来查看编码，正常应该是除了一个为''binary''以外，其他都是''utf8''；用命令{{{SHOW VARIABLES LIKE &quot;colla%&quot;}}}查看collation信息
&gt;如果有以后数据，那么参考[[这里|http://blog.jxwmw.cn/u/2/archives/2008/2805.html]]和[[这里|http://blog.chinaunix.net/u2/88611/showart_2079839.html]]

2，Django配置
#参照上面那篇[[文章|http://xanderzhang.javaeye.com/blog/465545]]，主要设置DEFAULT_CHARSET
!!!!sqlalchemy中文问题
参考[[这篇|http://firefish.blog.51cto.com/298258/112794]]文章，只需''传递参数(charset=utf8)即可''
&gt;{{{create_engine('mysql://uid:pwd@localhost/mydb?charset=utf8', echo=True)}}}

!!!52Pai
!!!!flickr照片上传器
源码：[[这里|http://code.google.com/p/teloon-works/source/browse/trunk/python/picuploadflickr.py]]
编码可能涉及的库：
&gt;ClientCookie 用来结果Cookies交接的问题（如从HOST为.yahoo.com跳到.flickr.com）
&gt;ClientForm 用来提交Form
&gt;BeautifulSoup
''参考文献''：
&gt;[[康爷的博客|http://kangye.org/get-started-with-flickr-api]]
&gt;[[Flickr API官方文档|http://www.flickr.com/services/api/]]
&gt;[[申请Flickr API key的地址|http://www.flickr.com/services/api/keys/apply/]]
&gt;[[Flickr Authentication API使用的官方介绍|http://www.flickr.com/services/api/auth.spec.html]]
&gt;[[Flickr API的Python类库|http://www.stuvel.eu/projects/flickrapi]]
!!!!Image Resizer 4 Mobile Phone
源码在GoogleCode上：[[传送门|http://code.google.com/p/teloon-works/source/browse/trunk/java/ImageResizer/JPGResizer.java]]
基本思路：
#用JPEGDecoder读取jpg的头信息以及像素矩阵：[[传送门|http://blog.csdn.net/hunhun1981/archive/2008/04/10/2276086.aspx]]，亦可用''com.sun.image.codec.jpeg.JPEGImageDecoder''，但未尝试
#用最邻近插值算法和双线性内插值算法缩小图像，生成新的像素矩阵：[[传送门1|http://blog.csdn.net/qiqi5521/archive/2008/03/22/2207562.aspx]],[[传送门2|http://blog.csdn.net/alucardpj/archive/2005/12/08/547045.aspx]], [[传送门3|http://school.ogdev.net/ArticleShow.asp?id=5740&amp;categoryid=5]]
#用如下方法生成JPEG图像：
**以像素矩阵为参数构造MemoryImageSource对象mi
**生成Image对象
&gt;{{{im = mi.createImage(mi);}}}
**生成BufferedImage对象
&gt;{{{BufferedImage bi = new BufferedImage(outputWidth, outputHeight, BufferedImage.TYPE_INT_RGB);}}}
**写入Image对象im：
&gt;{{{Graphics2D biContext = bi.createGraphics();}}}
&gt;{{{biContext.drawImage(outputImage, 0, 0, null);}}}
**Encoding：
&gt;&gt;{{{// Note that additional drawing such as watermarks or logos can be placed here.}}}
&gt;&gt;{{{// com.sun.image.codec.jpeg package is included in sun and ibm sdk 1.3}}}
&gt;{{{JPEGImageEncoder encoder = JPEGCodec.createJPEGEncoder(outputStream);}}}
&gt;&gt;{{{// The default quality is 0.75.}}}
&gt;{{{JPEGEncodeParam jep = JPEGCodec.getDefaultJPEGEncodeParam(bi);}}}
&gt;{{{jep.setQuality(outputQuality, true);}}}
&gt;{{{encoder.encode(bi, jep);}}}
&gt;&gt;{{{// encoder.encode( bi );}}}
&gt;{{{outputStream.flush();}}}

参考：
*[[Java数字图像处理常用算法|http://pengxiao.blog.ccidnet.com/blog-htm-do-showone-uid-64111-type-blog-itemid-202105.html]]
*[[ 图形图像处理－之－高质量的快速的图像缩放系列|http://blog.csdn.net/housisong/category/325273.aspx?PageNumber=2]]
*[[用java保存位图文件|http://blog.sina.com.cn/s/blog_4ee74fe201000dht.html?retcode=0]]

!!!版本管理
!!!!git
教程：
#简明教程：[[这里|http://blog.interlinked.org/tutorials/git.html]]和[[Linux kernel|http://www.kernel.org/pub/software/scm/git/docs/gittutorial.html]]
#[[git&amp;github on windows|http://kylecordes.com/2008/04/30/git-windows-go]]
#[[看日记学git|http://roclinux.cn/?p=178]]
*原理流程
[img[http://blog.interlinked.org/static/images/git/high-level-commands.png]]
!!!!SVN
培训教程：[[从VSS到SVN|http://lilyonwind.spaces.live.com/blog/cns!74592F9522995EEF!231.entry]]</pre>
</div>
<div title="PyQt" modifier="wy" created="201009171557" modified="201009190436" changecount="11">
<pre>[[学习PyQt之资料收集篇|http://vvonderblog.appspot.com/2009/12/22/learning-pyqt-about-resources.html]]
[[pyqt编写的程序如何发布|http://blog.linjunhalida.com/tag/python-pyqt/]]

*@@bgcolor(lightblue):实例@@
**[[PyQt编写Google翻译客户端程序|http://vvonderblog.appspot.com/2009/12/23/pyqt-google-translate-client.html]]
**[[PyQt4 编程简介与实例|http://pyqt-doc-cn.googlecode.com/svn/trunk/Introduction_to_PyQT4/doc/r54/index.html]]
**PyQt界面与事件分离：[[在Eric4下用PyQt4编写Python的图形界面程序|http://hi.baidu.com/runningon/blog/item/115662279ff36a06918f9d0b.html]]</pre>
</div>
<div title="Python Debugging" modifier="YourName" created="201103070430" modified="201104241147" changecount="4">
<pre>*{{{import code;code.interact(local=locals())}}}
*{{{import pdb;pdb.set_trace()}}}
&gt;抑或{{{ipdb}}}，更好地彩色显示
*{{{import logging;logging.basicConfig(level=...);logging.debug(&quot;...&quot;)}}}
&lt;code python&gt;
#获得断点的信息
import logging
log = logging.getLogger('')  # generic channel ''
log.debug('blah')            # path and line number reported correctly
...
&lt;/code&gt;
*IDLE、Pydev都有debugger

参考1：[[Python Debugging Techniques|http://aymanh.com/python-debugging-techniques]]</pre>
</div>
<div title="Python处理XML" modifier="wy" created="201007141439" modified="201009061645" changecount="3">
<pre>!!!小文件，不考虑性能
可以使用[[BeautifulSoup|http://stackoverflow.com/questions/1922032/parsing-html-in-python-lxml-or-beautifulsoup-which-of-these-is-better-for-what]]，它接口比较清晰明了。
!!!较大文件，考虑性能
看[[这里|http://blog.ianbicking.org/2008/03/30/python-html-parser-performance/]]的性能比较，lxml有绝对的优势，不过没用过。也[[有人说|http://stackoverflow.com/questions/1922032/parsing-html-in-python-lxml-or-beautifulsoup-which-of-these-is-better-for-what]]BeautifulSoup不再维护了，而且lxml也提供了BS的接口形式（lxml.soupparser），有空可以试试。但貌似它也是要将文件载入内存的，待证实。
!!!极大文件，考虑性能
需要顺序遍历文件，选择cElementTree，详见这里的讨论：[[What is the fastest way to parse large XML docs in Python?|http://stackoverflow.com/questions/324214/what-is-the-fastest-way-to-parse-large-xml-docs-in-python]]。从[[Benchmark|http://effbot.org/zone/celementtree.htm#benchmarks]]来看，性能很不错。测试来看，肯定是顺序遍历的，因为对一个2.5G的XML文件操作表示压力不大。
*相关资源
&gt;元素遍历的例子：[[官网|http://effbot.org/zone/element-iterparse.htm]]
&gt;官方的一些文档：[[这里|http://effbot.org/zone/element-index.htm#documentation]]
&gt;一些元素操作的API：[[好用的python cElementTree|http://blog.csdn.net/gisocean/archive/2007/12/08/1924580.aspx]]
*缺点
&gt;容错性较差，在遇到一些特殊字符时容易出错（如邱博的百度知道语料line 2258, column 28）</pre>
</div>
<div title="Python处理cvs, xls, xlsx" modifier="YourName" created="201101210741" modified="201101210744" changecount="2">
<pre>*[[python-excel|http://www.python-excel.org/]]
**‘’例子‘’见[[Read Excel files from Python|http://scienceoss.com/read-excel-files-from-python/]]
**‘’缺点‘’是不能处理xlsx
*[[openpyxl|http://ericgazoni.wordpress.com/2010/04/10/openpyxl-python-xlsx/]]
**用于写xlsx，这篇文章中提到了已有的一些读xlsx的方法
*使用''pywin32''
**他能''读写xlsx''
**见介绍：[[Python Excel Mini Cookbook|http://www.pythonexcels.com/2009/10/python-excel-mini-cookbook/]]</pre>
</div>
<div title="Python文件操作" modifier="YourName" created="201012121052" modified="201012121052" changecount="2">
<pre>*遍历文件树
&gt;os.walk
&gt;&gt;参考[[这里|http://blog.csdn.net/foyuan/archive/2007/07/28/1713659.aspx]]
*文件以及目录操作
&gt;参考[[这里|http://www.phpfans.net/article/htmls/201004/Mjg0MDAy.html]]
*读取文件
**读取所有或指定字节数
&gt;&gt;read(), read(N)
**按行读取
&gt;&gt;readline(), readlines()
&gt;&gt;&gt;更有效率的生成器：{{{(l for l in open('xxx.txt', 'r'))}}}</pre>
</div>
<div title="Python文件系统操作" modifier="YourName" created="201012111454" modified="201012111507" changecount="7">
<pre>*遍历目录
&gt;''os.walk''
&gt;&gt;返回类似'' [('C:\\&quot;,['System','Program','Windows','Temp'],['sys.page','a.txt']),...] ''
**参考[[这里|http://blog.csdn.net/foyuan/archive/2007/07/28/1713659.aspx]]
**其他包括''拷贝''、''删除''、''移动''、''重命名''、''文件名切割''、''扩展名切割''等等见[[Python 操作文件及目录|http://www.91linux.com/html/article/program/python/20100414/19191.html]]
*Python读取文件内容
&gt;读取全部内容、按行、按字节、生成器等，见[[Python读取文件|http://book.51cto.com/art/201005/198283.htm]]和[[如何让我读一次两行从文件中使用Python|http://audbel.com/0/9927561]]
{{{
	for line in (l for l in open(&quot;D:/work/torte.vim&quot;, 'r')):
	...print line
}}}</pre>
</div>
<div title="Python访问数据库" modifier="YourName" created="201009260832" modified="201104120247" changecount="7">
<pre>!!!访问MySQL
MySQLdb模块：[[Writing MySQL Scripts with Python DB-API|http://www.kitebird.com/articles/pydbapi.html]]
*问题
**默认它是全读进内存，在大数据的情况下如何一行行读？
&gt;解决：默认其实是Client模式（见[[文档|http://mysql-python.sourceforge.net/MySQLdb-1.2.2/public/MySQLdb.cursors-module.html]]），即将结果保存在Client端，可以通过设置cursor参数保存在Server端，见StackOverflow的讨论[[How to get a row-by-row MySQL ResultSet in python|http://stackoverflow.com/questions/337479]]
!!!访问oracle
*''cx_Oracle''+''Oracle Instant Client''
**ziclix：[[Python在Windows下如何连接Oracle数据库|http://star-word.appspot.com/2010/09/11/python_window_oracle_library.html]]
&gt;问题：出现{{{Unable to acquire Oracle environment handle}}}错误，暂无解决方案。可能''完全安装''Oracle可行，但''未尝试''
*''Jython''+''ojdbc''
**教程：[[使用Jython连接Oracle |http://zrmeng.itpub.net/post/4141/18365]]
&gt;安装jython，下载oracle instant client
&gt;需要两个包：''zxJDBC.JAR''和''ojdbc*.jar''，他们分别在''jython.jar''和instant client中的''ojdbc6.jar''，将这两个包加入''CLASSPATH''即可
&gt;将下面代码存为test.py，运行jython test.py即可
&lt;code python&gt;
from com.ziclix.python.sql import zxJDBC
d,u,p,v=&quot;jdbc:oracle:thin:@172.16.5.15:1521:abc&quot;,&quot;username&quot;,&quot;password&quot;,&quot;oracle.jdbc.driver.OracleDriver&quot;
db=zxJDBC.connect(d,u,p,v)
c=db.cursor()
c.execute(&quot;select 'aaa' from dual&quot;)
for a in c.fetchall():
  print a
c.close
db.close
&lt;/code&gt;
**''DriverManager''：直接当作java来写，参照[[java访问oracle|http://www.programfan.com/article/2843.html]]
&lt;code python&gt;
    driver = &quot;oracle.jdbc.driver.OracleDriver&quot;
    url = &quot;jdbc:oracle:thin:@10.141.200.199:1522:orcl&quot;
    db = DriverManager.getConnection(url, 'system', 'admin')
    st = db.prepareStatement(&quot;select * from ILLEGAL_DOC&quot;)
    res = st.executeQuery()
&lt;/code&gt;</pre>
</div>
<div title="Research" modifier="YourName" created="201005230312" modified="201012090856" changecount="66">
<pre>!!Parse Tree
@@bgcolor(red): Tools@@
*''Stanford Parser''
#以多种[[Treebank|http://en.wikipedia.org/wiki/Treebank]]的形式''输出''，单独遍历树的内容在''{{{edu.stanford.nlp.trees.Tree}}}''
#若要''读取Treebank''，则可参照''{{{edu.stanford.nlp.trees,PennTreeReader}}}''的方式，一篇[[博客说明|http://blog.outerthoughts.com/2007/06/laying-out-penn-treebank-output-of-stanford-parser/]]
*''图形化输出''
#''Graphviz''(Java)
&gt;见博客[[visualizing-citeulike-collections|http://blog.outerthoughts.com/2009/01/visualizing-citeulike-collections/]]和[[laying-out-penn-treebank-output-of-stanford-parser|http://blog.outerthoughts.com/2007/06/laying-out-penn-treebank-output-of-stanford-parser/]]提到的

[[评价标准(Evaluation)]]


!!语料库
*''英文''
#''[[WordNet|http://wordnet.princeton.edu/]]''® is a large lexical database of English,developed under the direction of George A. Miller. Nouns, verbs, adjectives and adverbs are grouped into sets of cognitive synonyms (synsets).

!!Papers
*''Duplicate Document Detection''
[[Finding Similar Files in Large Document Repositories]]
[[Design and Implementation of a High-Performance Distributed Web Crawler]]
[[A systematic study on parameter correlations in large scale duplicate document detection]]
[[On the Evolution of Clusters of Near-DuplicateWeb Pages]]
[[Using Bloom Filters to Reﬁne Web Search Results]]
[[一种基于LCS 的相似网页检测算法]]
[[unassorted]]</pre>
</div>
<div title="ResourceLinks" modifier="teloon" created="200902090421" tags="Resources tutorials" changecount="1">
<pre>Here is an incomplete list of some excellent TiddlyWiki resource pages. If you want to be listed here, just email me at &quot;jim at barr dot net&quot; and I will gladly add your site!

|[[TiddlyWiki|http://TiddlyWiki.com]] |Jeremy Ruston's official home of TiddlyWiki |
|[[TiddlyForge|http://www.tiddlyforge.net]] |A news and Plugin/macro resource site from Devon Jones |
|[[Monkey Pirate TiddlyWiki|http://simonbaird.com/mptw/]] |Simon Baird's excellent [[TagglyTagging|http://simonbaird.com/mptw1/#TagglyTagging]] site |
|[[TiddlyTools|http://www.elsdesign.com/tiddlywiki/tiddlytools.html]] |ELS Design Studios' Tools page featuring lots of excellent Plugins |
|[[Tutorial|http://www.blogjones.com/TiddlyWikiTutorial.html]] |A hands-on Tutorial|
|[[Overview|http://euicho.com/index.php?p=123]] |A great overview of TiddlyWiki by Euicho|
|[[TiddlyWikiTips|http://TiddlyWikiTips.com]] |TiddlyWiki Tips Resource (This site!) |
|[[zRenard's TiddlyWiki Tips|http://www.zrenard.com/tiddlywiki/]] |Some Tips, Tools, and Styles for TiddlyWiki |
|[[TiddlyWiki discussion forum|http://groups.google.com/group/TiddlyWiki]] |A Google Group devoted to all things TiddlyWiki |
|[[Developer discussion forum|http://groups.google.com/group/TiddlyWikiDev]] |A Google Group focusing on TiddlyWiki development |
|[[TiddlyWikiRequests|http://groups.google.com/group/TiddlyWikiRequests?lnk=li]] |A Google Group managing feature request discussions |</pre>
</div>
<div title="STL二三事" modifier="teloon" created="200908120512" modified="200911211457" tags="stl" changecount="25">
<pre>*''adapter''
**''stack''
&gt;可用deque（默认）、vector、list实现
**''queue''
&gt;可用deque（默认）、list实现
**''priority_queue''
&gt;可用vector（默认）、deque、最大（小）化堆

*''priority_queue的内部排序''
priority_queue默认是按最大化堆排列的，所以如果用默认的less比较函数(或者functor)，pop操作出来的是值最大的元素(即堆的根节点)，相反如果显式地传入greater(STL提供)函数或者自定义的greater比较函数(或functor)，则是按照最小堆排列的，pop出来的是最小值。
''注：'' 如果要自己制定比较函数（或Functor），那么必须是''3个参数''，即''第二个''必须指定用什么容器实现优先队列；

见代码：
&lt;code c&gt;
#include &lt;iostream&gt;
#include &lt;queue&gt;
#include &lt;vector&gt;

using namespace std;

class mycomparison
{
  bool reverse;
public:
  mycomparison(const bool&amp; revparam=false)
    {reverse=revparam;}
  bool operator() (const int&amp; lhs, const int&amp;rhs) const
  {
    if (reverse) return (lhs&gt;rhs);
    else return (lhs&lt;rhs);
  }
};

int main ()
{
  // using mycomparison:
  priority_queue&lt; int, ''vector&lt;int&gt;'', mycomparison &gt; fourth(mycomparison(false));

  fourth.push(10);
  fourth.push(60);
  fourth.push(50);
  fourth.push(20);
  for(int i=0; i&lt;4; ++i){
	cout &lt;&lt; fourth.top() &lt;&lt; &quot; &quot;;
	fourth.pop();
}

  return 0;
}
&lt;/code&gt;

输出：
&gt;10 20 50 60
如果把true改成false就是默认的less比较，输出“60 50 20 10”

*''容器中的begin和front''
两者都是指向容器的第一个元素，不同的在于begin返回的是迭代器，需要进一步用指针操作符才能得到元素，而front直接返回元素，可以对元素进行+1,-1操作等等。详见cplusplus文档

*''list中的merge操作的过程''
如下官方解释：
&gt;The merging is performed using two iterators: one to iterate through x and another one to keep the insertion point in the list object; During the iteration of x, if the current element in x compares less than the element at the current insertion point in the list object, the element is removed from x and inserted into that location, otherwise the insertion point is advanced. This operation is repeated until either end is reached, in which moment the remaining elements of x (if any) are moved to the end of the list object and the function returns (this last operation is performed in constant time).
总之是有两个''单向''的指针，是一直往前的，找到位置就插入(并删除本身)，直到结束

*''list的remove_if函数''
以Predicate类为参数，它他也是个functor，重载()操作符；或者也可以用比较函数为参数，不过只要返回bool就好了，不管是&lt;还是&gt;还是==，因为它只是作为一个条件存在。详见[[这里|http://www.cplusplus.com/reference/stl/list/remove_if/]]
也可以用STL的not_euqal_to&lt;int&gt;(),less&lt;int&gt;()操作等，需要的只是把这些操作的第二个参数固定(或者说绑定)，用的函数是bind2nd()。详见[[cplusplus|http://www.cplusplus.com/reference/std/functional/bind2nd/]]

*''STL内部各种算法、结构的实现''
#''stable_sort''是稳定的排序，因为他是用merge sort实现的
#''sort''在n&lt;10的时候也是稳定的，因为这时是插入排序
#''set''通常是红-黑树实现，这样查找、插入、删除的代价都是O(log(n))的
#''stack''默认是用deque来实现，但在初始化的时候可以指定为vector或list
#''queue''默认也是用deque来实现，但在初始化的时候可以指定为list（''不能使vector''，因为无法pop_front）

*''一些容易忘记的函数''
1,''排序''
&gt;''partial_sort''、''partial_sort_copy''、''partition''
2,''deque''
&gt;''merge''、''insert(pos, size, value)''
3,''list''
&gt;''splice''、''remove_if(bind2nd(not_equal_to&lt;int&gt;(), value))''
4, ''deque''
&gt;''erase''、''insert''、双端操作及取值
5, ''bitset''
&gt;''constructor'', ''set'',''any'',''none'',''flip'', ''operator[]'',</pre>
</div>
<div title="STL容器中指针作为元素" modifier="wy" created="200908081346" modified="200908240936" tags="智能指针 指针 STL 容器" changecount="3">
<pre>容器中insert操作是拷贝对象的，当容器的元素较大时，会引起效率问题，这时要用指针。
STL中默认的是aotu_ptr，是一个智能指针，他会帮你管理内存，但是它不是完美的，在容器中的一个重大问题就是会产生指针所有权转移的问题，这也是C++标准强烈反对在容器中使用auto_ptr的原因。所以要用更智能的指针才行。
选择时首先要考虑是否胜任，其次考虑效率。具体没有研究过，可以参考Effective STL和[[这里|http://www.cppblog.com/expter/archive/2009/03/29/78270.aspx]]，暂时用的是boost的[[shared_ptr|http://www.boost.org/doc/libs/1_39_0/libs/smart_ptr/shared_ptr.htm]]

具体讨论见YSSY C板版主的[[解释|http://bbs.sjtu.edu.cn/bbstcon,board,C,reid,1251073759.html]]</pre>
</div>
<div title="STL容器和算法的选择" modifier="wy" created="200908290841" modified="200908290925" changecount="6">
<pre>|!需求|!选择|
|''自排序''的容器|set、map|
|''随机''访问|vector、deque|
|内部''删除''|考虑效率：list自带的erase(itr)和remove、remove_if&lt;删除全部&gt;；不考虑效率：vector+自带的erase(itr)或remove&lt;删除全部&gt;|
|内部''插入''|deque,list,vector|
|双端''插入''、''删除''|deque,list,queue|
|FILO|stack|
|''查找''单个|1,  map,set的find&lt;键查找&gt;；2,  ''find,find_if''&lt;algorithm&gt;|
|''查找''&quot;子串&quot;|''search,find_end''&lt;algorithm&gt;|
|''查找''&quot;子串&quot;中的一个|''find_first_of''&lt;algorithm&gt;|
''注''：list的iterator不支持算术运算(但是++还是被重载的)，也不支持关系运算；算术运算可以用advance函数来弥补，但''当心越界''！</pre>
</div>
<div title="SiteSubtitle" modifier="YourName" created="200902081502" modified="200902091043" changecount="6">
<pre>Wiki as fun; Wiki as note; Wiki as study</pre>
</div>
<div title="SiteTitle" modifier="Teloon" created="200902081501" changecount="1">
<pre>Teloon's TiddlyWiki</pre>
</div>
<div title="Software" modifier="YourName" created="200905220659" modified="201105130502" changecount="20">
<pre>[[foobar显示歌词心得]]
[[使用Bookmarklet+Google CSE提升搜索效率]]
[[VNC Server配置]]
[[数据恢复软件]]
[[转录软件（语音识别）]]

!!!Linux
*''Kodos'' 是一个用于创建、测试、及调试正则表达式的图形化工具。因 Kodos 使用的正则表达式引擎是基于 PCRE 标准实现的，所以除了 Python 外，Kodos 也可被用于 Perl、PHP 等其他程序语言。(Win平台也有)
*[[wine指南]]
*[[一次安装闭源的“解码器、flashplayer、java虚拟机、微软字体”]]
*[[播放器可以解码、但停止不动的解决方案]]

!!!VIM
*[[vim配置]]
*[[vim命令]]
*[[VIM多标签切换]]

!!!智能手机
!!!!S60
[[塞班木马专杀|http://bbs.dospy.com/thread-5825635-1-1.html]](在线检测平台：[[here|http://cha.dospy.com/]])
#系统目录查看：''X-plore''
#系统进程查看：''易安信''，''掌中任务''
#十大流氓软件：
##手机无贼CellGuard3
##商务管家
##手机商务助手
##美通无线音乐播放器 mTunes
##主题管家SkinManager
##吾主题
##拇指精灵Findia
##迷迷之音
##手机大头 Datuu/旅行通/掌影无限/网络加速/万花筒

!!!程序开发
[[推荐安装的软件]]
[[Eclipse：''failed to create the java virtual machine''错误]]
[[Eclipse：''Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space''错误]]</pre>
</div>
<div title="StyleSheet" modifier="Jonny Gerold" created="200904132312" server.type="file" server.host="dl.getdropbox.com/u/52078/Notes/Notes.html" server.page.revision="200904132312">
<pre>[[StyleSheetSyntaxHighlighter]]</pre>
</div>
<div title="StyleSheetSyntaxHighlighter" modifier="wy" created="200904132302" modified="201012090510" server.type="file" server.host="dl.getdropbox.com/u/52078/Notes/Notes.html" server.page.revision="200904132302" changecount="3">
<pre>/***
StyleSheet for ~SyntaxHighlighter
***/

/*{{{*/
.dp-highlighter
{
	font-family: &quot;Consolas&quot;, &quot;Courier New&quot;, Courier, mono, serif;
	font-size: 12px;
	background-color: #E7E5DC;
	width: 99%;
	overflow: auto;
	margin: 18px 0 18px 0 !important;
	padding-top: 1px; /* adds a little border on top when controls are hidden */
}

/* clear styles */
.dp-highlighter ol,
.dp-highlighter ol li,
.dp-highlighter ol li span 
{
	margin: 0;
	padding: 0;
	border: none;
}

.dp-highlighter a,
.dp-highlighter a:hover
{
	background: none;
	border: none;
	padding: 0;
	margin: 0;
}

.dp-highlighter .bar
{
	padding-left: 45px;
}

.dp-highlighter.collapsed .bar,
.dp-highlighter.nogutter .bar
{
	padding-left: 0px;
}

.dp-highlighter ol
{
	list-style: decimal; /* for ie */
	background-color: #fff;
	margin: 0px 0px 1px 45px !important; /* 1px bottom margin seems to fix occasional Firefox scrolling */
	padding: 0px;
	color: #5C5C5C;
}

.dp-highlighter.nogutter ol,
.dp-highlighter.nogutter ol li
{
	list-style: none !important;
	margin-left: 0px !important;
}

.dp-highlighter ol li,
.dp-highlighter .columns div
{
	list-style: decimal-leading-zero; /* better look for others, override cascade from OL */
	list-style-position: outside !important;
	border-left: 3px solid #6CE26C;
	background-color: #F8F8F8;
	color: #5C5C5C;
	padding: 0 3px 0 10px !important;
	margin: 0 !important;
	line-height: 14px;
}

.dp-highlighter.nogutter ol li,
.dp-highlighter.nogutter .columns div
{
	border: 0;
}

.dp-highlighter .columns
{
	background-color: #F8F8F8;
	color: gray;
	overflow: hidden;
	width: 100%;
}

.dp-highlighter .columns div
{
	padding-bottom: 5px;
}

.dp-highlighter ol li.alt
{
	background-color: #FFF;
	color: inherit;
}

.dp-highlighter ol li span
{
	color: black;
	background-color: inherit;
}

/* Adjust some properties when collapsed */

.dp-highlighter.collapsed ol
{
	margin: 0px;
}

.dp-highlighter.collapsed ol li
{
	display: none;
}

/* Additional modifications when in print-view */

.dp-highlighter.printing
{
	border: none;
}

.dp-highlighter.printing .tools
{
	display: none !important;
}

.dp-highlighter.printing li
{
	display: list-item !important;
}

/* Styles for the tools */

.dp-highlighter .tools
{
	padding: 3px 8px 3px 10px;
	font: 9px Verdana, Geneva, Arial, Helvetica, sans-serif;
	color: silver;
	background-color: #f8f8f8;
	padding-bottom: 10px;
	border-left: 3px solid #6CE26C;
}

.dp-highlighter.nogutter .tools
{
	border-left: 0;
}

.dp-highlighter.collapsed .tools
{
	border-bottom: 0;
}

.dp-highlighter .tools a
{
	font-size: 9px;
	color: #a0a0a0;
	background-color: inherit;
	text-decoration: none;
	margin-right: 10px;
}

.dp-highlighter .tools a:hover
{
	color: red;
	background-color: inherit;
	text-decoration: underline;
}

/* About dialog styles */

.dp-about { background-color: #fff; color: #333; margin: 0px; padding: 0px; }
.dp-about table { width: 100%; height: 100%; font-size: 11px; font-family: Tahoma, Verdana, Arial, sans-serif !important; }
.dp-about td { padding: 10px; vertical-align: top; }
.dp-about .copy { border-bottom: 1px solid #ACA899; height: 95%; }
.dp-about .title { color: red; background-color: inherit; font-weight: bold; }
.dp-about .para { margin: 0 0 4px 0; }
.dp-about .footer { background-color: #ECEADB; color: #333; border-top: 1px solid #fff; text-align: right; }
.dp-about .close { font-size: 11px; font-family: Tahoma, Verdana, Arial, sans-serif !important; background-color: #ECEADB; color: #333; width: 60px; height: 22px; }

/* Language specific styles */

.dp-highlighter .comment, .dp-highlighter .comments { color: #008200; background-color: inherit; }
.dp-highlighter .string { color: blue; background-color: inherit; }
.dp-highlighter .keyword { color: #069; font-weight: bold; background-color: inherit; }
.dp-highlighter .preprocessor { color: gray; background-color: inherit; }

/*}}}*/</pre>
</div>
<div title="SyntaxHighlighterPlugin" modifier="wy" created="200904132309" modified="201012090513" tags="systemConfig" server.type="file" server.host="dl.getdropbox.com/u/52078/Notes/Notes.html" server.page.revision="200904132309" changecount="3">
<pre>/***
!Metadata:
|''Name:''|SyntaxHighlighterPlugin|
|''Description:''|Code Syntax Highlighter Plugin for TiddlyWiki.|
|''Version:''|1.1.3|
|''Date:''|Oct 24, 2008|
|''Source:''|http://www.coolcode.cn/show-310-1.html|
|''Author:''|Ma Bingyao (andot (at) ujn (dot) edu (dot) cn)|
|''License:''|[[GNU Lesser General Public License|http://www.gnu.org/licenses/lgpl.txt]]|
|''~CoreVersion:''|2.4.1|
|''Browser:''|Firefox 1.5+; InternetExplorer 6.0; Safari; Opera; Chrome; etc.|

!Syntax:
{{{
&lt;code options&gt;
codes
&lt;/code&gt;
}}}

!Examples:
{{{
&lt;code java&gt;
public class HelloWorld {
    public static void main(String args[]) {
        System.out.println(&quot;HelloWorld!&quot;);
    }
}
&lt;/code&gt;
}}}

!Revision History:
|''Version''|''Date''|''Note''|
|1.1.2|Oct 15, 2008|Optimize Highlight|
|1.0.0|Oct 13, 2008|Initial release|

!Code section:
***/
//{{{
var dp={sh:{Toolbar:{},Utils:{},RegexLib:{},Brushes:{},Strings:{AboutDialog:&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;About...&lt;/title&gt;&lt;/head&gt;&lt;body class=\&quot;dp-about\&quot;&gt;&lt;table cellspacing=\&quot;0\&quot;&gt;&lt;tr&gt;&lt;td class=\&quot;copy\&quot;&gt;&lt;p class=\&quot;title\&quot;&gt;dp.SyntaxHighlighter&lt;/div&gt;&lt;div class=\&quot;para\&quot;&gt;Version: {V}&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;http://www.dreamprojections.com/syntaxhighlighter/?ref=about\&quot; target=\&quot;_blank\&quot;&gt;http://www.dreamprojections.com/syntaxhighlighter&lt;/a&gt;&lt;/p&gt;&amp;copy;2004-2007 Alex Gorbatchev.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=\&quot;footer\&quot;&gt;&lt;input type=\&quot;button\&quot; class=\&quot;close\&quot; value=\&quot;OK\&quot; onClick=\&quot;window.close()\&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;&quot;},ClipboardSwf:null,Version:&quot;1.5.1&quot;}};dp.SyntaxHighlighter=dp.sh;dp.sh.Toolbar.Commands={ExpandSource:{label:&quot;+ expand source&quot;,check:function($){return $.collapse},func:function($,_){$.parentNode.removeChild($);_.div.className=_.div.className.replace(&quot;collapsed&quot;,&quot;&quot;)}},ViewSource:{label:&quot;view plain&quot;,func:function($,_){var A=dp.sh.Utils.FixForBlogger(_.originalCode).replace(/&lt;/g,&quot;&amp;lt;&quot;),B=window.open(&quot;&quot;,&quot;_blank&quot;,&quot;width=750, height=400, location=0, resizable=1, menubar=0, scrollbars=0&quot;);B.document.write(&quot;&lt;textarea style=\&quot;width:99%;height:99%\&quot;&gt;&quot;+A+&quot;&lt;/textarea&gt;&quot;);B.document.close()}},CopyToClipboard:{label:&quot;copy to clipboard&quot;,check:function(){return window.clipboardData!=null||dp.sh.ClipboardSwf!=null},func:function($,A){var B=dp.sh.Utils.FixForBlogger(A.originalCode).replace(/&amp;lt;/g,&quot;&lt;&quot;).replace(/&amp;gt;/g,&quot;&gt;&quot;).replace(/&amp;amp;/g,&quot;&amp;&quot;);if(window.clipboardData)window.clipboardData.setData(&quot;text&quot;,B);else if(dp.sh.ClipboardSwf!=null){var _=A.flashCopier;if(_==null){_=document.createElement(&quot;div&quot;);A.flashCopier=_;A.div.appendChild(_)}_.innerHTML=&quot;&lt;embed src=\&quot;&quot;+dp.sh.ClipboardSwf+&quot;\&quot; FlashVars=\&quot;clipboard=&quot;+encodeURIComponent(B)+&quot;\&quot; width=\&quot;0\&quot; height=\&quot;0\&quot; type=\&quot;application/x-shockwave-flash\&quot;&gt;&lt;/embed&gt;&quot;}alert(&quot;The code is in your clipboard now&quot;)}},PrintSource:{label:&quot;print&quot;,func:function($,B){var _=document.createElement(&quot;IFRAME&quot;),A=null;_.style.cssText=&quot;position:absolute;width:0px;height:0px;left:-500px;top:-500px;&quot;;document.body.appendChild(_);A=_.contentWindow.document;dp.sh.Utils.CopyStyles(A,window.document);A.write(&quot;&lt;div class=\&quot;&quot;+B.div.className.replace(&quot;collapsed&quot;,&quot;&quot;)+&quot; printing\&quot;&gt;&quot;+B.div.innerHTML+&quot;&lt;/div&gt;&quot;);A.close();_.contentWindow.focus();_.contentWindow.print();alert(&quot;Printing...&quot;);document.body.removeChild(_)}},About:{label:&quot;?&quot;,func:function(_){var A=window.open(&quot;&quot;,&quot;_blank&quot;,&quot;dialog,width=300,height=150,scrollbars=0&quot;),$=A.document;dp.sh.Utils.CopyStyles($,window.document);$.write(dp.sh.Strings.AboutDialog.replace(&quot;{V}&quot;,dp.sh.Version));$.close();A.focus()}}};dp.sh.Toolbar.Create=function(B){var A=document.createElement(&quot;DIV&quot;);A.className=&quot;tools&quot;;for(var _ in dp.sh.Toolbar.Commands){var $=dp.sh.Toolbar.Commands[_];if($.check!=null&amp;&amp;!$.check(B))continue;A.innerHTML+=&quot;&lt;a href=\&quot;#\&quot; onclick=\&quot;dp.sh.Toolbar.Command('&quot;+_+&quot;',this);return false;\&quot;&gt;&quot;+$.label+&quot;&lt;/a&gt;&quot;}return A};dp.sh.Toolbar.Command=function(_,$){var A=$;while(A!=null&amp;&amp;A.className.indexOf(&quot;dp-highlighter&quot;)==-1)A=A.parentNode;if(A!=null)dp.sh.Toolbar.Commands[_].func($,A.highlighter)};dp.sh.Utils.CopyStyles=function(A,_){var $=_.getElementsByTagName(&quot;link&quot;);for(var B=0;B&lt;$.length;B++)if($[B].rel.toLowerCase()==&quot;stylesheet&quot;)A.write(&quot;&lt;link type=\&quot;text/css\&quot; rel=\&quot;stylesheet\&quot; href=\&quot;&quot;+$[B].href+&quot;\&quot;&gt;&lt;/link&gt;&quot;)};dp.sh.Utils.FixForBlogger=function($){return(dp.sh.isBloggerMode==true)?$.replace(/&lt;br\s*\/?&gt;|&amp;lt;br\s*\/?&amp;gt;/gi,&quot;\n&quot;):$};dp.sh.RegexLib={MultiLineCComments:new RegExp(&quot;/\\*[\\s\\S]*?\\*/&quot;,&quot;gm&quot;),SingleLineCComments:new RegExp(&quot;//.*$&quot;,&quot;gm&quot;),SingleLinePerlComments:new RegExp(&quot;#.*$&quot;,&quot;gm&quot;),DoubleQuotedString:new RegExp(&quot;\&quot;(?:\\.|(\\\\\\\&quot;)|[^\\\&quot;\&quot;\\n])*\&quot;&quot;,&quot;g&quot;),SingleQuotedString:new RegExp(&quot;'(?:\\.|(\\\\\\')|[^\\''\\n])*'&quot;,&quot;g&quot;)};dp.sh.Match=function(_,$,A){this.value=_;this.index=$;this.length=_.length;this.css=A};dp.sh.Highlighter=function(){this.noGutter=false;this.addControls=true;this.collapse=false;this.tabsToSpaces=true;this.wrapColumn=80;this.showColumns=true};dp.sh.Highlighter.SortCallback=function($,_){if($.index&lt;_.index)return-1;else if($.index&gt;_.index)return 1;else if($.length&lt;_.length)return-1;else if($.length&gt;_.length)return 1;return 0};dp.sh.Highlighter.prototype.CreateElement=function(_){var $=document.createElement(_);$.highlighter=this;return $};dp.sh.Highlighter.prototype.GetMatches=function(_,B){var $=0,A=null;while((A=_.exec(this.code))!=null)this.matches[this.matches.length]=new dp.sh.Match(A[0],A.index,B)};dp.sh.Highlighter.prototype.AddBit=function($,A){if($==null||$.length==0)return;var C=this.CreateElement(&quot;SPAN&quot;);$=$.replace(/ /g,&quot;&amp;nbsp;&quot;);$=$.replace(/&lt;/g,&quot;&amp;lt;&quot;);$=$.replace(/\n/gm,&quot;&amp;nbsp;&lt;br&gt;&quot;);if(A!=null){if((/br/gi).test($)){var _=$.split(&quot;&amp;nbsp;&lt;br&gt;&quot;);for(var B=0;B&lt;_.length;B++){C=this.CreateElement(&quot;SPAN&quot;);C.className=A;C.innerHTML=_[B];this.div.appendChild(C);if(B+1&lt;_.length)this.div.appendChild(this.CreateElement(&quot;BR&quot;))}}else{C.className=A;C.innerHTML=$;this.div.appendChild(C)}}else{C.innerHTML=$;this.div.appendChild(C)}};dp.sh.Highlighter.prototype.IsInside=function(_){if(_==null||_.length==0)return false;for(var A=0;A&lt;this.matches.length;A++){var $=this.matches[A];if($==null)continue;if((_.index&gt;$.index)&amp;&amp;(_.index&lt;$.index+$.length))return true}return false};dp.sh.Highlighter.prototype.ProcessRegexList=function(){for(var $=0;$&lt;this.regexList.length;$++)this.GetMatches(this.regexList[$].regex,this.regexList[$].css)};dp.sh.Highlighter.prototype.ProcessSmartTabs=function(E){var B=E.split(&quot;\n&quot;),$=&quot;&quot;,D=4,A=&quot;\t&quot;;function _(A,E,_){var B=A.substr(0,E),C=A.substr(E+1,A.length),$=&quot;&quot;;for(var D=0;D&lt;_;D++)$+=&quot; &quot;;return B+$+C}function C(B,C){if(B.indexOf(A)==-1)return B;var D=0;while((D=B.indexOf(A))!=-1){var $=C-D%C;B=_(B,D,$)}return B}for(var F=0;F&lt;B.length;F++)$+=C(B[F],D)+&quot;\n&quot;;return $};dp.sh.Highlighter.prototype.SwitchToList=function(){var C=this.div.innerHTML.replace(/&lt;(br)\/?&gt;/gi,&quot;\n&quot;),B=C.split(&quot;\n&quot;);if(this.addControls==true)this.bar.appendChild(dp.sh.Toolbar.Create(this));if(this.showColumns){var A=this.CreateElement(&quot;div&quot;),_=this.CreateElement(&quot;div&quot;),E=10,G=1;while(G&lt;=150)if(G%E==0){A.innerHTML+=G;G+=(G+&quot;&quot;).length}else{A.innerHTML+=&quot;&amp;middot;&quot;;G++}_.className=&quot;columns&quot;;_.appendChild(A);this.bar.appendChild(_)}for(var G=0,D=this.firstLine;G&lt;B.length-1;G++,D++){var $=this.CreateElement(&quot;LI&quot;),F=this.CreateElement(&quot;SPAN&quot;);$.className=(G%2==0)?&quot;alt&quot;:&quot;&quot;;F.innerHTML=B[G]+&quot;&amp;nbsp;&quot;;$.appendChild(F);this.ol.appendChild($)}this.div.innerHTML=&quot;&quot;};dp.sh.Highlighter.prototype.Highlight=function(C){function A($){return $.replace(/^\s*(.*?)[\s\n]*$/g,&quot;$1&quot;)}function $($){return $.replace(/\n*$/,&quot;&quot;).replace(/^\n*/,&quot;&quot;)}function _(B){var E=dp.sh.Utils.FixForBlogger(B).split(&quot;\n&quot;),C=new Array(),D=new RegExp(&quot;^\\s*&quot;,&quot;g&quot;),$=1000;for(var F=0;F&lt;E.length&amp;&amp;$&gt;0;F++){if(A(E[F]).length==0)continue;var _=D.exec(E[F]);if(_!=null&amp;&amp;_.length&gt;0)$=Math.min(_[0].length,$)}if($&gt;0)for(F=0;F&lt;E.length;F++)E[F]=E[F].substr($);return E.join(&quot;\n&quot;)}function D(A,$,_){return A.substr($,_-$)}var F=0;if(C==null)C=&quot;&quot;;this.originalCode=C;this.code=$(_(C));this.div=this.CreateElement(&quot;DIV&quot;);this.bar=this.CreateElement(&quot;DIV&quot;);this.ol=this.CreateElement(&quot;OL&quot;);this.matches=new Array();this.div.className=&quot;dp-highlighter&quot;;this.div.highlighter=this;this.bar.className=&quot;bar&quot;;this.ol.start=this.firstLine;if(this.CssClass!=null)this.ol.className=this.CssClass;if(this.collapse)this.div.className+=&quot; collapsed&quot;;if(this.noGutter)this.div.className+=&quot; nogutter&quot;;if(this.tabsToSpaces==true)this.code=this.ProcessSmartTabs(this.code);this.ProcessRegexList();if(this.matches.length==0){this.AddBit(this.code,null);this.SwitchToList();this.div.appendChild(this.bar);this.div.appendChild(this.ol);return}this.matches=this.matches.sort(dp.sh.Highlighter.SortCallback);for(var E=0;E&lt;this.matches.length;E++)if(this.IsInside(this.matches[E]))this.matches[E]=null;for(E=0;E&lt;this.matches.length;E++){var B=this.matches[E];if(B==null||B.length==0)continue;this.AddBit(D(this.code,F,B.index),null);this.AddBit(B.value,B.css);F=B.index+B.length}this.AddBit(this.code.substr(F),null);this.SwitchToList();this.div.appendChild(this.bar);this.div.appendChild(this.ol)};dp.sh.Highlighter.prototype.GetKeywords=function($){return&quot;\\b&quot;+$.replace(/ /g,&quot;\\b|\\b&quot;)+&quot;\\b&quot;};dp.sh.BloggerMode=function(){dp.sh.isBloggerMode=true};dp.sh.HighlightAll=function(N,B,K,I,O,E){function A(){var $=arguments;for(var _=0;_&lt;$.length;_++){if($[_]==null)continue;if(typeof($[_])==&quot;string&quot;&amp;&amp;$[_]!=&quot;&quot;)return $[_]+&quot;&quot;;if(typeof($[_])==&quot;object&quot;&amp;&amp;$[_].value!=&quot;&quot;)return $[_].value+&quot;&quot;}return null}function J($,_){for(var A=0;A&lt;_.length;A++)if(_[A]==$)return true;return false}function L(A,B,C){var _=new RegExp(&quot;^&quot;+A+&quot;\\[(\\w+)\\]$&quot;,&quot;gi&quot;),$=null;for(var D=0;D&lt;B.length;D++)if(($=_.exec(B[D]))!=null)return $[1];return C}function C(B,A,_){var $=document.getElementsByTagName(_);for(var C=0;C&lt;$.length;C++)if($[C].getAttribute(&quot;name&quot;)==A)B.push($[C])}var T=[],P=null,M={},$=&quot;innerHTML&quot;;C(T,N,&quot;pre&quot;);C(T,N,&quot;textarea&quot;);if(T.length==0)return;for(var R in dp.sh.Brushes){var F=dp.sh.Brushes[R].Aliases;if(F==null)continue;for(var G=0;G&lt;F.length;G++)M[F[G]]=R}for(G=0;G&lt;T.length;G++){var _=T[G],U=A(_.attributes[&quot;class&quot;],_.className,_.attributes[&quot;language&quot;],_.language),Q=&quot;&quot;;if(U==null)continue;U=U.split(&quot;:&quot;);Q=U[0].toLowerCase();if(M[Q]==null)continue;P=new dp.sh.Brushes[M[Q]]();_.style.display=&quot;none&quot;;P.noGutter=(B==null)?J(&quot;nogutter&quot;,U):!B;P.addControls=(K==null)?!J(&quot;nocontrols&quot;,U):K;P.collapse=(I==null)?J(&quot;collapse&quot;,U):I;P.showColumns=(E==null)?J(&quot;showcolumns&quot;,U):E;var D=document.getElementsByTagName(&quot;head&quot;)[0];if(P.Style&amp;&amp;D){var S=document.createElement(&quot;style&quot;);S.setAttribute(&quot;type&quot;,&quot;text/css&quot;);if(S.styleSheet)S.styleSheet.cssText=P.Style;else{var H=document.createTextNode(P.Style);S.appendChild(H)}D.appendChild(S)}P.firstLine=(O==null)?parseInt(L(&quot;firstline&quot;,U,1)):O;P.Highlight(_[$]);P.source=_;_.parentNode.insertBefore(P.div,_)}};version.extensions.SyntaxHighLighterPlugin={major:1,minor:1,revision:3,date:new Date(2008,10,24)};dp.sh.ClipboardSwf=&quot;clipboard.swf&quot;;dp.sh.Highlight=function(_,Q,B,J,H,M,D){function A(){var $=arguments;for(var _=0;_&lt;$.length;_++){if($[_]==null)continue;if(typeof($[_])==&quot;string&quot;&amp;&amp;$[_]!=&quot;&quot;)return $[_]+&quot;&quot;;if(typeof($[_])==&quot;object&quot;&amp;&amp;$[_].value!=&quot;&quot;)return $[_].value+&quot;&quot;}return null}function I($,_){for(var A=0;A&lt;_.length;A++)if(_[A]==$)return true;return false}function K(A,B,C){var _=new RegExp(&quot;^&quot;+A+&quot;\\[(\\w+)\\]$&quot;,&quot;gi&quot;),$=null;for(var D=0;D&lt;B.length;D++)if(($=_.exec(B[D]))!=null)return $[1];return C}var N=null,$=&quot;innerHTML&quot;;if(this.registered==undefined){var L={};for(var O in dp.sh.Brushes){var E=dp.sh.Brushes[O].Aliases;if(E==null)continue;for(var F=0;F&lt;E.length;F++)L[E[F]]=O}this.registered=L}Q=Q.split(&quot;:&quot;);language=Q[0].toLowerCase();if(this.registered[language]==null)return;N=new dp.sh.Brushes[this.registered[language]]();_.style.display=&quot;none&quot;;N.noGutter=(B==null)?I(&quot;nogutter&quot;,Q):!B;N.addControls=(J==null)?!I(&quot;nocontrols&quot;,Q):J;N.collapse=(H==null)?I(&quot;collapse&quot;,Q):H;N.showColumns=(D==null)?I(&quot;showcolumns&quot;,Q):D;var C=document.getElementsByTagName(&quot;head&quot;)[0],P=document.getElementById(N.CssClass);if(N.Style&amp;&amp;C&amp;&amp;!P){P=document.createElement(&quot;style&quot;);P.setAttribute(&quot;id&quot;,N.CssClass);P.setAttribute(&quot;type&quot;,&quot;text/css&quot;);if(P.styleSheet)P.styleSheet.cssText=N.Style;else{var G=document.createTextNode(N.Style);P.appendChild(G)}C.appendChild(P)}N.firstLine=(M==null)?parseInt(K(&quot;firstline&quot;,Q,1)):M;N.Highlight(_[$]);N.source=_;_.parentNode.insertBefore(N.div,_)};config.formatters.push({name:&quot;SyntaxHighlighter&quot;,match:&quot;^&lt;code[\\s]+[^&gt;]+&gt;\\n&quot;,element:&quot;pre&quot;,handler:function(_){this.lookaheadRegExp=/&lt;code[\s]+([^&gt;]+)&gt;\n((?:^[^\n]*\n)+?)(^&lt;\/code&gt;$\n?)/mg;this.lookaheadRegExp.lastIndex=_.matchStart;var $=this.lookaheadRegExp.exec(_.source);if($&amp;&amp;$.index==_.matchStart){var C=$[1],B=$[2];if(config.browser.isIE)B=B.replace(/\n/g,&quot;\r&quot;);var A=createTiddlyElement(_.output,this.element,null,null,B);dp.sh.Highlight(A,C);_.nextMatch=$.index+$[0].length}}});config.formatterHelpers.enclosedTextHelper=function(_){this.lookaheadRegExp.lastIndex=_.matchStart;var $=this.lookaheadRegExp.exec(_.source);if($&amp;&amp;$.index==_.matchStart){var B=$[1];if(config.browser.isIE)B=B.replace(/\n/g,&quot;\r&quot;);var A=createTiddlyElement(_.output,this.element,null,null,B);switch(_.matchText){case&quot;/*{{{*/\n&quot;:dp.sh.Highlight(A,&quot;css&quot;);break;case&quot;//{{{\n&quot;:dp.sh.Highlight(A,&quot;js&quot;);break;case&quot;&lt;!--{{{--&gt;\n&quot;:dp.sh.Highlight(A,&quot;xml&quot;);break}_.nextMatch=$.index+$[0].length}};dp.sh.Brushes.AS3=function(){var _=&quot;class interface package&quot;,$=&quot;Array Boolean Date decodeURI decodeURIComponent encodeURI encodeURIComponent escape &quot;+&quot;int isFinite isNaN isXMLName Number Object parseFloat parseInt &quot;+&quot;String trace uint unescape XML XMLList &quot;+&quot;Infinity -Infinity NaN undefined &quot;+&quot;as delete instanceof is new typeof &quot;+&quot;break case catch continue default do each else finally for if in &quot;+&quot;label return super switch throw try while with &quot;+&quot;dynamic final internal native override private protected public static &quot;+&quot;...rest const extends function get implements namespace set &quot;+&quot;import include use &quot;+&quot;AS3 flash_proxy object_proxy &quot;+&quot;false null this true &quot;+&quot;void Null&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;blockcomment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;definition&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(&quot;var&quot;,&quot;gm&quot;),css:&quot;variable&quot;}];this.CssClass=&quot;dp-as&quot;;this.Style=&quot;.dp-as .comment { color: #009900; font-style: italic; }&quot;+&quot;.dp-as .blockcomment { color: #3f5fbf; }&quot;+&quot;.dp-as .string { color: #990000; }&quot;+&quot;.dp-as .preprocessor { color: #0033ff; }&quot;+&quot;.dp-as .definition { color: #9900cc; font-weight: bold; }&quot;+&quot;.dp-as .keyword { color: #0033ff; }&quot;+&quot;.dp-as .variable { color: #6699cc; font-weight: bold; }&quot;};dp.sh.Brushes.AS3.prototype=new dp.sh.Highlighter();dp.sh.Brushes.AS3.Aliases=[&quot;as&quot;,&quot;actionscript&quot;,&quot;ActionScript&quot;,&quot;as3&quot;,&quot;AS3&quot;];dp.sh.Brushes.Bash=function(){var _=&quot;alias bg bind break builtin cd command compgen complete continue &quot;+&quot;declare dirs disown echo enable eval exec exit export fc fg &quot;+&quot;getopts hash help history jobs kill let local logout popd printf &quot;+&quot;pushd pwd read readonly return set shift shopt source &quot;+&quot;suspend test times trap type typeset ulimit umask unalias unset wait&quot;,$=&quot;case do done elif else esac fi for function if in select then &quot;+&quot;time until while&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLinePerlComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;[()[\\]{}]&quot;,&quot;g&quot;),css:&quot;delim&quot;},{regex:new RegExp(&quot;\\$\\w+&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;\\w+=&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;\\s-\\w+&quot;,&quot;g&quot;),css:&quot;flag&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;builtin&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-bash&quot;;this.Style=&quot;.dp-bash .builtin {color: maroon; font-weight: bold;}&quot;+&quot;.dp-bash .comment {color: gray;}&quot;+&quot;.dp-bash .delim {font-weight: bold;}&quot;+&quot;.dp-bash .flag {color: green;}&quot;+&quot;.dp-bash .string {color: red;}&quot;+&quot;.dp-bash .vars {color: blue;}&quot;};dp.sh.Brushes.Bash.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Bash.Aliases=[&quot;bash&quot;,&quot;sh&quot;];dp.sh.Brushes.Batch=function(){var _=&quot;APPEND ATTRIB CD CHDIR CHKDSK CHOICE CLS COPY DEL ERASE DELTREE &quot;+&quot;DIR EXIT FC COMP FDISK FIND FORMAT FSUTIL HELP JOIN &quot;+&quot;LABEL LOADFIX MK MKDIR MEM MEMMAKER MORE MOVE MSD PCPARK &quot;+&quot;PRINT RD RMDIR REN SCANDISK SHARE SORT SUBST SYS &quot;+&quot;TIME DATE TREE TRUENAME TYPE UNDELETE VER XCOPY&quot;,$=&quot;DO ELSE FOR IN CALL CHOICE GOTO SHIFT PAUSE ERRORLEVEL &quot;+&quot;IF NOT EXIST LFNFOR START SETLOCAL ENDLOCAL ECHO SET&quot;;this.regexList=[{regex:new RegExp(&quot;REM.*$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:new RegExp(&quot;::.*$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;[()[\\]{}]&quot;,&quot;g&quot;),css:&quot;delim&quot;},{regex:new RegExp(&quot;%\\w+%&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;%%\\w+&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;\\w+=&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;@\\w+&quot;,&quot;g&quot;),css:&quot;keyword&quot;},{regex:new RegExp(&quot;:\\w+&quot;,&quot;g&quot;),css:&quot;keyword&quot;},{regex:new RegExp(&quot;\\s/\\w+&quot;,&quot;g&quot;),css:&quot;flag&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;builtin&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-batch&quot;;this.Style=&quot;.dp-batch .builtin {color: maroon; font-weight: bold;}&quot;+&quot;.dp-batch .comment {color: gray;}&quot;+&quot;.dp-batch .delim {font-weight: bold;}&quot;+&quot;.dp-batch .flag {color: green;}&quot;+&quot;.dp-batch .string {color: red;}&quot;+&quot;.dp-batch .vars {color: blue;font-weight: bold;}&quot;};dp.sh.Brushes.Batch.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Batch.Aliases=[&quot;batch&quot;,&quot;dos&quot;];dp.sh.Brushes.ColdFusion=function(){this.CssClass=&quot;dp-coldfusion&quot;;this.Style=&quot;.dp-coldfusion { font: 13px \&quot;Courier New\&quot;, Courier, monospace; }&quot;+&quot;.dp-coldfusion .tag, .dp-coldfusion .tag-name { color: #990033; }&quot;+&quot;.dp-coldfusion .attribute { color: #990033; }&quot;+&quot;.dp-coldfusion .attribute-value { color: #0000FF; }&quot;+&quot;.dp-coldfusion .cfcomments { background-color: #FFFF99; color: #000000; }&quot;+&quot;.dp-coldfusion .cfscriptcomments { color: #999999; }&quot;+&quot;.dp-coldfusion .keywords { color: #0000FF; }&quot;+&quot;.dp-coldfusion .mgkeywords { color: #CC9900; }&quot;+&quot;.dp-coldfusion .numbers { color: #ff0000; }&quot;+&quot;.dp-coldfusion .strings { color: green; }&quot;;this.mgKeywords=&quot;setvalue getvalue addresult viewcollection viewstate&quot;;this.keywords=&quot;var eq neq gt gte lt lte not and or true false &quot;+&quot;abs acos addsoaprequestheader addsoapresponseheader &quot;+&quot;arrayappend arrayavg arrayclear arraydeleteat arrayinsertat &quot;+&quot;arrayisempty arraylen arraymax arraymin arraynew &quot;+&quot;arrayprepend arrayresize arrayset arraysort arraysum &quot;+&quot;arrayswap arraytolist asc asin atn binarydecode binaryencode &quot;+&quot;bitand bitmaskclear bitmaskread bitmaskset bitnot bitor bitshln &quot;+&quot;bitshrn bitxor ceiling charsetdecode charsetencode chr cjustify &quot;+&quot;compare comparenocase cos createdate createdatetime createobject &quot;+&quot;createobject createobject createobject createobject createodbcdate &quot;+&quot;createodbcdatetime createodbctime createtime createtimespan &quot;+&quot;createuuid dateadd datecompare dateconvert datediff dateformat &quot;+&quot;datepart day dayofweek dayofweekasstring dayofyear daysinmonth &quot;+&quot;daysinyear de decimalformat decrementvalue decrypt decryptbinary &quot;+&quot;deleteclientvariable directoryexists dollarformat duplicate encrypt &quot;+&quot;encryptbinary evaluate exp expandpath fileexists find findnocase &quot;+&quot;findoneof firstdayofmonth fix formatbasen generatesecretkey &quot;+&quot;getauthuser getbasetagdata getbasetaglist getbasetemplatepath &quot;+&quot;getclientvariableslist getcontextroot getcurrenttemplatepath &quot;+&quot;getdirectoryfrompath getencoding getexception getfilefrompath &quot;+&quot;getfunctionlist getgatewayhelper gethttprequestdata gethttptimestring &quot;+&quot;getk2serverdoccount getk2serverdoccountlimit getlocale &quot;+&quot;getlocaledisplayname getlocalhostip getmetadata getmetricdata &quot;+&quot;getpagecontext getprofilesections getprofilestring getsoaprequest &quot;+&quot;getsoaprequestheader getsoapresponse getsoapresponseheader &quot;+&quot;gettempdirectory gettempfile gettemplatepath gettickcount &quot;+&quot;gettimezoneinfo gettoken hash hour htmlcodeformat htmleditformat &quot;+&quot;iif incrementvalue inputbasen insert int isarray isbinary isboolean &quot;+&quot;iscustomfunction isdate isdebugmode isdefined isk2serverabroker &quot;+&quot;isk2serverdoccountexceeded isk2serveronline isleapyear islocalhost &quot;+&quot;isnumeric isnumericdate isobject isquery issimplevalue issoaprequest &quot;+&quot;isstruct isuserinrole isvalid isvalid isvalid iswddx isxml &quot;+&quot;isxmlattribute isxmldoc isxmlelem isxmlnode isxmlroot javacast &quot;+&quot;jsstringformat lcase left len listappend listchangedelims listcontains &quot;+&quot;listcontainsnocase listdeleteat listfind listfindnocase listfirst &quot;+&quot;listgetat listinsertat listlast listlen listprepend listqualify &quot;+&quot;listrest listsetat listsort listtoarray listvaluecount &quot;+&quot;listvaluecountnocase ljustify log log10 lscurrencyformat lsdateformat &quot;+&quot;lseurocurrencyformat lsiscurrency lsisdate lsisnumeric lsnumberformat &quot;+&quot;lsparsecurrency lsparsedatetime lsparseeurocurrency lsparsenumber &quot;+&quot;lstimeformat ltrim max mid min minute month monthasstring now &quot;+&quot;numberformat paragraphformat parameterexists parsedatetime pi &quot;+&quot;preservesinglequotes quarter queryaddcolumn queryaddrow querynew &quot;+&quot;querysetcell quotedvaluelist rand randomize randrange refind &quot;+&quot;refindnocase releasecomobject removechars repeatstring replace &quot;+&quot;replacelist replacenocase rereplace rereplacenocase reverse right &quot;+&quot;rjustify round rtrim second sendgatewaymessage setencoding &quot;+&quot;setlocale setprofilestring setvariable sgn sin spanexcluding &quot;+&quot;spanincluding sqr stripcr structappend structclear structcopy &quot;+&quot;structcount structdelete structfind structfindkey structfindvalue &quot;+&quot;structget structinsert structisempty structkeyarray structkeyexists &quot;+&quot;structkeylist structnew structsort structupdate tan timeformat &quot;+&quot;tobase64 tobinary toscript tostring trim ucase urldecode urlencodedformat &quot;+&quot;urlsessionformat val valuelist week wrap writeoutput xmlchildpos &quot;+&quot;xmlelemnew xmlformat xmlgetnodetype xmlnew xmlparse xmlsearch xmltransform &quot;+&quot;xmlvalidate year yesnoformat&quot;;this.stringMatches=new Array();this.attributeMatches=new Array()};dp.sh.Brushes.ColdFusion.prototype=new dp.sh.Highlighter();dp.sh.Brushes.ColdFusion.Aliases=[&quot;coldfusion&quot;,&quot;cf&quot;];dp.sh.Brushes.ColdFusion.prototype.ProcessRegexList=function(){function B(_,$){_[_.length]=$}function A(A,$){for(var _=0;_&lt;A.length;_++)if(A[_]==$)return _;return-1}var _=null,$=null;this.GetMatches(new RegExp(&quot;\\b(\\d+)&quot;,&quot;gm&quot;),&quot;numbers&quot;);this.GetMatches(new RegExp(this.GetKeywords(this.mgKeywords),&quot;igm&quot;),&quot;mgkeywords&quot;);this.GetMatches(dp.sh.RegexLib.SingleLineCComments,&quot;cfscriptcomments&quot;);this.GetMatches(dp.sh.RegexLib.MultiLineCComments,&quot;cfscriptcomments&quot;);this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)!---[\\s\\S]*?---(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;cfcomments&quot;);$=new RegExp(&quot;(cfset\\s*)?([:\\w-.]+)\\s*=\\s*(\&quot;.*?\&quot;|'.*?')*&quot;,&quot;gm&quot;);while((_=$.exec(this.code))!=null){if(_[1]!=undefined&amp;&amp;_[1]!=&quot;&quot;)continue;if(_[3]!=undefined&amp;&amp;_[3]!=&quot;&quot;&amp;&amp;_[3]!=&quot;\&quot;\&quot;&quot;&amp;&amp;_[3]!=&quot;''&quot;){B(this.matches,new dp.sh.Match(_[2],_.index,&quot;attribute&quot;));B(this.matches,new dp.sh.Match(_[3],_.index+_[0].indexOf(_[3]),&quot;attribute-value&quot;));B(this.stringMatches,_[3]);B(this.attributeMatches,_[2])}}this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)/*\\?*(?!\\!)|/*\\?*(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;tag&quot;);$=new RegExp(&quot;(?:&amp;lt;|&lt;)/*\\?*\\s*([:\\w-.]+)&quot;,&quot;gm&quot;);while((_=$.exec(this.code))!=null)B(this.matches,new dp.sh.Match(_[1],_.index+_[0].indexOf(_[1]),&quot;tag-name&quot;));$=new RegExp(this.GetKeywords(this.keywords),&quot;igm&quot;);while((_=$.exec(this.code))!=null)if(A(this.attributeMatches,_[0])==-1)B(this.matches,new dp.sh.Match(_[0],_.index,&quot;keywords&quot;));$=new RegExp(&quot;cfset\\s*.*(\&quot;.*?\&quot;|'.*?')&quot;,&quot;gm&quot;);while((_=$.exec(this.code))!=null)if(_[1]!=undefined&amp;&amp;_[1]!=&quot;&quot;){B(this.matches,new dp.sh.Match(_[1],_.index+_[0].indexOf(_[1]),&quot;strings&quot;));B(this.stringMatches,_[1])}while((_=dp.sh.RegexLib.DoubleQuotedString.exec(this.code))!=null)if(A(this.stringMatches,_[0])==-1)B(this.matches,new dp.sh.Match(_[0],_.index,&quot;strings&quot;));while((_=dp.sh.RegexLib.SingleQuotedString.exec(this.code))!=null)if(A(this.stringMatches,_[0])==-1)B(this.matches,new dp.sh.Match(_[0],_.index,&quot;strings&quot;))};dp.sh.Brushes.Cpp=function(){var _=&quot;ATOM BOOL BOOLEAN BYTE CHAR COLORREF DWORD DWORDLONG DWORD_PTR &quot;+&quot;DWORD32 DWORD64 FLOAT HACCEL HALF_PTR HANDLE HBITMAP HBRUSH &quot;+&quot;HCOLORSPACE HCONV HCONVLIST HCURSOR HDC HDDEDATA HDESK HDROP HDWP &quot;+&quot;HENHMETAFILE HFILE HFONT HGDIOBJ HGLOBAL HHOOK HICON HINSTANCE HKEY &quot;+&quot;HKL HLOCAL HMENU HMETAFILE HMODULE HMONITOR HPALETTE HPEN HRESULT &quot;+&quot;HRGN HRSRC HSZ HWINSTA HWND INT INT_PTR INT32 INT64 LANGID LCID LCTYPE &quot;+&quot;LGRPID LONG LONGLONG LONG_PTR LONG32 LONG64 LPARAM LPBOOL LPBYTE LPCOLORREF &quot;+&quot;LPCSTR LPCTSTR LPCVOID LPCWSTR LPDWORD LPHANDLE LPINT LPLONG LPSTR LPTSTR &quot;+&quot;LPVOID LPWORD LPWSTR LRESULT PBOOL PBOOLEAN PBYTE PCHAR PCSTR PCTSTR PCWSTR &quot;+&quot;PDWORDLONG PDWORD_PTR PDWORD32 PDWORD64 PFLOAT PHALF_PTR PHANDLE PHKEY PINT &quot;+&quot;PINT_PTR PINT32 PINT64 PLCID PLONG PLONGLONG PLONG_PTR PLONG32 PLONG64 POINTER_32 &quot;+&quot;POINTER_64 PSHORT PSIZE_T PSSIZE_T PSTR PTBYTE PTCHAR PTSTR PUCHAR PUHALF_PTR &quot;+&quot;PUINT PUINT_PTR PUINT32 PUINT64 PULONG PULONGLONG PULONG_PTR PULONG32 PULONG64 &quot;+&quot;PUSHORT PVOID PWCHAR PWORD PWSTR SC_HANDLE SC_LOCK SERVICE_STATUS_HANDLE SHORT &quot;+&quot;SIZE_T SSIZE_T TBYTE TCHAR UCHAR UHALF_PTR UINT UINT_PTR UINT32 UINT64 ULONG &quot;+&quot;ULONGLONG ULONG_PTR ULONG32 ULONG64 USHORT USN VOID WCHAR WORD WPARAM WPARAM WPARAM &quot;+&quot;char bool short int __int32 __int64 __int8 __int16 long float double __wchar_t &quot;+&quot;clock_t _complex _dev_t _diskfree_t div_t ldiv_t _exception _EXCEPTION_POINTERS &quot;+&quot;FILE _finddata_t _finddatai64_t _wfinddata_t _wfinddatai64_t __finddata64_t &quot;+&quot;__wfinddata64_t _FPIEEE_RECORD fpos_t _HEAPINFO _HFILE lconv intptr_t &quot;+&quot;jmp_buf mbstate_t _off_t _onexit_t _PNH ptrdiff_t _purecall_handler &quot;+&quot;sig_atomic_t size_t _stat __stat64 _stati64 terminate_function &quot;+&quot;time_t __time64_t _timeb __timeb64 tm uintptr_t _utimbuf &quot;+&quot;va_list wchar_t wctrans_t wctype_t wint_t signed&quot;,$=&quot;break case catch class const __finally __exception __try &quot;+&quot;const_cast continue private public protected __declspec &quot;+&quot;default delete deprecated dllexport dllimport do dynamic_cast &quot;+&quot;else enum explicit extern if for friend goto inline &quot;+&quot;mutable naked namespace new noinline noreturn nothrow &quot;+&quot;register reinterpret_cast return selectany &quot;+&quot;sizeof static static_cast struct switch template this &quot;+&quot;thread throw true false try typedef typeid typename union &quot;+&quot;using uuid virtual void volatile whcar_t while&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^ *#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;datatypes&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-cpp&quot;;this.Style=&quot;.dp-cpp .datatypes { color: #2E8B57; font-weight: bold; }&quot;};dp.sh.Brushes.Cpp.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Cpp.Aliases=[&quot;cpp&quot;,&quot;c&quot;,&quot;c++&quot;];dp.sh.Brushes.CSharp=function(){var $=&quot;abstract as base bool break byte case catch char checked class const &quot;+&quot;continue decimal default delegate do double else enum event explicit &quot;+&quot;extern false finally fixed float for foreach get goto if implicit in int &quot;+&quot;interface internal is lock long namespace new null object operator out &quot;+&quot;override params private protected public readonly ref return sbyte sealed set &quot;+&quot;short sizeof stackalloc static string struct switch this throw true try &quot;+&quot;typeof uint ulong unchecked unsafe ushort using virtual void while&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-c&quot;;this.Style=&quot;.dp-c .vars { color: #d00; }&quot;};dp.sh.Brushes.CSharp.prototype=new dp.sh.Highlighter();dp.sh.Brushes.CSharp.Aliases=[&quot;c#&quot;,&quot;c-sharp&quot;,&quot;csharp&quot;];dp.sh.Brushes.CSS=function(){var _=&quot;ascent azimuth background-attachment background-color background-image background-position &quot;+&quot;background-repeat background baseline bbox border-collapse border-color border-spacing border-style border-top &quot;+&quot;border-right border-bottom border-left border-top-color border-right-color border-bottom-color border-left-color &quot;+&quot;border-top-style border-right-style border-bottom-style border-left-style border-top-width border-right-width &quot;+&quot;border-bottom-width border-left-width border-width border cap-height caption-side centerline clear clip color &quot;+&quot;content counter-increment counter-reset cue-after cue-before cue cursor definition-src descent direction display &quot;+&quot;elevation empty-cells float font-size-adjust font-family font-size font-stretch font-style font-variant font-weight font &quot;+&quot;height letter-spacing line-height list-style-image list-style-position list-style-type list-style margin-top &quot;+&quot;margin-right margin-bottom margin-left margin marker-offset marks mathline max-height max-width min-height min-width orphans &quot;+&quot;outline-color outline-style outline-width outline overflow padding-top padding-right padding-bottom padding-left padding page &quot;+&quot;page-break-after page-break-before page-break-inside pause pause-after pause-before pitch pitch-range play-during position &quot;+&quot;quotes richness size slope src speak-header speak-numeral speak-punctuation speak speech-rate stemh stemv stress &quot;+&quot;table-layout text-align text-decoration text-indent text-shadow text-transform unicode-bidi unicode-range units-per-em &quot;+&quot;vertical-align visibility voice-family volume white-space widows width widths word-spacing x-height z-index&quot;,$=&quot;above absolute all always aqua armenian attr aural auto avoid baseline behind below bidi-override black blink block blue bold bolder &quot;+&quot;both bottom braille capitalize caption center center-left center-right circle close-quote code collapse compact condensed &quot;+&quot;continuous counter counters crop cross crosshair cursive dashed decimal decimal-leading-zero default digits disc dotted double &quot;+&quot;embed embossed e-resize expanded extra-condensed extra-expanded fantasy far-left far-right fast faster fixed format fuchsia &quot;+&quot;gray green groove handheld hebrew help hidden hide high higher icon inline-table inline inset inside invert italic &quot;+&quot;justify landscape large larger left-side left leftwards level lighter lime line-through list-item local loud lower-alpha &quot;+&quot;lowercase lower-greek lower-latin lower-roman lower low ltr marker maroon medium message-box middle mix move narrower &quot;+&quot;navy ne-resize no-close-quote none no-open-quote no-repeat normal nowrap n-resize nw-resize oblique olive once open-quote outset &quot;+&quot;outside overline pointer portrait pre print projection purple red relative repeat repeat-x repeat-y rgb ridge right right-side &quot;+&quot;rightwards rtl run-in screen scroll semi-condensed semi-expanded separate se-resize show silent silver slower slow &quot;+&quot;small small-caps small-caption smaller soft solid speech spell-out square s-resize static status-bar sub super sw-resize &quot;+&quot;table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group teal &quot;+&quot;text-bottom text-top thick thin top transparent tty tv ultra-condensed ultra-expanded underline upper-alpha uppercase upper-latin &quot;+&quot;upper-roman url visible wait white wider w-resize x-fast x-high x-large x-loud x-low x-slow x-small x-soft xx-large xx-small yellow&quot;,A=&quot;[mM]onospace [tT]ahoma [vV]erdana [aA]rial [hH]elvetica [sS]ans-serif [sS]erif&quot;;this.regexList=[{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;\\#[a-zA-Z0-9]{3,6}&quot;,&quot;g&quot;),css:&quot;value&quot;},{regex:new RegExp(&quot;(-?\\d+)(.\\d+)?(px|em|pt|:|%|)&quot;,&quot;g&quot;),css:&quot;value&quot;},{regex:new RegExp(&quot;!important&quot;,&quot;g&quot;),css:&quot;important&quot;},{regex:new RegExp(this.GetKeywordsCSS(_),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetValuesCSS($),&quot;g&quot;),css:&quot;value&quot;},{regex:new RegExp(this.GetValuesCSS(A),&quot;g&quot;),css:&quot;value&quot;}];this.CssClass=&quot;dp-css&quot;;this.Style=&quot;.dp-css .value { color: black; }&quot;+&quot;.dp-css .important { color: red; }&quot;};dp.sh.Highlighter.prototype.GetKeywordsCSS=function($){return&quot;\\b([a-z_]|)&quot;+$.replace(/ /g,&quot;(?=:)\\b|\\b([a-z_\\*]|\\*|)&quot;)+&quot;(?=:)\\b&quot;};dp.sh.Highlighter.prototype.GetValuesCSS=function($){return&quot;\\b&quot;+$.replace(/ /g,&quot;(?!-)(?!:)\\b|\\b()&quot;)+&quot;:\\b&quot;};dp.sh.Brushes.CSS.prototype=new dp.sh.Highlighter();dp.sh.Brushes.CSS.Aliases=[&quot;css&quot;];dp.sh.Brushes.Delphi=function(){var $=&quot;abs addr and ansichar ansistring array as asm begin boolean byte cardinal &quot;+&quot;case char class comp const constructor currency destructor div do double &quot;+&quot;downto else end except exports extended false file finalization finally &quot;+&quot;for function goto if implementation in inherited int64 initialization &quot;+&quot;integer interface is label library longint longword mod nil not object &quot;+&quot;of on or packed pansichar pansistring pchar pcurrency pdatetime pextended &quot;+&quot;pint64 pointer private procedure program property pshortstring pstring &quot;+&quot;pvariant pwidechar pwidestring protected public published raise real real48 &quot;+&quot;record repeat set shl shortint shortstring shr single smallint string then &quot;+&quot;threadvar to true try type unit until uses val var varirnt while widechar &quot;+&quot;widestring with word write writeln xor&quot;;this.regexList=[{regex:new RegExp(&quot;\\(\\*[\\s\\S]*?\\*\\)&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:new RegExp(&quot;{(?!\\$)[\\s\\S]*?}&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;\\{\\$[a-zA-Z]+ .+\\}&quot;,&quot;g&quot;),css:&quot;directive&quot;},{regex:new RegExp(&quot;\\b[\\d\\.]+\\b&quot;,&quot;g&quot;),css:&quot;number&quot;},{regex:new RegExp(&quot;\\$[a-zA-Z0-9]+\\b&quot;,&quot;g&quot;),css:&quot;number&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-delphi&quot;;this.Style=&quot;.dp-delphi .number { color: blue; }&quot;+&quot;.dp-delphi .directive { color: #008284; }&quot;+&quot;.dp-delphi .vars { color: #000; }&quot;};dp.sh.Brushes.Delphi.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Delphi.Aliases=[&quot;delphi&quot;,&quot;pascal&quot;];dp.sh.Brushes.Java=function(){var $=&quot;abstract assert boolean break byte case catch char class const &quot;+&quot;continue default do double else enum extends &quot;+&quot;false final finally float for goto if implements import &quot;+&quot;instanceof int interface long native new null &quot;+&quot;package private protected public return &quot;+&quot;short static strictfp super switch synchronized this throw throws true &quot;+&quot;transient try void volatile while&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;\\b([\\d]+(\\.[\\d]+)?|0x[a-f0-9]+)\\b&quot;,&quot;gi&quot;),css:&quot;number&quot;},{regex:new RegExp(&quot;(?!\\@interface\\b)\\@[\\$\\w]+\\b&quot;,&quot;g&quot;),css:&quot;annotation&quot;},{regex:new RegExp(&quot;\\@interface\\b&quot;,&quot;g&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-j&quot;;this.Style=&quot;.dp-j .annotation { color: #646464; }&quot;+&quot;.dp-j .number { color: #C00000; }&quot;};dp.sh.Brushes.Java.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Java.Aliases=[&quot;java&quot;];dp.sh.Brushes.JScript=function(){var $=&quot;abstract boolean break byte case catch char class const continue debugger &quot;+&quot;default delete do double else enum export extends false final finally float &quot;+&quot;for function goto if implements import in instanceof int interface long native &quot;+&quot;new null package private protected public return short static super switch &quot;+&quot;synchronized this throw throws transient true try typeof var void volatile while with&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-c&quot;};dp.sh.Brushes.JScript.prototype=new dp.sh.Highlighter();dp.sh.Brushes.JScript.Aliases=[&quot;js&quot;,&quot;jscript&quot;,&quot;javascript&quot;];dp.sh.Brushes.Lua=function(){var $=&quot;break do end else elseif function if local nil not or repeat return and then until while this&quot;,_=&quot;math\\.\\w+ string\\.\\w+ os\\.\\w+ debug\\.\\w+ io\\.\\w+ error fopen dofile coroutine\\.\\w+ arg getmetatable ipairs loadfile loadlib loadstring longjmp print rawget rawset seek setmetatable assert tonumber tostring&quot;;this.regexList=[{regex:new RegExp(&quot;--\\[\\[[\\s\\S]*\\]\\]--&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:new RegExp(&quot;--[^\\[]{2}.*$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;func&quot;},];this.CssClass=&quot;dp-lua&quot;};dp.sh.Brushes.Lua.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Lua.Aliases=[&quot;lua&quot;];dp.sh.Brushes.Mxml=function(){this.CssClass=&quot;dp-mxml&quot;;this.Style=&quot;.dp-mxml .cdata { color: #000000; }&quot;+&quot;.dp-mxml .tag { color : #0000ff; }&quot;+&quot;.dp-mxml .tag-name { color: #0000ff; }&quot;+&quot;.dp-mxml .script { color: green; }&quot;+&quot;.dp-mxml .metadata { color: green; }&quot;+&quot;.dp-mxml .attribute { color: #000000; }&quot;+&quot;.dp-mxml .attribute-value { color: #990000; }&quot;+&quot;.dp-mxml .trace { color: #cc6666; }&quot;+&quot;.dp-mxml .var { color: #6699cc; }&quot;+&quot;.dp-mxml .comment { color: #009900; }&quot;+&quot;.dp-mxml .string { color: #990000; }&quot;+&quot;.dp-mxml .keyword { color: blue; }&quot;};dp.sh.Brushes.Mxml.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Mxml.Aliases=[&quot;mxml&quot;];dp.sh.Brushes.Mxml.prototype.ProcessRegexList=function(){function H(_,$){_[_.length]=$}function B(B,_){var A=0,$=false;for(A=0;A&lt;B.length;A++)if(_.index&gt;B[A].firstIndex&amp;&amp;_.index&lt;B[A].lastIndex)$=true;return $}var $=0,F=null,D=null,A=null,C=&quot;&quot;,E=new Array(),_=&quot;abstract boolean break byte case catch char class const continue debugger &quot;+&quot;default delete do double else enum export extends false final finally float &quot;+&quot;for function goto if implements import in instanceof int interface long native &quot;+&quot;new null package private protected public return short static super switch &quot;+&quot;synchronized this throw throws transient true try typeof var void volatile while with&quot;,G=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords(&quot;trace&quot;),&quot;gm&quot;),css:&quot;trace&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;keyword&quot;}];A=new RegExp(&quot;&amp;lt;\\!\\[CDATA\\[(.|\\s)*?\\]\\]&amp;gt;&quot;,&quot;gm&quot;);while((F=A.exec(this.code))!=null){C=F[0].substr(0,12);H(this.matches,new dp.sh.Match(C,F.index,&quot;cdata&quot;));C=F[0].substr(12,F[0].length-12-6);for(var I=0;I&lt;G.length;I++)while((D=G[I].regex.exec(C))!=null)H(this.matches,new dp.sh.Match(D[0],F.index+12+D.index,G[I].css));C=F[0].substr(F[0].length-6,6);H(this.matches,new dp.sh.Match(C,F.index+F[0].length-6,&quot;cdata&quot;));E.push({firstIndex:F.index,lastIndex:F.index+F[0].length-1})}this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)!--\\s*.*?\\s*--(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;comments&quot;);A=new RegExp(&quot;([:\\w-.]+)\\s*=\\s*(\&quot;.*?\&quot;|'.*?'|\\w+)*|(\\w+)&quot;,&quot;gm&quot;);while((F=A.exec(this.code))!=null){if(F[1]==null)continue;if(B(E,F))continue;H(this.matches,new dp.sh.Match(F[1],F.index,&quot;attribute&quot;));if(F[2]!=undefined)H(this.matches,new dp.sh.Match(F[2],F.index+F[0].indexOf(F[2]),&quot;attribute-value&quot;))}A=new RegExp(&quot;(?:&amp;lt;|&lt;)/*\\?*\\s*([:\\w-.]+)&quot;,&quot;gm&quot;);while((F=A.exec(this.code))!=null){if(B(E,F))continue;C=F[0].substr(4,F[0].length-4);switch(C){case&quot;mx:Script&quot;:case&quot;/mx:Script&quot;:H(this.matches,new dp.sh.Match(F[0]+&quot;&amp;gt;&quot;,F.index,&quot;script&quot;));break;case&quot;mx:Metadata&quot;:case&quot;/mx:Metadata&quot;:H(this.matches,new dp.sh.Match(F[0]+&quot;&amp;gt;&quot;,F.index,&quot;metadata&quot;));break;default:H(this.matches,new dp.sh.Match(F[0],F.index,&quot;tag-name&quot;));break}}A=new RegExp(&quot;\\?&amp;gt;|&amp;gt;|/&amp;gt;&quot;,&quot;gm&quot;);while((F=A.exec(this.code))!=null){if(B(E,F))continue;H(this.matches,new dp.sh.Match(F[0],F.index,&quot;tag&quot;))}};dp.sh.Brushes.Perl=function(){var _=&quot;abs accept alarm atan2 bind binmode bless caller chdir chmod chomp chop chown chr chroot close closedir connect cos crypt dbmclose dbmopen defined delete dump each endgrent endhostent endnetent endprotoent endpwent endservent eof exec exists exp fcntl fileno flock fork format formline getc getgrent getgrgid getgrnam gethostbyaddr gethostbyname gethostent getlogin getnetbyaddr getnetbyname getnetent getpeername getpgrp getppid getpriority getprotobyname getprotobynumber getprotoent getpwent getpwnam getpwuid getservbyname getservbyport getservent getsockname getsockopt glob gmtime grep hex import index int ioctl join keys kill lc lcfirst length link listen localtime lock log lstat m map mkdir msgctl msgget msgrcv msgsnd no oct open opendir ord pack pipe pop pos print printf prototype push q qq quotemeta qw qx rand read readdir readline readlink readpipe recv ref rename reset reverse rewinddir rindex rmdir scalar seek seekdir semctl semget semop send setgrent sethostent setnetent setpgrp setpriority setprotoent setpwent setservent setsockopt shift shmctl shmget shmread shmwrite shutdown sin sleep socket socketpair sort splice split sprintf sqrt srand stat study sub substr symlink syscall sysopen sysread sysseek system syswrite tell telldir tie tied time times tr truncate uc ucfirst umask undef unlink unpack unshift untie utime values vec waitpid wantarray warn write qr&quot;,$=&quot;s select goto die do package redo require return continue for foreach last next wait while use if else elsif eval exit unless switch case&quot;,A=&quot;my our local&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLinePerlComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;(\\$|@|%)\\w+&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gmi&quot;),css:&quot;func&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords(A),&quot;gm&quot;),css:&quot;declarations&quot;}];this.CssClass=&quot;dp-perl&quot;};dp.sh.Brushes.Perl.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Perl.Aliases=[&quot;perl&quot;];dp.sh.Brushes.Php=function(){var _=&quot;abs acos acosh addcslashes addslashes &quot;+&quot;array_change_key_case array_chunk array_combine array_count_values array_diff &quot;+&quot;array_diff_assoc array_diff_key array_diff_uassoc array_diff_ukey array_fill &quot;+&quot;array_filter array_flip array_intersect array_intersect_assoc array_intersect_key &quot;+&quot;array_intersect_uassoc array_intersect_ukey array_key_exists array_keys array_map &quot;+&quot;array_merge array_merge_recursive array_multisort array_pad array_pop array_product &quot;+&quot;array_push array_rand array_reduce array_reverse array_search array_shift &quot;+&quot;array_slice array_splice array_sum array_udiff array_udiff_assoc &quot;+&quot;array_udiff_uassoc array_uintersect array_uintersect_assoc &quot;+&quot;array_uintersect_uassoc array_unique array_unshift array_values array_walk &quot;+&quot;array_walk_recursive atan atan2 atanh base64_decode base64_encode base_convert &quot;+&quot;basename bcadd bccomp bcdiv bcmod bcmul bindec bindtextdomain bzclose bzcompress &quot;+&quot;bzdecompress bzerrno bzerror bzerrstr bzflush bzopen bzread bzwrite ceil chdir &quot;+&quot;checkdate checkdnsrr chgrp chmod chop chown chr chroot chunk_split class_exists &quot;+&quot;closedir closelog copy cos cosh count count_chars date decbin dechex decoct &quot;+&quot;deg2rad delete ebcdic2ascii echo empty end ereg ereg_replace eregi eregi_replace error_log &quot;+&quot;error_reporting escapeshellarg escapeshellcmd eval exec exit exp explode extension_loaded &quot;+&quot;feof fflush fgetc fgetcsv fgets fgetss file_exists file_get_contents file_put_contents &quot;+&quot;fileatime filectime filegroup fileinode filemtime fileowner fileperms filesize filetype &quot;+&quot;floatval flock floor flush fmod fnmatch fopen fpassthru fprintf fputcsv fputs fread fscanf &quot;+&quot;fseek fsockopen fstat ftell ftok getallheaders getcwd getdate getenv gethostbyaddr gethostbyname &quot;+&quot;gethostbynamel getimagesize getlastmod getmxrr getmygid getmyinode getmypid getmyuid getopt &quot;+&quot;getprotobyname getprotobynumber getrandmax getrusage getservbyname getservbyport gettext &quot;+&quot;gettimeofday gettype glob gmdate gmmktime ini_alter ini_get ini_get_all ini_restore ini_set &quot;+&quot;interface_exists intval ip2long is_a is_array is_bool is_callable is_dir is_double &quot;+&quot;is_executable is_file is_finite is_float is_infinite is_int is_integer is_link is_long &quot;+&quot;is_nan is_null is_numeric is_object is_readable is_real is_resource is_scalar is_soap_fault &quot;+&quot;is_string is_subclass_of is_uploaded_file is_writable is_writeable mkdir mktime nl2br &quot;+&quot;parse_ini_file parse_str parse_url passthru pathinfo readlink realpath rewind rewinddir rmdir &quot;+&quot;round str_ireplace str_pad str_repeat str_replace str_rot13 str_shuffle str_split &quot;+&quot;str_word_count strcasecmp strchr strcmp strcoll strcspn strftime strip_tags stripcslashes &quot;+&quot;stripos stripslashes stristr strlen strnatcasecmp strnatcmp strncasecmp strncmp strpbrk &quot;+&quot;strpos strptime strrchr strrev strripos strrpos strspn strstr strtok strtolower strtotime &quot;+&quot;strtoupper strtr strval substr substr_compare&quot;,$=&quot;and or xor __FILE__ __LINE__ array as break case &quot;+&quot;cfunction class const continue declare default die do else &quot;+&quot;elseif empty enddeclare endfor endforeach endif endswitch endwhile &quot;+&quot;extends for foreach function include include_once global if &quot;+&quot;new old_function return static switch use require require_once &quot;+&quot;var while __FUNCTION__ __CLASS__ &quot;+&quot;__METHOD__ abstract interface public implements extends private protected throw&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;\\$\\w+&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gmi&quot;),css:&quot;func&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-c&quot;};dp.sh.Brushes.Php.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Php.Aliases=[&quot;php&quot;];dp.sh.Brushes.Python=function(){var $=&quot;and assert break class continue def del elif else &quot;+&quot;except exec finally for from global if import in is &quot;+&quot;lambda not or pass print raise return try yield while&quot;,_=&quot;None True False self cls class_&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLinePerlComments,css:&quot;comment&quot;},{regex:new RegExp(&quot;^\\s*@\\w+&quot;,&quot;gm&quot;),css:&quot;decorator&quot;},{regex:new RegExp(&quot;(['\&quot;]{3})([^\\1])*?\\1&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:new RegExp(&quot;\&quot;(?!\&quot;)(?:\\.|\\\\\\\&quot;|[^\\\&quot;\&quot;\\n\\r])*\&quot;&quot;,&quot;gm&quot;),css:&quot;string&quot;},{regex:new RegExp(&quot;'(?!')*(?:\\.|(\\\\\\')|[^\\''\\n\\r])*'&quot;,&quot;gm&quot;),css:&quot;string&quot;},{regex:new RegExp(&quot;\\b\\d+\\.?\\w*&quot;,&quot;g&quot;),css:&quot;number&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;special&quot;}];this.CssClass=&quot;dp-py&quot;;this.Style=&quot;.dp-py .builtins { color: #ff1493; }&quot;+&quot;.dp-py .magicmethods { color: #808080; }&quot;+&quot;.dp-py .exceptions { color: brown; }&quot;+&quot;.dp-py .types { color: brown; font-style: italic; }&quot;+&quot;.dp-py .commonlibs { color: #8A2BE2; font-style: italic; }&quot;};dp.sh.Brushes.Python.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Python.Aliases=[&quot;py&quot;,&quot;python&quot;];dp.sh.Brushes.Ruby=function(){var $=&quot;alias and BEGIN begin break case class def define_method defined do each else elsif &quot;+&quot;END end ensure false for if in module new next nil not or raise redo rescue retry return &quot;+&quot;self super then throw true undef unless until when while yield&quot;,_=&quot;Array Bignum Binding Class Continuation Dir Exception FalseClass File::Stat File Fixnum Fload &quot;+&quot;Hash Integer IO MatchData Method Module NilClass Numeric Object Proc Range Regexp String Struct::TMS Symbol &quot;+&quot;ThreadGroup Thread Time TrueClass&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLinePerlComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;:[a-z][A-Za-z0-9_]*&quot;,&quot;g&quot;),css:&quot;symbol&quot;},{regex:new RegExp(&quot;(\\$|@@|@)\\w+&quot;,&quot;g&quot;),css:&quot;variable&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;builtin&quot;}];this.CssClass=&quot;dp-rb&quot;;this.Style=&quot;.dp-rb .symbol { color: #a70; }&quot;+&quot;.dp-rb .variable { color: #a70; font-weight: bold; }&quot;};dp.sh.Brushes.Ruby.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Ruby.Aliases=[&quot;ruby&quot;,&quot;rails&quot;,&quot;ror&quot;];dp.sh.Brushes.Sql=function(){var _=&quot;abs avg case cast coalesce convert count current_timestamp &quot;+&quot;current_user day isnull left lower month nullif replace right &quot;+&quot;session_user space substring sum system_user upper user year&quot;,$=&quot;absolute action add after alter as asc at authorization begin bigint &quot;+&quot;binary bit by cascade char character check checkpoint close collate &quot;+&quot;column commit committed connect connection constraint contains continue &quot;+&quot;create cube current current_date current_time cursor database date &quot;+&quot;deallocate dec decimal declare default delete desc distinct double drop &quot;+&quot;dynamic else end end-exec escape except exec execute false fetch first &quot;+&quot;float for force foreign forward free from full function global goto grant &quot;+&quot;group grouping having hour ignore index inner insensitive insert instead &quot;+&quot;int integer intersect into is isolation key last level load local max min &quot;+&quot;minute modify move name national nchar next no numeric of off on only &quot;+&quot;open option order out output partial password precision prepare primary &quot;+&quot;prior privileges procedure public read real references relative repeatable &quot;+&quot;restrict return returns revoke rollback rollup rows rule schema scroll &quot;+&quot;second section select sequence serializable set size smallint static &quot;+&quot;statistics table temp temporary then time timestamp to top transaction &quot;+&quot;translation trigger true truncate uncommitted union unique update values &quot;+&quot;varchar varying view when where with work&quot;,A=&quot;all and any between cross in join like not null or outer some&quot;;this.regexList=[{regex:new RegExp(&quot;--(.*)$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gmi&quot;),css:&quot;func&quot;},{regex:new RegExp(this.GetKeywords(A),&quot;gmi&quot;),css:&quot;op&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gmi&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-sql&quot;;this.Style=&quot;.dp-sql .func { color: #ff1493; }&quot;+&quot;.dp-sql .op { color: #808080; }&quot;};dp.sh.Brushes.Sql.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Sql.Aliases=[&quot;sql&quot;];dp.sh.Brushes.Vb=function(){var $=&quot;AddHandler AddressOf AndAlso Alias And Ansi As Assembly Auto &quot;+&quot;Boolean ByRef Byte ByVal Call Case Catch CBool CByte CChar CDate &quot;+&quot;CDec CDbl Char CInt Class CLng CObj Const CShort CSng CStr CType &quot;+&quot;Date Decimal Declare Default Delegate Dim DirectCast Do Double Each &quot;+&quot;Else ElseIf End Enum Erase Error Event Exit False Finally For Friend &quot;+&quot;Function Get GetType GoSub GoTo Handles If Implements Imports In &quot;+&quot;Inherits Integer Interface Is Let Lib Like Long Loop Me Mod Module &quot;+&quot;MustInherit MustOverride MyBase MyClass Namespace New Next Not Nothing &quot;+&quot;NotInheritable NotOverridable Object On Option Optional Or OrElse &quot;+&quot;Overloads Overridable Overrides ParamArray Preserve Private Property &quot;+&quot;Protected Public RaiseEvent ReadOnly ReDim REM RemoveHandler Resume &quot;+&quot;Return Select Set Shadows Shared Short Single Static Step Stop String &quot;+&quot;Structure Sub SyncLock Then Throw To True Try TypeOf Unicode Until &quot;+&quot;Variant When While With WithEvents WriteOnly Xor&quot;;this.regexList=[{regex:new RegExp(&quot;'.*$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-vb&quot;};dp.sh.Brushes.Vb.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Vb.Aliases=[&quot;vb&quot;,&quot;vb.net&quot;];dp.sh.Brushes.Xml=function(){this.CssClass=&quot;dp-xml&quot;;this.Style=&quot;.dp-xml .cdata { color: #ff1493; }&quot;+&quot;.dp-xml .tag, .dp-xml .tag-name { color: #069; font-weight: bold; }&quot;+&quot;.dp-xml .attribute { color: red; }&quot;+&quot;.dp-xml .attribute-value { color: blue; }&quot;};dp.sh.Brushes.Xml.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Xml.Aliases=[&quot;xml&quot;,&quot;xhtml&quot;,&quot;xslt&quot;,&quot;html&quot;,&quot;xhtml&quot;];dp.sh.Brushes.Xml.prototype.ProcessRegexList=function(){function B(_,$){_[_.length]=$}var $=0,A=null,_=null;this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)\\!\\[[\\w\\s]*?\\[(.|\\s)*?\\]\\](&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;cdata&quot;);this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)!--\\s*.*?\\s*--(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;comments&quot;);_=new RegExp(&quot;([:\\w-.]+)\\s*=\\s*(\&quot;.*?\&quot;|'.*?'|\\w+)*|(\\w+)&quot;,&quot;gm&quot;);while((A=_.exec(this.code))!=null){if(A[1]==null)continue;B(this.matches,new dp.sh.Match(A[1],A.index,&quot;attribute&quot;));if(A[2]!=undefined)B(this.matches,new dp.sh.Match(A[2],A.index+A[0].indexOf(A[2]),&quot;attribute-value&quot;))}this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)/*\\?*(?!\\!)|/*\\?*(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;tag&quot;);_=new RegExp(&quot;(?:&amp;lt;|&lt;)/*\\?*\\s*([:\\w-.]+)&quot;,&quot;gm&quot;);while((A=_.exec(this.code))!=null)B(this.matches,new dp.sh.Match(A[1],A.index+A[0].indexOf(A[1]),&quot;tag-name&quot;))}
//}}}</pre>
</div>
<div title="Temp" modifier="teloon" created="200905220604" modified="200905220659" changecount="4">
<pre>[[foobar显示歌词心得]]</pre>
</div>
<div title="TiddlyWiki" modifier="teloon" created="200902081503" modified="200902140912" tags="tiddlywiki" changecount="7">
<pre>*TiddlyWiki是采用Javascript+CSS+HTML构成的小程序，外表看起来仅仅是一个html页面，但由于其中采用js技术，就显得很酷很炫，真是可以称为绿色软件。它与wiki的不同之处是不能像一般的wiki程序一样在网络上由多人共同编辑，其他的功能一概不缺。而且，TiddlyWiki只需要通过浏览器执行，完全不需要PHP，或者ASP以及数据库等的支持。
*TiddlyWiki是由Jeremy Ruston开发的，目前Bram Chen的简体中文翻译，由于fans众多，而且都很努力，所以目前出现了多种版本应用，已经出现可以在网络上直接编辑的TiddlyWiki。
*那TiddlyWiki到底可以用来做什么呢？
*#在本地电脑中，它可以用来做记事本，日记，备忘录等等，但我个人感觉用来收集资料或者做教程将是非常理想，因为Wiki的内部互相链接，可以使一个框架不断展开，直到深层。
*#你也可以像我一样，将你编辑的内容上传变成一个网页或者网站。
台湾同胞在TiddlyWiki方面的研究远远超过了中国大陆，您可以在[[相关链接]]查看更多专业的作者，快速进步，变成高手。</pre>
</div>
<div title="TiddlyWikiAdaptations" modifier="teloon" created="200902090420" tags="resources tutorials" changecount="1">
<pre>Here is an incomplete list of some excellent TiddlyWiki Adaptations. If you want to be listed here, just email me at &quot;jim at barr dot net&quot; and I will gladly add your site!
|~JimBarr's ~TiddlyWikiTasks |http://TiddlyWikiTips.com/TiddlyWikiTasks.html|
|~KeithHodges' ~TiddlyPom |http://www.warwick.ac.uk/~tuspam/tiddlypom.html|
|~RodneyGomes' ~RoWiki, based on PyTW |http://rodney.gotdns.com/|
|~LarsEnglund's ~TiddlyWikiRDF |http://larsenglund.com/TiddlyWikiRDF/|
|~BramChen's ~PrinceTiddlyWiki |http://ptw.sf.net/index-en.html|
|~JoshGoebel's ~ServerSideWiki |http://www.serversidewiki.com|
|~MasakiYatsu's ~LesserWiki |http://lesserwiki.org/|
|~MichaelBridgen's ~StickyWiki |http://www.squaremobius.net/~mikeb/Darcs/sticky-wiki/|
|~DavidHarper's ~BloTid |http://www.spacecoastweb.net/BloTid/Tiddly/|
|~EricShulman's ELS Design site |http://www.elsdesign.com/tiddlywiki/|
|~JacquesTurbé's ~TidliPo, in French |http://avm.free.fr/tidlipo.html|
|~JoeRaii's pytw |http://www.cs.utexas.edu/~joeraii/pytw/ |
|and his Siglet |http://www.cs.utexas.edu/~joeraii/siglet/|
|~JároliJózsef's ~MagyarTiddlyWiki |http://innen.hu/MagyarTiddlyWiki in Hungarian|
|Yoshimov's ~EncryptedTiddlyWiki |http://wiki.yoshimov.com/?page=EncryptedTiddlyWiki|
|~TiagoDionizio's ~TsWiki using Tcl and ~SQLite |http://mega.ist.utl.pt/~tngd/wiki/|
|~TimMorgan's ~ZiddlyWiki based on Zope |http://timmorgan.org/ZiddlyWiki/|
|~SteveRumsby's ~YetAnotherTiddlyWikiAdaptation |http://www.rumsby.org/yatwa/|
|~PhonoHawk's ~PerlTiddlyWiki |http://ccm.sherry.jp/tiddly/|
|~NathanBower's ~GTDTiddlyWiki |http://shared.snapgrid.com/gtd_tiddlywiki.html|
|~SimonBaird's ~MonkeyPirateTiddlyWiki |http://simonbaird.com/mptw/|
|~GeetDuggal's ~PileTiddly |http://www.geetduggal.com/PileTiddly/|
|~DanPhiffer's ~TiddlyWikiRemote |http://phiffer.org/tiddly/|
|~JonnyLeRoy's ~TiddlyTagWiki |http://www.digitaldimsum.co.uk/|
|~JodyFoo's ~TagglyWiki |http://informationality.com/tagglywiki/tagglywiki.html|
|~ChristianHauck's |http://www.christianhauck.net/html/14300.html|
|~TonyLownds's ~TiddlyHacks |http://tony.lownds.com/tiddly/dev/cgi/index.cgi|
|~AlanHecht's ~QwikiWeb |http://snipurl.com/qwikiweb|
|~TimCuthbertson and ~MattGiuca's ~TiddlyWikiCSS |http://codestar.lidonet.net/misc/tiddlywikicss.html|
|~PeterLazarev's further improvements |http://petka.webhop.net/#NiceTiddlyWiki|
|~PatrickCurry and ~GabrielJeffrey's ~PhpTiddlyWiki |http://www.patrickcurry.com/tiddly/|
|~KevemBuangga's ~TiddlyWikiClone |http://www.kevembuangga.com/hwk/hailiwiki.htm|
|Inspired by ~TiddlyWiki, Dr ~MichaelRees' ~DotWikIE |http://comet.it.bond.edu.au/dotsoft/Pages/dotwikiehome.aspx|</pre>
</div>
<div title="Tokyo Cabinet数据库" modifier="YourName" created="200908141032" modified="201007240832" changecount="6">
<pre>相关资源：[[igvita|http://www.igvita.com/2009/02/13/tokyo-cabinet-beyond-key-value-store/]]的这篇很详细的介绍，以及[[官方文档|http://tokyocabinet.sourceforge.net/spex-en.html]]

看下来有如下几点理解：
#Cabinet快在他是key-value形的数据库，所以存储overhead也少了很多
#但是Cabinet功能不简单，照样提供了具有关系类型的tableDatabase
#各个类型的database的特点如下(其实官方文档上很清楚了)：
&gt;Hash Database速度很快，支持变长，但是不提供排序功能；
&gt;B＋ 同样支持变长，因为支持排序，所以速度较Hash慢；
&gt;Fixed Length 不支持排序，不支持变长，但是也因此速度嗖嗖的，而且用mmap映射到内存，磁盘I/O进一步减少，速度更嗖嗖的；
&gt;Table 支持变长，可以排序，有传统relational database复杂的功能，所以速度也影响，但是他更灵活(如不需要定义schema，详见igvita的文章)；
总结来说：
&gt;''速度：''{{{Fixed Length &gt; Hash Database &gt; B+ &gt; Table }}}
&gt;''功能：''{{{与速度正好相反}}}
具体使用要看情况

@@color(red):跟新@@
[[这篇文章|http://willko.javaeye.com/blog/333003]]的留言里作者讲到了三种不同类型数据库的特点及应用场景，作者博客里的其他几篇文章也很不错
[[这个博客|http://zhliji2.blogspot.com/2009/04/phptokyo-cabinetmemcache.html]]里有是几篇将tokyo的，主要是和PHP互操作</pre>
</div>
<div title="TspotSetupPlugin" modifier="YourName" created="200808081041" modified="200808081041" tags="systemConfig" server.page.revision="200808081041" server.host="telooon.tiddlyspot.com" server.type="file">
<pre>/***
Description: Contains the stuff you need to use Tiddlyspot
Note, you also need UploadPlugin, PasswordOptionPlugin and LoadRemoteFileThroughProxy
from http://tiddlywiki.bidix.info for a complete working Tiddlyspot site.
***/
//{{{

// edit this if you are migrating sites or retrofitting an existing TW
config.tiddlyspotSiteId = 'telooon';

// make it so you can by default see edit controls via http
config.options.chkHttpReadOnly = false;
window.readOnly = false; // make sure of it (for tw 2.2)
window.showBackstage = true; // show backstage too

// disable autosave in d3
if (window.location.protocol != &quot;file:&quot;)
	config.options.chkGTDLazyAutoSave = false;

// tweak shadow tiddlers to add upload button, password entry box etc
with (config.shadowTiddlers) {
	SiteUrl = 'http://'+config.tiddlyspotSiteId+'.tiddlyspot.com';
	SideBarOptions = SideBarOptions.replace(/(&lt;&lt;saveChanges&gt;&gt;)/,&quot;$1&lt;&lt;tiddler TspotSidebar&gt;&gt;&quot;);
	OptionsPanel = OptionsPanel.replace(/^/,&quot;&lt;&lt;tiddler TspotOptions&gt;&gt;&quot;);
	DefaultTiddlers = DefaultTiddlers.replace(/^/,&quot;[[WelcomeToTiddlyspot]] &quot;);
	MainMenu = MainMenu.replace(/^/,&quot;[[WelcomeToTiddlyspot]] &quot;);
}

// create some shadow tiddler content
merge(config.shadowTiddlers,{

'TspotOptions':[
 &quot;tiddlyspot password:&quot;,
 &quot;&lt;&lt;option pasUploadPassword&gt;&gt;&quot;,
 &quot;&quot;
].join(&quot;\n&quot;),

'TspotControls':[
 &quot;| tiddlyspot password:|&lt;&lt;option pasUploadPassword&gt;&gt;|&quot;,
 &quot;| site management:|&lt;&lt;upload http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/store.cgi index.html . .  &quot; + config.tiddlyspotSiteId + &quot;&gt;&gt;//(requires tiddlyspot password)//&lt;br&gt;[[control panel|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/controlpanel]], [[download (go offline)|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/download]]|&quot;,
 &quot;| links:|[[tiddlyspot.com|http://tiddlyspot.com/]], [[FAQs|http://faq.tiddlyspot.com/]], [[blog|http://tiddlyspot.blogspot.com/]], email [[support|mailto:support@tiddlyspot.com]] &amp; [[feedback|mailto:feedback@tiddlyspot.com]], [[donate|http://tiddlyspot.com/?page=donate]]|&quot;
].join(&quot;\n&quot;),

'WelcomeToTiddlyspot':[
 &quot;This document is a ~TiddlyWiki from tiddlyspot.com.  A ~TiddlyWiki is an electronic notebook that is great for managing todo lists, personal information, and all sorts of things.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //What now?// &amp;nbsp;&amp;nbsp;@@ Before you can save any changes, you need to enter your password in the form below.  Then configure privacy and other site settings at your [[control panel|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/controlpanel]] (your control panel username is //&quot; + config.tiddlyspotSiteId + &quot;//).&quot;,
 &quot;&lt;&lt;tiddler TspotControls&gt;&gt;&quot;,
 &quot;See also GettingStarted.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Working online// &amp;nbsp;&amp;nbsp;@@ You can edit this ~TiddlyWiki right now, and save your changes using the \&quot;save to web\&quot; button in the column on the right.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Working offline// &amp;nbsp;&amp;nbsp;@@ A fully functioning copy of this ~TiddlyWiki can be saved onto your hard drive or USB stick.  You can make changes and save them locally without being connected to the Internet.  When you're ready to sync up again, just click \&quot;upload\&quot; and your ~TiddlyWiki will be saved back to tiddlyspot.com.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Help!// &amp;nbsp;&amp;nbsp;@@ Find out more about ~TiddlyWiki at [[TiddlyWiki.com|http://tiddlywiki.com]].  Also visit [[TiddlyWiki.org|http://tiddlywiki.org]] for documentation on learning and using ~TiddlyWiki. New users are especially welcome on the [[TiddlyWiki mailing list|http://groups.google.com/group/TiddlyWiki]], which is an excellent place to ask questions and get help.  If you have a tiddlyspot related problem email [[tiddlyspot support|mailto:support@tiddlyspot.com]].&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Enjoy :)// &amp;nbsp;&amp;nbsp;@@ We hope you like using your tiddlyspot.com site.  Please email [[feedback@tiddlyspot.com|mailto:feedback@tiddlyspot.com]] with any comments or suggestions.&quot;
].join(&quot;\n&quot;),

'TspotSidebar':[
 &quot;&lt;&lt;upload http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/store.cgi index.html . .  &quot; + config.tiddlyspotSiteId + &quot;&gt;&gt;&lt;html&gt;&lt;a href='http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/download' class='button'&gt;download&lt;/a&gt;&lt;/html&gt;&quot;
].join(&quot;\n&quot;)

});
//}}}</pre>
</div>
<div title="Ubuntu8.04环境 boost手动安装" modifier="wy" created="200907260620" modified="200907260623" tags="boost 安装" changecount="5">
<pre>根据[[这里|http://hi.baidu.com/wuxicn/blog/item/20eb1a0a84913b1a94ca6ba0.html]]所说的下载解压，HEAD ONLY部分一样，但是下面要编译安装部分还是参考官网上[[教程|http://www.boost.org/doc/libs/1_39_0/more/getting_started/unix-variants.html#build-directory]]。

下面这些库是需要单独编译的:
* Boost.Filesystem
* Boost.IOStreams
* Boost.ProgramOptions
* Boost.Python (see the Boost.Python build documentation before building and installing it)
* Boost.Regex
* Boost.Serialization
* Boost.Signals
* Boost.System
* Boost.Thread
* Boost.Wave

编译步骤如下同官网教程5.1节，但要注意的是
*''./bootstrap.sh''生成的是''project-config.jam''文件，应该是bjam工具的配置文件
*''{{{--prefix=path/to/installation/prefix}}}''参数是指定下一步运行bjam生成链接文件的位置；{{{--with-libraries=filesystem}}}参数来指定编译的库;其他可用{{{--help}}}来查看相关选项；
*''./bjam install''生成的主要内容是''stage文件夹''，里面的内容是所需要的连接文件。还有些中间文件生成，如bin.v2目录
*最后把stage目录中的文件拷到/usr/lib目录，这样就可用''-lboost_filesystem-gcc42-mt''参数来连接它</pre>
</div>
<div title="UploadLog" modifier="wy" created="201110110505" modified="201304080910" server.page.revision="201110110541" server.host="telooon.tiddlyspot.com" server.type="file">
<pre>| !date | !user | !location | !storeUrl | !uploadDir | !toFilename | !backupdir | !origin |
| 04/11/2011 13:55:11 | wy | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . |
| 28/12/2011 12:35:28 | wy | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . |
| 29/12/2011 14:02:58 | YourName | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . |
| 16/02/2012 00:16:50 | teloon | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . |
| 02/03/2012 14:37:01 | teloon | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . |
| 23/04/2012 22:59:32 | wy | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . |
| 04/09/2012 12:58:09 | wy | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . |
| 08/04/2013 17:07:56 | wy | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . | ok |
| 08/04/2013 17:09:48 | wy | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . | ok |
| 08/04/2013 17:10:37 | wy | [[/|http://telooon.tiddlyspot.com/]] | [[store.cgi|http://telooon.tiddlyspot.com/store.cgi]] | . | [[index.html | http://telooon.tiddlyspot.com/index.html]] | . |</pre>
</div>
<div title="UploadPlugin" modifier="YourName" created="200808080918" modified="201110110509" tags="systemConfig" server.page.revision="201110110509" server.host="telooon.tiddlyspot.com" server.type="file">
<pre>/***
|''Name:''|UploadPlugin|
|''Description:''|Save to web a TiddlyWiki|
|''Version:''|4.1.3|
|''Date:''|Feb 24, 2008|
|''Source:''|http://tiddlywiki.bidix.info/#UploadPlugin|
|''Documentation:''|http://tiddlywiki.bidix.info/#UploadPluginDoc|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0|
|''Requires:''|PasswordOptionPlugin|
***/
//{{{
version.extensions.UploadPlugin = {
	major: 4, minor: 1, revision: 3,
	date: new Date(&quot;Feb 24, 2008&quot;),
	source: 'http://tiddlywiki.bidix.info/#UploadPlugin',
	author: 'BidiX (BidiX (at) bidix (dot) info',
	coreVersion: '2.2.0'
};

//
// Environment
//

if (!window.bidix) window.bidix = {}; // bidix namespace
bidix.debugMode = false;	// true to activate both in Plugin and UploadService
	
//
// Upload Macro
//

config.macros.upload = {
// default values
	defaultBackupDir: '',	//no backup
	defaultStoreScript: &quot;store.php&quot;,
	defaultToFilename: &quot;index.html&quot;,
	defaultUploadDir: &quot;.&quot;,
	authenticateUser: true	// UploadService Authenticate User
};
	
config.macros.upload.label = {
	promptOption: &quot;Save and Upload this TiddlyWiki with UploadOptions&quot;,
	promptParamMacro: &quot;Save and Upload this TiddlyWiki in %0&quot;,
	saveLabel: &quot;save to web&quot;, 
	saveToDisk: &quot;save to disk&quot;,
	uploadLabel: &quot;upload&quot;	
};

config.macros.upload.messages = {
	noStoreUrl: &quot;No store URL in parmeters or options&quot;,
	usernameOrPasswordMissing: &quot;Username or password missing&quot;
};

config.macros.upload.handler = function(place,macroName,params) {
	if (readOnly)
		return;
	var label;
	if (document.location.toString().substr(0,4) == &quot;http&quot;) 
		label = this.label.saveLabel;
	else
		label = this.label.uploadLabel;
	var prompt;
	if (params[0]) {
		prompt = this.label.promptParamMacro.toString().format([this.destFile(params[0], 
			(params[1] ? params[1]:bidix.basename(window.location.toString())), params[3])]);
	} else {
		prompt = this.label.promptOption;
	}
	createTiddlyButton(place, label, prompt, function() {config.macros.upload.action(params);}, null, null, this.accessKey);
};

config.macros.upload.action = function(params)
{
		// for missing macro parameter set value from options
		if (!params) params = {};
		var storeUrl = params[0] ? params[0] : config.options.txtUploadStoreUrl;
		var toFilename = params[1] ? params[1] : config.options.txtUploadFilename;
		var backupDir = params[2] ? params[2] : config.options.txtUploadBackupDir;
		var uploadDir = params[3] ? params[3] : config.options.txtUploadDir;
		var username = params[4] ? params[4] : config.options.txtUploadUserName;
		var password = config.options.pasUploadPassword; // for security reason no password as macro parameter	
		// for still missing parameter set default value
		if ((!storeUrl) &amp;&amp; (document.location.toString().substr(0,4) == &quot;http&quot;)) 
			storeUrl = bidix.dirname(document.location.toString())+'/'+config.macros.upload.defaultStoreScript;
		if (storeUrl.substr(0,4) != &quot;http&quot;)
			storeUrl = bidix.dirname(document.location.toString()) +'/'+ storeUrl;
		if (!toFilename)
			toFilename = bidix.basename(window.location.toString());
		if (!toFilename)
			toFilename = config.macros.upload.defaultToFilename;
		if (!uploadDir)
			uploadDir = config.macros.upload.defaultUploadDir;
		if (!backupDir)
			backupDir = config.macros.upload.defaultBackupDir;
		// report error if still missing
		if (!storeUrl) {
			alert(config.macros.upload.messages.noStoreUrl);
			clearMessage();
			return false;
		}
		if (config.macros.upload.authenticateUser &amp;&amp; (!username || !password)) {
			alert(config.macros.upload.messages.usernameOrPasswordMissing);
			clearMessage();
			return false;
		}
		bidix.upload.uploadChanges(false,null,storeUrl, toFilename, uploadDir, backupDir, username, password); 
		return false; 
};

config.macros.upload.destFile = function(storeUrl, toFilename, uploadDir) 
{
	if (!storeUrl)
		return null;
		var dest = bidix.dirname(storeUrl);
		if (uploadDir &amp;&amp; uploadDir != '.')
			dest = dest + '/' + uploadDir;
		dest = dest + '/' + toFilename;
	return dest;
};

//
// uploadOptions Macro
//

config.macros.uploadOptions = {
	handler: function(place,macroName,params) {
		var wizard = new Wizard();
		wizard.createWizard(place,this.wizardTitle);
		wizard.addStep(this.step1Title,this.step1Html);
		var markList = wizard.getElement(&quot;markList&quot;);
		var listWrapper = document.createElement(&quot;div&quot;);
		markList.parentNode.insertBefore(listWrapper,markList);
		wizard.setValue(&quot;listWrapper&quot;,listWrapper);
		this.refreshOptions(listWrapper,false);
		var uploadCaption;
		if (document.location.toString().substr(0,4) == &quot;http&quot;) 
			uploadCaption = config.macros.upload.label.saveLabel;
		else
			uploadCaption = config.macros.upload.label.uploadLabel;
		
		wizard.setButtons([
				{caption: uploadCaption, tooltip: config.macros.upload.label.promptOption, 
					onClick: config.macros.upload.action},
				{caption: this.cancelButton, tooltip: this.cancelButtonPrompt, onClick: this.onCancel}
				
			]);
	},
	options: [
		&quot;txtUploadUserName&quot;,
		&quot;pasUploadPassword&quot;,
		&quot;txtUploadStoreUrl&quot;,
		&quot;txtUploadDir&quot;,
		&quot;txtUploadFilename&quot;,
		&quot;txtUploadBackupDir&quot;,
		&quot;chkUploadLog&quot;,
		&quot;txtUploadLogMaxLine&quot;		
	],
	refreshOptions: function(listWrapper) {
		var opts = [];
		for(i=0; i&lt;this.options.length; i++) {
			var opt = {};
			opts.push();
			opt.option = &quot;&quot;;
			n = this.options[i];
			opt.name = n;
			opt.lowlight = !config.optionsDesc[n];
			opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
			opts.push(opt);
		}
		var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
		for(n=0; n&lt;opts.length; n++) {
			var type = opts[n].name.substr(0,3);
			var h = config.macros.option.types[type];
			if (h &amp;&amp; h.create) {
				h.create(opts[n].colElements['option'],type,opts[n].name,opts[n].name,&quot;no&quot;);
			}
		}
		
	},
	onCancel: function(e)
	{
		backstage.switchTab(null);
		return false;
	},
	
	wizardTitle: &quot;Upload with options&quot;,
	step1Title: &quot;These options are saved in cookies in your browser&quot;,
	step1Html: &quot;&lt;input type='hidden' name='markList'&gt;&lt;/input&gt;&lt;br&gt;&quot;,
	cancelButton: &quot;Cancel&quot;,
	cancelButtonPrompt: &quot;Cancel prompt&quot;,
	listViewTemplate: {
		columns: [
			{name: 'Description', field: 'description', title: &quot;Description&quot;, type: 'WikiText'},
			{name: 'Option', field: 'option', title: &quot;Option&quot;, type: 'String'},
			{name: 'Name', field: 'name', title: &quot;Name&quot;, type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'} 
			]}
};

//
// upload functions
//

if (!bidix.upload) bidix.upload = {};

if (!bidix.upload.messages) bidix.upload.messages = {
	//from saving
	invalidFileError: &quot;The original file '%0' does not appear to be a valid TiddlyWiki&quot;,
	backupSaved: &quot;Backup saved&quot;,
	backupFailed: &quot;Failed to upload backup file&quot;,
	rssSaved: &quot;RSS feed uploaded&quot;,
	rssFailed: &quot;Failed to upload RSS feed file&quot;,
	emptySaved: &quot;Empty template uploaded&quot;,
	emptyFailed: &quot;Failed to upload empty template file&quot;,
	mainSaved: &quot;Main TiddlyWiki file uploaded&quot;,
	mainFailed: &quot;Failed to upload main TiddlyWiki file. Your changes have not been saved&quot;,
	//specific upload
	loadOriginalHttpPostError: &quot;Can't get original file&quot;,
	aboutToSaveOnHttpPost: 'About to upload on %0 ...',
	storePhpNotFound: &quot;The store script '%0' was not found.&quot;
};

bidix.upload.uploadChanges = function(onlyIfDirty,tiddlers,storeUrl,toFilename,uploadDir,backupDir,username,password)
{
	var callback = function(status,uploadParams,original,url,xhr) {
		if (!status) {
			displayMessage(bidix.upload.messages.loadOriginalHttpPostError);
			return;
		}
		if (bidix.debugMode) 
			alert(original.substr(0,500)+&quot;\n...&quot;);
		// Locate the storeArea div's 
		var posDiv = locateStoreArea(original);
		if((posDiv[0] == -1) || (posDiv[1] == -1)) {
			alert(config.messages.invalidFileError.format([localPath]));
			return;
		}
		bidix.upload.uploadRss(uploadParams,original,posDiv);
	};
	
	if(onlyIfDirty &amp;&amp; !store.isDirty())
		return;
	clearMessage();
	// save on localdisk ?
	if (document.location.toString().substr(0,4) == &quot;file&quot;) {
		var path = document.location.toString();
		var localPath = getLocalPath(path);
		saveChanges();
	}
	// get original
	var uploadParams = new Array(storeUrl,toFilename,uploadDir,backupDir,username,password);
	var originalPath = document.location.toString();
	// If url is a directory : add index.html
	if (originalPath.charAt(originalPath.length-1) == &quot;/&quot;)
		originalPath = originalPath + &quot;index.html&quot;;
	var dest = config.macros.upload.destFile(storeUrl,toFilename,uploadDir);
	var log = new bidix.UploadLog();
	log.startUpload(storeUrl, dest, uploadDir,  backupDir);
	displayMessage(bidix.upload.messages.aboutToSaveOnHttpPost.format([dest]));
	if (bidix.debugMode) 
		alert(&quot;about to execute Http - GET on &quot;+originalPath);
	var r = doHttp(&quot;GET&quot;,originalPath,null,null,username,password,callback,uploadParams,null);
	if (typeof r == &quot;string&quot;)
		displayMessage(r);
	return r;
};

bidix.upload.uploadRss = function(uploadParams,original,posDiv) 
{
	var callback = function(status,params,responseText,url,xhr) {
		if(status) {
			var destfile = responseText.substring(responseText.indexOf(&quot;destfile:&quot;)+9,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;destfile:&quot;)));
			displayMessage(bidix.upload.messages.rssSaved,bidix.dirname(url)+'/'+destfile);
			bidix.upload.uploadMain(params[0],params[1],params[2]);
		} else {
			displayMessage(bidix.upload.messages.rssFailed);			
		}
	};
	// do uploadRss
	if(config.options.chkGenerateAnRssFeed) {
		var rssPath = uploadParams[1].substr(0,uploadParams[1].lastIndexOf(&quot;.&quot;)) + &quot;.xml&quot;;
		var rssUploadParams = new Array(uploadParams[0],rssPath,uploadParams[2],'',uploadParams[4],uploadParams[5]);
		var rssString = generateRss();
		// no UnicodeToUTF8 conversion needed when location is &quot;file&quot; !!!
		if (document.location.toString().substr(0,4) != &quot;file&quot;)
			rssString = convertUnicodeToUTF8(rssString);	
		bidix.upload.httpUpload(rssUploadParams,rssString,callback,Array(uploadParams,original,posDiv));
	} else {
		bidix.upload.uploadMain(uploadParams,original,posDiv);
	}
};

bidix.upload.uploadMain = function(uploadParams,original,posDiv) 
{
	var callback = function(status,params,responseText,url,xhr) {
		var log = new bidix.UploadLog();
		if(status) {
			// if backupDir specified
			if ((params[3]) &amp;&amp; (responseText.indexOf(&quot;backupfile:&quot;) &gt; -1))  {
				var backupfile = responseText.substring(responseText.indexOf(&quot;backupfile:&quot;)+11,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;backupfile:&quot;)));
				displayMessage(bidix.upload.messages.backupSaved,bidix.dirname(url)+'/'+backupfile);
			}
			var destfile = responseText.substring(responseText.indexOf(&quot;destfile:&quot;)+9,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;destfile:&quot;)));
			displayMessage(bidix.upload.messages.mainSaved,bidix.dirname(url)+'/'+destfile);
			store.setDirty(false);
			log.endUpload(&quot;ok&quot;);
		} else {
			alert(bidix.upload.messages.mainFailed);
			displayMessage(bidix.upload.messages.mainFailed);
			log.endUpload(&quot;failed&quot;);			
		}
	};
	// do uploadMain
	var revised = bidix.upload.updateOriginal(original,posDiv);
	bidix.upload.httpUpload(uploadParams,revised,callback,uploadParams);
};

bidix.upload.httpUpload = function(uploadParams,data,callback,params)
{
	var localCallback = function(status,params,responseText,url,xhr) {
		url = (url.indexOf(&quot;nocache=&quot;) &lt; 0 ? url : url.substring(0,url.indexOf(&quot;nocache=&quot;)-1));
		if (xhr.status == 404)
			alert(bidix.upload.messages.storePhpNotFound.format([url]));
		if ((bidix.debugMode) || (responseText.indexOf(&quot;Debug mode&quot;) &gt;= 0 )) {
			alert(responseText);
			if (responseText.indexOf(&quot;Debug mode&quot;) &gt;= 0 )
				responseText = responseText.substring(responseText.indexOf(&quot;\n\n&quot;)+2);
		} else if (responseText.charAt(0) != '0') 
			alert(responseText);
		if (responseText.charAt(0) != '0')
			status = null;
		callback(status,params,responseText,url,xhr);
	};
	// do httpUpload
	var boundary = &quot;---------------------------&quot;+&quot;AaB03x&quot;;	
	var uploadFormName = &quot;UploadPlugin&quot;;
	// compose headers data
	var sheader = &quot;&quot;;
	sheader += &quot;--&quot; + boundary + &quot;\r\nContent-disposition: form-data; name=\&quot;&quot;;
	sheader += uploadFormName +&quot;\&quot;\r\n\r\n&quot;;
	sheader += &quot;backupDir=&quot;+uploadParams[3] +
				&quot;;user=&quot; + uploadParams[4] +
				&quot;;password=&quot; + uploadParams[5] +
				&quot;;uploaddir=&quot; + uploadParams[2];
	if (bidix.debugMode)
		sheader += &quot;;debug=1&quot;;
	sheader += &quot;;;\r\n&quot;; 
	sheader += &quot;\r\n&quot; + &quot;--&quot; + boundary + &quot;\r\n&quot;;
	sheader += &quot;Content-disposition: form-data; name=\&quot;userfile\&quot;; filename=\&quot;&quot;+uploadParams[1]+&quot;\&quot;\r\n&quot;;
	sheader += &quot;Content-Type: text/html;charset=UTF-8&quot; + &quot;\r\n&quot;;
	sheader += &quot;Content-Length: &quot; + data.length + &quot;\r\n\r\n&quot;;
	// compose trailer data
	var strailer = new String();
	strailer = &quot;\r\n--&quot; + boundary + &quot;--\r\n&quot;;
	data = sheader + data + strailer;
	if (bidix.debugMode) alert(&quot;about to execute Http - POST on &quot;+uploadParams[0]+&quot;\n with \n&quot;+data.substr(0,500)+ &quot; ... &quot;);
	var r = doHttp(&quot;POST&quot;,uploadParams[0],data,&quot;multipart/form-data; ;charset=UTF-8; boundary=&quot;+boundary,uploadParams[4],uploadParams[5],localCallback,params,null);
	if (typeof r == &quot;string&quot;)
		displayMessage(r);
	return r;
};

// same as Saving's updateOriginal but without convertUnicodeToUTF8 calls
bidix.upload.updateOriginal = function(original, posDiv)
{
	if (!posDiv)
		posDiv = locateStoreArea(original);
	if((posDiv[0] == -1) || (posDiv[1] == -1)) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + &quot;\n&quot; +
				store.allTiddlersAsHtml() + &quot;\n&quot; +
				original.substr(posDiv[1]);
	var newSiteTitle = getPageTitle().htmlEncode();
	revised = revised.replaceChunk(&quot;&lt;title&quot;+&quot;&gt;&quot;,&quot;&lt;/title&quot;+&quot;&gt;&quot;,&quot; &quot; + newSiteTitle + &quot; &quot;);
	revised = updateMarkupBlock(revised,&quot;PRE-HEAD&quot;,&quot;MarkupPreHead&quot;);
	revised = updateMarkupBlock(revised,&quot;POST-HEAD&quot;,&quot;MarkupPostHead&quot;);
	revised = updateMarkupBlock(revised,&quot;PRE-BODY&quot;,&quot;MarkupPreBody&quot;);
	revised = updateMarkupBlock(revised,&quot;POST-SCRIPT&quot;,&quot;MarkupPostBody&quot;);
	return revised;
};

//
// UploadLog
// 
// config.options.chkUploadLog :
//		false : no logging
//		true : logging
// config.options.txtUploadLogMaxLine :
//		-1 : no limit
//      0 :  no Log lines but UploadLog is still in place
//		n :  the last n lines are only kept
//		NaN : no limit (-1)

bidix.UploadLog = function() {
	if (!config.options.chkUploadLog) 
		return; // this.tiddler = null
	this.tiddler = store.getTiddler(&quot;UploadLog&quot;);
	if (!this.tiddler) {
		this.tiddler = new Tiddler();
		this.tiddler.title = &quot;UploadLog&quot;;
		this.tiddler.text = &quot;| !date | !user | !location | !storeUrl | !uploadDir | !toFilename | !backupdir | !origin |&quot;;
		this.tiddler.created = new Date();
		this.tiddler.modifier = config.options.txtUserName;
		this.tiddler.modified = new Date();
		store.addTiddler(this.tiddler);
	}
	return this;
};

bidix.UploadLog.prototype.addText = function(text) {
	if (!this.tiddler)
		return;
	// retrieve maxLine when we need it
	var maxLine = parseInt(config.options.txtUploadLogMaxLine,10);
	if (isNaN(maxLine))
		maxLine = -1;
	// add text
	if (maxLine != 0) 
		this.tiddler.text = this.tiddler.text + text;
	// Trunck to maxLine
	if (maxLine &gt;= 0) {
		var textArray = this.tiddler.text.split('\n');
		if (textArray.length &gt; maxLine + 1)
			textArray.splice(1,textArray.length-1-maxLine);
			this.tiddler.text = textArray.join('\n');		
	}
	// update tiddler fields
	this.tiddler.modifier = config.options.txtUserName;
	this.tiddler.modified = new Date();
	store.addTiddler(this.tiddler);
	// refresh and notifiy for immediate update
	story.refreshTiddler(this.tiddler.title);
	store.notify(this.tiddler.title, true);
};

bidix.UploadLog.prototype.startUpload = function(storeUrl, toFilename, uploadDir,  backupDir) {
	if (!this.tiddler)
		return;
	var now = new Date();
	var text = &quot;\n| &quot;;
	var filename = bidix.basename(document.location.toString());
	if (!filename) filename = '/';
	text += now.formatString(&quot;0DD/0MM/YYYY 0hh:0mm:0ss&quot;) +&quot; | &quot;;
	text += config.options.txtUserName + &quot; | &quot;;
	text += &quot;[[&quot;+filename+&quot;|&quot;+location + &quot;]] |&quot;;
	text += &quot; [[&quot; + bidix.basename(storeUrl) + &quot;|&quot; + storeUrl + &quot;]] | &quot;;
	text += uploadDir + &quot; | &quot;;
	text += &quot;[[&quot; + bidix.basename(toFilename) + &quot; | &quot; +toFilename + &quot;]] | &quot;;
	text += backupDir + &quot; |&quot;;
	this.addText(text);
};

bidix.UploadLog.prototype.endUpload = function(status) {
	if (!this.tiddler)
		return;
	this.addText(&quot; &quot;+status+&quot; |&quot;);
};

//
// Utilities
// 

bidix.checkPlugin = function(plugin, major, minor, revision) {
	var ext = version.extensions[plugin];
	if (!
		(ext  &amp;&amp; 
			((ext.major &gt; major) || 
			((ext.major == major) &amp;&amp; (ext.minor &gt; minor))  ||
			((ext.major == major) &amp;&amp; (ext.minor == minor) &amp;&amp; (ext.revision &gt;= revision))))) {
			// write error in PluginManager
			if (pluginInfo)
				pluginInfo.log.push(&quot;Requires &quot; + plugin + &quot; &quot; + major + &quot;.&quot; + minor + &quot;.&quot; + revision);
			eval(plugin); // generate an error : &quot;Error: ReferenceError: xxxx is not defined&quot;
	}
};

bidix.dirname = function(filePath) {
	if (!filePath) 
		return;
	var lastpos;
	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {
		return filePath.substring(0, lastpos);
	} else {
		return filePath.substring(0, filePath.lastIndexOf(&quot;\\&quot;));
	}
};

bidix.basename = function(filePath) {
	if (!filePath) 
		return;
	var lastpos;
	if ((lastpos = filePath.lastIndexOf(&quot;#&quot;)) != -1) 
		filePath = filePath.substring(0, lastpos);
	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {
		return filePath.substring(lastpos + 1);
	} else
		return filePath.substring(filePath.lastIndexOf(&quot;\\&quot;)+1);
};

bidix.initOption = function(name,value) {
	if (!config.options[name])
		config.options[name] = value;
};

//
// Initializations
//

// require PasswordOptionPlugin 1.0.1 or better
bidix.checkPlugin(&quot;PasswordOptionPlugin&quot;, 1, 0, 1);

// styleSheet
setStylesheet('.txtUploadStoreUrl, .txtUploadBackupDir, .txtUploadDir {width: 22em;}',&quot;uploadPluginStyles&quot;);

//optionsDesc
merge(config.optionsDesc,{
	txtUploadStoreUrl: &quot;Url of the UploadService script (default: store.php)&quot;,
	txtUploadFilename: &quot;Filename of the uploaded file (default: in index.html)&quot;,
	txtUploadDir: &quot;Relative Directory where to store the file (default: . (downloadService directory))&quot;,
	txtUploadBackupDir: &quot;Relative Directory where to backup the file. If empty no backup. (default: ''(empty))&quot;,
	txtUploadUserName: &quot;Upload Username&quot;,
	pasUploadPassword: &quot;Upload Password&quot;,
	chkUploadLog: &quot;do Logging in UploadLog (default: true)&quot;,
	txtUploadLogMaxLine: &quot;Maximum of lines in UploadLog (default: 10)&quot;
});

// Options Initializations
bidix.initOption('txtUploadStoreUrl','');
bidix.initOption('txtUploadFilename','');
bidix.initOption('txtUploadDir','');
bidix.initOption('txtUploadBackupDir','');
bidix.initOption('txtUploadUserName','');
bidix.initOption('pasUploadPassword','');
bidix.initOption('chkUploadLog',true);
bidix.initOption('txtUploadLogMaxLine','10');


// Backstage
merge(config.tasks,{
	uploadOptions: {text: &quot;upload&quot;, tooltip: &quot;Change UploadOptions and Upload&quot;, content: '&lt;&lt;uploadOptions&gt;&gt;'}
});
config.backstageTasks.push(&quot;uploadOptions&quot;);


//}}}</pre>
</div>
<div title="Using Bloom Filters to Reﬁne Web Search Results" modifier="wy" created="200907110530" modified="200907110551" changecount="6">
<pre>//Navendu Jain   Department of Computer Sciences   University of Texas at Austin  Austin, TX, 78712   nav@cs.utexas.edu
Mike Dahlin       Department of Computer  Sciences  University of Texas at Austin  Austin, TX, 78712   dahlin@cs.utexas.edu
Renu Tewari      IBM Almaden Research Center    650 Harry Road      San Jose, CA, 95111     tewarir@us.ibm.com//

!!!Framework
&gt;Use ''content-deﬁned chunking (CDC)'' to extract document features that are resilient to modiﬁcations.
&gt;&gt;Use these features as set elements for ''generating Bloom ﬁlters''({{{   Sampling}}})
&gt;&gt;&gt;''Compare the Bloom ﬁlters'' to detect near-duplicate documents above a certain similarity thresh-old (say 70%)

!!!!CDC Overview
CDC splits a document into ''variable-sized'' blocks whose bound-aries are determined by its ''Rabin ﬁngerprint'' matching a pre-determined marker value [18]. The number of bits in the Rabin ﬁngerprint that are used to match the marker deter-mine the expected chunk size.

!!!!Bloom Filter Overview
''Elements''
*a set of chunks(U)
*k hash functions: h1,h2,h3...hk
*array whose size is m
&gt;Each hash function hi(u) for 1 ≤ i ≤ k maps to one bit in the array {1 . . .m}. Thus, when an element is added to the set,it sets k bits, each bit corresponding to a hash function, in the Bloom ﬁlter array to 1. If a bit was already set it stays 1.If all of the m bits is already set 1, the element is abandoned.
&gt;&gt;''Advantage:''
####The compactness of Bloom ﬁlters is very attractive for storage and transmission whenever we want to minimize the meta-data overheads.
####Bloom ﬁlters enable fast comparison as matching is a bitwise-AND operation.
####Since Bloom ﬁlters are a complete repre-sentation of a set rather than a deterministic sample (e.g.,shingling), they can determine inclusions eﬀectively
&gt;&gt;''Flaws:''It may yield false positive</pre>
</div>
<div title="VIM多标签切换" modifier="wy" created="200906171213" modified="200906171214" tags="vim 标签 tab" changecount="5">
<pre>!!!初级
VIM(应该是某个版本以上)自带命令：
# '':tabnew [++opt选项] ［＋cmd］ 文件''            建立对指定文件新的tab
# '':tabc''       关闭当前的tab
# '':tabo''       关闭所有其他的tab
# '':tabs''       查看所有打开的tab
# '':tabp''      前一个
# '':tabn''      后一个
''标准模式下''：
gt , gT 可以直接在tab之间切换。（''最方便''）
&gt;更详细的可'':help table''查看
!!!进阶
修改''.vimrc''文件，增加''映射''：
[[灵活操作 Vim 中的 Tabs|http://hi.baidu.com/tpxc/blog/item/9ab09cb1013f4350092302c4.html]]
!!!高级
自己写脚本或插件：[[使用alt+数字键来切换tab (vim7+)|http://vim.group.javaeye.com/group/topic/7050]]
用现有插件：[[Bufpos -- 用 Alt+n 切换 Vim 的标签|http://www.linuxgem.org/2009/1/24/use-alt-n-switch-gvim-tab.6984.html]]</pre>
</div>
<div title="VNC Server配置" modifier="wy" created="201012021151" modified="201012021213" changecount="7">
<pre>1.安装VNC Server
2.运行vncpasswd
&gt;设置VNC连接的密码
3.默认的图形管理器twm会比较丑，更改~/.xstartup，将其中的twm改成''gnome-session''
4.运行''{{{vncserver -geometry 1024x768 -depth 16}}}''
&gt;系统装了vncserver以后，每个用户都能创建自己的VNC session，session ID自动递增，这条命令的输出信息中有
&gt;vncserver会监听某一端口，端口号为''{{{5900+sessionID}}}''，通过浏览器中访问ip地址+端口即可访问
5.一般来说这样就可以用VNC Viewer访问了

一些错误
*10065错误
&gt;有可能是开启了防火墙，使用命令# service iptales stop 停止防火墙。或参照[[这里|http://blog.csdn.net/Tobeabetterman_He/archive/2006/11/14/1384180.aspx]]和[[这里|http://hi.baidu.com/itsuper/blog/item/474206c2a9c66a30e5dd3bd9.html]]设置iptable。
&gt;&gt;或者通过SSH Tunnel绕过去，参照[[这里|http://blog.csdn.net/Tobeabetterman_He/archive/2006/11/14/1384180.aspx]]，在putty中''Connection-SSH-tunnels''设置转发：源端口为{''{{{5900+sessionID}}}''}，目的地为''localhost:{{{{5900+sessionID}}}}''。它的解释见[[这里|http://www.cyberciti.biz/tips/tunneling-vnc-connections-over-ssh-howto.html]]
&gt;或者是配置文件开启了localhost，使得只允许本地访问，见[[这里|http://hi.baidu.com/higkoo/blog/item/d04b901f990774e5e0fe0b80.html]]
*10061错误
&gt;没有启动vnc server

上面的方法有个缺点，即系统重启VNC Server的守护程序就不运行了，需要手动启动，故可在系统配置文件中设置开机启动
参考：[[Linux 远程桌面 VNC server|http://www.hduo.net/archives/linux-remote-desktop-vncserver.html]]和[[Configuring the VNC server/viewer in Linux.|http://bobpeers.com/linux/vnc]]

*参考
**[[CentOS官方文档|http://wiki.centos.org/HowTos/VNC-Server]]
**[[Ubuntu下的配置|http://imthi.com/blog/linux/ubuntu-904-remote-desktop-using-vncserver-without-monitor.php]]</pre>
</div>
<div title="WebApp" modifier="wy" created="200902241419" modified="201008190415" tags="webapp web" changecount="4">
<pre>&lt;html&gt;&lt;font size=4 color=purple&gt;&lt;b&gt;About this: A collect of pages about Web Application.&lt;/b&gt;&lt;/font&gt;&lt;/html&gt;
*[[url转义字符]]
*[[去除点击链接时出现的虚线框]]
*[[如何上twitter]]</pre>
</div>
<div title="Wiki" modifier="wy" created="200902091126" modified="200903241027" tags="wiki" changecount="21">
<pre>&lt;html&gt;&lt;font size=4 color=purple&gt;&lt;b&gt;This page is a collect of my pages about this wiki&lt;/b&gt;&lt;/font&gt;&lt;/html&gt;
*[[关于Wiki的组织]]
*[[关于Wiki的编辑]]
*[[上传TiddlyWiki|http://faq.tiddlyspot.com/]]</pre>
</div>
<div title="WikiBarPlugin" modifier="wy" created="201012090457" modified="201012090521" tags="systemConfig plugin" changecount="9">
<pre>/***
|''Name:''|WikiBar|
|''Version:''|2.0.0 beta3|
|''Source:''|[[AiddlyWiki|http://aiddlywiki.sourceforge.net]]|
|''Author:''|[[Arphen Lin|mailto:arphenlin@gmail.com]]|
|''Type:''|toolbar macro command extension|
|''Required:''|TiddlyWiki 2.0.0 beta6|
!Description
WikiBar is a toolbar that gives access to most of TiddlyWiki's formatting features with a few clicks. It's a handy tool for people who are not familiar with TiddlyWiki syntax.
Besides, with WikiBar-addons, users can extend the power of WikiBar.
!Support browser
*Firefox 1.5
!Revision history
*v2.0.0 beta3 (2005/12/30)
** remove macros (replaced by TWMacro addon)
** add wikibar command in toolbar automatically
** rename DOIT to HANDLER
** rename TIP to TOOLTIP
*v2.0.0 beta2 (2005/12/21)
** re-design Wikibar addon framework
*v2.0.0 beta1 (2005/12/14)
** Note:
*** WikiBarPlugin is renamed to WikiBar
** New Features:
*** support TiddlyWiki 2.0.0 template mechanism
*** new wikibar data structure
*** new wikibar-addon framework for developers
**** support dynamic popup menu generator
*** support most new macros added in TiddlyWiki 2.0.0
*** multi-level popup menu
*** fix wikibar tab stop
*** remove paletteSelector
** Known Bugs:
*** popup-menu and color-picker can't be closed correctly
*** some macros can't be displayed correctly in previewer
*** text in previewer will be displayed italic
*v1.2.0 (2005/11/21)
**New Features:
***User defined color palettes supported
####Get color palettes from [[ColorZilla Palettes|http://www.iosart.com/firefox/colorzilla/palettes.html]].
####Save the palette file(*.gpl) as a new tiddler and tag it with 'ColorPalettes', then you can use it in WikiBar.
***WikiBar style sheet supported
***Click on document to close current colorPicker, paletteSelector or aboutWikibar
*v1.1.1 (2005/11/03)
**Bugs fixed:
***'Not enough parameters!' message is displayed when the parameter includes '%+number', ex: 'hello%20world!'
*v1.1.0 (2005/11/01)
**Bugs fixed:
***WikiBar overruns (reported by by GeoffS &lt;gslocock@yahoo.co.uk&gt;)
**New features:
***Insert a color code at the cursor. (Thanks to RunningUtes &lt;RunningUtes@gmail.com&gt;)
***Enable gradient macro. (Thanks to RunningUtes &lt;RunningUtes@gmail.com&gt;)
***Insert tiddler comment tags {{{/% ... %/}}}. (new feature supported by TiddlyWiki 1.2.37)
***Insert DateFormatString for {{{&lt;&lt;today&gt;&gt;}}} macro. (new feature supported by TiddlyWiki 1.2.37)
**Enhanced:
***Allow optional parameters in syntax.
**Bugs:
***'Not enough parameters!' message is displayed when the parameter includes '%+number', ex: 'hello%20world!'
*v1.0.0 (2005/10/30)
**Initial release
!Code
***/
//{{{
config.macros.wikibar = {major: 2, minor: 0, revision: 0, beta: 3, date: new Date(2005,12,30)};
config.macros.wikibar.handler = function(place,macroName,params,wikifier,paramString,tiddler){
  if(!(tiddler instanceof Tiddler))  {return;}
	story.setDirty(tiddler.title,true);
  place.id = 'wikibar'+tiddler.title;
  place.className = 'toolbar wikibar';
};
function wikibar_install(){
  config.commands.wikibar = {
  	text: 'wikibar',
  	tooltip: 'wikibar on/off',
  	handler: function(e,src,title) {
      if(!e){ e = window.event; }
      var theButton = resolveTarget(e);
      theButton.id = 'wikibarButton'+title;
      wikibarPopup.remove();
      wikibar_installAddons(theButton, title);
      wikibar_createWikibar(title);
      return(false);
    }
  };
  config.shadowTiddlers['EditTemplate'] = wikibar_addWikibarCommand(config.shadowTiddlers['EditTemplate']);
  var tiddler = store.getTiddler('EditTemplate');
  if(tiddler){
    tiddler.text = wikibar_addWikibarCommand(tiddler.text);
  }
}
function wikibar_installAddons(theButton, title){
 	var tiddlers = store.getTaggedTiddlers('wikibarAddons');
	if(!tiddlers)	  { return; }
	theButton.addons=[];
  for(var i=0; i&lt;tiddlers.length; i++){
    try{
      eval(tiddlers[i].text);
      try{
        wikibar_addonInstall(title);
        wikibar_addonInstall = null;
        theButton.addons.push({ok:true, name:tiddlers[i].title});
      }catch(ex){
        theButton.addons.push({ok:false, name:tiddlers[i].title, error:ex});
      }
    }catch(ex){
      theButton.addons.push({ok:false, name:tiddlers[i].title, error:ex});
    }
  }
}
function wikibar_addWikibarCommand(tiddlerText){
  var div = document.createElement('div');
  div.style.display = 'none';
  div.innerHTML = tiddlerText;
  for(var i=0; i&lt;div.childNodes.length; i++){
    var o=div.childNodes[i];
    if(o.tagName==='DIV'){
      if(o.className=='toolbar'){
        var macroText = o.getAttribute('macro').trim();
        if(macroText.search('wikibar')&lt;=0){
          macroText += ' wikibar';
          o.setAttribute('macro', macroText);
        }
        break;
      }
    }
  }
  return div.innerHTML.replace(/\&quot;/g, &quot;\'&quot;);
}
function wikibar_processSyntaxParams(theSyntax, params){
  try{
    var pcr = 'AplWikibarPcr';
    var rx=null;
    var allParams=null;
    if(params){
      if(typeof(params)=='object'){
        for(var i=0; i&lt;params.length; i++){
          if(params[i]){
            params[i] = params[i].replace(new RegExp('%','g'), pcr).trim();
            rx = '(\\[%'+(i+1)+'\\])' + '|' + '(%'+(i+1)+')';
            theSyntax = theSyntax.replace(new RegExp(rx,'g'), params[i] );
          }
        }
        allParams = params.join(' ').trim();
      }else{
        allParams = params.replace(new RegExp('%','g'), pcr).trim();
        rx = /(\[%1{1}\])|(%1{1})/g;
        theSyntax = theSyntax.replace(rx, allParams);
      }
    }
    if(allParams){
      theSyntax = theSyntax.replace(new RegExp('%N{1}','g'), allParams);
    }
    rx=/\[%(([1-9]{1,}[0-9]{0,})|(N{1}))\]/g;
    theSyntax = theSyntax.replace(rx, '');
    rx=/%(([1-9]{1,}[0-9]{0,})|(N{1}))/g;
    if( theSyntax.match(rx) ){
      throw 'Not enough parameters! ' + theSyntax;
    }
    theSyntax=theSyntax.replace(new RegExp(pcr,'g'), '%');
    return theSyntax;
  } catch(ex){
    return null;
  }
}
function wikibar_resolveEditItem(tiddlerWrapper, itemName){
  if(tiddlerWrapper.hasChildNodes()){
    var c=tiddlerWrapper.childNodes;
    for(var i=0; i&lt;c.length; i++){
      var txt=wikibar_resolveEditItem(c[i], itemName);
      if(!txt){
        continue;
      }else{
        return txt;
      }
    }
  }
  return ((tiddlerWrapper.getAttribute &amp;&amp; tiddlerWrapper.getAttribute('edit')==itemName)? tiddlerWrapper : null);
}
function wikibar_resolveEditItemValue(tiddlerWrapper, itemName){
  var o = wikibar_resolveEditItem(tiddlerWrapper, itemName);
  return (o? o.value.replace(/\r/mg,'') : null);
}
function wikibar_resolveTiddlerEditorWrapper(obj){
  if(obj.id=='tiddlerDisplay'){return null;}
  if((obj.getAttribute &amp;&amp; obj.getAttribute('macro')=='edit text')){return obj;}
  return wikibar_resolveTiddlerEditorWrapper(obj.parentNode);
}
function wikibar_resolveTiddlerEditor(obj){
  if(obj.hasChildNodes()){
    var c = obj.childNodes;
    for(var i=0; i&lt;c.length; i++){
      var o=wikibar_resolveTiddlerEditor(c[i]);
      if(o){ return o;}
    }
  }
  return ((obj.getAttribute &amp;&amp; obj.getAttribute('edit')=='text')? obj : null);
}
function wikibar_resolveTargetButton(obj){
  if(obj.id &amp;&amp; obj.id.substring(0,7)=='wikibar'){ return null; }
  if(obj.tiddlerTitle){
    return obj;
  }else{
    return wikibar_resolveTargetButton(obj.parentNode);
  }
}
function wikibar_isValidMenuItem(tool){
  if(!tool){  return false; }
  if(tool.TYPE=='MENU' || tool.TYPE=='MAIN_MENU'){
    for(var key in tool){
      if(key.substring(0,8)=='DYNAITEM'){ return true; }
      if(wikibar_isValidMenuItem(tool[key])){ return true; }
    }
    return false;
  }else{
    return (tool.HANDLER? true : false);
  }
}
function wikibar_editFormat(param){
  var editor = param.button.editor;
  var params = param.params;
  clearMessage();
  if(!editor){ return; }
  var repText = wikibar_processSyntaxParams(this.syntax, params);
  if(repText===null){ return; }
	var st = editor.scrollTop;
	var ss = editor.selectionStart;
	var se = editor.selectionEnd;
	var frontText= '';
	var endText  = '';
	var fullText = editor.value;
	if(se&gt;ss &amp;&amp; ss&gt;=0){
	  frontText  = fullText.substring(0, ss);
	  endText    = fullText.substring(se, fullText.length);
	}
	else if(ss===0 &amp;&amp; (se===0 || se == fullText.length) ){
    endText    = fullText;
	}
	else if(se==ss &amp;&amp; ss&gt;0){
    frontText  = fullText.substring(0, ss);
    endText    = fullText.substring(se, fullText.length);
	}
	if(repText.indexOf('user_text')&gt;=0 &amp;&amp; this.hint){
		repText = repText.replace('user_text', this.hint);
	}
	editor.value = frontText + repText + endText;
	editor.selectionStart = ss;
	editor.selectionEnd   = ss + repText.length;
	editor.scrollTop      = st;
	editor.focus();
}
function wikibar_editFormatByWord(param){
  var editor = param.button.editor;
  var params = param.params;
  clearMessage();
  if(!editor){return;}
  var repText = wikibar_processSyntaxParams(this.syntax, params);
  if(repText===null){ return; }
	var st = editor.scrollTop;
	var ss = editor.selectionStart;
	var se = editor.selectionEnd;
	var frontText= '';
	var selText  = '';
	var endText  = '';
	var fullText = editor.value;
	if(se&gt;ss &amp;&amp; ss&gt;=0){
	  frontText  = fullText.substring(0, ss);
	  selText	   = fullText.substring(ss,se);
	  endText    = fullText.substring(se, fullText.length);
	}
	else if(ss===0 &amp;&amp; (se===0 || se == fullText.length) ){
    endText    = fullText;
	}
	else if(se==ss &amp;&amp; ss&gt;0){
    frontText  = fullText.substring(0, ss);
    endText    = fullText.substring(se, fullText.length);
	  if(!( fullText.charAt(ss-1).match(/\W/gi) || fullText.charAt(ss).match(/\W/gi) )){
      var m = frontText.match(/\W/gi);
      if(m){
        ss = frontText.lastIndexOf(m[m.length-1])+1;
      }
      else{
        ss = 0;
      }
      m = endText.match(/\W/gi);
      if(m){
        se += endText.indexOf(m[0]);
      }
      else{
        se = fullText.length;
      }
      frontText = fullText.substring(0, ss);
  	  endText   = fullText.substring(se, fullText.length);
  	  selText   = fullText.substring(ss,se);
	  }
	}
	if(selText.length&gt;0){
		repText = repText.replace('user_text', selText);
	}
	if(repText.indexOf('user_text')&gt;=0 &amp;&amp; this.hint){
		repText = repText.replace('user_text', this.hint);
	}
	editor.value = frontText + repText + endText;
	editor.selectionStart = ss;
	editor.selectionEnd   = ss + repText.length;
	editor.scrollTop      = st;
	editor.focus();
}
function wikibar_editFormatByCursor(param){
  var editor = param.button.editor;
  var params = param.params;
  clearMessage();
  if(!editor){ return; }
  var repText = wikibar_processSyntaxParams(this.syntax, params);
  if(repText===null){ return; }
	var st = editor.scrollTop;
	var ss = editor.selectionStart;
	var se = editor.selectionEnd;
	var frontText= '';
	var endText  = '';
	var fullText = editor.value;
	if(se&gt;ss &amp;&amp; ss&gt;=0){
	  frontText  = fullText.substring(0, ss);
	  endText    = fullText.substring(se, fullText.length);
	}
	else if(ss===0 &amp;&amp; (se===0 || se == fullText.length) ){
    endText    = fullText;
	}
	else if(se==ss &amp;&amp; ss&gt;0){
    frontText  = fullText.substring(0, ss);
    endText    = fullText.substring(se, fullText.length);
	}
	if(repText.indexOf('user_text')&gt;=0 &amp;&amp; this.hint){
		repText = repText.replace('user_text', this.hint);
	}
	editor.value = frontText + repText + endText;
	editor.selectionStart = ss;
	editor.selectionEnd   = ss + repText.length;
	editor.scrollTop      = st;
	editor.focus();
}
function wikibar_editFormatByLine(param){
  var editor = param.button.editor;
  var params = param.params;
  clearMessage();
  if(!editor){ return; }
  var repText = wikibar_processSyntaxParams(this.syntax, params);
  if(repText===null){ return; }
	var st = editor.scrollTop;
	var ss = editor.selectionStart;
	var se = editor.selectionEnd;
	var frontText= '';
	var selText  = '';
	var endText  = '';
	var fullText = editor.value;
	if(se&gt;ss &amp;&amp; ss&gt;=0){
		if(this.byBlock){
	    frontText  = fullText.substring(0, ss);
	    selText		 = fullText.substring(ss,se);
	    endText    = fullText.substring(se, fullText.length);
		}
		else{
	  	se = ss;
		}
	}
  if(ss===0 &amp;&amp; (se===0 || se == fullText.length) ){
    var m=fullText.match(/(\n|\r)/g);
    if(m){
      se = fullText.indexOf(m[0]);
    }else{
      se = fullText.length;
    }
    selText    = fullText.substring(0, se);
    endText    = fullText.substring(se, fullText.length);
	}
	else if(se==ss &amp;&amp; ss&gt;0){
    frontText  = fullText.substring(0, ss);
    endText    = fullText.substring(se, fullText.length);
    m = frontText.match(/(\n|\r)/g);
    if(m){
      ss = frontText.lastIndexOf(m[m.length-1])+1;
    }
    else{
      ss = 0;
    }
    m = endText.match(/(\n|\r)/g);
    if(m){
      se += endText.indexOf(m[0]);
    }
    else{
      se = fullText.length;
    }
    frontText = fullText.substring(0, ss);
	  selText   = fullText.substring(ss,se);
	  endText   = fullText.substring(se, fullText.length);
	}
	if(selText.length&gt;0){
		repText = repText.replace('user_text', selText);
	}
	if(repText.indexOf('user_text')&gt;=0 &amp;&amp; this.hint){
		repText = repText.replace('user_text', this.hint);
	}
	if(this.byBlock){
    if( (frontText.charAt(frontText.length-1)!='\n') &amp;&amp; ss&gt;0 ){
    	repText = '\n' + repText;
    }
    if( (endText.charAt(0)!='\n') || se==fullText.length){
    	repText += '\n';
    }
	}
	editor.value = frontText + repText + endText;
	editor.selectionStart = ss;
	editor.selectionEnd   = ss + repText.length;
	editor.scrollTop      = st;
	editor.focus();
}
function wikibar_editFormatByTableCell(param){
  var editor = param.button.editor;
  var params = param.params;
  clearMessage();
  if(!editor){ return; }
  var repText = wikibar_processSyntaxParams(this.syntax, params);
  if(repText===null){ return; }
	var st = editor.scrollTop;
	var ss = editor.selectionStart;
	var se = editor.selectionEnd;
	var frontText= '';
	var selText  = '';
	var endText  = '';
	var fullText = editor.value;
	if(ss===0 || ss==fullText.length){
		throw 'not valid cell!';
	}
	se=ss;
  frontText  = fullText.substring(0, ss);
  endText    = fullText.substring(se, fullText.length);
  i=frontText.lastIndexOf('\n');
  j=frontText.lastIndexOf('|');
  if(i&gt;j || j&lt;0){
  	throw 'not valid cell!';
  }
	ss = j+1;
  i=endText.indexOf('\n');
  j=endText.indexOf('|');
  if(i&lt;j || j&lt;0){
  	throw 'not valid cell!';
  }
  se += j;
  frontText = fullText.substring(0, ss-1);
  selText   = fullText.substring(ss,se);
  endText   = fullText.substring(se+1, fullText.length);
	if(this.key.substring(0,5)=='align'){
		selText = selText.trim();
		if(	selText=='&gt;' || selText=='~' ||	selText.substring(0,8)=='bgcolor(')	{return; }
	}
	if(selText.length&gt;0){
		repText = repText.replace('user_text', selText);
	}
	if(repText.indexOf('user_text')&gt;=0 &amp;&amp; this.hint){
		repText = repText.replace('user_text', this.hint);
	}
	editor.value = frontText + repText + endText;
	editor.selectionStart = ss;
	editor.selectionEnd   = ss + repText.length - 2;
	editor.scrollTop      = st;
	editor.focus();
}
function wikibar_editSelectAll(param){
  var editor = param.button.editor;
	editor.selectionStart = 0;
	editor.selectionEnd   = editor.value.length;
	editor.scrollTop      = 0;
	editor.focus();
}
function wikibar_doPreview(param){
  var theButton = param.button;
  var editor = param.button.editor;
  var wikibar = theButton.parentNode;
  if(!wikibar)  { return; }
  title = theButton.tiddlerTitle;
  var editorWrapper = wikibar_resolveTiddlerEditorWrapper(editor);
  var tiddlerWrapper = editorWrapper.parentNode;
  var previewer = document.getElementById('previewer'+title);
  if(previewer){
    previewer.parentNode.removeChild(previewer);
    editorWrapper.style.display = 'block';
    visible=true;
  }else{
    previewer = document.createElement('div');
    previewer.id = 'previewer'+title;
    previewer.className = 'viewer previewer';
    previewer.style.height = (editor.offsetHeight) + 'px';
    wikify(editor.value, previewer);
    tiddlerWrapper.insertBefore(previewer, editorWrapper);
    editorWrapper.style.display = 'none';
    visible=false;
  }
  var pv=null;
  for(var i=0; i&lt;wikibar.childNodes.length; i++){
    try{
      var btn = wikibar.childNodes[i];
      if(btn.toolItem.key == 'preview'){ pv=btn; }
      if(btn.toolItem.key != 'preview'){
        btn.style.display = visible ? '': 'none';
      }
    }catch(ex){}
  }
  if(!pv) { return; }
  if(visible){
    pv.innerHTML = '&lt;font face=\&quot;verdana\&quot;&gt;&amp;infin;&lt;/font&gt;';
    pv.title = 'preview current tiddler';
  }
  else{
    pv.innerHTML = '&lt;font face=\&quot;verdana\&quot;&gt;&amp;larr;&lt;/font&gt;';
    pv.title = 'back to editor';
  }
}
function wikibar_doListAddons(param){
  clearMessage();
  var title = param.button.tiddlerTitle;
  var wikibarButton = document.getElementById('wikibarButton'+title);
  var ok=0, fail=0;
  for(var i=0; i&lt;wikibarButton.addons.length; i++){
    var addon=wikibarButton.addons[i];
    if(addon.ok){
      displayMessage('[ o ] '+addon.name);
      ok++;
    }
    else{
      displayMessage('[ x ] '+addon.name + ': ' + addon.error);
      fail++;
    }
  }
  displayMessage('---------------------------------');
  displayMessage(ok + ' ok ; ' + fail + ' failed');
}
function wikibar_getColorCode(param){
  var cbOnPickColor = function(colorCode, param){
    param.params = colorCode;
    param.button.toolItem.doMore(param);
  };
  wikibarColorTool.openColorPicker(param.button, cbOnPickColor, param);
}
function wikibar_getLinkUrl(param){
  var url= prompt('Please enter the link target', (this.param? this.param : ''));
  if (url &amp;&amp; url.trim().length&gt;0){
    param.params = url;
    this.doMore(param);
  }
}
function wikibar_getTableRowCol(param){
  var rc= prompt('Please enter (rows x cols) of the table', '2 x 3');
  if (!rc || (rc.trim()).length&lt;=0){ return; }
  var arr = rc.toUpperCase().split('X');
  if(arr.length != 2)   { return; }
  for(var i=0; i&lt;arr.length; i++){
    if(isNaN(arr[i].trim()))  { return; }
  }
  var rows = parseInt(arr[0].trim(), 10);
  var cols = parseInt(arr[1].trim(), 10);
  var txtTable='';
  for(var r=0; r&lt;rows; r++){
    for(var c=0; c&lt;=cols; c++){
      if(c===0){
        txtTable += '|';
      }else{
        txtTable += ' |';
      }
    }
    txtTable += '\n';
  }
  if(txtTable.trim().length&gt;0){
    param.params = txtTable.trim();
    this.doMore(param);
  }
}
function wikibar_getMacroParam(param){
  var p = prompt('Please enter the parameters of macro \&quot;' + this.key + '\&quot;:' +
                 '\nSyntax: ' + this.syntax +
                 '\n\nNote: '+
                 '\n%1,%2,... - parameter needed'+
                 '\n[%1] - optional parameter'+
                 '\n%N   - more than one parameter(1~n)'+
                 '\n[%N] - any number of parameters(0~n)'+
                 '\n\nPS:'+
                 '\n1. Parameters should be seperated with space character'+
                 '\n2. Use \&quot; to wrap the parameter that includes space character, ex: \&quot;hello world\&quot;'+
                 '\n3. Input the word(null) for the optional parameter ignored',
                 (this.param? this.param : '') );
  if(!p)  { return; }
  p=p.readMacroParams();
  for(var i=0; i&lt;p.length; i++){
    var s=p[i].trim();
    if(s.indexOf(' ')&gt;0){ p[i]=&quot;'&quot;+s+&quot;'&quot;; }
    if(s.toLowerCase()=='null'){ p[i]=null; }
  }
  param.params = p;
  this.doMore(param);
}
function wikibar_getMorePalette(unused){
  clearMessage();
  displayMessage('Get more color palettes(*.gpl) from ColorZilla Palettes site', 'http:\/\/www.iosart.com/firefox/colorzilla/palettes.html');
  displayMessage('Save it as a new tiddler with \&quot;ColorPalettes\&quot; tag');
}
function wikibar_createWikibar(title){
  var theWikibar = document.getElementById('wikibar' + title);
  if(theWikibar){
    if(theWikibar.hasChildNodes()){
      theWikibar.style.display = (theWikibar.style.display=='block'? 'none':'block');
      return;
    }
  }
  var tiddlerWrapper = document.getElementById('tiddler'+title);
  var theTextarea = wikibar_resolveTiddlerEditor(tiddlerWrapper);
  if(!theTextarea){
    clearMessage();
    displayMessage('WikiBar only works in tiddler edit mode now');
    return;
  }else{
    if(!theTextarea.id){ theTextarea.id = 'editor'+title; }
    if(!theTextarea.parentNode.id){ theTextarea.parentNode.id='editorWrapper'+title;  }
  }
  if(theWikibar){
    theWikibar = document.getElementById('wikibar'+title);
  }else{
    var editorWrapper = wikibar_resolveTiddlerEditorWrapper(theTextarea);
    theWikibar = createTiddlyElement(tiddlerWrapper, 'div', 'wikibar'+title, 'toolbar');
    addClass(theWikibar, 'wikibar');
    var previewer = document.getElementById('previewer'+title);
    if(previewer){
      tiddlerWrapper.insertBefore(theWikibar, previewer);
    }else{
      tiddlerWrapper.insertBefore(theWikibar, editorWrapper);
    }
  }
  wikibar_createMenu(theWikibar,wikibarStore,title,theTextarea);
  if(config.options['chkWikibarSetEditorHeight'] &amp;&amp; config.options['txtWikibarEditorRows']){
    theTextarea.rows = config.options['txtWikibarEditorRows'];
  }
  setStylesheet(
    '.wikibar{text-align:left;visibility:visible;margin:2px;padding:1px;}.previewer{overflow:auto;display:block;border:1px solid;}#colorPicker{position:absolute;display:none;z-index:10;margin:0px;padding:0px;}#colorPicker table{margin:0px;padding:0px;border:2px solid #000;border-spacing:0px;border-collapse:collapse;}#colorPicker td{margin:0px;padding:0px;border:1px solid;font-size:11px;text-align:center;cursor:auto;}#colorPicker .header{background-color:#fff;}#colorPicker .button{background-color:#fff;cursor:pointer;cursor:hand;}#colorPicker .button:hover{padding-top:3px;padding-bottom:3px;color:#fff;background-color:#136;}#colorPicker .cell{padding:4px;font-size:7px;cursor:crosshair;}#colorPicker .cell:hover{padding:10px;}.wikibarPopup{position:absolute;z-index:10;border:1px solid #014;color:#014;background-color:#cef;}.wikibarPopup table{margin:0;padding:0;border:0;border-spacing:0;border-collapse:collapse;}.wikibarPopup .button:hover{color:#eee;background-color:#014;}.wikibarPopup .disabled{color:#888;}.wikibarPopup .disabled:hover{color:#888;background-color:#cef;}.wikibarPopup tr .seperator hr{margin:0;padding:0;background-color:#cef;width:100%;border:0;border-top:1px dashed #014;}.wikibarPopup tr .icon{font-family:verdana;font-weight:bolder;}.wikibarPopup tr .marker{font-family:verdana;font-weight:bolder;}.wikibarPopup td{font-size:0.9em;padding:2px;}.wikibarPopup input{border:0;border-bottom:1px solid #014;margin:0;padding:0;font-family:arial;font-size:100%;background-color:#fff;}',
  	'WikiBarStyleSheet');
}
function wikibar_createMenu(place,toolset,title,editor){
  if(!wikibar_isValidMenuItem(toolset)){return;}
  if(!(toolset.TYPE=='MAIN_MENU' || toolset.TYPE=='MENU')){ return; }
    for(var key in toolset){
      if(key.substring(0,9)=='SEPERATOR'){
        wikibar_createMenuSeperator(place);
        continue;
      }
      if(key.substring(0,8)=='DYNAITEM'){
        var dynaTools = toolset[key](title,editor);
        if(dynaTools.TYPE &amp;&amp; dynaTools.TYPE=='MENU'){
          wikibar_createMenuItem(place,dynaTools,null,editor,title);
        }else{
          dynaTools.TYPE = 'MENU';
          wikibar_createMenu(place, dynaTools, title, editor);
        }
        continue;
      }
      if((toolset[key].TYPE!='MENU' &amp;&amp; toolset[key].TYPE!='MAIN_MENU') &amp;&amp; !toolset[key].HANDLER){continue;}
      wikibar_createMenuItem(place,toolset,key,editor,title);
    }
}
function wikibar_createMenuItem(place,toolset,key,editor,title){
  if(!key){
    var tool = toolset;
  }else{
    tool = toolset[key];
    tool.key = key;
  }
  if(!wikibar_isValidMenuItem(tool)){return;}
  var toolIsOnMainMenu = (toolset.TYPE=='MAIN_MENU');
  var toolIsMenu = (tool.TYPE=='MENU');
  var theButton;
  if(toolIsOnMainMenu){
    theButton = createTiddlyButton(
                  place,
                  '',
                  (tool.TOOLTIP? tool.TOOLTIP : ''),
                  (toolIsMenu? wikibar_onClickMenuItem : wikibar_onClickItem),
                  'button');
    theButton.innerHTML = (tool.CAPTION? tool.CAPTION : key);
    theButton.isOnMainMenu = true;
    addClass(theButton, (toolIsMenu? 'menu' : 'item'));
  	place.appendChild( document.createTextNode('\n') );
    if(!toolIsMenu){
      if(config.options['chkWikibarPopmenuOnMouseOver']){
        theButton.onmouseover = function(e){ wikibarPopup.remove(); };
      }
    }
  }else{
    theButton=createTiddlyElement(place, 'tr',key,'button');
    theButton.title = (tool.TOOLTIP? tool.TOOLTIP : '');
    theButton.onclick = (toolIsMenu? wikibar_onClickMenuItem : wikibar_onClickItem);
    var tdL = createTiddlyElement(theButton, 'td','','marker');
    var td = createTiddlyElement(theButton, 'td');
    var tdR = createTiddlyElement(theButton, 'td','','marker');
    td.innerHTML = (tool.CAPTION? tool.CAPTION : key);
    if(toolIsMenu){
      tdR.innerHTML='&amp;nbsp;&amp;nbsp;&amp;rsaquo;';
    }
    if(tool.SELECTED){
      tdL.innerHTML = '&amp;radic; ';
      addClass(theButton, 'selected');
    }
    if(tool.DISABLED){
      addClass(theButton, 'disabled');
    }
  }
  theButton.tiddlerTitle = title;
  theButton.toolItem = tool;
  theButton.editor = editor;
  theButton.tabIndex = 999;
  if(toolIsMenu){
    if(config.options['chkWikibarPopmenuOnMouseOver']){
      theButton.onmouseover = wikibar_onClickMenuItem;
    }
  }
}
function wikibar_createMenuSeperator(place){
  if(place.id.substring(0,7)=='wikibar')  { return; }
  var onclickSeperator=function(e){
  	if(!e){ e = window.event; }
  	e.cancelBubble = true;
    if (e.stopPropagation){ e.stopPropagation();  }
  	return(false);
  };
  var theButton=createTiddlyElement(place,'tr','','seperator');
  var td = createTiddlyElement(theButton, 'td','','seperator');
  td.colSpan=3;
  theButton.onclick=onclickSeperator;
	td.innerHTML = '&lt;hr&gt;';
}
function wikibar_genWikibarAbout(){
  var toolset={};
  toolset.version = {
    CAPTION: '&lt;center&gt;WikiBar ' +
              config.macros.wikibar.major + '.' +
              config.macros.wikibar.minor + '.' +
              config.macros.wikibar.revision +
              (config.macros.wikibar.beta? ' beta '+config.macros.wikibar.beta : '') +
              '&lt;/center&gt;',
    HANDLER: function(){}
  };
  toolset.SEPERATOR = {};
  toolset.author = {
    CAPTION: '&lt;center&gt;Arphen Lin&lt;br&gt;arphenlin@gmail.com&lt;/center&gt;',
    TOOLTIP: 'send mail to the author',
    HANDLER: function(){ window.open('mailto:arphenlin@gmail.com'); }
  };
  toolset.website = {
    CAPTION: '&lt;center&gt;aiddlywiki.sourceforge.net&lt;/center&gt;',
    TOOLTIP: 'go to the web site of WikiBar',
    HANDLER: function(){ window.open('http:\/\/aiddlywiki.sourceforge.net/'); }
  };
  return toolset;
}
function wikibar_genWikibarOptions(title, editor){
  var toolset={};
  toolset.popOnMouseOver = {
    CAPTION:'popup menu on mouse over',
    SELECTED: config.options['chkWikibarPopmenuOnMouseOver'],
    HANDLER: function(param){
      config.options['chkWikibarPopmenuOnMouseOver'] = !config.options['chkWikibarPopmenuOnMouseOver'];
      saveOptionCookie('chkWikibarPopmenuOnMouseOver');
      var title = param.button.tiddlerTitle;
      var wikibar = document.getElementById('wikibar'+title);
      if(wikibar){ wikibar.parentNode.removeChild(wikibar); }
      wikibar_createWikibar(title);
    }
  };
  toolset.setEditorSize = {
    CAPTION:'set editor height: &lt;input id=\&quot;txtWikibarEditorRows\&quot; type=text size=1 MAXLENGTH=3 value=\&quot;' +
            (config.options['txtWikibarEditorRows']? config.options['txtWikibarEditorRows']:editor.rows) + '\&quot;&gt; ok',
    HANDLER: function(param){
      var input = document.getElementById('txtWikibarEditorRows');
      if(input){
        var rows = parseInt(input.value, 10);
        if(!isNaN(rows)){
          var editor = param.button.editor;
          editor.rows = rows;
        }else{
          rows=config.maxEditRows;
        }
        config.options['txtWikibarEditorRows'] = rows;
        saveOptionCookie('txtWikibarEditorRows');
        config.maxEditRows = rows;
      }
    }
  };
  toolset.setEditorSizeOnLoadingWikibar = {
    CAPTION:'set editor height on loading wikibar',
    SELECTED: config.options['chkWikibarSetEditorHeight'],
    HANDLER: function(param){
      config.options['chkWikibarSetEditorHeight'] = !config.options['chkWikibarSetEditorHeight'];
      saveOptionCookie('chkWikibarSetEditorHeight');
      if(config.options['chkWikibarSetEditorHeight']){
        var rows = config.options['txtWikibarEditorRows'];
        if(!isNaN(rows)){ rows = 15; }
        var editor = param.button.editor;
        editor.rows = rows;
        config.options['txtWikibarEditorRows'] = rows;
        saveOptionCookie('txtWikibarEditorRows');
      }
    }
  };
  toolset.SEPERATOR = {};
  toolset.update = {
    CAPTION: 'check for updates',
    DISABLED: true,
    HANDLER: function(){}
  };
  return toolset;
}
function wikibar_genPaletteSelector(){
  try{
  	var cpTiddlers = store.getTaggedTiddlers('ColorPalettes');
  	if(!cpTiddlers) { return; }
  	var palettes=[];
  	palettes.push(wikibarColorTool.defaultPaletteName);
  	for(var i=0; i&lt;cpTiddlers.length; i++){
  		palettes.push(cpTiddlers[i].title.trim());
  	}
    var toolset={};
    for(i=0; i&lt;palettes.length; i++){
      toolset[palettes[i]] = {
        TOOLTIP: palettes[i],
        SELECTED: (palettes[i]==wikibarColorTool.paletteName),
        HANDLER: wikibar_doSelectPalette
      };
    }
    return toolset;
  }catch(ex){ return null; }
}
function wikibar_onClickItem(e){
	if(!e){ e = window.event; }
	var theTarget = resolveTarget(e);
	if(theTarget.tagName=='INPUT'){
    e.cancelBubble = true;
    if (e.stopPropagation){ e.stopPropagation(); }
    return;
	}
	var theButton = wikibar_resolveTargetButton(theTarget);
	if(!theButton){ return(false);  }
  	var o = theButton.toolItem;
    if(!o) { return; }
    var param = {
      event: e,
      button: theButton
    };
    if(o.HANDLER){ o.HANDLER(param);  }
  if(o.DISABLED){
    e.cancelBubble = true;
    if (e.stopPropagation){ e.stopPropagation(); }
  }
	return(false);
}
function wikibar_onClickMenuItem(e){
	if(!e){ e = window.event; }
	var theButton = wikibar_resolveTargetButton(resolveTarget(e));
	if(!theButton){ return(false);  }
	e.cancelBubble = true;
	if (e.stopPropagation){ e.stopPropagation(); }
    var title = theButton.tiddlerTitle;
    var editor = theButton.editor;
    var tool = theButton.toolItem;
    if(!tool) { return; }
    var popup = wikibarPopup.create(this);
  	if(popup){
      wikibar_createMenu(popup,tool,title,editor);
      if(!popup.hasChildNodes()){
        wikibarPopup.remove();
      }else{
        wikibarPopup.show(popup, false);
      }
    }
	return(false);
}
var wikibarColorTool = {
  defaultPaletteName : 'default',
  defaultColumns : 16,
  defaultPalette : [
    '#FFF','#DDD','#CCC','#BBB','#AAA','#999','#666','#333','#111','#000','#FC0','#F90','#F60','#F30','#C30','#C03',
    '#9C0','#9D0','#9E0','#E90','#D90','#C90','#FC3','#FC6','#F96','#F63','#600','#900','#C00','#F00','#F36','#F03',
    '#CF0','#CF3','#330','#660','#990','#CC0','#FF0','#C93','#C63','#300','#933','#C33','#F33','#C36','#F69','#F06',
    '#9F0','#CF6','#9C3','#663','#993','#CC3','#FF3','#960','#930','#633','#C66','#F66','#903','#C39','#F6C','#F09',
    '#6F0','#9F6','#6C3','#690','#996','#CC6','#FF6','#963','#630','#966','#F99','#F39','#C06','#906','#F3C','#F0C',
    '#3F0','#6F3','#390','#6C0','#9F3','#CC9','#FF9','#C96','#C60','#C99','#F9C','#C69','#936','#603','#C09','#303',
    '#0C0','#3C0','#360','#693','#9C6','#CF9','#FFC','#FC9','#F93','#FCC','#C9C','#969','#939','#909','#636','#606',
    '#060','#3C3','#6C6','#0F0','#3F3','#6F6','#9F9','#CFC','#9CF','#FCF','#F9F','#F6F','#F3F','#F0F','#C6C','#C3C',
    '#030','#363','#090','#393','#696','#9C9','#CFF','#39F','#69C','#CCF','#C9F','#96C','#639','#306','#90C','#C0C',
    '#0F3','#0C3','#063','#396','#6C9','#9FC','#9CC','#06C','#369','#99F','#99C','#93F','#60C','#609','#C3F','#C0F',
    '#0F6','#3F6','#093','#0C6','#3F9','#9FF','#699','#036','#039','#66F','#66C','#669','#309','#93C','#C6F','#90F',
    '#0F9','#6F9','#3C6','#096','#6FF','#6CC','#366','#069','#36C','#33F','#33C','#339','#336','#63C','#96F','#60F',
    '#0FC','#6FC','#3C9','#3FF','#3CC','#399','#033','#39C','#69F','#00F','#00C','#009','#006','#003','#63F','#30F',
    '#0C9','#3FC','#0FF','#0CC','#099','#066','#3CF','#6CF','#09C','#36F','#0CF','#09F','#06F','#03F','#03C','#30C'
  ],
	colorPicker : null,
  pickColorHandler: null,
  userData: null
};
wikibarColorTool.paletteName = wikibarColorTool.defaultPaletteName;
wikibarColorTool.columns = wikibarColorTool.defaultColumns;
wikibarColorTool.palette = wikibarColorTool.defaultPalette;
wikibarColorTool.onPickColor = function(e){
	if (!e){ e = window.event; }
	var theCell = resolveTarget(e);
	if(!theCell){ return(false); }
    color = theCell.bgColor.toLowerCase();
    if(!color)  { return; }
    wikibarColorTool.displayColorPicker(false);
    if(wikibarColorTool.pickColorHandler){
      wikibarColorTool.pickColorHandler(color, wikibarColorTool.userData);
    }
	return(false);
};
wikibarColorTool.onMouseOver = function(e){
	if (!e){ e = window.event; }
	var theButton = resolveTarget(e);
	if(!theButton){ return(false);  }
  	if(!wikibarColorTool)  { return; }
    color = theButton.bgColor.toUpperCase();
    if(!color)  { return; }
    td=document.getElementById('colorPickerInfo');
  	if(!td) { return; }
  	td.bgColor = color;
  	td.innerHTML = '&lt;span style=\&quot;color:#000;\&quot;&gt;'+color+'&lt;/span&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;' +
  	               '&lt;span style=\&quot;color:#fff;\&quot;&gt;'+color+'&lt;/span&gt;';
	e.cancelBubble = true;
	if (e.stopPropagation){ e.stopPropagation(); }
	return(false);
};
wikibarColorTool.openColorPicker = function(theTarget, pickColorHandler, userData){
  wikibarColorTool.skipClickDocumentEvent = true;
  wikibarColorTool.pickColorHandler = pickColorHandler;
  wikibarColorTool.userData = userData;
  wikibarColorTool.moveColorPicker(theTarget);
};
wikibarColorTool.convert3to6HexColor = function(c){
  c=c.trim();
  var rx=/^\#(\d|[a-f])(\d|[a-f])(\d|[a-f])$/gi;
  return (rx.test(c)? c.replace(rx, '#$1$1$2$2$3$3') : c);
};
wikibarColorTool.numToHexColor = function (n){
  if(typeof(n)=='number' &amp;&amp; (n&gt;=0 &amp;&amp; n&lt;=255)) {
  		s = n.toString(16).toLowerCase();
  		return ((s.length==1)? '0'+s : s);
  }else{
	 return null;
	}
};
wikibarColorTool.renderColorPalette = function(){
	if(wikibarColorTool.paletteName==wikibarColorTool.defaultPaletteName){
		wikibarColorTool.palette=wikibarColorTool.defaultPalette;
		wikibarColorTool.columns=wikibarColorTool.defaultColumns;
		return;
	}
	tiddlerText = (store.getTiddlerText(wikibarColorTool.paletteName, '')).trim();
	if(tiddlerText.length&lt;=0) { return; }
	var cpContents = tiddlerText.split('\n');
	var colors=[];
	columns = wikibarColorTool.defaultColumns;
	var tmpArray=null;
	errCount=0;
	for(var i=0; i&lt;cpContents.length; i++){
		cpLine=cpContents[i].trim();
    if( (!cpLine) || (cpLine.length&lt;=0) || (cpLine.charAt(0) == '#') ){ continue; }
		if(cpLine.substring(0,8).toLowerCase()=='columns:'){
			tmpArray = cpLine.split(':');
			try{
				columns = parseInt(tmpArray[1],10);
			}catch(ex){
				columns = wikibarColorTool.defaultColumns;
			}
		}else{
			tmpArray = cpLine.replace('\t', ' ').split(/[ ]{1,}/);
			try{
				color='';
				for(var j=0; j&lt;3; j++){
          c=parseInt(tmpArray[j].trim(), 10);
          if(isNaN(c)){
						break;
          }else{
						c=wikibarColorTool.numToHexColor(c);
						if(!c) {break;}
            color+=c;
					}
				}
				if(color.length==6){
					colors.push('#'+color);
				}	else {
					throw 'error';
				}
			}catch(ex){
			}
		}
	}
	if(colors.length&gt;0){
		wikibarColorTool.palette = colors;
		wikibarColorTool.columns = columns;
	}else{
		throw 'renderColorPalette(): No color defined in the palette.';
	}
};
wikibarColorTool.displayColorPicker = function(visible){
  if(wikibarColorTool.colorPicker){
    wikibarColorTool.colorPicker.style.display = (visible? 'block' : 'none');
  }
};
wikibarColorTool.moveColorPicker = function(theTarget){
  if(!wikibarColorTool.colorPicker){
  	wikibarColorTool.createColorPicker();
  }
	var cp = wikibarColorTool.colorPicker;
	var rootLeft = findPosX(theTarget);
  var rootTop = findPosY(theTarget);
  var popupLeft = rootLeft;
  var popupTop = rootTop;
  var popupWidth = cp.offsetWidth;
  var winWidth = findWindowWidth();
  if(popupLeft + popupWidth &gt; winWidth){
	  popupLeft = winWidth - popupWidth;
	}
  cp.style.left = popupLeft + 'px';
  cp.style.top = popupTop + 'px';
  wikibarColorTool.displayColorPicker(true);
};
wikibarColorTool.createColorPicker = function(unused, palette){
  if(palette){	wikibarColorTool.paletteName=palette; }
	wikibarColorTool.renderColorPalette();
	wikibarColorTool.colorPicker = document.createElement('div');
	wikibarColorTool.colorPicker.id = 'colorPicker';
	document.body.appendChild(wikibarColorTool.colorPicker);
  var theTable = document.createElement('table');
  wikibarColorTool.colorPicker.appendChild(theTable);
  var theTR = document.createElement('tr');
	theTable.appendChild(theTR);
	var theTD = document.createElement('td');
	theTD.className = 'header';
	theTD.colSpan = wikibarColorTool.columns;
	theTD.innerHTML = wikibarColorTool.paletteName;
  theTR.appendChild(theTD);
  for(var i=0; i&lt;wikibarColorTool.palette.length; i++){
    if((i%wikibarColorTool.columns)===0){
      theTR = document.createElement('tr');
      theTable.appendChild(theTR);
    }
    theTD = document.createElement('td');
    theTD.className = 'cell';
    theTD.bgColor = wikibarColorTool.convert3to6HexColor(wikibarColorTool.palette[i]);
    theTD.onclick = wikibarColorTool.onPickColor;
    theTD.onmouseover = wikibarColorTool.onMouseOver;
    theTR.appendChild(theTD);
  }
  rest = wikibarColorTool.palette.length % wikibarColorTool.columns;
  if(rest&gt;0){
    theTD = document.createElement('td');
		theTD.colSpan = wikibarColorTool.columns-rest;
    theTD.bgColor = '#000000';
    theTR.appendChild(theTD);
  }
  theTR = document.createElement('tr');
	theTable.appendChild(theTR);
	theTD = document.createElement('td');
	theTD.colSpan = wikibarColorTool.columns;
	theTD.id = 'colorPickerInfo';
  theTR.appendChild(theTD);
};
wikibarColorTool.onDocumentClick = function(e){
	if (!e){ e = window.event; }
	if(wikibarColorTool.skipClickDocumentEvent) {
	  wikibarColorTool.skipClickDocumentEvent = false;
    return true;
	}
	if((!e.eventPhase) || e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET){
    wikibarColorTool.displayColorPicker(false);
  }
	return true;
};
function wikibar_doSelectPalette(param){
	clearMessage();
	var theButton = param.button;
	if(!theButton.toolItem.key)  { return; }
	var palette = theButton.toolItem.key;
	var oldPaletteName = wikibarColorTool.paletteName;
	if(oldPaletteName != palette){
		try{
			wikibarColorTool.createColorPicker(theButton, palette);
			displayMessage('Palette \&quot;'+palette+'\&quot; ('+ wikibarColorTool.palette.length +' colors) is selected');
		}catch(ex){
			errMsg = ex;
			if(errMsg.substring(0,18)=='renderColorPalette'){
				displayMessage('Invalid palette \&quot;' + palette + '\&quot;, please check it out!');
				wikibarColorTool.createColorPicker(theButton, oldPaletteName);
			}
		}
	}
}
var wikibarPopup = {
  skipClickDocumentEvent: false,
	stack: []
};
wikibarPopup.resolveRootPopup = function(o){
  if(o.isOnMainMenu){  return null; }
  if(o.className.substring(0,12)=='wikibarPopup'){  return o;}
  return wikibarPopup.resolveRootPopup(o.parentNode);
};
wikibarPopup.create = function(root){
  for(var i=0; i&lt;wikibarPopup.stack.length; i++){
    var p=wikibarPopup.stack[i];
    if(p.root==root){
      wikibarPopup.removeFrom(i+1);
      return null;
    }
  }
  var rootPopup = wikibarPopup.resolveRootPopup(root);
  if(!rootPopup){
    wikibarPopup.remove();
  }else{
    wikibarPopup.removeFromRootPopup(rootPopup);
  }
	var popup = createTiddlyElement(document.body,'div','wikibarPopup'+root.toolItem.key,'wikibarPopup');
	var pop = createTiddlyElement(popup,'table','','');
	wikibarPopup.stack.push({rootPopup: rootPopup, root: root, popup: popup});
	return pop;
};
wikibarPopup.show = function(unused,slowly){
	var curr = wikibarPopup.stack[wikibarPopup.stack.length-1];
	var overlayWidth = 1;
  var rootLeft, rootTop, rootWidth, rootHeight, popupLeft, popupTop, popupWidth;
  if(curr.rootPopup){
  	rootLeft = findPosX(curr.rootPopup);
  	rootTop = findPosY(curr.root);
  	rootWidth = curr.rootPopup.offsetWidth;
  	popupLeft = rootLeft + rootWidth - overlayWidth;
  	popupTop = rootTop;
  }else{
  	rootLeft = findPosX(curr.root);
  	rootTop = findPosY(curr.root);
  	rootHeight = curr.root.offsetHeight;
  	popupLeft = rootLeft;
  	popupTop = rootTop + rootHeight;
  }
	var winWidth = findWindowWidth();
	popupWidth = curr.popup.offsetWidth;
	if(popupLeft + popupWidth &gt; winWidth){
		popupLeft = rootLeft - popupWidth + overlayWidth;
	}
	curr.popup.style.left = popupLeft + 'px';
	curr.popup.style.top = popupTop + 'px';
	curr.popup.style.display = 'block';
	addClass(curr.root, 'highlight');
	if(config.options.chkAnimate){
		anim.startAnimating(new Scroller(curr.popup,slowly));
	}else{
		window.scrollTo(0,ensureVisible(curr.popup));
	}
};
wikibarPopup.remove = function(){
	if(wikibarPopup.stack.length &gt; 0){
		wikibarPopup.removeFrom(0);
  }
};
wikibarPopup.removeFrom = function(from){
	for(var t=wikibarPopup.stack.length-1; t&gt;=from; t--){
		var p = wikibarPopup.stack[t];
		removeClass(p.root,'highlight');
		p.popup.parentNode.removeChild(p.popup);
  }
	wikibarPopup.stack = wikibarPopup.stack.slice(0,from);
};
wikibarPopup.removeFromRootPopup = function(from){
  for(var t=0; t&lt;wikibarPopup.stack.length; t++){
    var p = wikibarPopup.stack[t];
    if(p.rootPopup==from){
      wikibarPopup.removeFrom(t);
      break;
    }
  }
};
wikibarPopup.onDocumentClick = function(e){
	if (!e){ e = window.event; }
	if(wikibarPopup.skipClickDocumentEvent){
	 wikibarPopup.skipClickDocumentEvent=false;
	 return true;
	}
	if((!e.eventPhase) || e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET){
		wikibarPopup.remove();
	}
	return true;
};
var wikibarStore = {
  TYPE: 'MAIN_MENU',
  help:{
    TYPE:'MENU',
    CAPTION: '&lt;font face=\&quot;verdana\&quot;&gt;?&lt;/font&gt;',
    TOOLTIP:     'about WikiBar',
    options:{
      TYPE:'MENU',
      DYNAITEM: wikibar_genWikibarOptions
    },
    about:{
      TYPE:'MENU',
      DYNAITEM: wikibar_genWikibarAbout
    }
  },
  preview:{
    TOOLTIP:     'preview this tiddler',
    CAPTION: '&lt;font face=\&quot;verdana\&quot;&gt;&amp;infin;&lt;/font&gt;',
    HANDLER: wikibar_doPreview
  },
	line:{
		TOOLTIP:    'horizontal line',
		CAPTION: '&lt;font face=\&quot;verdana\&quot;&gt;&amp;mdash;&lt;/font&gt;',
		syntax: '\n----\n',
		HANDLER: wikibar_editFormatByCursor
	},
	crlf:{
		TOOLTIP:    'new line',
		CAPTION: '&lt;font face=\&quot;verdana\&quot;&gt;&amp;para;&lt;/font&gt;',
		syntax: '\n',
		HANDLER: wikibar_editFormatByCursor
	},
	selectAll:{
		TOOLTIP:    'select all',
		CAPTION: '&lt;font face=\&quot;verdana\&quot;&gt;&amp;sect;&lt;/font&gt;',
		HANDLER: wikibar_editSelectAll
	},
	deleteSelected:{
		TOOLTIP:    'delete selected',
		CAPTION: '&lt;font face=\&quot;verdana\&quot;&gt;&amp;times;&lt;/font&gt;',
		syntax: '',
		HANDLER: wikibar_editFormat
	},
  textFormat:{
    TYPE: 'MENU',
    CAPTION: 'text',
    TOOLTIP: 'text formatters',
    ignore:{
			TOOLTIP:     'ignore wiki word',
			CAPTION: 'ignore wikiWord',
			syntax:  '~user_text',
			hint:    'wiki_word',
			HANDLER:    wikibar_editFormatByWord
		},
		bolder:{
			TOOLTIP:     'bolder text',
			CAPTION: '&lt;strong&gt;bolder&lt;/strong&gt;',
			syntax:  &quot;''user_text''&quot;,
			hint:		 'bold_text',
			HANDLER:    wikibar_editFormatByWord
		},
		italic:{
			TOOLTIP:    'italic text',
			CAPTION: '&lt;em&gt;italic&lt;/em&gt;',
			syntax: '\/\/user_text\/\/',
			hint:		'italic_text',
			HANDLER: wikibar_editFormatByWord
		},
		underline:{
			TOOLTIP:    'underline text',
			CAPTION: '&lt;u&gt;underline&lt;/u&gt;',
			syntax: '__user_text__',
			hint:		'underline_text',
			HANDLER: wikibar_editFormatByWord
		},
		strikethrough:{
			TOOLTIP:    'strikethrough text',
			CAPTION: '&lt;strike&gt;strikethrough&lt;/strike&gt;',
			syntax: '==user_text==',
			hint:		'strikethrough_text',
			HANDLER: wikibar_editFormatByWord
		},
		superscript:{
			TOOLTIP:    'superscript text',
			CAPTION: 'X&lt;sup&gt;superscript&lt;/sup&gt;',
			syntax: '^^user_text^^',
			hint:		'superscript_text',
			HANDLER: wikibar_editFormatByWord
		},
		subscript:{
			TOOLTIP:    'subscript text',
			CAPTION: 'X&lt;sub&gt;subscript&lt;/sub&gt;',
			syntax: '~~user_text~~',
			hint:		'subscript_text',
			HANDLER: wikibar_editFormatByWord
		},
		comment:{
			TOOLTIP:    'comment text',
			CAPTION: 'comment text',
			syntax: '/%user_text%/',
			hint:		'comment_text',
			HANDLER: wikibar_editFormatByWord
		},
		monospaced:{
			TOOLTIP:    'monospaced text',
			CAPTION: '&lt;code&gt;monospaced&lt;/code&gt;',
			syntax: '{{{user_text}}}',
			hint:		'monospaced_text',
			HANDLER: wikibar_editFormatByWord
		}
  },
  paragraph:{
    TYPE: 'MENU',
    TOOLTIP: 'paragarph formatters',
    list:{
      TYPE: 'MENU',
      TOOLTIP: 'list tools',
      bullet:{
  			TOOLTIP:    'bullet point',
  			syntax: '*user_text',
  			hint:		'bullet_text',
  			HANDLER: wikibar_editFormatByLine
  		},
  		numbered:{
  			TOOLTIP:    'numbered list',
  			syntax: '#user_text',
  			hint:		'numbered_text',
  			HANDLER: wikibar_editFormatByLine
  		}
    },
    heading:{
      TYPE: 'MENU',
      heading1:{
  		  CAPTION:'&lt;h1&gt;Heading 1&lt;/h1&gt;',
  			TOOLTIP:    'Heading 1',
  			syntax: '!user_text',
  			hint:		'heading_1',
  			HANDLER: wikibar_editFormatByLine
  		},
  		heading2:{
  		  CAPTION:'&lt;h2&gt;Heading 2&lt;h2&gt;',
  			TOOLTIP:    'Heading 2',
  			syntax: '!!user_text',
  			hint:		'heading_2',
  			HANDLER: wikibar_editFormatByLine
  		},
  		heading3:{
  		  CAPTION:'&lt;h3&gt;Heading 3&lt;/h3&gt;',
  			TOOLTIP:    'Heading 3',
  			syntax: '!!!user_text',
  			hint:		'heading_3',
  			HANDLER: wikibar_editFormatByLine
  		},
  		heading4:{
  		  CAPTION:'&lt;h4&gt;Heading 4&lt;/h4&gt;',
  			TOOLTIP:    'Heading 4',
  			syntax: '!!!!user_text',
  			hint:		'heading_4',
  			HANDLER: wikibar_editFormatByLine
  		},
  		heading5:{
  		  CAPTION:'&lt;h5&gt;Heading 5&lt;/h5&gt;',
  			TOOLTIP:    'Heading 5',
  			syntax: '!!!!!user_text',
  			hint:		'heading_5',
  			HANDLER: wikibar_editFormatByLine
  		}
    },
    comment:{
      TYPE: 'MENU',
      commentByLine:{
  			CAPTION:'comment by line',
  			TOOLTIP:    'line comment',
  			syntax: '/%user_text%/',
  			hint:		'comment_text',
  			HANDLER: wikibar_editFormatByLine
  		},
  		commentByBlock:{
  			CAPTION:'comment by block',
  			TOOLTIP:    'block comment',
  			syntax: '/%\nuser_text\n%/',
  			hint:		'comment_text',
  			byBlock: true,
  			HANDLER: wikibar_editFormatByLine
  		}
    },
    monospaced:{
      TYPE: 'MENU',
  		monosByLine:{
  			CAPTION: 	'monospaced by line',
  			TOOLTIP:    'line monospaced',
  			syntax: '{{{\nuser_text\n}}}',
  			hint:		'monospaced_text',
  			HANDLER: wikibar_editFormatByLine
  		},
  		monosByBlock:{
  			CAPTION: 	'monospaced by block',
  			TOOLTIP:    'block monospaced',
  			syntax: '{{{\nuser_text\n}}}',
  			hint:		'monospaced_text',
  			byBlock: true,
  			HANDLER: wikibar_editFormatByLine
  		}
    },
    quote:{
      TYPE: 'MENU',
  		quoteByLine:{
  			CAPTION: 	'quote by line',
  			TOOLTIP:    'line quote',
  			syntax: '&gt;user_text',
  			hint:		'quote_text',
  			HANDLER: wikibar_editFormatByLine
  		},
  		quoteByBlcok:{
  			CAPTION: 	'quote by block',
  			TOOLTIP:    'block quote',
  			syntax: '&lt;&lt;&lt;\nuser_text\n&lt;&lt;&lt;',
  			hint:		'quote_text',
  			byBlock: true,
  			HANDLER: wikibar_editFormatByLine
  		}
    },
    plugin:{
      TYPE: 'MENU',
      code:{
  			CAPTION: 	'code area',
  			TOOLTIP:    'block monospaced for plugin',
  			syntax: '\n\/\/{{{\nuser_text\n\/\/}}}\n',
  			hint:		'monospaced_plugin_code',
  			byBlock: true,
  			HANDLER: wikibar_editFormatByLine
  		},
  		commentByLine:{
  			CAPTION: 	'comment by line',
  			TOOLTIP:    'line comment',
  			syntax: '\/\/user_text',
  			hint:		'plugin_comment',
  			HANDLER: wikibar_editFormatByLine
  		},
  		commentByBlock:{
  			CAPTION: 	'comment by block',
  			TOOLTIP:    'block comment',
  			syntax: '\/\***\nuser_text\n***\/',
  			hint:		'plugin_comment',
  			byBlock: true,
  			HANDLER: wikibar_editFormatByLine
  		}
    },
    css:{
      TYPE: 'MENU',
      code:{
  			CAPTION: 	'code area',
  			TOOLTIP:    'block monospaced for css',
  			syntax: '\n\nuser_text\n\n',
  			hint:		'monospaced_css_code',
  			byBlock: true,
  			HANDLER: wikibar_editFormatByLine
  		},
  		commentByLine:{
  			CAPTION: 	'comment by line',
  			TOOLTIP:    'line comment',
  			syntax: '',
  			hint:		'css_comment',
  			HANDLER: wikibar_editFormatByLine
  		},
  		commentByBlock:{
  			CAPTION: 	'comment by block',
  			TOOLTIP:    'block comment',
  			syntax: '',
  			hint:		'css_comment',
  			byBlock: true,
  			HANDLER: wikibar_editFormatByLine
  		}
    }
  },
  color:{
    TYPE: 'MENU',
    TOOLTIP: 'color tools',
    highlight:{
		  CAPTION:'highlight text',
			TOOLTIP:    'highlight text',
			syntax: '@@user_text@@',
			hint:		'highlight_text',
			HANDLER: wikibar_editFormatByWord
		},
		color:{
		  CAPTION:'text color',
			TOOLTIP:    'text color',
			hint:		'your_text',
			syntax: '@@color(%1):user_text@@',
			HANDLER:   wikibar_getColorCode,
			doMore: wikibar_editFormatByWord
		},
		bgcolor:{
		  CAPTION:'background color',
			TOOLTIP:    'background color',
			hint:		'your_text',
			syntax: '@@bgcolor(%1):user_text@@',
			HANDLER: wikibar_getColorCode,
			doMore: wikibar_editFormatByWord
		},
		colorcode:{
      CAPTION:'color code',
      TOOLTIP:    'insert color code',
      syntax: '%1',
      HANDLER: wikibar_getColorCode,
      doMore: wikibar_editFormatByCursor
    },
    'color palette':{
      TYPE:'MENU',
      DYNAITEM: wikibar_genPaletteSelector,
  		SEPERATOR:{},
  		morePalette:{
  		  CAPTION:'more palettes',
  		  TOOLTIP:'get more palettes',
  		  HANDLER: wikibar_getMorePalette
  		}
    }
  },
  link:{
    TYPE: 'MENU',
    TOOLTIP: 'insert link',
    wiki:{
		  CAPTION:'wiki link',
			TOOLTIP:    'wiki link',
			syntax: '[[user_text]]',
			hint:		'wiki_word',
			HANDLER: wikibar_editFormatByWord
		},
		pretty:{
			CAPTION: 	'pretty link',
			TOOLTIP:    'pretty link',
			syntax: '[[user_text|%1]]',
			hint:		'pretty_word',
			param:	'PrettyLink Target',
			HANDLER:   wikibar_getLinkUrl,
			doMore: wikibar_editFormatByWord
		},
		url:{
			TOOLTIP:    'url link',
			syntax: '[[user_text|%1]]',
			hint:		'your_text',
			param:	'http:\/\/...',
			HANDLER:   wikibar_getLinkUrl,
			doMore: wikibar_editFormatByWord
		},
		image:{
			TOOLTIP:    'image link',
			syntax: '[img[user_text|%1]]',
			hint:		'alt_text',
			param:	'image/icon.jpg',
			HANDLER:   wikibar_getLinkUrl,
			doMore: wikibar_editFormatByWord
		}
  },
  macro:{},
  more:{
    TYPE: 'MENU',
    TOOLTIP: 'more tools',
    table:{
      TYPE: 'MENU',
      TOOLTIP: 'table',
      table:{
  		  CAPTION:'create table',
  			TOOLTIP:    'create a new table',
  			syntax: '\n%1\n',
  			HANDLER: wikibar_getTableRowCol,
  			doMore: wikibar_editFormatByWord
  		},
  		header:{
  			TOOLTIP:    'table header text',
  			syntax: '|user_text|c',
  			hint:		'table_header',
  			HANDLER: wikibar_editFormatByWord
  		},
  		cell:{
  			TOOLTIP:    'create a tabel cell',
  			syntax: '|user_text|',
  			hint:		'your_text',
  			HANDLER: wikibar_editFormatByWord
  		},
  		columnHeader:{
  		  CAPTION:'column header',
  			TOOLTIP:    'create a column header cell',
  			syntax: '|!user_text|',
  			hint:		'column_header',
  			HANDLER: wikibar_editFormatByWord
  		},
  	  cell:{
  	    TYPE: 'MENU',
        CAPTION: 'cell options',
    		bgcolor:{
    			CAPTION: 	'background color',
    			TOOLTIP:    'cell bgcolor',
    			syntax: '|bgcolor(%1):user_text|',
    			hint:		'your_text',
    			HANDLER: wikibar_getColorCode,
    			doMore: wikibar_editFormatByTableCell
    		},
    		alignLeft:{
    			CAPTION: 	'align left',
    			TOOLTIP:    'left align cell text',
    			syntax: '|user_text|',
    			hint:		'your_text',
    			HANDLER: wikibar_editFormatByTableCell
    		},
    		alignCenter:{
    			CAPTION: 	'align center',
    			TOOLTIP:    'center align cell text',
    			syntax: '| user_text |',
    			hint:		'your_text',
    			HANDLER: wikibar_editFormatByTableCell
    		},
    		alignRight:{
    			CAPTION: 	'align right',
    			TOOLTIP:    'right align cell text',
    			syntax: '| user_text|',
    			hint:		'your_text',
    			HANDLER: wikibar_editFormatByTableCell
    		}
    	}
    },
    html:{
      TYPE: 'MENU',
      html:{
  			CAPTION: 	'&amp;lt;html&amp;gt;',
  			TOOLTIP:    'html tag',
  			syntax: '&lt;html&gt;\nuser_text\n&lt;/html&gt;',
  			hint:		'html_content',
  			byBlock: true,
  			HANDLER: wikibar_editFormatByLine
  		}
    }
  },
  addon:{
    TYPE: 'MENU',
    TOOLTIP:'3rd party tools',
    'about addons':{
      TOOLTIP: 'list loaded addons',
      HANDLER: wikibar_doListAddons
    },
    SEPERATOR:{}
  }
};
addEvent(document, 'click', wikibarColorTool.onDocumentClick);
addEvent(document, 'click', wikibarPopup.onDocumentClick);
wikibar_install();
//}}}</pre>
</div>
<div title="Windows和Linux共享文件" modifier="wy" created="201111040516" modified="201111040554" changecount="21">
<pre>!!ubuntu自带的共享工具
*ubuntu {{{--&gt;}}} windows
路径：''System-Preferences-Personal File Sharing''（ubuntu10.04是这样，早期版本可能是''System-Administration-Shared Folders''）
若没有的话可以安装：
&gt;sudo apt-get install nautilus-share
可能会出现如下错误
{{{
This feature  cannot  be enabled  because the required packages are not installed on your system
}}}
安装apache即可：
&gt;sudo apt-get install apache2
*windows {{{--&gt;}}} ubuntu
windows正常共享，ubuntu中工具：''Places-Network''用于查看局域网中的所有共享目录，或''Places-Connect to Server''，填入地址直接访问共享目录
!!samba工具
*ubuntu {{{--&gt;}}} windows
安装samba，并配置，参考[[How To: Definitive Samba Guide for 10.04|http://ubuntuforums.org/showthread.php?t=1468498]]
需要注意的是''samba中增加的用户必须是系统中存在的用户''，否则会出错（可以先在系统中新建一个用于共享的用户）
*windows {{{--&gt;}}} ubuntu
&lt;code bash&gt;
sudo mkdir /media/win_share #共享目录的挂载目的地
sudo apt-get install smbfs  #挂载时使用的是smbfs文件系统类型，samba会帮忙通信，需安装
#将window目录挂载到本地目录，注意iocharset=uft8是为了解决乱码问题，default的具体含义见最下参考文献
sudo mount -t smbfs –o username=wy,password=123,iocharset=uft8,defaults //192.168.0.1/share /media/win_share  
&lt;/code&gt;
这样做的话每次重启都需要手动挂载，解决办法有两个1, 将上述命令写成脚本，设成开机启动；2, 设置fstab，在/etc/fstab中加入如下行
&lt;code bash&gt;
//192.168.0.1/share   /media/win_share  smbfs  username=wy,password=123,iocharset=utf8,defaults  0  0
&lt;/code&gt;
fstab的信息可参考[[用fstab挂载分区]]和[[ How to edit and understand /etc/fstab|http://www.tuxfiles.org/linuxhelp/fstab.html#one-two]]
也可以使用''smbclient''，参考[[ubuntu_Samba||http://wiki.ubuntu.org.cn/Samba]]，它还包括一些错误信息

</pre>
</div>
<div title="Word长篇文档排版技巧" modifier="YourName" created="201006091623" modified="201006091727" changecount="6">
<pre>@@color(red):来自电脑中的视频《word长篇文档排版技巧》@@

*{{{Ctrl+Home}}}
&gt;定位到文章开头(24m46s)
*通过''查找''菜单中的''格式''菜单来定位所有某一个格式的文字
*应用样式可设置快捷键，在''修改样式''的菜单中
*{{{Ctrl+[或]}}}调整字体大小
*去除格式：选中文字-在''格式和样式''窗口点''清除格式''(27m56s)
*分节的作用是：可以对不同的节弄不同的格式
&gt;查看分节：按“''显示或隐藏标记标记''”按钮，或者快捷键（''Ctrl+*''），后者用查找（查找内容在''特殊字符''中选择''分节符''）
&gt;很多时候不同的章节之间要分节，而不是分页
&gt;“''首页不同''”选项是指每一节的''第一页''的格式不同
*''模板''&amp;''样式''的选择与传递（''1h35m''）</pre>
</div>
<div title="XML处理" modifier="YourName" created="201009090405" modified="201012140416" changecount="7">
<pre>*预处理
由于[[XML标准|http://www.w3.org/TR/2000/REC-xml-20001006#NT-Char]]所规定的字符集是Unicode（如UTF8）的''子集''，所以在处理Unicode字符集的XML文档是需要进行预处理，见[[Invalid XML Characters: when valid UTF8 does not mean valid XML|http://cse-mjmcl.cse.bris.ac.uk/blog/2007/02/14/1171465494443.html]]。StackOverflow上也早有人遇到过此问题，有人提供了一个Sanitize XML文件的程序：见[[这里|http://stackoverflow.com/questions/93655/stripping-invalid-xml-characters-in-java]]
*Parsing
**Java版：[[Java处理XML]]
**Python版：[[Python处理XML]]
*XML生成
**xml.dom.minidom
&gt;见[[这里|http://www.postneo.com/projects/pyxml/]]和[[CSDN博客|http://blog.csdn.net/kiki113/archive/2009/04/15/4078228.aspx]]
**xml.etree.ElementTree
&gt;见[[这里|http://lulinbest.blog.sohu.com/75921823.html]]
*XML特殊字符转义([[Ref|http://blogger.org.cn/blog/more.asp?name=Qr&amp;id=30342]])
| !特殊字符 | !实体值字符串 |
| &gt; | &amp;gt; |
| &lt; | &amp;lt; |
| &amp; | &amp;amp; |
| &quot; | &amp;quote; |
| ' | &amp;apos; |
</pre>
</div>
<div title="__main__二三事" modifier="teloon" created="200908111646" modified="200910291221" tags="__main__" changecount="3">
<pre>{{{__main__}}}是个模块，当整个文件作为主程序时，程序的{{{__name__}}}(应该是模块名)就为{{{__main__}}}；当这个文件被当作模块被其他程序导入(调用)时，{{{__name__}}}是这个文件的文件名（即模块名）。
{{{update}}}:参见《Dive Into Python》26页，它的一般用处是在将模块集成到大程序中前先进行单元测试；</pre>
</div>
<div title="awk" modifier="wy" created="201111030744" modified="201111030826" changecount="3">
<pre>*''{{{内置变量}}}'':ARGC,ARGV,NR,FNR,NF,FS,OFS,RS,ORS,FILENAME,ENVIRON
*''{{{next}}}'':可以简单理解为''跳过后面''的代码，如果next被执行，那么它后面的代码就都不会被执行了。
*可以指定''变量名的值''或向脚本传''具名参数''
*''{{{字符串函数}}}''
*''{{{数组}}}''
*''{{{for}}}''循环遍历
{{{
for (i in array) {print array[i]}
}}}
*''{{{printf}}}''格式化输出字符串（不是打印到文件）
*''{{{awk脚本文件}}}''开头写上''!/bin/awk -f''，执行自包含脚本，需要输入文件作为参数</pre>
</div>
<div title="code" modifier="wy" created="200904100229" modified="201111030743" tags="code" changecount="91">
<pre>!C
*[[变量在内存中存储结构]]
*[[结构体指针+1的问题]]
*[[格式化sprintf]]
*[[C&amp;C++中关于void的一些原则]]
*[[minix中函数原型定义的方法]]
*[[C语言指针]]
*[[关于char和unsigned char自己的一些理解]]
*[[struct中的字节对齐]]
*[[++操作及其效率]]
*[[关于指针和数组变量]]
*[[双重指针]]
!Java
*[[《JAVA SE6全方位学习》笔记]]
*[[java中的局部变量和成员变量]]
*[[java类中静态域、块，非静态域、块，构造函数的初始化顺序]]
*[[IO类选择]]
*[[Java处理XML]]
*[[Java正则]]
*[[long和byte[]相互转换]]
!CPP
*[[参考资源]]
*[[杂记]]
*[[《C++大学教程》笔记]]
*[[《C++ Primer》笔记]]
*[[Ubuntu8.04环境 boost手动安装]]
*[[vector中的resize和reserve]]
*[[CPP中指针与引用]]
*[[自定义STL容器中的比较函数]]
*[[STL容器中指针作为元素]]
*[[STL二三事]]
*[[调用python]]
*[[模板库]]
*[[文件操作方法]]
*[[二维数组声明]]
*[[图像处理]]
!Python
[[Python文件操作]]
[[Dive Into Python学习笔记]]
[[Core Python学习笔记]]
[[python杂]]
[[__main__二三事]]
[[eric安装]]
[[人人网信息抓取器]]
[[Java与Python]]
[[Python处理XML]]
[[Python处理cvs, xls, xlsx]]
[[PyQt]]
[[Python访问数据库]]
[[Python Debugging]]
!shell脚本
[[awk]]
!Profile
[[工具讨论]]
!Resource
台湾井民全的课程页面（Java,C++,Windows Programming等）：[[传送们|http://debut.cis.nctu.edu.tw/~ching/Course/course.htm]]
!其他
[[XML处理]]
[[编码问题]]</pre>
</div>
<div title="eric安装" modifier="wy" created="200911021719" modified="201009180137" tags="eric PythonIDE" changecount="13">
<pre>!windows下安装

''@@bgcolor(lightblue):先安装[[Python(x,y)|http://www.pythonxy.com/]]，它已经将环境和依赖配置好了，然后直接进入安装Eric的步骤@@''

==================================废弃=================================
1. ''安装Python''
&gt;直接按默认目录(C:\Python26\)安装，然后配置环境变量
2.''安装QT4''
&gt;到官网上下载Windows平台的GPL版本（170多M吧），它已经自带MINGW，安装目录可以自定义&lt;下得很慢，自己都保存好好了&gt;
&gt;将QT和MINGW的''bin''目录加到path路径中
&gt;增加下面两个环境变量，作用未知
&gt;&gt;QTDIR=E:\Qt\4.3.2（QT的安装目录）
&gt;&gt;QMAKESPEC=win32-g++
3.''将mingw-make复制为make.exe''
&gt;因为下面编译的时候要用到make，不用单独下make工具了，直接用MinGW的
4.''安装SIP''(以下进入SIP目录)
&gt;{{{python configure.py -p win32-g++}}}
&gt;{{{make}}}
&gt;{{{make install}}}
5.''安装QScintilla''（以下进入QScintilla目录）
&gt;{{{cd Qt4}}}
&gt;{{{qmake qscintilla.pro}}}
&gt;{{{make}}}
&gt;{{{make install}}}
&gt;{{{copy %QTDIR%\lib\qscintilla2.dll %QTDIR%\bin}}}
&gt;{{{cd ..}}}
&gt;{{{cd Python}}}
&gt;{{{python configure.py -n C:\Qt\4.4.2\include -o C:\Qt\4.4.2\lib}}}
以下几步没做(没成功)，但是后面还是能正常安装的
&gt;&lt;编辑makefile，将QT的目录换成真实目录&gt;
&gt;{{{make}}}
&gt;{{{make install}}}
6.''安装PyQt''
&gt;最好按''默认路径''直接安装到''Python的安装目录''中，第一次没这样做出现了问题
7.''安装eric''(以下进入eric目录)
&gt;{{{python install}}}
&gt;关于Eric的配置见''Ref3''，其中配置Auto-completion时，Python的api文件是在Python的安装目录中的api目录里

''首要参考''：[[Ref1|http://blog.chinaunix.net/u2/78219/showart_1211981.html]]
''次要参考''：[[Ref2|http://acestrong.spaces.live.com/blog/cns!A931637097BB476D!635.entry]]
''Another参考''：[[Ref3|http://beike.javaeye.com/blog/266007]]
==================================/废弃=================================</pre>
</div>
<div title="foobar显示歌词心得" modifier="YourName" created="200905220649" modified="201007240831" tags="software foobar" changecount="10">
<pre>去[[这里|http://www.foobar2000.com.cn/showtopic-1693.html]]随便下个美化版，我试下来比较喜欢''仿播放器经典界面Classic Emu''，下下来解压到某处，暂且根目录定为如下路径：
|D:\foobar2000
打开后发现他本身就有一个''lyric show''组件，其实还可以的，但是词库量还是不够大，所以追求完美的话要自己的歌词显示组件来替换它。
试下来，最好的还是''乐辞''，它的词库比较全。它的安装步骤见[[这篇文章|http://www.jiaocheng360.com/jiaocheng/19680.html]]，总体来说就是两步：
#下载并安装乐辞，很傻瓜的操作，都可以默认
#需要额外下载''Columns UI''组件，在它的官网上有，然后在configure中把它添加到合适位置
由于这个CUI（具体的CUI、PUI、DUI区别见[[这里|http://www.foobar2000.com.cn/showtopic-2765.html]]）组件相当得丑，所以为了能够在其他CUI中添加乐辞，找了n久解决方案。最后居然是在不经意间解决的：
乐辞的原理貌似是本机上装了软件，但是foobar通过它自己的CUI组件来调用乐辞软件的。所以不换CUI理论上根本没法弄。事实上也证明是这样的，在CUI中右击，看不到''面板-&gt;乐辞''的选项。
然后，自己又在网上找，找到一个叫''速配歌词的软件''，下载它的''[[独立版|http://www.newhua.com/soft/1450.htm#download]]''，然后安装即可，安装过程桌选择foobar的路径即可。它其实是一个外挂字幕，暂时没发现把它嵌到foobar的方法，所以不大方便。
神奇的是，这是我有突然可以再foobar的configure里的CUI中添加乐辞了，即右键选项中有''面板-&gt;乐辞''的选项。正常加载！
总体来说，三者之间的比较就是：
||!自带的lyric show|!乐辞|!速配歌词|
|优点|不用配置，内嵌|词库大，内嵌|词库大（貌似调用的是九天的词库）|
|缺点|词库''相对''较小|--需要配置，配置拼人品-- 已解决，详见最后更新|外挂，不方便|
现在已经把成功运行乐辞的foobar打包，将来可以直接用了~

''&lt;html&gt;&lt;font color=&quot;red&quot; size=&quot;5&quot;&gt;更新：&lt;/font&gt;&lt;/html&gt;''乐辞的那个问题已经解决，只要将一个名为foo_uie_lyricist.dll的文件放入components目录即可，至于之歌文件怎么来的，没发现，可能是装速配的时候有的吧。其他很多其他改版里面都包含了这个文件。

配置好的foobar贴图：
[img[这里应该是图片|file:///J:\pic\贴图\foobar.png]]</pre>
</div>
<div title="grep命令" modifier="wy" created="200904101540" tags="grep command" changecount="1">
<pre>''See:'' [[Geek Stuff|http://www.thegeekstuff.com/2009/03/15-practical-unix-grep-command-examples/]]
*Checking for full words, not for sub-strings using ''grep -w''
* Displaying lines before/after/around the match using ''grep -A, -B and -C''
*Searching in all files recursively using ''grep -r''
*Invert match using ''grep -v''
*display the lines which does not matches all the given pattern.
Syntax:
''grep -v -e &quot;pattern&quot; -e &quot;pattern&quot;''
&gt;$ cat test-file.txt
&gt;a
&gt;b
&gt;c
&gt;d
&gt;$ grep -v -e &quot;a&quot; -e &quot;b&quot; -e &quot;c&quot; test-file.txt
&gt;d
*Counting the number of matches using ''grep -c''
*Display only the file names which matches the given pattern using ''grep -l''
*Show only the matched string using ''grep -o''
*Show line number while displaying the output using ''grep -n''</pre>
</div>
<div title="iTouch指南" modifier="YourName" created="201010130407" modified="201012180624" changecount="44">
<pre>1. [[iTunes注册|http://bbs.weiphone.com/read-htm-tid-215824-page-1.html]]
2.备份shsh：
**[[请小白重视一下备份SHSH的重要|http://bbs.weiphone.com/read-htm-tid-1134647.html]]
**[[教你如何备份shsh(新增4.1备份工具) 越狱 解锁 恢复3.1.3固件等一系列详细教程|http://bbs.weiphone.com/read-htm-tid-912818.html]]
3.越狱
**三代机器，所有系统版本（除iOS 4.1 Beta版以外）：[[完美越狱JailbreakMe2.0降临|http://iphone.weiphone.com/news/2010-08-02/The_perfect_escape_JailbreakMe2.0_come_220871.shtml]]
**三代以上全系统，包括4.1：[[绿毒越狱|http://bbs.weiphone.com/read-htm-tid-1208735.html]]
&gt;&gt;此方法需要不断重试：[[我的绿毒越狱成功|http://bbs.weiphone.com/read-htm-tid-1208729.html]]
**比较老(但貌似也比较稳)的帖子（5月份）3.1.2, 3.1.3, or 3.2：[[全设备越狱时代到来，Spirit越狱工具发布|http://bbs.weiphone.com/read-htm-tid-772203.html]]
**4.0系统越狱：[[iPod Touch全系列4.0固件越狱详细教程|http://bbs.weiphone.com/read-htm-tid-858509.html]]
**4.1系统越狱
***[[itouch 4代亲测越狱成功（适合3代机子哦）|http://bbs.weiphone.com/read-htm-tid-1190125.html]]
&gt;&gt;&gt;此方法的注意事项：[[〖99.99成功〗关于32G及其他版本使用becoolm方法越狱没出现绿水滴的解决办法|http://bbs.weiphone.com/read-htm-tid-1204439-page-1.html]]
***[[【4.1完美越狱教程】绿雨图文安装教程 (完美支持41周前与后）|http://bbs.weiphone.com/read-htm-tid-1190530.html]]
&gt;&gt;&gt;[[分享我的touch 3代 32G越狱经验|http://bbs.weiphone.com/read-htm-tid-1192102.html]]
&gt;&gt;&gt;[[touch 3 32g limera1n beta4 成功越狱记录.doc|http://bbs.weiphone.com/read-htm-tid-1212478.html]]
**越狱心得：
***[[伪3和3代32G越狱|http://bbs.weiphone.com/read-htm-tid-1215338.html]]
***[[说说是用绿雨越狱后的感受吧|http://bbs.weiphone.com/read-htm-tid-1210471.html]]
4. [[iTunes教程|http://bbs.weiphone.com/read-htm-tid-1137415.html]]
5.系统配置
**[[不用91助手！itouch2完全图文教程 [ipa、传输文件、安装主题]（Winscp装主题）|http://bbs.weiphone.com/read.php?tid=306305]]
6.软件&amp;游戏资源
**[[音乐经营类游戏|http://iphonebbs.cnmo.com/thread-98947-1-1.html]]
**[[iPod Touch软件资源收集全集合(分类较好)|http://bbs.weiphone.com/read-htm-tid-550417.html]]
**[[超华丽！目前最好用的RSS软件 SmartRSS 2|http://bbs.weiphone.com/read-htm-tid-317452.html]]
**[[App分享+经验技巧+系统改造+源集+工具|http://bbs.weiphone.com/read-htm-tid-857917.html]]
**[[weGeeks自购自破合集索引|http://bbs.weiphone.com/read-htm-tid-659072.html]]
**[[touch3代精品免费软件大收集|http://bbs.weiphone.com/read-htm-tid-512106.html]]
**[[IT3超无敌实用又好用软件游戏集锦|http://bbs.weiphone.com/read-htm-tid-528653.html]]
**[[22款精品游戏+14款实用软件（5月29日更新）|http://bbs.weiphone.com/read-htm-tid-785526-page-1.html]]
**[[破解软件海量下载!全力打造最强IPA集合|http://bbs.weiphone.com/read.php?tid=221494]]
**[[ios 4.0越狱后一定要安装的软件和使用教程|http://bbs.weiphone.com/read-htm-tid-1031027.html]]
**[[豆瓣小组推荐|http://www.douban.com/group/topic/9180754/]]
**[豆瓣在线活动——APP分享|http://www.douban.com/online/10363700/album/24385700/]]
7.电子书资源
**[[我的IBOOKS里收藏的图书(EPUB)|http://bbs.weiphone.com/read-htm-tid-989223.html]]
**[[导入电子书（传输文件）|http://www.digidna.net/products/diskaid/download]]
**[[电子书、文档查看器|http://www.digidna.net/products/fileapp]]
8. 主题
**[[ipod-touch-themes|http://www.ipod-touch-themes.de]]
**[[91 theme|http://mobile.91.com/Theme/iPhone/35554.html]]
9.传输文件与文件操作
**''DiskAid''
&gt;&gt;附keygen的下载见[[这里|http://bbs.weiphone.com/read-htm-tid-579144-page-1.html]]，然后下载最新版本覆盖即可
{{{
相当好用的工具，可以传输电子书（直接定位StanZa的目录），软件的扩展文件(如字幕、歌词等等)
}}}
**''iFile''
&gt;&gt;直接在iTouch上访问文件系统，操作文件和目录
{{{
rou的Itouch的一些程序目录（/var/mobile/Applications/）：太鼓达人（289D392C....）LRC Player（C5CE3CAC....）
}}}

*Reference:
**[[【iTouch 版块精品资源大集合】(几乎包含下面资源的索引)|http://bbs.weiphone.com/read-htm-tid-477787.html]]
**[[『WEIP技术组』我的iPod Touch我做主~新手篇&amp;破解&amp;说明&amp;更新|http://bbs.weiphone.com/read-htm-tid-443797.html]]
***1楼：TOUCH的相关介绍 
***2楼：TOUCH的破解。 (包括固件升级教程)
***3楼：TOUCH的游戏和程序安装。 
***4楼：TOUCH的主题安装 
***5楼：TOUCH的相关高级说明 
***6楼：Touch固件大全
**[[苹果所有产品所有版本固件下载|http://bbs.weiphone.com/read-htm-tid-643300.html]]
**[[iPod Touch秘籍|http://bbs.weiphone.com/read-htm-tid-290195.html]]
**[[关于音乐.-.电影.-.破解后.-.Touch的使用集合帖子（音乐、电影格式转换）|http://bbs.weiphone.com/read-htm-tid-342904.html]]
**[[优酷视频专辑|http://u.youku.com/user_show/id_UMjQ1NTMyMDk2.html]]
**[[How do I transfer books from my computer to my iPhone or iPod Touch|http://www.lexcycle.com/faq/how_to_get_books_onto_stanza_iphone]]</pre>
</div>
<div title="java中的局部变量和成员变量" modifier="wy" created="200905130857" tags="局部变量 全局变量" changecount="1">
<pre>*成员变量：作为类的成员而存在，直接存在于类中。
*局部变量：作为方法或语句块的成员而存在，存在于方法的参数列表和方法定义中。

局部变量在使用前必须被程序员主动的初始化，和此形成对比，系统中的成员变量则会被系统提供一个默认的初始值。所以在语法上，类的成员变量能够定义后直接使用，而局部变量在定义后先要赋初值，然后才能使用。

所有类的成员变量可以通过this来引用。成员变量又分成俩中类型：实例变量和静态变量。静态变量在定义时要使用static关键字。</pre>
</div>
<div title="java类中静态域、块，非静态域、块，构造函数的初始化顺序" modifier="wy" created="200906161552" tags="java 初始化" changecount="1">
<pre>[[原文|http://fishermen.javaeye.com/blog/24025]]
在《Core java 2: volumn 1, Edition 5》一书的第四章“对象与类”中讲到域赋值语句、实例块、静态块及构造方法等在创建类实例时的执行顺序，中文译本有些处翻译的不贴切，而英文原书中也有一处错误。本文通过一个小程序来说明类实例构造过程中的语句执行顺序。

程序如下：

public class Teststaticblock
{
public Teststaticblock()
{
  this(&quot;second&quot;);
  System.out.println(&quot;begin constructor&quot;);
  System.out.println(s_a);
  System.out.println(s_b);
  System.out.println(c);
  System.out.println(d);
{{{//  this(&quot;second&quot;);//call to this must be first statement in constructor}}}
  s_a=1111;
  s_b=2222;
  c=3333;
  d=4444;
  System.out.println(s_a);
  System.out.println(s_b);
  System.out.println(c);
  System.out.println(d);
  System.out.println(&quot;end constructor&quot;);
}
public Teststaticblock(String s)
{
  System.out.println(&quot;begin second constructor&quot;);
  System.out.println(&quot;end second constructor&quot;);
}
public static void main(String args[])
{
  System.out.println(&quot;begin main&quot;);
  System.out.println(s_a);
  System.out.println(s_b);
{{{//  System.out.println(c);//non-static variable c cannot be referenced from a static context}}}
{{{//  System.out.println(d);//non-static variable c cannot be referenced from a static context}}}
  s_a=11111;
  s_b=22222;
{{{//  c=33333;//non-static variable c cannot be referenced from a static context}}}
{{{//  d=44444;//non-static variable c cannot be referenced from a static context}}}
  System.out.println(s_a);
  System.out.println(s_b);
{{{//  System.out.println(c);//non-static variable c cannot be referenced from a static context}}}
{{{//  System.out.println(d);//non-static variable c cannot be referenced from a static context}}}
  System.out.println(&quot;before new class object&quot;);
  Teststaticblock t = new Teststaticblock();
  System.out.println(&quot;end new class object&quot;);
  System.out.println(s_a);
  System.out.println(s_b);
{{{//  System.out.println(c);//non-static variable c cannot be referenced from a static context}}}
{{{//  System.out.println(d);//non-static variable c cannot be referenced from a static context}}}
  s_a=111111;
  s_b=222222;
{{{//  c=333333;//non-static variable c cannot be referenced from a static context}}}
{{{//  d=444444;//non-static variable c cannot be referenced from a static context}}}
  System.out.println(s_a);
  System.out.println(s_b);
{{{//  System.out.println(c);//non-static variable c cannot be referenced from a static context}}}
{{{//  System.out.println(d);//non-static variable c cannot be referenced from a static context}}}
  System.out.println(&quot;end main&quot;);
}

static int s_a=1;
int c=3;
{
  System.out.println(&quot;begin block&quot;);
  System.out.println(s_a);
  System.out.println(s_b);
  System.out.println(c);
{{{//  System.out.println(d);//illegal forward reference}}}
  s_a=111;
  s_b=222;
  c=333;
  d=444;
  System.out.println(s_a);
  System.out.println(s_b);
  System.out.println(c);
{{{//  System.out.println(d);//illegal forward reference}}}
  System.out.println(&quot;end block&quot;);
}
static
{
  System.out.println(&quot;begin static block&quot;);
  System.out.println(s_a);
{{{//  System.out.println(s_b);//illegal forward reference}}}
{{{//  System.out.println(c);//non-static variable c cannot be referenced from a static context}}}
{{{//  System.out.println(d);//non-static variable c cannot be referenced from a static context}}}
  s_a=11;
  s_b=22;
  System.out.println(s_a);
{{{//  System.out.println(s_b);//illegal forward reference}}}
{{{//  System.out.println(c);//non-static variable c cannot be referenced from a static context}}}
{{{//  System.out.println(d);//non-static variable c cannot be referenced from a static context}}}
  System.out.println(&quot;end static block&quot;);
}
int d=4;
static int s_b=2;

}


输出如下：

begin static block
1
11
end static block
begin main
11
2
11111
22222
before new class object
begin block
11111
22222
3
111
222
333
end block
begin second constructor
end second constructor
begin constructor
111
222
333
4
1111
2222
3333
4444
end constructor
end new class object
1111
2222
111111
222222
end main

通过对输出进行分析，可以得出如下结果：
1、在类第一次加载时候，会执行静态域(field)初始化语句和静态块（用static{}包含的部分）。
这里要注意：
    a、不管静态域声明语句的实际位置在哪儿，当第一次加载类的时候都会首先对它初始化为缺省值(0,false,null等）。
    b、即使静态域声明中使用了显式初始化语句（比如：int x=3)，第一次加载类的时候也会先把它初始化为缺省值（此时x为0），然后再按照下面说的要点c来执行赋值语句（x=3)。
    c、对于静态域的显式初始化语句和静态块，按照在类中代码出现的先后顺序执行。
     因此，在上面的例子程序中，我们看到
      static int s_a=1;
      static
      {
         s_a=11;
         s_b=22;
       }
       static int s_b=2;
      对s_a,s_b会有不同的效果。类加载时候，s_a,s_b都被初始化为0，然后由于依照代码顺序执行了s_a=1;s_a=11;s_b=22;s_b=2;结果s_a、s_b分别变成了11和2。

2、当构造类实例时候，会先对实例域初始化为缺省值，然后执行实例块（用{}括起来的部分），然后执行构造方法。其中：
    a、如同1中一样，如果有实例域的显式初始化语句，程序仍然是先将该域初始化为缺省值，然后按照代码在类中出现的先后顺序执行初始化语句或者实例块。如果实例块位置在初始化语句前面，即使它改变了该域的值，也会被随后执行的初始化语句改回去。
    b、在进入构造方法后，如果构造方法第一句是使用this(...)调用另一构造方法的话，则先执行另一构造方法，然后再执行本构造方法的方法体。这种用法必须让this(...)位于第一句。

《Core java 2》书中所说的&quot;进入构造方法后，如果第一句是调用别的构造方法，则进入别的构造方法。否则，执行实例块&quot;的提法有问题。事实是，不管是否使用 this()都会先执行实例块，再进入构造方法。另外，本程序需要在sdk1.4下编译，在sdk1.3下编译将不允许在静态块或实例块中改变位置在它们后面声明的域的值。</pre>
</div>
<div title="long和byte[]相互转换" modifier="wy" created="201010011013" modified="201010011018" changecount="9">
<pre>*使用移位操作（见org.apache.hadoop.io.MD5Hash类中的halfDigest方法）
&lt;code java&gt;
public long byteArrayToLong(byte[] digest){
			long value = 0;
		    for (int i = 0; i &lt; 8; i++)
		      value |= ((digest[i] &amp; 0xffL) &lt;&lt; (8*(7-i)));
		    return value;
}
public byte[] longToByteArray(long value){
			byte[] res = new byte[8];
			for(int i=0; i&lt;8; ++i){
				res[7-i] = (byte)(value&gt;&gt;&gt;i*8); 
            }
            return res;
}
&lt;/code&gt;
*使用ByteArrayInputStream、ByteArrayOutputStream、DataInputStream和DataOutputStream
见[[这里|http://www.coderanch.com/t/378647/java/java/convert-long-byte-array-back]]
&lt;code java&gt;
ByteArrayOutputStream bos = new ByteArrayOutputStream();
DataOutputStream dos = new DataOutputStream(bos);
dos.writeLong(10L);
dos.writeInt(-4);
// etc.
dos.flush();
byte[] data = bos.toByteArray();
&lt;/code&gt;</pre>
</div>
<div title="minix中函数原型定义的方法" modifier="teloon" created="200904220227" modified="200904220246" tags="prototype minix" changecount="7">
<pre>minix中函数原型定义是用如下代码形式进行声明（见kernel/main.c）：
&gt;FORWARD _PROTOTYPE( void announce, (void));
&gt;FORWARD _PROTOTYPE( void shutdown, (timer_t *tp));
其中FORWARD是minix定义的宏(include/minix/const.h)，暂不管
对于_PROTOTYPE这种C中没有的关键字，其实早该想到是宏，它的定义是在include/ansi.h中：
&gt;#ifdef _ANSI
&gt;/* Keep everything for ANSI prototypes. */
&gt;#define _PROTOTYPE(function, params) function params
&gt;#define _ARGS(params)    params
&gt;
&gt;#else
&gt;/* Throw away the parameters for K&amp;R prototypes. */
&gt;#define _PROTOTYPE(function, params) function()
&gt;#define _ARGS(params)    ()
可以看出，实际上 ''_PROTOTYPE( void announce, (void));'' 就相当于 '' void announce (void);''，放在文件头即相当于函数原型的声明。

在实际编程中，也可以参照此法，自己定义一个 _PROTOTYPE( function, params) function params这样的宏，以便函数原型的统一管理。

再看一个minix中更复杂的例子，但原理是一样的（/servers/pm/table.c）：
&gt;{{{_PROTOTYPE (int (*call_vec[NCALLS]), (void) ) = {}}}
&gt;{{{	no_sys,		/*  0 = unused	*/}}}
&gt;{{{	do_pm_exit,	/*  1 = exit	*/}}}
&gt;{{{	do_fork,	/*  2 = fork	*/}}}
&gt;{{{	no_sys,		/*  3 = read	*/}}}
&gt;{{{            ... ...}}}

其实这个就相当于：
&gt;{{{int (*call_vec[NCALLS]) (void)  = {}}}
&gt;{{{	no_sys,		/*  0 = unused	*/}}}
&gt;{{{	do_pm_exit,	/*  1 = exit	*/}}}
&gt;{{{	do_fork,	/*  2 = fork	*/}}}
&gt;{{{	no_sys,		/*  3 = read	*/}}}
&gt;{{{            ... ...}}}
关于(*call_vec[NCALLS]) (void)的理解，详见[[西邮wiki|http://www.xiyoulinux.cn/wiki/index.php?title=%E6%B7%B1%E5%85%A5C%E8%AF%AD%E8%A8%80#.E6.B7.B1.E5.85.A5.E7.90.86.E8.A7.A3C.2FC.2B.2B.E6.8C.87.E9.92.88]]
所以，这里声明的就是一个数组，数组里的东西是指向函数的指针，即指向no_sys,do_fork这些东西，所以这里的_PROTOTYPE()的作用就不是声明函数原型了，而就是用来声明一个指针数组。

''Reference: ''[[here|http://hi.baidu.com/shirdrn/blog/item/c3f6d3daca25c1ddb7fd4843.html]]</pre>
</div>
<div title="pascal三角（杨辉三角）" modifier="wy" created="200908250908" modified="200908250908" tags="Pascal" changecount="2">
<pre>只要记住一个公式就行了：
&gt;''nCr = (n-r+1/r) * nCr-1''
&gt;''nC0 = 1''
&gt;&gt;其中n是行数，0,1,2,3...；r是每行中的列数，0,1,2,3....
''简单来说''，每行中的数（除了第一个）是他前面那个数的''(n-r+1)''倍；

参考：Algorithm Gossip</pre>
</div>
<div title="python杂" modifier="YourName" created="200911031355" modified="201012111453" changecount="24">
<pre>参考：
&gt;1. [[Python Doc|file:///I:/STUDY/CODE/Python/python-2.6.2-docs-html/library/index.html]]
!!!正则表达式
1.{{{(?P&lt;name&gt;...)}}}语法，详见参考1；
2.{{{\w}}}和{{{\W}}}与''LOCAL''和''UNICODE'' flag有关，见参考1；
3.{{{re.search(r'(\d)+', '12345').group(1)}}}和{{{re.search(r'(\d+)', '12345').group(1)}}}的区别
&gt;前者子组1中的数据不断被替换，开始时'1'，然后'2'，最后是'5'（详见《Python核心编程P461》）
4. ''贪婪匹配''和''非贪婪匹配''（详见《Python核心编程P462》）
5. {{{re.findall}}}返回的是groups()的list，list中的每个元素师每个匹配的groups，详见参考1和以下测试：
&gt;{{{print re.findall(r'(\d)+', '12345a6789')}}}
6. group(),groups()
&gt;''group() == group(0)'', return the whole match
&gt;''group(N)'', return group N
&gt;''group(N1, N2, N3....)'', return a list of n groups (N1st, N2nd, N3rd....)
&gt;''groups()'', return a list of all groups
!!!other
1. raw_input省去''linesep''，readline()和readlines()保留''linesep''
2. ''拷贝''（deepcopy&amp;shallowcopy）
* shallowcopy发生的条件：
** take a ''complete'' slice(''[:]'')
** using a ''factory function''(''list()''''dict()'')
** using ''copy()'' function in copy module
*deepcopy发生的条件：copy.deepcopy()
*注意：
&gt;shallowcopy只对''mutable''的变量有效，而对于''immutable''的变量如''原子变量''（如string, int等），''tuple''等无效
&gt;详见《Core Python Programming 2ed》英文版 6.20章节
3.''python多线程''
*[[threading模块]] 原文在[[这里|http://blog.chinaunix.net/u3/93470/showart_2203387.html]]
*相关例子：[[Thread|http://linhs.blog.51cto.com/370259/126180]], [[Semaphore|]]
4.''python国际化''
5.''with_statement''
&gt;''with''语句的具体原理（流程）：[[Python的with关键字|http://www.phpfans.net/forum/viewthread.php?tid=98585]]
&gt;文件操作中的with：《The Python Library Reference》6.9小节
6.Iterator, generator, Iterable
*[[Iterators, Iterables, and Generators! Oh, my!|http://www.learningpython.com/2009/02/23/iterators-iterables-and-generators-oh-my/]]
*Python官方文档中：Iterator，Generator，Iterable
*[[The Python yield keyword explained|http://stackoverflow.com/questions/231767/the-python-yield-keyword-explained]]
*本地思维导图


参见''gettext''模块
单下划线（自动翻译成local指定的语言）：见[[Python中的单下划线'_'漫谈|http://blog.sina.com.cn/s/blog_54ce569c01009orr.html]]

一些''内建的函数''
&gt;range,type,str,dir,callable,getattr,lambda
其他''函数''和''变量''
&gt;random.randint(), sys.maxint, date.ctime(),string.lowercase, random.choice(), string.strip(), </pre>
</div>
<div title="struct中的字节对齐" modifier="wy" created="200906081237" modified="200906081314" tags="struct 对齐 内存占用" changecount="13">
<pre>基本规则：
{{{VC规定各成员变量存放的起始地址相对于结构的起始地址的偏移量必须为该变量的类型所占用的字节数的倍数。}}}''@@color(red):见第一例@@''
{{{同时VC为了确保结构的大小为结构的字节边界数（即该结构中占用最大空间的类型所占用的字节数）的倍数，所以在为最后一个成员变量申请空间后，还会根据需要自动填充空缺的字节。}}}''@@color(red):见第二例@@''
|!类型|!对齐方式（变量存放的起始地址相对于结构的起始地址的偏移量）|
|char|''偏移量''必须为sizeof(char)即1的倍数|
|short|''偏移量''必须为sizeof(short)即2的倍数|
|int|''偏移量''必须为sizeof(int)即4的倍数|
|float|''偏移量''必须为sizeof(float)即4的倍数|
|double|''偏移量''必须为sizeof(double)即8的倍数|
''一句话：''struct的对齐一般是保证下一个成员的偏移位置为该成员大小的整数倍。   
''具体例子1：''
 {{{    struct MyStruct   {     double dda1;    char dda;       int type;   };}}}
为上面的结构分配空间的时候，VC根据成员变量出现的顺序和对齐方式，依次分配。

''（1）''先为第一个成员dda1分配空间，其起始地址跟结构的起始地址相同，刚好偏移量0刚好为sizeof(double)的倍数，该成员变量占sizeof(double) =8个字节；
''（2）''接下来为第二个成员dda分配空间，这时下一个可以分配的地址对于结构的起始地址的''偏移量''为8，是sizeof(char)的倍数，所以把dda存放在偏移量为8的地方满足对齐方式，该成员变量占用sizeof(char)=1个字节；
''（3）''接下来为第三个成员type分配空间，这时下一个可以分配的地址对于结构的起始地址的''偏移量''为9，不是sizeof(int)=4的倍数，为了满足对齐方式对偏移量的约束问题，VC自动填充3个字节（这三个字节没有放什么东西），这时下一个可以分配的地址对于结构的起始地址的偏移量为12，刚好是=4的倍数，所以把type存放在偏移量为12的地方，该成员变量占用sizeof(int)=4个字节；、
''（4）''这时整个结构的成员变量已经都分配了空间，总的占用的空间大小为：8+1+3+4=16，刚好为结构的字节边界数（这个应该是和下面提到的''对齐系数''有关，用#pragma pack(n)指定）的倍数，所以没有空缺的字节需要填充。
''（5）''所以整个结构的大小为：sizeof(MyStruct)=8+1+3+4=16，其中有3个字节是VC自动填充的，没有放任何有意义的东西。

''具体例子2：''
{{{   struct MyStruct   {char dda;      double dda1;    int type;   };}}}

这个结构占用的空间为多大呢？在VC6.0环境下，可以得到sizeof(MyStruc)为24。结合上面提到的分配空间的一些原则，分析下VC怎么样为上面的结构分配空间的。（简单说明）
''struct MyStruct {char dda;''
/*偏移量为0，满足对齐方式，dda占用1个字节；*/
''double dda1;''
/*下一个可用的地址的偏移量为1，不是sizeof(double)=8的倍数，需要补足个字节才能使偏移量变为（满足对齐方式），因此VC自动填充7个字节，dda1存放在偏移量为8的地址上，它占用8个字节。*/
''int type；''
/*下一个可用的地址的偏移量为16，是sizeof(int)=4的倍数，满足int的对齐方式，所以不需要VC自动填充，type存放在偏移量为的地址上，它占用4个字节。*/
''};''
所有成员变量都分配了空间，空间总的大小为1+7+8+4=20，不是结构的''节边界数''（即结构中占用最大空间的类型所占用的字节数sizeof(double)=8）的倍数，所以需要填充4个字节，以满足结构的大小为sizeof(double)=8的倍数。所以该结构总的大小为：sizeof(MyStruc)为1+7+8+4+4=24。其中总的有7+4=11个字节是VC自动填充的，没有放任何有意义的东西。

同时，每个特定平台上的编译器都有自己的默认''对齐系数''(也叫对齐模数)。程序员可以通过预编译命令''#pragma pack(n)''，n=1,2,4,8,16来改变这一系数，其中的n就是你要指定的“对齐系数”。（[[来源|http://bbs.chinaunix.net/viewthread.php?tid=955085]]）

    VC中提供了''#pragma pack(n)''来设定变量以n字节对齐方式。n字节对齐就是说变量存放的起始地址的偏移量有两种情况：第一、如果n大于等于该变量所占用的字节数，那么偏移量必须满足默认的对齐方式，第二、如果n小于该变量的类型所占用的字节数，那么偏移量为n的倍数，不用满足默认的对齐方式。''结构的总大小也有个约束条件''，分下面两种情况：如果n大于所有成员变量类型所占用的字节数，那么结构的总大小必须为占用空间最大的变量占用的空间数的倍数；否则必须为n的倍数。下面举例说明其用法。
{{{  #pragma pack(push)    }}}/*保存对齐状态*/

{{{  #pragma pack(4)   }}}/*设定为4字节对齐*/

{{{  struct test{char m1;double m4;int m3;};   }}}

{{{  #pragma pack(pop)   }}}/*恢复对齐状态*/
    以上结构的大小为16，下面分析其存储情况，首先为m1分配空间，其''偏移量''为0，满足我们自己设定的对齐方式（4字节对齐），m1占用1个字节。接着开始为m4分配空间，这时其偏移量为1，需要补足3个字节，这样使''偏移量''满足为n=4的倍数（因为n小于sizeof(double)）,m4占用8个字节。接着为m3分配空间，这时其偏移量为12，满足为4的倍数，m3占用4个字节。这时已经为所有成员变量分配了空间，共分配了16个字节，满足为n的倍数。如果把上面的#pragma pack(4)改为#pragma pack(16)，那么我们可以得到结构的大小为24。（[[来源|http://blog.pfan.cn/xman/38666.html]]）

总之，对齐是为了加快CPU的运行速度。</pre>
</div>
<div title="threading模块" modifier="teloon" created="201004040500" modified="201004040501" changecount="4">
<pre>首先看一下threading模块中的对象：
&gt;   Thread：表示一个线程的执行的对象
&gt;   Lock：锁原语对象
&gt;   RLock：可重入锁对象。使单线程可以再次获得已经获得的锁
&gt;   Condition：条件变量对象能让一个线程停下来，等待其他线程满足了某个“条件”，如状态的改变或值的改变
&gt;   Event：通用的条件变量。多个线程可以等待某个事件发生，在事件发生后，所有的线程都被激活
&gt;   Semaphore：为等待锁的线程提供一个类似“等候室”的结构
&gt;   BoundedSemaphore ：与semaphore类似，只是它不允许超过初始值
&gt;   Timer：与Thread类似，只是，它要等待一段时间后才开始运行


其中Thread类是主要的运行对象，它有很多函数，常用的为以下三种。
&gt;   创建一个Thread的实例，传给它一个函数
&gt;   创建一个Thread实例，传给它一个可调用的类对象
&gt;   从Thread派生出一个子类，创建一个这个子类的实例


Thread类的函数有：
&gt;     | getName(self) 返回线程的名字
&gt;     | isAlive(self) 布尔标志，表示这个线程是否还在运行中
&gt;     | isDaemon(self) 返回线程的daemon标志
&gt;     | join(self, timeout=None) 程序挂起，直到线程结束，如果给出timeout，则最多阻塞timeout秒
&gt;     | run(self) 定义线程的功能函数
&gt;     | setDaemon(self, daemonic) 把线程的daemon标志设为daemonic
&gt;     | setName(self, name) 设置线程的名字
&gt;     | start(self) 开始线程执行</pre>
</div>
<div title="ubuntu上对apt/bash加上代理（proxy）" modifier="wy" created="201304080909" modified="201304080910" changecount="2">
<pre>如果机器无法直接访问外网，比如在学校，需要添加代理。

网上有很多解决方案，却都没完全解决问题：
*在~/.bashrc中添加：
&gt;https_proxy=http://[username:password@]www.proxy.com:port/
&gt;http_proxy=http://[username:password@]www.proxy.com:port/
*在/etc/apt/apt.conf中添加：
&gt;Acquire::http::Proxy &quot;http://[username:password@]www.proxy.com:port/&quot;;
&gt;Acquire::http::Proxy &quot;http://[username:password@]www.proxy.com:port/&quot;;

主要的问题是在进行apt-get或add-apt-repository都是需要sudo的，而sudo看的是root用户的环境变量，所以不看~/.bashrc中环境变量；同时，至少在10.04版本，/etc/sudoers文件中有一行”Defaults env_reset“，它会让sudoer忽略当前用户的环境变量，这其实是该版本的一个[[bug|https://bugs.launchpad.net/ubuntu/+source/software-properties/+bug/516032]]
正确的做法是：
*首先，如上在~/.bashrc中添加https_proxy和http_proxy；
*其次，参考该[[帖子|http://askubuntu.com/questions/53146/how-do-i-get-add-apt-repository-to-work-through-a-proxy]]，对所有sudo命令加上''-E''参数，告诉sudo忽略''Defaults env_reset''（参考sudo的man），考虑当前的环境变量，如：
&gt;sudo -E apt-add-repository ppa:linaro-maintainers/toolchain
&gt;sudo -E apt-get update
*然而，如果通过apt-add-repository加了一个新的源，在‘’apt-get update‘’后会出现类似“''{{{GPG error...NO_PUBKEY E635A714505A2DD1}}}''“的错误，参考这个[[帖子|http://stream-recorder.com/forum/w-gpg-error-http-ppa-launchpad-net-t6741.html?s=21750c4fa5bba92d940e8f00325b9ed7&amp;amp;]]，运行如下命令(505A2DD1是出错信息中key的最后8位)：
&gt;gpg {{{--}}}keyserver keyserver.ubuntu.com {{{--}}}recv 505A2DD1
&gt;gpg {{{--}}}export {{{--}}}armor 505A2DD1 | sudo apt-key add -</pre>
</div>
<div title="unassorted" modifier="wy" created="200907080920" changecount="1">
<pre>shingling with a ﬁxed length sliding window avoids the alignment problem between two documents with minor diﬀerences
变长Chunk方法能够增加系统招回率</pre>
</div>
<div title="url转义字符" modifier="teloon" created="200902241421" modified="200902241432" tags="url 转义" changecount="11">
<pre>!url转义字符原理

如果表单的action为list.jsf?act=go&amp;state=5

则提交时通过request.getParameter可以分别取得act和state的值。

如果你的本意是act='go&amp;state=5'这个字符串，那么为了在服务端拿到act的准确值，你必须对&amp;进行转义

[''预备知识'']
 
        对与通过get方式提交的url，浏览器在提交前首先根据http协议把一一个的参数及其值解析配对。而url的参数间是通过&amp;分割的，这就是浏览器进行参数配置的分割依据。如果你的参数值中含有&amp;等url特殊字符，那么你在服务器端就会拿到意想不到的值。所以必须对url的特殊字符进行转义。
编码的格式为：%加字符的ASCII码，即一个百分号%，后面跟对应字符的ASCII（16进制）码值。例如 空格的编码值是&quot;%20&quot;。
下表中列出了一些URL特殊符号及编码
　

[''十六进制值'']
&gt;1. ''+''  URL 中+号表示空格 ''%2B''
&gt;2. ''空格'' URL中的空格可以用+号或者编码 ''%20''
&gt;3. ''/''  分隔目录和子目录 ''%2F'' 
&gt;4. ''?''  分隔实际的 URL 和参数 ''%3F'' 
&gt;5. ''%'' 指定特殊字符 ''%25'' 
&gt;6. ''#'' 表示书签 ''%23'' 
&gt;7. ''&amp;'' URL 中指定的参数间的分隔符 ''%26'' 
&gt;8. ''='' URL 中指定参数的值 ''%3D''
所以上述的action你应该写成list.jsf?act=go%26state=5
''附：''
|!字符|!URL编码值|
|空格|%20|
|&quot;|%22|
|#|%23|
|%|%25|
|&amp;|%26|
|(|%28|
|)|%29|
|+|%2B|
|,|%2C|
|/|%2F|
|:|%3A|
|;|%3B|
|&lt;|%3C|
|=|%3D|
|{{{&gt;}}}|%3E|
|?|%3F|
|@|%4o|
|\|%5C|
|{{{|}}}|%7C|</pre>
</div>
<div title="vector中的resize和reserve" modifier="YourName" created="200908040542" tags="resize reserve" changecount="1">
<pre>!!!resize
它改变的是有效数据的多少，即改变了size()返回的值：
&gt;如果原来有元素：''{5,2}''，则它的size为2； 经过resize(5)，它的元素将变为：''{5,2,0,0,0}''，而size变成了5，说明把后面的三个0都当作有效数据了
&gt;所以，''resize''既改变了capacity，又改变了size；

!!!reserve
它改变的只是vertor的''capacity''，即容量，而不改变它的有效数据，即''不改变size''</pre>
</div>
<div title="vim命令" modifier="teloon" created="201005101627" modified="201005201358" changecount="4">
<pre>*VIM 折叠和展开
&gt;''V''，选中若干行，按''zF''折叠。
*VIM 分割窗口
&gt;{{{:split &lt;filename&gt;}}}
&gt;&gt;按拆分模式打开文件，默认为上下拆分
&gt;{{{:vsplit &lt;filename&gt;}}}
&gt;&gt;左右拆分
&gt;{{{Ctrl-w w}}}
&gt;&gt;切换活动窗口
&gt;{{{Ctrl-w Ctrl-w}}}
&gt;&gt;同上
&gt;{{{Ctrl-w h/j/k/l}}}
&gt;&gt;切换活动窗口为 左/上/下/右 边的窗口</pre>
</div>
<div title="vim配置" modifier="YourName" created="200911111735" modified="201012110750" changecount="11">
<pre>!!!目标：美观，高效
基本上参照这篇文章[[面向前端开发者和TextMate粉丝的vim配置|http://www.limboy.com/2009/05/30/vim-setting/#more-230]]
其中，''我的资源都在QQ邮箱的&quot;网盘－linux&quot;tag中''；下面的我不同于此教程之处：
*''主题''
&gt;我使用的是''crt''或者''thestars''（与他的''yytextmate''基本相似）
*语法着色
&gt;如果是正常安装VIM的，那么在''/usr/share/vim/vim71/syntax''目录下会有超多的配色文件，基本上全了；
&gt;如果没有，可尝试完全安装：''sudo apt-get install vim-full''
&gt;如果对现有的着色文件不满意，可替换（如那篇文章中说的html和javascript），可从[[这个网站|http://www.fleiner.com/vim/download.html]]下
*''插件''
&gt;插件管理
&gt;&gt;默认插件文件分散在跟个目录，卸载麻烦
&gt;&gt;按照[[How I boosted my Vim|http://nvie.com/posts/how-i-boosted-my-vim/]]所介绍的pathogen插件可解决这个问题
&gt;缩进
&gt;&gt;按照文章上说的设置
&gt;bash support
&gt;&gt;我的资源中已配置好
&gt;snippet
&gt;&gt;暂时没有很强烈的需求，暂不配置
&gt;自动补全
&gt;&gt;参见[[这篇文章|http://hi.baidu.com/xydream/blog/item/fefaad38142055cbd462252a.html]]
&gt;&gt;默认可以用Ctrl+P或Ctrl+N来自动补全，但不能''实时过滤''，参见上面文章解决方案：
&gt;&gt;1、安装[[SuperTab|http://www.vim.org/scripts/script.php?script_id=1643]]插件
&gt;&gt;2、下载[[AutoComplPop|http://www.vim.org/scripts/script.php?script_id=1879]]插件(注意：它只支持7.0版本的VIM；测试下来它不装也无大碍)，然后根据[[这篇文章|http://hi.baidu.com/walkandsing/blog/item/e2a3e20362577e8ad43f7c17.html]]下载并配置各语言的自动补全，上面提到的几种语言的complete文件在[[这里|http://mikael.jansson.be/hacking/limp/browser/vim-ecl/7.2/runtime/autoload?rev=367]]都有下；
&gt;&gt;这样需求就都满足了：@@color(blue):''自动弹出''、''实时过滤''、''基本的API帮定''@@
&gt;文件项目管理
&gt;&gt;目录树：照那片文章下载，然后[[这里|http://blog.chinaunix.net/u2/72494/showart_1915745.html]]是用法
&gt;&gt;Buffer Explorer：打开多个文件是比较有用，见[[这里|http://hi.baidu.com/geniusfox/blog/item/57df1912b3934556f919b85d.html]]介绍

!!!一些配置
''set list''
&gt;显示文件中的非打印字符，如换行符等等
''set fileformats=unix, dos, mac''
&gt;选择文件的格式，根据文件的一些特征vim会自动选择（如结尾是不是^M(&lt;Ctrl+V&gt;,&lt;Ctrl+M&gt;)）；如果文件格式选择的是dos，这时即使行末尾是^M，使用''set list''命令也不会显示出^M来，需要转换成unix格式的；</pre>
</div>
<div title="wine指南" modifier="wy" created="200903270420" modified="200903270426" tags="wine software linux" changecount="4">
<pre>wine 完全使用指南
from Linux开源系统 by jackcfan

wine-logo一直苦于没有一篇像样的使用指南，原来外国有朋友跟我有同感，既然他捷足先登了，那我只好翻译了。原文作者说会保持更新，这篇文章是很新的，介绍了很多实用的Wine设置方法，非常全面，无论新手还是老鸟都值得一读。

我收集到的关于Wine的一些资料

如果你像我一样的话，当你第一次使用Wine的时候，就会被Wine的帮助文章现状所困扰。互联网上确实有很多的HOWTO文章来教你使用一些程序或游戏，但是我找不到一个全面的“Wine初学者教程”来让我真正懂得实际了解和使用Wine所需的基本知识。我不需要一个教我如何运行半条命2的文章，我需要的是一篇能实实在在教我怎样使用Wine的文章。最后，我整理了从众多的Wiki、指南、帖子和HOWTO搜集来的资料，写成这篇文章。虽然这篇文章主要针对在Wine下运行游戏，但是它包括的几乎所有的信息都可以应用到用Wine来运行其它的程序。

!!1.一般资料

!!!1.1Wine is not an emulator

这个我就不翻译了，没有多少技术介绍。

!!!1.2使用最新的Wine

记住最新版的Wine会包含一些旧版本里没有的bug。在feisty的软件仓库里包含了0.9.33，而最新的Wine是0.9.44（我翻译文章时）。0.9.33更加稳定，但是最新的版本包含重大的DirectX改进。有一些不能在0.9.33下运行的游戏能够在0.9.44中很好地运行。在使用0.9.37到0.9.40之间的某些版本运行KotOR2时，声音在我的系统上崩溃了。那是最好的有关使用最新版导致棘手问题的好例子。

（译者：我个人还是推荐使用最新版，使用新版本会有更好的运行速度，而且基本上每个bug都会在未来的2~3个版本中被修复）

!!!1.3不要从源码编译安装Wine

（译者：作者没有说为什么，可能是因为编译要解决的依赖性问题太多了。

我个人还是推荐编译安装，这样安装完后问题少一点，性能好一点。）

!!!1.4使用终端

如果正确安装的话，wine会把它自己关联到exe文件，所以你只要双击exe文件就可以运行。无论怎样，这都不是我们所推荐的使用wine的方法（译者：我也不推荐）。使用终端会比较好，因为这样可以正确地设定程序的路径，否则程序就会找不到所需要的文件。另外，使用终端还可以显示出错误信息，这对于解决问题是非常有用的。

!!!1.5准备对付挫折

Wine并不完美。不会所有的事情都能顺利发展，有时候甚至需要你自己去解决问题。但你现在是一个linux用户了，你就要准备着去应付。

!!2.“winecfg”的使用资料

!!!2.1运行“winecfg”

你至少需要运行一次winecfg来设置wine的目录和硬件。

!!!2.2虚拟桌面

使用这个选项可以使软件的安装更加流畅。我发现在不使用这个选项的时候，使用某些程序会导致已经激活的对话框、CDKEY输入窗口或更换光盘的确认窗口不能出现在前端。让我以为程序卡死了，就kill掉了进程。选择这个选项还能够避免程序锁死你的桌面或者把你的屏幕分辨率改成难看的模式。

!!!2.3使用Application Settings

你可以在winecfg的Application标签里的Application Settings对话框对个别的程序进行自定义设置。那里只允许你进行windows兼容运行模式设置（译者：像windows下的exe属性里的兼容性标签）、某些显示设置和DLL的设置。

当你只需要设置某个程序使用某些特定的windows自带的DLL，不希望其它程序（包括wine）使用这些native的DLL的时候（而其它程序使用这些DLL会导致问题），（译者：wine自带的DLL叫做builtin，windows下原生的DLL叫做native）这个选项就会变得十分有用。在进行DLL设置时我都用这个方法，就是为了防止某些对wine的运行存在潜在威胁的nativeDLL被wine调用（译者：在一般情况下， wine只调用自带的builtinDLL，而不会使用native的DLL，版权问题，除非经过设置，如上所述）。这样我就只是修改了那些可执行的配置文件，当我不需要时，可以改回来而不会损坏整个Wine。（译者：设置这些东西之前，保证已经将一个程序的exe文件添加到Application标签的白框中，并且反色选中。不是default的那个，是你所需要设置的那个exe文件。）

!!!2.4Windows版本

对不同的程序尝试不同的Windows版本。这就是说一个为了XP而设计的游戏可能会在wine的98模式的支持下能更好地运行。在做这个之前确认你已经把程序添加到Application的白框中，并且选中，反色显示。

!!!2.5使用ALSA驱动

有些游戏是需要OSS才能运行，但是OSS已经不会再继续开发了。

（译者：推荐只是独立声卡使用ALSA，集成的还是使用OSS最好）

!!!2.6不要总是选择allow the window manager to control the windows（winecfg里的）

使用这个选项有时候会使游戏在全屏幕运行时出现问题。当前的wine版本0.9.39+已经修正了多数游戏的全屏问题，但是引入了一个新的问题：当不使用这个选项时，会使键盘不能游戏中输入。在使用一个单独的X server来运行游戏时，这个问题可以得到解决。（见“高级设置资料”）

!!!2.7谨慎对待DLL

winecfg可以让你用native的DLL替换builtin的DLL。下面的这些DLL是绝对不能被替换的。kernel32.dll， gdi32.dll，user32.dll，和ntdll.dll。有些nativeDLL也可能使一些程序不能运行。记得永远不要覆盖wine自带的 dll，如果native的用不了就用builtin的换回来。有些MS的DLL要得到许可才能用，如果你没有许可，就不要用。

!!3.特殊配置资料

!!!3.1建立一个到CD的链接

Wine会建立一个到你挂载CD的文件夹的链接，但是建立一个到真正的/dev里的设备的链接会更好。我发现如果不这样做，Wine会自己建立到 /dev的链接，把CD认成E：盘，而我的挂载目录却链接为D：盘。我认为这个可能会导致某些使用CD安装的程序出现问题。修改/dev/hdc以适应你的系统（译者：7.04一般都是/dev/scd0）。

ln -s /dev/hdc ~/.wine/dosdevices/d\:\:

!!!3.2实用注册表键值

有些设置是不能通过winecfg来进行设置的，但是可以在注册表中进行设置。在wine的wiki中有一篇保持更新的文章

http://wiki.winehq.org/UsefulRegistryKeys

有两个键值是非常有用的，一个是Alsa Driver的UseDirectHW，可以解决一些声音跳顿的问题；还有Direct3D的VideoMemorySize，你应该设置成你的显卡的准确显存，默认wine会设置成64MB。

!!!3.3WINEPREFIXCREATE

这个我暂时不翻译

!!!3.4安装Wine Gecko IE engine

有些程序的运行依赖于IE，但是，安装IE会严重地破环Wine。所以可以安装Wine Gecko IE engine作为替代品。

a、在终端下运行下面的命令：

&gt;''wine iexplore http://www.winehq.org''

b、当出现安装提示时回答yes

c、打开http://wiki.winehq.org/UsefulRegistryKeys，找到HKEY_LOCAL_MACHINE板块

d、把所有有关Internet Explorer的键值加到注册表中

安装完成后，运行

&gt;''wine iexplore http://www.winehq.org''

成功的话就会出现winehq的主页。

!!!3.5中文支持设置

把下面的代码保存为zh.reg，然后终端执行regedit zh.reg。从Windows目录下的Fonts里的simsun.ttc复制到/home/user/.wine/drive_c/windows/fonts里面。

REGEDIT4
[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\FontSubstitutes]
“Arial”=”simsun”
“Arial CE,238″=”simsun”
“Arial CYR,204″=”simsun”
“Arial Greek,161″=”simsun”
“Arial TUR,162″=”simsun”
“Courier New”=”simsun”
“Courier New CE,238″=”simsun”
“Courier New CYR,204″=”simsun”
“Courier New Greek,161″=”simsun”
“Courier New TUR,162″=”simsun”
“FixedSys”=”simsun”
“Helv”=”simsun”
“Helvetica”=”simsun”
“MS Sans Serif”=”simsun”
“MS Shell Dlg”=”simsun”
“MS Shell Dlg 2″=”simsun”
“System”=”simsun”
“Tahoma”=”simsun”
“Times”=”simsun”
“Times New Roman CE,238″=”simsun”
“Times New Roman CYR,204″=”simsun”
“Times New Roman Greek,161″=”simsun”
“Times New Roman TUR,162″=”simsun”
“Tms Rmn”=”simsun”

!!4.安装资料

!!!4.1不要在CD的目录下安装程序

（译者：就是不要cd到CD的挂载目录运行安装程序）

如果这样做的话，就会在换CD时出现CD不能推出的问题，用下面的命令来安装CD：

wine /media/cdrom0/setup.exe

!!!4.2需要用到“wine eject”

如果安装程序需要你换CD，而系统却说不能推出CD，那就打开一个新终端，输入：

wine eject d：

!!!4.3安装InstallShield的bug补丁

安装http://support.installshield.com …… 2/IkernelUpdate.exe

这个补丁可以解决一些CD安装问题。

!!!4.4使用uninstaller

使用命令“uninstaller”来卸载安装的程序，不要使用程序在菜单里面创建的卸载快捷方式，他们有时候不能正常工作，而uninstaller可以。

!!!4.5安装.msi文件

有些windows的安装程序是使用msi来安装的，那就用下面的命令来安装：

&gt;''wine msiexec /i install.msi''

或者

&gt;''wine start install.msi''

!!!4.6不要安装DirectX

Wine有它自己的DirectX库，安装微软的DirectX会破坏wine的DirectX库和Wine。

但是，d3dx9_##.dll和d3dx10_33.dll可以从Windows复制过来使用，可能会在启动某些游戏时有所帮助。使用这些dll你需要微软的授权证书。

!!5.一般使用资料

!!!5.1如何用wine来运行程序

wine application.exe

!!!5.2运行程序前cd到程序的安装目录

cd到程序的安装目录再运行程序。

!!!5.3关掉WINEDEBUG

一般情况下，wine会不断地产生一些debug信息（那些“fixme”的东西）。那些信息在很多情况下是没有用的，尤其你已经可以正常地运行一个程序。你可以使用下面的命令来避免debug信息，节省资源：

&gt;''WINEDEBUG=-all game.exe''

!!!5.4不要使用root或者sudo来运行wine

可能会损坏系统文件。

!!!5.5其他wine的命令

wineboot 模拟windows的重新启动

wine control 运行控制面板

wineserver wineserver会随着wine的命令自动启动，但也能通过终端启动来达到不同的目的。

wineserver的一些参数

a、-d# 设置终端中debug的显示级别。

b、-h 显示wineserver帮助文件

c、-k kill掉当前的wineserver，当程序失去响应而你要结束它时使用。

d、-p 让wineserver一直运行，也就是说即使程序退出了，wineserver还继续运行。当你需要运行连续的程序时可以使用，这样可以缩短程序的启动时间。

e、-w 让wineserver一直运行直到当前已激活的wineserver退出。

!!!5.6让Wine运行更流畅

当出现程序运行缓慢或性能起伏不定的问题时，可以通过提高进程的优先级来解决。启动游戏后，可以使用“renice”命令来改变进程的优先级。 “renice”命令可以改变当前进程的优先级，“nice”的值是优先级级别的标志，（高优先级=低nice值，低优先级=高nice值）。这个命令把程序优先级的值设置为从-20（最高优先级）到19（最低优先级）之间的任何一个整数值，而默认的值是0。在启动游戏以后，你需要打开另外一个终端输入下面的命令来改变程序的优先级：

&gt;''sudo renice -10 -n game.exe''

在用Wine运行游戏时，我不推荐直接把程序的优先级设置到-20，最好是从-10开始，如果效果提升不明显，可以一步步尝试小幅度的提高（- 11，-12，……）。你会发现绝大多数的游戏不需要比-10更高的优先级就已经可以达到最好的性能了。不用多说（我认为），在游戏中你可以用ALT- TAB组合键回到桌面使用“renice”命令。

第二种方法

使用图形界面来设置优先级。

1、 用终端运行游戏，按ALT-TAB回到桌面

2、 系统——&gt;系统管理——&gt;系统监视程序，切换到进程标签

3、 在进程上点右键——更改优先权

4、 要求密码时输入

5、 关闭系统监视程序，用ALT-TAB回到游戏

#!/bin/sh
#uncomment if launching from console session
#sudo /etc/init.d/gdm stop
#KDE use this instead
#sudo /etc/init.d/kdm stop
# Launches a new X session on display 3. If you don’t have an Nvidia card
# take out the “&amp; nvidia-settings –load-config-only” part
X :3 -ac &amp; nvidia-settings –load-config-only
# Goto game dir (modify as needed)
cd “$HOME/.wine/drive_c/Program Files/Game/Directory/”
# Forces the system to have a break for 2 seconds, X doesn’t launch instantly
sleep 2
# Launches game (modify as needed)
DISPLAY=:3 WINEDEBUG=-all wine “C:/Program Files/Game/Directory/game.exe”

!!6.第三方软件资料

!!!6.1 WineTools

WineTools是一个菜单式的可以安装90多个常见Windows程序的软件。它也可以帮助你设置Wine的基本目录。已经不再有人维护 WineTools，它已经两年没有升级了，但很多用户都发现它依然有用。而WineTools所作的一切事情都可以自己通过winecfg或终端完成。

!!!6.2Wine-Doors

Wine-Doors是一个帮助你安装很多的Windows程序，包括游戏的一个图形界面的软件。它现在还处在开发阶段，但已经发布了一个可以下载的最初版本。就这个软件看来，是非常有前途的。

!!!6.3Cedega

Cedega就技术上来说是Wine的一个分支，它明确地针对于游戏。cedega包含了一个安装和运行游戏的图形界面，还加上了对受防拷贝保护的软件的支持（不需要使用破解来免CD）（译者：wine的对防拷贝的支持不是很好）。cedega不适免费的，最低消费是购买3个月，每月3美元，如果预付一年的费用的话，可以享受一点折扣。cedega从前叫做WineX，在Wine还是MIT软件，而不是现在的GPL的时候，WineX就从wine的一个分支分离出来，就因为cedega不属于GPL，cedega不再对wine的代码发展作贡献了。再加上cedega缺少支持，很多人便不再用 cedega 在linux下玩游戏。

!!!6.4CrossOver

CrossOver从技术上来说，CrossOver不是wine的一个第三方产品，而是wine的主要财力支持者。CrossOver一开始是以在linux下运行Microsoft Office软件为目标的，但最近它开始添加对游戏的支持。CrossOver基于一个更老，更稳定的Wine版本（译者：好像是0.9.17），但 CrossOver也随着Wine一起升级。CrossOver标准版的售价是39.95美元。

!!!6.5ReactOS

正如CrossOver一样，ReactOS也是Wine的一个支持者，基于许多Wine已经完成的成果，它致力于建立一个能与Windows完全兼容的操作系统。完成后，ReactOS能够使用Windows的驱动程序和软件，完全兼容。这项计划还处于开发阶段，但已经可以提供安装CD、 LiveCD、QEMU和VMware镜像的下载。

!!7.高级设置资料

!!!7.1使用启动脚本（使用之前确保游戏能够正常运行）

再使用单独得X server时，很多游戏一般都可以发挥出他们最佳性能。wine不需要窗口管理器（GNOME或KDE）就可以正常地运行，所以如果你在一个单独的X server下运行游戏，你会得到明显的性能提升。在运行游戏之前，关闭GDM或KDM，还会得到更大的性能提升（只能通过控制（console）台来实现）。

a、首先，在终端下建立一个脚本

&gt;''nano launcher.sh（可以用vim替换nano）''

b、复制下面的文字到终端里。如果你没有nVidia的显卡，就删除nvidia settings的那部分，然后用你的游戏的正确路径替换里面的路径

#!/bin/sh
#uncomment if launching from console session
#sudo /etc/init.d/gdm stop
#KDE use this instead
#sudo /etc/init.d/kdm stop
# Launches a new X session on display 3. If you don’t have an Nvidia card
# take out the “&amp; nvidia-settings –load-config-only” part
X :3 -ac &amp; nvidia-settings –load-config-only
# Goto game dir (modify as needed)
cd “$HOME/.wine/drive_c/Program Files/Game/Directory/”
# Forces the system to have a break for 2 seconds, X doesn’t launch instantly
sleep 2
# Launches game (modify as needed)
DISPLAY=:3 WINEDEBUG=-all wine “C:/Program Files/Game/Directory/game.exe”

c、把文件保存到你的主文件夹（保存Ctrl+O，退出Ctrl+X。Vim的话先Esc，再Shift+：，保存w，退出q）

d、然后，给你的脚本加上可执行属性

&gt;''chmod +x ~/launcher.sh''

e、运行脚本

&gt;''sh launcher.sh''

或

&gt;''./launcher.sh''

f.结束游戏后，用CTRL-ALT-BACKSPACE回到桌面

第二种方法

如果你的游戏不能运行或者只是单纯想压榨出更好的游戏性能，跟着下面的步骤尝试在关闭X session的情况下运行游戏。

a、取消注销“sudo /etc/init.d/gdm stop”语句（删除#）后保存，如果你是使用KDE，就取消注销“sudo /etc/init.d/kdm stop”。

b、关闭所有程序，按CTRL-ALT-F1打开控制台

c、在控制台登陆并运行这个脚本。你会被要求输入密码，然后游戏会在它自己的X session里运行，而没有GDM或KDM的妨碍。

d、如果脚本显示你没有启动X session的权限，就修改那个脚本

按照这样修改X server的启动语句

&gt;''sudo X :3 -ac &amp; nvidia-settings ——load-config-only''

注意：为了避免修改脚本，你可以修改Xwrapper.config给与一般用户启动X的权限。用sudo vim打开/etc/X11/Xwrapper.config，把allowed_users=console修改为allowed_users=anybody。

e、结束游戏后，可以重启或CTRL-ALT-BACKSPACE回到控制台，重新启动X和桌面：

&gt;''sudo /etc/init.d/gdm start''

如果是KDE

&gt;''sudo /etc/init.d/kdm start''

桌面会很快出现，还不行的话就输入

&gt;''startx''

注意：

a、如果让游戏使用它自己的X session，确认禁止winecfg里的virtual desktop。

b、让游戏使用它自己的X session可以解决在游戏时键盘无法输入的问题。</pre>
</div>
<div title="《C++ Primer》笔记" modifier="wy" created="201012010621" modified="201012020951" changecount="10">
<pre>P19：C++源文件后缀
P21：取得main返回值（Linux &amp; Window）
P40：C++头文件后缀
P55~P56：各种算术类型的存储空间
*最小存储空间
*一般的存储空间
P58：char有三种，但只有两种表示类型，由编译器决定
*plain char
*unsigned char
*signed char
P59：浮点数有效位数
P60：除用标准库中的类型外，使用unsigned类型比较安全，防止负数越界
P60：char类型是signed还是unsigned''貌似''由编译器决定
P61：八进制以''0''开头
P62：定义unsigned类型，数值后加u或U
P62：科学计数法，指数加E或e
P63：宽字符wchar_t，字符字面值前加L
P63：非打印字符表示：\ooo或\xddd
P64：为兼容C，C++编译器自动在''字符串''末尾添加空字符（''\0''）
P65：字符串''字面值''可以用空白（空格、tab或换行）连接，但''不用类型''的字符串字面值连接的行为是未定义的，由编译器决定
P72：变量命名：标识符不能包含''两个连续的下划线''，也不能''下划线开头后紧跟一个大写字母''
P74：两种初始化方法，初始化与赋值的区别（P75有多个初始化式时不能使用复制初始化）
P77：内置变量类型的初始化
P79：声明和定义之间的区别（形式、影响、作用）
P82：作用域的嵌套（同变量名覆盖）
P83：把一个对象定义在它首次使用的地方是一个很好的办法
P86：非 const 变量默认为 extern。const 变量默认为文件的局部变量，要使它能够在其他的文件中访问，必须地指定它为 extern。
P90：非const引用只能绑定到与该引用同类型的对象
P91：typedef的目的
P92：类定义后面要加''分号''
P96：''class''和''struct''的区别
P98：编译大的头文件需要耗费很多时间，所以有''预编译''出现
P99：编译和链接多个源文件的方法
P100：头文件不应该包含变量或函数的定义，会造成多重定义问题。三个例外
#类（class）
#const对象
#inline函数</pre>
</div>
<div title="《C++大学教程》笔记" modifier="wy" created="200907110129" modified="200908220313" tags="CPP" changecount="23">
<pre>!!!关键字
P51: ''static_cast''&lt;//float//&gt;( value )
&gt;Ref:[[here|http://www.cplusplus.com/doc/tutorial/typecasting/]]
P51: ''setprecision(intValue)'' {{{    需要iomanip.h}}}
P51: ''setiosflags(ios::fixed | ios:showpoint)''{{{    需要iomanip.h}}}
&gt;以上两条，都是对于关键字使用''以后''的输出有效
P67: ''setw(intValue)''
&gt;仅对后面的''一个''输出有效
P109: ''函数原型''的一个重要作用：''强制参数类型转换''
P115: ''srand(time(0))''取得随机数{{{    需要stdlib.h(cstdlib)或time.h(ctime)}}}
P117: ''enum Status{ CONTUNUE=1, WON, LOSE};''
P119: ''auto, register(现在的编译器通常能自动识别常用变量，把它放到寄存器), extern, static''
P128: ''递归与迭代''：
#迭代用于''重复结构''，递归用于''选择结构''
#迭代采用''计数器''，递归不断''最初问题的简化副本''
#递归消耗大量内存
选择递归的原因：
&gt;更自然地反映问题，更容易调试。或者没有明显的迭代方案
P130: ''空参数表：''
&gt;CPP中表示''函数不去任何参数''，C中表示不对参数检查
P131  ''内联函数''
&gt;任何对内联函数的修改都可能要求函数的所有客户端重新编译，这在有些程序的开发和维护中影响很大。
P133  ''按引用传递''的''形式''
&gt;{{{int count=1;}}}
&gt;{{{int &amp;cRef = count;     }}}此后cRef是count的''别名''
''按引用传递''的''一般原则''
&gt;通过''指针''将''可修改参数''传给函数
&gt;通过''按值传递''将''不可修改''的''小参数''
&gt;通过''常量引用''将''不可修改''的''大参数''
P134 ''引用变量''必须''初始化''
P135 ''默认参数''
P136 ''一元作用域运算符：''{{{::}}}
P138 ''重载函数''通过''签名''进行区别，签名是''函数名''+''参数类型、个数、顺序''的组合(与返回值无关)，具体转换成汇编代码后的效果因编译器而异（Borland C++见书）
P139 ''函数模板''
&gt;{{{template &lt;class T&gt;
&gt;{{{T method(T val1, T val2, T val3)}}}
&gt;{{{{   T local1 = val1;}}}
&gt;{{{     .......       }}}
&gt;{{{}}}}
P171 ''cin''从键盘读取字符，直到遇到第一个''空白字符''
P175 ''函数传递数组''
&gt;定义：{{{void modifyArray(int a[], int arraySize)}}}
&gt;调用：{{{const int ARRAYSIZE=5;  int a [ARRAYSIZE]={0,1,2,3,4};  modifyArray(a, arraySize)}}}
P210 C++第三种向函数传值方式：用''指针参数''按引用调用
&gt;{{{void callByReference(int *nPtr)}}}
&gt;{{{{}}}
&gt;{{{.....}}}
&gt;{{{}}}}
&gt;{{{int number=5;}}}
&gt;{{{callByReference(&amp;number);}}}
P216 {{{const int *和int * const}}}
P237 setw用于cin时可保证读到的字符数目不超过某个长度
&gt;{{{cin &gt;&gt; setw(20) &gt;&gt; word;}}}
P238  ''cin.getline(array, len, seperator)''
P297 ''函数返回数据成员的引用''
&gt;{{{int &amp;Time::badSetTime(int hh)}}}
&gt;{{{{}}}
&gt;{{{hour = hh;}}}
&gt;{{{return }}}''hour'';
&gt;{{{}}}}
&gt;{{{int main()}}}
&gt;{{{{}}}
&gt;{{{Time t; int &amp;hourRef = t.badSetTime(20);}}}
&gt;{{{......}}};
&gt;{{{}}}}
P317''友元''：有权访问类的private和protected成员
&gt;友元关系是''给予''的；友元关系既''不对称''，也''不能传递''；
&gt;一般将友元关系的声明放在''类的首部''，不能加任何成员''访问说明符''；
&gt;友元''不是成员函数''
P319  this''指针''（this是指针）
&gt;''x'' == ''this-&gt;x'' == ''(*this).x''
&gt;返回this指针的用法（P320-P322）
P324 ''new''自动调用构造函数，''delete''自动调用析构函数
P328 ''#define NDEBUG''
&gt;使预处理器''忽略所有断言''，而不必手动删除；
P331-332 ''代理类''的设计
P332 ''[[提前类声明|http://www-subatech.in2p3.fr/~photons/subatech/soft/carnac/CPP-INC-1.shtml]]''
P341 ''用作成员函数和友元函数的运算符函数''
&gt;''if'' (运算符的''左操作数''是类的对象 )，可以把运算符重载函数作为类的成员；
&gt;''else if'' ( 重载函数''需要访问类私有成员'' )，可以把重载函数设成友元函数；（另一原因是使得运算符有''可交换性''）
&gt;''else''， 可以不是成员函数也不是友元（如果类中有set、get函数也行）
P344 static函数成员函数只能static数据变量
P344 重载''一元操作符''，有两法：
&gt;设为成员函数，无参数（较好）
&gt;设为友元，有一个类对象(副本或引用)作参数（破坏类封装性）
在需要连续操作时，运算符重载函数的返回值可能是引用，可能是副本，要具体情况分析。
&gt;如''“{{{&lt;&lt;, &gt;&gt;, +=}}}”''的都需要引用，''“+”''一般返回副本
&gt;上面不绝对，但是有原则：''返回的引用绝对不能是重载函数中的变量（栈上）''</pre>
</div>
<div title="《JAVA SE6全方位学习》笔记" modifier="wy" created="200905111453" modified="200906281405" tags="java 学习笔记" changecount="70">
<pre>*对整数来说，算术表达式运算完的结果自动变成int（P48）
*&amp;和|是''非短路运算符''，&amp;&amp;和||是''短路运算符''（P50）
*位运算符，''只能用在整数类型上''（P56）
&gt;''{{{&amp;  |  ^  ~}}}''
*移位运算符：''{{{&gt;&gt; &lt;&lt; &gt;&gt;&gt;}}}''（P57）
&gt;1. 对于负数，&gt;&gt;右移时，第一位补''1''
&gt;2. ''&gt;&gt;&gt;''是无符号右移，第一位补0，只能用于int和long，byte和short自动转换成int
&gt;3. Java采取''减次运算''，如int类型，最终移位位数是''{{{用户要移的位数 mod 32}}}''
*''属性''和''方法''成为对象的''成员''（P88）
*''多态''：父类的方法被子类修改，当以父类的观点来调用子类的这个方法时，会运行子类的方法。（P90）
&gt;多态，即多种状态，树袋熊可以是动物状态，可以是熊状态，但是这些“角度”没法改变他是树袋熊这一本质，故调用“睡觉”这个方法时，调用的是树袋熊自己的方法。
*子类转换成父类是自动转换，父类转换成子类要强制转换（P102）
*{{{A instanceof B}}}，判断''A对象''是不是''B类''的''实例''：（P102）
&gt;''{{{class SON extends PARENT }}}''
&gt;''{{{ PARENT p ＝ new SON();}}}''
&gt;则，''{{{p instanceof SON}}}''　为true
*成员：实例成员、类成员（P103）
*''super()''和''this()''只能在构造函数的第一句（P107）
*遮蔽（shadow）与覆写（override）（P109－P111）
&gt;遮蔽的客体是''属性''
&gt;覆写的课题是''方法''，即与''多态''中描述的一样，它本质上是什么类就会调用这用类的这个方法，强制转换也没用，即覆写父类的方法了。
&gt;对于static的方法来说，他伴随于类，不会受子类影响，所以它只会被遮蔽，不会被覆写。
*包管理：
&gt;''{{{javac zoo\Zoo.java;  java zoo.Zoo;}}}''，写成''“zoo.Zoo”''是因为Java对package的设置是用句点作为分割符的。
&gt;使用java命令时，-classpath可以简写成''-cp'',但是javac不行
&gt;''protected''修饰符表示的是受到''包和继承的保护''。
&gt;''default''修饰符（其实不存在）表示的是只有在一个包中才能互相访问，在不同类中，''即使''继承也没法访问'。（成员修饰符）
&gt;对于''类申明''，只能用''public''和''default（即什么都不写）''两种修饰符。
*''String:'' ==比较''对象''，euqals比较''内容''，对于''一般的类''，通常自己写equals函数来覆写Object中的equals函数。（P135）
*Java文档规定：两个相同的对象，其''散列码''必然相同。当然这只是（推荐的）规定，当你覆写并调用equals函数时，照样能产生''true''结果，。－－－－－Object类中有hashCode方法来查看对象的散列码。（P136）
&gt;''注：''在Hasdhmap等Hash家族中，查找都是根据hashcode和equals来判断的，内部它是先看hashcode是否相等，在看equals是否为true，具体看[[这里|http://blog.chinaunix.net/u1/53616/showart_432480.html]]，还有[[重写equals()方法为什么还要必须重写hashCode方法|http://jaywee.javaeye.com/blog/265200]]
*clone()函数用来复制一个对象，产生一个''不同地址内容相同''的对象（P138）
&gt;要求：1、impements Cloneable；  2、覆写clone函数
&gt;注意：clone函数返回的是Object类型，要强制转换成所要的类型；clone可能产生CloneNotSupportException，要catch
*''System.arrayCopy''函数用来数组拷贝，5个参数
*Java支持不规则数组
*打印数组（数组的元素也是数组），可以用Arrays.deepToString函数，但是传入的参数必须是Object类型的数组（toString是可以任意类型的）；同样，Arrays.equals也有对应的Arrays.deepEquals
*Java只有传值，没有传地址
*将对象赋值为null就可以让GC（Garbage Collection）回收这些内存
&gt;可以用''freeMemory''和''totalMemory''来查看系统（JVM）中空闲内存和总内存容量（P163）
&gt;设为null后系统可能不马上释放内存，可以通过Runtime.getRuntime.gc()来手动释放（当然也不完全肯定能马上释放，这只是''建议''）
&gt;在对象被释放之前会自动调用''finalize''函数，类可以覆写这个函数来事项相关功能
*System类使用
&gt;''setOut''''setErr''''setIn''重定向
&gt;''setProperties''和''setProperty''设置系统属性
!!!异常处理
*''java.lang.Throwable''是所有异常类的始祖
&gt;''Runtime Exception''、''Checked Exception''、''Error''
*finally
*‘’throws‘’与''throw''
*继承中异常的改写的原则
&gt;不可丢出 父类的丢出的异常的父类或上层类
&gt;丢出的异常类数目不可比父类丢出的多
&lt;html&gt;&lt;font size=&quot;4&quot; color=&quot;red&quot;&gt;   GUI   &lt;/font&gt;&lt;/html&gt;
*''Layout''：使用Layout的目的是使不同的平台下显示的效果一样
&gt;Frame默认是BorderLayout
&gt;Panel默认是FlowLayout（同样Applet也是）
&gt;FlowLayout默认居中对齐
&gt;CardLayout名字取自“纸牌”，显示组件的方法：''{next | previous | first | last }''（CONTAINER）或指定组件名字：''show(CONTAINER, STRING)''
&gt;GridLayout
&gt;GridBagLayout属性与方法:gridx, gridy, gridwidth, gridheight, weightx, weighty, anchor, fill, inserts
&gt;setHgap, SetVgap
*''AWT Event''
&gt;''分类''：''ComponentEvent''(Low-Level Event)和Semantic Event
&gt;''ComponentEvent''(Low-Level Event)：
&gt;&gt;''ContainerEvent''
&gt;&gt;''FocusEvent''
&gt;&gt;''WindowEvent''
&gt;&gt;''InputEvent''：''KeyEvent''和''MouseEvent''
&gt;''Semantic Event''：
&gt;&gt;''ActionEvent''
&gt;&gt;''AdjustmentEvent''
&gt;&gt;''ItemEvent''
&gt;&gt;''TextEvent''
*每种Event都有其对应的Listener
*由于实现接口要实现接口中的''所有方法''，所以较麻烦；故可用''Adapter''类，它实现了接口中所有的方法(空方法)，用时只要''覆盖所需要的方法''
*不是每个Listener都有对应的Adapter，有个一个方法的Listener就不需要Adapter了
*一个组件上可以注册多个Listener，处理的顺序按照声明的顺序
&lt;html&gt;&lt;font size=&quot;4&quot; color=&quot;red&quot;&gt;  内部类（Inner Class）  &lt;/font&gt;&lt;/html&gt;
*''内部类的好处：''既有独立类结构清晰的有点，也有同一个类的直接访问对象、成员的优点。
&gt;故其''存在的目的是：''1、可以让逻辑上相关的类结合在一起；2、Inner Class可以直接访问外部类的成员；
*''声明的位置：''1、类成员式，声明为一个类的成员；  2、区域式，在一个方法中声明；   
*''访问权限：''可以是任何一个访问权限修饰符；
*''具体分类''（按照作用域）：
#类级别：加上static修饰符；直接OutterClass.StaticInnerClass in = new OutterClass.StaticInnerClass()；
#对象级别：在OutterClass中，但没static修饰符；OutterClass out = new OutterClass(); OutterClass.InnerClass in = out.new InnerClass()；  
#区域变量（临时变量）级别：在方法中声明，一般的用法是当作Object类对象返回；  
#匿名级别：同上，目的是懒的命名了；
*''关于static：''Inner Class中的成员若要使用static修饰符，那么该Inner Class也必须是static的
&lt;html&gt;&lt;font size=&quot;4&quot; color=&quot;red&quot;&gt;  包装类  &lt;/font&gt;&lt;/html&gt;
1、@@color(red):Integer@@
*''设计基本数据类型的原因：''1、速度（可直接放入寄存器）；  2、直观；
*''引入包装类的原因：''又是不得不使用类对象；
*''构造函数：''可传入int型或@@color(red):String型@@参数
*''类常量：''MIN_VALUE、MAX_VALUE、TYPE(取得当前对象是那个Wrapper类)；
*''取出int值：''1、Integer.parseInt(intString)；  2、（Integer i = new Integer(aIntValue)）i.intValue；
*''数据转换：''1、Integer.parseInt(intString, radix)；  2、Integer.toString(aIntValue, radix)； 3、valueOf类似，但返回Integer对象；  4、toBinaryString系列； 5、同理有byteValue、shortValue、longValue、floatValue、doubleValue来把类对象转换成对应的基本数据类型数值；
*''比较对象“大小”：''compareTo，返回int；
2、@@color(red):Boolean@@
*''类常量：''TRUE、FALSE、TYPE
*''方法：''booleanValue、getBoolean、valueOf；
3、@@color(red):Byte@@{{{  与Integer类类似}}}
4、@@color(red):Character@@{{{  详见API}}}
5、@@color(red):Double@@{{{  详见API}}}
6、@@color(red):Float@@{{{  详见API}}}
7、@@color(red):Short@@{{{  详见API}}}
8、@@color(red):Long@@{{{  详见API}}}

&lt;html&gt;&lt;font size=&quot;4&quot; color=&quot;red&quot;&gt;  深入理解字符串  &lt;/font&gt;&lt;/html&gt;
*产生字符串对象方法
#调用''构造函数''（new），原理是直接产生一个新对象。
#使用''双引号''赋值，原理是从''字符串池''（String Pool）中寻找是否有相同字符串，有的话直接引用。
*字符串对象是不可修改的（''immutable''），所有修改操作都会导致新的字符串对象产生。若真需要常常修改，可用''StringBuffer''类。
*String类的构造函数：主要五类7个（全部看api）：无参数、byte数组、char数组、字符串、StringBuffer
*String类的方法：
##类方法：copyValueOf、valueOf、format
##对象方法：……
*StringBuffer类方法(在java.lang包下)
**增加
##append：共10种重载，根据参数不同分为char、String、Object(toString)、char数组、有起终点的char数组、boolean、double、float、int、long
##''insert''：总共10种，与append几乎一样，只是第一个参数是插入的位置，int型；
**修改
##''reverse：''无参数，返回修改后的StringBuffer对象；
##''setCharAt：''参数：''（要替换的位置int，新的字符char）''，无返回；
##''replace：''参数：''（要替换的起点int，要替换的终点int，新的字符串String）''，返回修改后的StringBuffer对象；
**删除
##''deleteAt：''参数：''(要删除的位置int)''，返回修改后的StringBuffer对象；
##''delete：''参数：''(要删除的起点int，要删除的终点int)''
**查询
##''charAt''
##''getChars''
##''substring''
&gt;@@color(red):注：@@StringBuffer是线程安全的（同步），但也因此执行效率''相对较低''；相反，StringBuilder是线程不安全的，但执行效率高。
&gt;故当''确定''程序中不涉及多线程时，推荐使用StringBuilder。
*''StringTokenizer''(在java.util包下)
**''构造函数：''三种；默认的''分隔符''是：空格、定位符(Tab,\t)、换行(\n)，Carriage-return(\r)、form feed(\f)
**''方法''
##''countTokens''
##''hasMoreElements''、''hasMoreTokens''   ''区别''在于前者是实现Enumeration接口而来的，后者是StringTokenizer专有的，两者效果一样；
##''nextElement''、''nextToken''对应于上面两个方法；

&lt;html&gt;&lt;font size=&quot;4&quot; color=&quot;red&quot;&gt;  文件与输入/输出处理  &lt;/font&gt;&lt;/html&gt;
*''Stream''纵览
#''InputStream''和''OutputStream''是所有输入输出相关类的父类，它是以''字节''为单位来传送数据；继承的类大都是XXXXStream；
#''Reader''和''Writer''两个类用来处理字符流数据；继承的类大都是XXXXReader、XXXXWriter；
*''Node''(节点类)
#''作用：''将数据来源或目的地进行''连接''；
#''分类：''字节继承体（三类）和字符继承体（四类），具体见下表
|!种类\继承体系|!字节|!字符|
|!文件(File)|FileInputStream,FileOutputStream|FileReader,FileWriter|
|!内存(Array)|ByteArrayInputStream,ByteArrayOutputStream|CharArrayReader,CharArrayWriter|
|!内存(String)||StringReader,StringWriter|
|!管道(pipe)|PipeInputStream,PipeOutputStream|PipeReader,PipeWriter|
*''方法使用''
**''InputStream类''
##''read：''三种重载方式，参数...返回值...
##''close：''关闭数据流
##''available：''参数...返回值...可能会产生''IOException异常''，需要处理。
&gt;&gt;@@color(red):注：@@InputStream对象调用这个方法，它一直返回0；只有继承自InputStream的子类的对象调用才能正常使用；
##''skip：''参数...返回值...
##''mark''、''reset''：参数...返回值...
&gt;&gt;@@color(red):注：@@mark不是所有流都支持(而且只能是InputStream的子类)，可用''markSupported''检测；reset会产生IOException异常
**''OutputStream类''
##''write：''三种重载方式，参数...返回值...
##''flush：''write之后不马上写，要flush
##''close：''同上
**''Reader类''
&gt;&gt;与InputStream类类似，只不过操作对象变成了''char类型''；同时，Reader类中没有available方法，取而代之的是''ready''方法；
**''Reader类''
&gt;&gt;与OutputStream类似，同样byte类型变成''char类型''；不过多出来两个write方法（把char数组编程String对象），总共5个；
*''文件处理''
**''文件操作''
##''File常量：''目录分隔符：''separator''(String类型)、''separatorChar''(char类型)；路径分隔符：''pathSeparator''、''pathSeparatorChar''；
##''File构造：''三种，参数...返回值...
&gt;&gt;@@color(red):注：@@File类对象可以文件，也可以是''目录''；取得当前目录（PWD）：System.getProperty(&quot;user.dir&quot;)；
##''方法：''其中有createTempFile、delete、deleteOnExit、list、listFiles、listRoots、mkdir、mkdirs具体看API；
**''文件访问''
##''FileInputStream''初始化时要处理''FileNotFoundException''异常；
##''FileInputStream''类中的方法：read：每次读一个字节，没有数据返回-1；不过有available方法直接判断是否有数据可读。
##由于中文编码每个字要''两个字节''，所以一般不用read一个个地读取每个字节（用得话也要保证每个字的第一个字节是''奇数''个字节），通常读字符
##通常用''FileReader''和''FileWriter''来“包装”FileInputStream，实现每次读一个字符，其他InputStream应该类似。
##''RandomAccessFile''，直接继承Object类
**''数据流连接''(''Filter流''类)
##Java提供的机制，能用数据流做连接，使得流能够以''特殊（方便）的方法''访问。
##负责这项机制的是''Filter''类，类似可分为''FilterInputStream'',''FilterOuputStream'',''FilterReader'',''FilterWriter''四个类。具体继承自他们的类见下表
|!种类/集成体系|!字节|!字符|
|!暂存|BufferedInputStream,BufferedOutputStream|BufferedReader,BuffereWriter|
|!字节字符装换||InputStreamReader,OutputStreamWriter|
|!对象串行化|ObjectInputStream,ObjectOutputStream||
|!特定数据类型访问|DataInputStream,DataOutputStream||
|!计数|LineNumberInputStream|LineNumberReader|
|!重复|PushbackInputStream|PushbackReader|
|!打印|PrintStream|PrintWriter|
''注:''对于对象串行化，可以在类的属性声明时加上“''transient''”修饰符，这样这个属性就可以''不被串行化''(不被写入文件)。(格式如:{{{transient int a}}})
&lt;html&gt;&lt;font size=&quot;4&quot; color=&quot;red&quot;&gt;  线程  &lt;/font&gt;&lt;/html&gt;
*尽量用''实现Runnable接口''，而不是''继承Thread类''
*''P336''的线程架构图
*Thread对象只能调用''一次start方法''
*在JDK1.1以后，''stop方法''被废弃了，只有当''run''方法运行结束以后，线程才会结束；
*''暂停线程运行''方法
#''sleep''方法(''类方法'',须处理''InterruptedException''异常)：进入''block''状态，当到时间后，进入''runnable''状态(''@@color(red):不是running状态@@'')
#''yield''方法(''类方法''):进入''Runnable''状态，知道再次被CPU调度到；
#''join''方法(''对象方法'')：一个线程A等在另一个调用join的线程B上,处于''block''状态;直到B运行结束,A进入''Runnable''状态；它也可以设置等待时间；
*关于''时间''：默认的方法都是以''毫秒''为单位(也有重载的以纳秒&lt;十亿分之一秒&gt;为单位);方便起见，可以使用''TimeUnit''类
*''TimeUnit''类是''Enum''类，具体使用见API
*''取得线程信息''的方法
#''isAlive''
#''setName''
#''getName''
#''currentThread''：当线程是''实现Runnable接口''而来时，由于没有Thread对象，故要用此方法来取得当前运行的对象；
*''数据同步''
&gt;关于''@@color(red):锁@@''：每个对象都有一个锁，当要运行某个对象中设置锁的某段代码时，须先取得这个锁；当别的线程也想运行那段代码    &gt;时，须等别的线程归还那把锁；
&gt;具体代码：
&gt;{{{synchronized(要取得锁的对象)
         {      要加上锁的代码       }}}}
&gt;(按我理解,从效果上来讲,synchronized表示在某个''对象''上建立的各个线程对''&quot;加上锁的的代码&quot;''是互斥访问的,由此有了''得到锁''和''释放锁''的语义)
**''synchronized声明''
##如上面的代码：''优点：''可以对某段''需要同步的代码''锁定，不必浪费时间在其他代码上，并可以取得其他对象的锁；''缺点：''在javadoc中无法知道那些方法是synchronized的；
##{{{public synchronized void method() { ... }}}}   ''优点：''在生成的javadoc中知道哪些方法是synchronized的；''缺点：''方法中很多不需要同步的代码浪费运行时间，再有它只能取得这个方法所在类的对象的锁（''只能取得自己的对象的锁''）
**''锁归还的方式''
##''bread语句''跳离锁定的语句块，不过对于''方法声明上的synchronized''没用；
##遇到''return语句''；
##遇到''异常''；
**一些''原则''，除第一条，其他都是网上资料
##'受synchronized保护的代码中，要访问的对象属性必须设置为''private''；
##无论synchronized加在方法还是对象上,它''取得的锁都是对象'',而不是把一段代码或函数当作锁――且同步方法很可能还会被其他线程的对象访问，故''当心死锁''。 
##''每个对象''只有''一个锁''(lock)与之相关联。若一个对象有多个synchronized方法，只要一个线程访问了其中的一个synchronized方法，其它线程不能同时访问这个对象中任何一个synchronized方法。
##''类的锁''：(1)静态方法前加synchronized。 (2)synchronized(className.class).(3)synchronized(Class.forName(className)。
##''零长度的byte数组对象''创建起来将比任何对象都经济：private byte[] lock = new byte[0]; 
&gt;''[[来源1|http://colorlife.javaeye.com/blog/325084]]''，''[[来源2|http://henry406.javaeye.com/blog/371932]]''
*高级线程操作
#对于同步(synchronized)的方法，一般''用while来判断wait的条件''：因为首先运行wait()后线程(B)停在wait()之后那句，其次线程调度是''随机''的，线程A执行notify后，不一定是我们想要的线程(B)得到运行，中间运行过几个线程后，当我们想要运行的线程(B)得到运行时，但是的''条件可能已经不满足''了，所以要继续判断一下wait的条件，如果还是满足，那要继续wait，所以用while。
#P354上的最终的状态转化图。系统的暂停状态有三个：
##''Blocked Pool''：属于系统，只有一个；
##''Lock Pool''：依不同的对象，会有多个；
##''Wait Pool''：依不同的对象，会有多个；
#''注意''
##wait和notify要对应同一个对象；
##调用notify后，从Wait Pool中''随机''挑选一个到''Lock Pool''(原因是Thread对象进入等待池前会''释放全部锁''，所以出来后要再加一次锁)，然后到Runnable；
##可以用''notifyAll''方法把等待池中的线程全部转到锁定池中(Monitor Model)，用于保证共用数据的一致性和系统不会进入死锁状态；</pre>
</div>
<div title="一次安装闭源的“解码器、flashplayer、java虚拟机、微软字体”" modifier="YourName" created="200902210759" tags="解码器 闭源" changecount="1">
<pre>ubuntu推出的安装包，只要执行下面命令：
&gt;''sudo apt-get install ubuntu-restrictes-extras''</pre>
</div>
<div title="一种基于LCS 的相似网页检测算法" modifier="wy" created="200907110646" modified="200907110710" changecount="5">
<pre>黄连恩, 王磊, 李晓明 北京大学 网络与分布式系统实验室

提交时间：2007-12-20

!!!摘要
网页的相似性检测长期以来是一个研究的热点，shingling 和 simhash 被认为是当前最好的两个算法，然而它们存在着一定的不足：一方面，高的分数意味着高的相似概率，但并不必然意味着高的相似度；另一方面，哈希代码的长度和多样性之间的冲突决定了难以同时获得高的准确率和覆盖率。本文提出了一种新型的相似网页检测算法，同时具备高准确率与高覆盖率的优点。该算法采用基于LCS（longest common subsequence）的相似性度量方法，它可以更好地度量网页之间的相似度和包含关系，并获得高的准确度。同时，本文设计了一个包含了三个步骤的检测过程框架，以保证算法的效率。综合实验表明本文的算法同时获得了高准确率与高覆盖率并具有较好的效率。该算法成功应用于4.3亿文章型网页集合，将其分割为0.68亿个相似网页子集，整个过程使用6台Linux服务器仅花费了5天的时间。

!!!引言
*在基于哈希的相似检测算法中，''哈希代码的长度''决定了基于哈希方法的准确度，而''多样性''（multiplicity）则决定了召回率，两者之间的冲突决定了无法同时获得高的准确度和召回率。（{{{源自论文：B. Stein. 《Principles of hash-based text retrieval》}}}）

!!!定义
我们定义一个文档为一系列的字符组成。给定两个文档 A和 B，|LCS| 为它们的 LCS的长度，|SES|  为最短编辑脚本的长度。以上述例子为例，设 A = abcabba，B = cbabac，A 和 B的长度分别表示为 |A| 和 |B|，则有， 
&gt;{{{                         |A| + |B| = 2|LCS| + |SES| }}}
定义 resemble rate 为： 
&gt;{{{                       r(A,B) = |LCS| / (|A| + |B| - |LCS|) }}}
定义 contain rate 为： 
&gt;{{{                           c(A,B) = |LCS| / |B|}}}
!!!检测过程
LCS是一种两两比较文档的相似性检测方法。假设对于一个文档集合 R，经相似性检测后将得到分割为若干相似文档子集 a, b, c, d,  …  共  n  个。那么，相似性检测的一般过程可描述如下： 
##按一定方法对文档进行排序，原则是尽可能使形成最大子集的文档排在前面。 
##读取第一个文档，放入第一个子集 a。 
##顺序读取其它文档，与已有子集的第一个文档比较，若不相似，新生成一个子集。 
分析可知，在这个过程中，每个文档最多将比较  n－1次。因此，每篇文档的比较次数，取决于文档集合 R 的不相似文章数量。
&gt;‘’与COS测度比较的优势‘’
###LCS体现了词的顺序，而 Cos 没有；
###LCS 可以评估两篇文档之间的包容关系，而 Cos 不能；
###一般认为，Cos 的方法要比 LCS更快。但对于中文文档来说，这一优势并不是那么明显，因为COS方法要切词
!!!算法实现
算法的系统框架划分为三个步骤：
##将网页文档集合分割为''可能相似文档子集''，仅在每个可能相似文档子集中计算 LCS；
##在计算两篇网页文档的 LCS之前，对网页文档进行过滤生成文档''过滤框架''，在该框架而不是原始文档上进行 LCS计算；
##计算LCS并选取它的可信部分（称为 TLCS）来计算相似度
!!!!可能相似子集计算
&gt;去HTML标签，去格式，按照标点分割成句子；
&gt;&gt;计算文档指纹：
####对''每个文档''，选择那些''长度大于一定值 X ''的句子，每个对句子计算 MD5摘要，对m取模，不同值''分成m个组''；
####对''每个组''，取其中MD5值''最小的Y个不同句子''（并且要求Y个句子分布在不同位置，即其覆盖的文字长度达到一定值 Z）计算一个哈希值（128 位），称为指纹，这样共得到''m个指纹''；
####对''MD5值''（共16字节）循环移位一个字节，重复上面 2 步，这样，最多可以得到 ‘’16×m个指纹‘’。
&gt;&gt;&gt;对文档按指纹进行索引，然后将它们聚集到可能相似的子集里。聚集算法描述如下：
#####对文档按它可以生产的指纹数从大到小进行排序，显然，指纹越多它就可能找到越多的相似文档；
#####按顺序从文档集合中逐个读取文档，对于每个文档，根据指纹索引从剩下的文档集合中读取和它可能相似的文档以及根据传递性得到的可能相似文档聚集到一起，形成一个可能相似子集；
!!!!文档过滤框架计算 
对于给定将要进行比较的两篇文档 A和 B，做如下算法：
#对每篇文档， 使用一个长度为 S 的滑动窗口来顺序读取一个文字片断， 滑动窗口相互是交叉的；对该''窗口的文字片断''使用'' Rabin'' 的方法[16]计算一个哈希值。 
#每篇文档将''哈希值记录''在自己的一个哈希表里（另一种办法是记录在位图里，位图的大小应该远大于文档长度） 。 
#对于 A 中的每个哈希值，检查它是否在 B 中也存在，如果是，则它所对应的文字片断被保留下来。''文档 A 的过滤框架即为这些被保留下来的文字片断的交集''。 
&gt;使用同样的方法得到文档 B 的过滤框架
!!!!可信部分计算
略</pre>
</div>
<div title="不同文件系统的文件大小及分区大小限制" modifier="wy" created="200904101425" modified="200904101426" changecount="3">
<pre>[[fat32文件系统最大文件不超过4G|http://www.javaeye.com/topic/188752]]
[[Design and Implementation of the EXT2|http://e2fsprogs.sourceforge.net/ext2intro.html]]</pre>
</div>
<div title="不用临时变量，交换两个数的值" modifier="teloon" created="200911151304" modified="200911151336" changecount="2">
<pre>方法一：
&gt;{{{a = a+b}}}
&gt;{{{b = a-b}}}
&gt;{{{a=a-b}}}

方法二(更高效)：
&gt;{{{a = a^b}}}
&gt;{{{b = b^a}}}
&gt;{{{a = a^b}}}

来源：[[这里|http://ipie.blogbus.com/logs/38126775.html]]</pre>
</div>
<div title="与python混合编程" modifier="wy" created="200908110340" changecount="1">
<pre>Type the text for '与python混合编程'</pre>
</div>
<div title="二维数组声明" modifier="teloon" created="200909161633" modified="200910291613" changecount="8">
<pre>1、{{{int (*a)[n] = new int[m][n]}}}
&gt;优点：空间连续，直观，使用方便
&gt;缺点：n需事先知道
2、见下
&lt;code c&gt;
int **a = new int*[m]
for(int i=0; i&lt;m; ++i)
    a[i]=new int[n];
.....
for(int i=0; i&lt;m; ++i)
     delete[] a[i];
delete[] a;
&lt;/code&gt;
&gt;优点：n可未知，调用直观
&gt;缺点：非连续存储，析构较烦
3、见下
&lt;code c&gt;
int *a = new int[m*n]
......
delete[] a;
&lt;/code&gt;
&gt;优点：析构简单，n可未知，连续存储
&gt;缺点：调用不直观
4、见下
&lt;code c&gt;
vector&lt;int&gt; a;
a.resize(m);
for(int i=0;i&lt;m; ++i)
    a[i].resize(n);
&lt;/code&gt;
&gt;优点：自动析构，动态增长，调用直观
&gt;缺点：非连续存储，复杂性增大
5、见下
&lt;code c&gt;
vector&lt;int&gt; a;
a.resize(m*n);
&lt;/code&gt;
&gt;3、4的结合
6、见下
&lt;code c&gt;
int **a = new int*[m];
a[0] = new int[m*n];
for(int i=1; i&lt;m; ++i)
    a[i] = a[i-1] + n;
........
delete[] a;
&lt;/code&gt;
&gt;优点：连续存储，方便析构，调用直观，n可以是未知

参考：[[这里|http://www.cnblogs.com/beyondstorm/archive/2008/08/26/1276278.html]]</pre>
</div>
<div title="人人网信息抓取器" modifier="wy" created="201003271432" modified="201003271444" changecount="3">
<pre>代码1：[[人人网登陆发文|http://fayaa.com/code/view/9987/]]
!!!模拟登陆，保存cookie
*''Cookie保存''
Cookie用{{{cookielib.CookieJar()}}}生成的对象保存，然后用这个Cookie通过{{{urllib2.build_opener}}}生成OpenerDirector对象，以后用这个OpenerDirector对象建立的链接就不用登陆了（保存Cookie了）。详细见//代码1//中的{{{login}}}函数
!!!POST文章
*''组建参数''
基本的参数可以通过firebug的网络调试功能找到，到发表文章的[[页面|http://blog.renren.com/blog/0/addBlog]]，开启firebug，填好内容提交，查看POST参数。可以看到，有如下值需要提交：
&gt;''blogControl'', ''categoryId'',  ''editBlogControl'',  ''isVip'', ''title'', ''body'', ''postFormId''
前四个只要设成firebug中观测到的响应的值即可，title和body是将要发表的日志的内容，最重要也是最难弄的是最后一项，他与用户每次登陆的 session绑定，是个随机值。故需要//代码1中//的get_postFormID来取得每次登陆的所随到的值。
参数用如下方式来包装：
&gt;{{{urllib.urlencode(body)}}}
*''提交POST''
只需用之前生成的opener（已经有Cookie）打开一个连接，发送POST请求{{{opener.open(url_post, urllib.urlencode(body))}}}
*''编码问题''
#title和body都有可能是中文，而人人网的默认编码是UTF8，所以需要转码；
#在Windows环境中，默认的编码是''mbcs''，或者是''cp936''，所以可以先用mbcs来''decode''，再encode成''utf8''，详见代码1。
#关键就是找到系统默认的文件系统编码，然后对其进行转换；
#问题解决参考：[[limodou|http://www.linuxforum.net/forum/printthread.php?Cat=&amp;Board=python&amp;main=575924&amp;type=thread]]和取得[[系统编码|http://code.google.com/p/mylibs/source/browse/tools/Python/coding.py]]</pre>
</div>
<div title="使用Bookmarklet+Google CSE提升搜索效率" modifier="wy" created="201011290230" modified="201011290232" changecount="2">
<pre>  1.创建Google CSE
过程很简单，在[[Google CSE|http://www.google.com/cse/]]页面一步步按照提示创建即可。例子如笑来老师的[[Encyclopedia|http://www.lixiaolai.com/index.php/archives/992.html]]和[[Twitter|http://www.google.com/cse/home?cx=017195234153172777936:aqsxgxsvgyy]]搜索。

  2.Bookmarklet工具
相关资源见：电脑玩物的常用[[Bookmarklet|http://playpcesor.blogspot.com/2010/06/bookmarklets-2010.html]]和[[Brawny Walking|http://brownywalking.blogspot.com/2009/01/firefox-useful-bookmarklets.html]]的常用Bookmarklet，他的参考资料也是个不错的资源。
当Bookmarklet收藏了很多的时候，找也来可能也是个麻烦事，这时候另一个搜寻Bookmarklet的[[工具|http://brownywalking.blogspot.com/2010/01/command-line-bookmarklet.html]]就可能比较有用。

  3.创建Google CSE的Bookmarklet
利用[[Bookmarklets|http://bookmarklets.com/mk.phtml]]网站提供的工具创建，具体教程见[[这里|http://www.ampercent.com/site-search-bookmarklet/2647/]] 。</pre>
</div>
<div title="关于Wiki的组织" modifier="teloon" created="200902091134" modified="200902091213" tags="wiki 组织" changecount="16">
<pre>*首先是MainMenu，由于TiddlyWiki相互之间的链接是由Tiddler名称或Tag宏~~(暂时只发现这两种)~~来组织的，但是由于Tag宏的显示效果不适合导航Menu，所以采用Tiddler名称来组织。故现在看到的MainMenu上面的都是Tiddler名称。这样的话，由于Tiddler名称是单一的，所以这些Tiddler链向的页面都只能是一个汇总的页面，是几个页面的collector。所以MainMenu可以看做''一级目录''，这个collector页面可以看做有特定主题的一个''二级目录''。
*对于交叉的页面，比如我有个关于JavaScript的页面，我可以把它分在JavaScript目录，也可以把它分在code目录，那么我只需在二级目录分别建立对次Tiddler的链接。
*对于某篇文章的定位的几种方法：
**@@color(green):tag查找@@{{{       --------}}}若确定tag的话查找会很快，适合''了解文章，知道tag''；
**@@color(green):搜索@@{{{        --------}}}适合于''模糊查找''，''最慢''，但''成功率高''；
**@@color(green):~MainMenu@@{{{        --------}}}从~MainMenu开始，一级级定位。但对于查找某篇文章，这个方法比较''鸡肋''，没有tag查找的快速，没有搜索的准确；不过，对于''某一大类的文章''的浏览还是很适合的，毕竟MainMenu就是给一个粗略的分类。</pre>
</div>
<div title="关于Wiki的编辑" modifier="teloon" created="200902091144" modified="200902091145" tags="wiki 编辑" changecount="3">
<pre>*由于TiddlyWiki自身的编辑语法功能有限，所以产生的效果很难个性化；不过现在可以使用html代码以后，把TiddlyWiki的编辑功能简直提升了一个层次，估计以后用html来编辑可能会用得多一些。</pre>
</div>
<div title="关于char和unsigned char自己的一些理解" modifier="wy" created="200906071357" modified="200908151520" tags="char unsigned" changecount="2">
<pre>首先要知道有char、unsigned char、signed char，char是与编译器相关的可能是signed（大多数情况），也可能是unsigned的，也正是这个编译器依赖性，标准制定者又引入了signed char。REF：[[Here|http://www.chinaunix.net/jh/23/894918.html]]

其次，char、unsigned char都是8位的变量，10进制范围分别是-128~127和0~255；同时ASCII自己也有自己的一套编码，只不过是正好与char的范围吻合（''这个应该是有历史原因的''），所以通过char的二进制编码值可以显示ASCII字符。所以看char对应的是什么字符，关键还是看他的二进制编码。由unsigned char*转到char *直接显式强行转换就好了。

最后，关于char扩展到整数，具体可看这篇文章：[[Here|http://blog.csdn.net/cugbliang/archive/2008/07/16/2657161.aspx]]</pre>
</div>
<div title="关于指针和数组变量" modifier="wy" created="200906160728" modified="200908290759" tags="C 数组 指针 地址" changecount="16">
<pre>先看程序：
&gt;#include&lt;stdio.h&gt;
&gt;
&gt;int main(void)
&gt;{
&gt;     char *a = &quot;hello&quot;;
&gt;     char c[10] = &quot;ccc&quot;;
&gt;
&gt;     printf(&quot;c:%p\n&amp;c[0]:%p\n&amp;c:%p\n&quot;, c, &amp;c[0], &amp;c);
&gt;     printf(&quot;a:%p\n&amp;a[0]:%p\n&amp;a:%p\n&quot;, a, &amp;a[0], &amp;a);
&gt;
&gt;     return 0;
&gt;}

''输出结果''：
&gt;c:0x22ccc0
&gt;&amp;c[0]:0x22ccc0
&gt;&amp;c:0x22ccc0
&gt;a:0x402000
&gt;&amp;a[0]:0x402000
&gt;&amp;a:0x22ccdc

--结论：--
*--无论数组还是指针变量x，x表示的是''x变量的值''，对于指针，此值是''指向的地址''；对于数组，此值就是此变量x的地址，所以可以数组变量看作''指向自己的指针''(我的理解)--；
*--从对于数组变量c，c和&amp;c的值相同验证了上面那一点：“数组可以看做''指向自己的指针''”--；
*--在上面“数组可以看做''指向自己的指针''”的基础上，可以把数组也看成指针；那么''x[n]''(n是0,1,2...)是在x变量的值的基础上的操作(n是偏移量)，也就是对*x''指向的地址''的操作；''x[n]''是取值，''&amp;x[n]''是取地址--；

''结论''：
上面的理解有问题，总的来说数组是数组，指针是指针，它们是两个不同的概念。指针和自己平常理解是相一致(变量的值被当成地址来看)，而数组不应该和指针混起来，它只是''内存中的一块区域''(应该是连续的吧)。
*在C中，对于数组变量c，把c、&amp;c、&amp;c[0]都&quot;解释&quot;成那块内存的''首地址''(就是这么设计!)，如在上面的程序中。
*在有些情况下，比如函数传参的时候等等，可以把数组变量看成指针变量，来访问那一块区域；
*对于sizeof，它计算的是''变量自身类型的大小''，所以绝大多数情况下，数组变量计算的是数组的大小(设计就是这样!)，少数情况下，当它作为指针时，那么他就是指针变量的大小，即地址的大小（如32位是4字节）

''参考''：
*[[自己水源上的帖子|http://bbs.sjtu.edu.cn/bbscon?board=C&amp;file=M.1246085304.A&amp;num=11246]]
*[[西邮的wiki|http://www.xiyoulinux.cn/wiki/index.php?title=C%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8#C.E8.AF.AD.E8.A8.80.E6.A0.B8.E5.BF.83.E2.80.94.E2.80.94.E6.8C.87.E9.92.88]]

''最终语''：
关于知识，有的是内部的实现是这样，有其存在的规律或者必要性(比如栈、堆的实现、管理方式，否则就不成栈、堆，它是有道理的)；也有的是作者就是这么规定、这么设计的，其他也许也行(比如不一定要设计成栈、堆的形式，其他管理方式也行，但是一旦这么设计了就有上面&quot;遵守栈、堆的管理方式&quot;的规律性的东西了，它是有道理的)。</pre>
</div>
<div title="内核中针对proc文件系统的编程函数总结" modifier="teloon" created="200903061517" modified="200903061540" tags="proc kernel" changecount="2">
<pre>!!一、头文件：
    #include &lt;linux/proc_fs.h&gt;
!!一、头文件：
    #include &lt;linux/proc_fs.h&gt;
!!二、创建与删除proc文件：
    ''&lt;一&gt;创建普通文件：''
        1.创建不可读写的普通文件
            /*此函数只负责在proc中创建一个只读文件，即能在proc中看到这个文件。
             * */
            struct proc_dir_entry* create_proc_entry (const char *name,mode_t mode,struct proc_dir_entry *parent);
            @name :要创建的文件名
            @mode :要创建的文件的属性 默认0755
            @parent :这个文件的父目录
        2.创建只读的普通文件
            /*和create_proc_entry基本一样。
             * 只是为该文件挂接上读函数：read_proc(void data);
             * */
            struct proc_dir_entry * create_proc_read_entry (const char *name,mode_t mode,struct proc_dir_entry *parent,read_proc_t* read_proc,void *data);
            @name :要创建的文件名
            @mode :要创建的文件的属性 默认0755
            @parent :这个文件的父目录
            @read_proc :当用户读这个文件时，内核调用的函数
            @data :传给read_proc的参数
        3.创建符号连接
            /*该函数在父目录parent下创建一个指向dest的连接name。
             * 就像ln：
             * #ln -s dest parent/name
             * */
            struct proc_dir_entry * proc_symlink (const char *name,struct proc_dir_entry *parent,const char *dest);
            @name :要创建的文件名
            @parent :这个文件的父目录
            @dest :符号连接的目标文件
        4.创建目录
            /*该函数在父目录parent下创建一个目录name
             * */
            struct proc_dir_entry * proc_mkdir (const char *name,struct proc_dir_entry *parent);
            @name :要创建的目录名
            @parent :这个目录的父目录
        5.删除文件或目录
            /*这个函数从proc文件系统中删除一个文件或目录。
             * 注意：1。是通过参数name，而不是通过创建时返回的指针来删除的。
             * 2。该函数不会递归删除目录下的文件。
             * 3。data变量保存了分配的内存，要先释放对应内存，再删除该文件。
             * */
            void remove_proc_entry (const char *name,struct proc_dir_entry *parent);
            @name :要删除的文件或目录名
            @parent :所在的父目录       
   '' &lt;二&gt;、读写proc文件''
        为了能让用户读写添加的proc文件，需要挂接上读写回调函数：read_proc和write_proc
        例：
            struct proc_dir_entry * entry;
            entry-&gt;read_proc = read_proc_foo;
            entry-&gt;write_proc = write_proc_foo;
        1.读函数read_func
            /*该函数把要写的信息写入buffer，最多不超过PAGE_SIZE
             * */
            int read_func (char *buffer,char **stat,off_t off,int count,int *peof,void *data);
            @buffer :把要返回给用户的信息写在buffer里，最大不超过PAGE_SIZE（一般4K）
            @stat :一般不使用
            @off :buffer的偏移量
            @count :用户要取的字节数
            @peof :读到文件尾时，把peof指向的位置置1
            @data :被多个proc文件定义为读时，通过data传递参数
        2.写函数write_func
            /*该函数最多从buffer中读取count个字节的数据。
             * 注意：buffer地址在用户空间，需要先用copy_from_user()把这些数据拷贝到内核中。
             * */
            int write_func (struct file *file,const char *buffer,unsigned long count,void *data);
            @file :该proc文件对应的file结构，一般忽略。
            @buffer :待写的数据所在的位置
            @count :待写数据的大小
            @data :同read_func
'' &lt;三&gt;、seq_file编程接口''
        include/linux/seq_file.h:
        struct seq_file{
            char *buf;
            size_t size;
            size_t from;
            size_t count;
            loff_t index;
            loff_t version;
            struct semaphore sem;
            struct seq_opertions *op;
            void *private;
        };
        seq_file结构会在seq_open函数调用中分配，然后作为参数传给每一个seq_file的操作函数。
        1.seq_file操作函数：
            struct seq_operations {
                void (*start) (struct seq_file *m,loff_t *pos);
                void (*stop) (struct seq_file *m,void *v);
                void (*next) (struct seq_file *m,void *v,loff_t *pos);
                void (*show) (struct seq_file *m,void *v);
            };
        2.四个操作函数作用：
            start：用来遍历连接对象的时候做初始化准备工作。
                    从pos得到偏移，返回一个连接对象的偏移。
                    也可以返回一个特殊值：SEQ_START_TOKEN
                    出错返回：ERR_PTR(error_code)
            stop:遍历结束时被调用。
                    主要做一些清理工作，如释放锁、释放内存
                    注意：如果调用了start，就必定会调用stop，即使start返回出错。
            next：遍历中寻找下一个连接对象。一般是下一个节点。
            show：对当前遍历到的连接对象或节点进行一些操作。
                    例如调用seq_xxx函数输出对象的一些内容。
        3.格式化输出函数
            seq_printf(struct seq_file *m,&quot;格式化字符串&quot;,var):和printk很相似，只是多了个*ｍ
            seq_putc (struct seq_file *m,char c);输出字符
            seq_puts (struct seq_file *m,const char *s);输出字符串
            seq_escape (struct seq_file *m,const char *s,const char *esc);跟seq_puts类似，不同的是这个函数特殊处理字符串s中的特殊字符（esc指针指向的每个字符），这些特殊字符输出为八进制，其他字符照常。 </pre>
</div>
<div title="分页 分段 缺页的通俗解释" modifier="teloon" created="200905010448" modified="200905010449" tags="分页 分段 缺页" changecount="2">
<pre>''SRC：'' [[here|http://zhidao.baidu.com/question/38394944.html]]

!!!什么是分页？
无论你的NT服务器的内存有多大，它总是显得不够充足。当物理RAM从低端开始运行时，Windows NT使用了分页文件Pagefile.sys。为了运行不同的进程和应用程序，Pagefile.sys给物理内存分配了一些空间。在这些空间内允许交换数据页。

!!!什么是分段？

程序分段的好处。cpu中的段寄存器中保存了段址（base）和偏移值的上限（limit）。段址：有效地址 中，如果有效地址大于limit，便会引发异常。这样就可以限制程序不能范围当前段外的数据，不能访问其他程序的数据。总之就是不能访问它不能访问的数据。
面向对象的好处。对象就是一块连续的内存中的数据吧。这点跟上面一点类似。通过限制访问，就做到了private的效果吧。

!!!分段与分页：
(1)内存分段和内存分页一样都是一种内存管理技术,分段是为了权限保护,分页是为了虚拟内存.
(2)分段后,程序员可以定义自己的段,各段有独立的地址空间,象进程的地址空间互相独立一样.
(3)同一个类的实例分配在一个段中,只有该类的方法可以访问,如果其他类的方法去访问,会因为段保护而出错.可以从硬件上实现类的数据保护和隐藏

!!!什么是缺页？
为什么会出现缺页？你的问题中已经有了答案。物理内存和系统“提供”给用户的内存的不对称性。
是不是很容易就出现缺页的情况？像windows nt这样的系统，每个进程拥有4G的虚存，记住，是每个进程。其中3-4G影射为操作系统的核心，是只读的，1-2G映射为用户空间，其中一部分是系统提供的动态链接库。
对于每一个进程，操作系统只向物理内存映射少数的地址，这是因为 RAM 实在是太宝贵、太稀缺了。进程的剩下的内存实际上都保存在二级存储器（通常是硬盘）上。这就是为什么要叫虚拟内存的原因。没有映射到物理 RAM 的地址都被做上了标记。只要进程一访问这样的地址，操作系统就将数据从二级存储器上取回到内存。若操作系统把物理 RAM 用光了，它就把一些数据换出来腾出空间。之后我们还可以把这些数据取回，因为它们都保存在在二级存储器上。那些数据被换出是由替换策略决定的。 Windows NT 使用先进先出（First-In-First-Out，FIFO）的策略。根据这个策略，当空间不够时，最老的数据（即最先取进内存的数据）被换出。
缺页的频率取决于你系统的实际内存的大小和系统的进程数目等因素。例如同时跑着几千个进程的网络服务器，缺页肯定是非常频繁的。</pre>
</div>
<div title="单源最短路径" modifier="wy" created="200908281504" modified="200908281504" tags="图论 算法" changecount="3">
<pre>与[[最小代价生成树]]中的prim算法思路、实现几乎一样，区别就在于closest的更新，这个closest是到''源点''的最短路径，而不是到u集合的最短路径
在实现中要注意下面的问题：
&gt;1、如果两个点之间无边，则edges的值设为int的最大值，而在更新closest时，要对边的值做加法，这是可能会''超出int的范围''，变成负数，所以要先判断

源码见这里：[[代码发芽网|http://fayaa.com/code/view/5314/#]]</pre>
</div>
<div title="去除点击链接时出现的虚线框" modifier="teloon" created="200902281329" modified="200902281341" tags="css 虚线框" changecount="19">
<pre>''方法一''
IE下可使用其私有的html属性：hideFoucs，在标签的结构中加入hidefocus=&quot;true&quot;属性。即：
&gt;{{{&lt;a href=&quot;http://www.17css.com&quot; hidefocus=&quot;true&quot; title=&quot;17css-青色's Blog&quot;&gt;17css-青色's Blog&lt;/a&gt;}}}

而在 Firfox 浏览器中则相对比较容易，直接给标签 a 定义样式 outline:none; 就可以了，即：
&gt;{{{.HideFocus {outline:none;}
}}}

''方法二''
也可以使用''CSS expression''来控制，但''不推荐''使用，毕竟expression在''性能''上有问题。
&gt;{{{.HideFocus {
hide-focus: expression(this.hideFocus=true);  /* for ie 5+ */}}}
&gt;{{{outline: none;  /* for firefox 1.5 + */
}
}}}
除链接外，该CSS同样适用于input和button标签。(''注：''这里的hide-focus是自己随便取的名字)

''方法三''
将以下代码保存为link.htc文件：
&gt;&lt;public:attach event=&quot;onfocus&quot; onevent=&quot;hscfsy()&quot;/&gt;
&gt;&lt;script language=&quot;javascript&quot;&gt;
&gt;function hscfsy(){
&gt;this.blur();
&gt;}
&gt;&lt;/script&gt;

链接样式中加入：
&gt;a {
&gt;behavior:url(link.htc);
&gt;}

IE中已经没有问题，但是在FF中虚线框依然存在。再增加一条样式定义来解决此问题：
&gt;a:focus {
&gt;outline:0;
&gt;}
这样IE、FF中虚线都不存在了。

''方法四''
通过JavaScript遍历实现
&gt;window.onload=function()
&gt;{
&gt;for(var ii=0; ii document.links$[$ii$]$.onfocus = function(){this.blur()}
&gt;}
''注：''暂时不懂 ==!</pre>
</div>
<div title="参考资源" modifier="wy" created="201011261052" changecount="1">
<pre>*[[cplusplus|http://www.cplusplus.com/doc/tutorial/]]绝对是个好地方啊，东西写得''简洁''、''清楚''</pre>
</div>
<div title="双重指针" modifier="wy" created="200908070206" tags="指针" changecount="1">
<pre>一句话就是指针的指针
具体见[[这里|http://forum.byr.edu.cn/wForum/elite.php?file=%2Fgroups%2Fsci.faq%2FCPP%2FC%2Fpointer%2FM.1207279974.b0]]</pre>
</div>
<div title="变量在内存中存储结构" modifier="wy" created="200904100229" modified="200904100246" tags="C memory zz" changecount="12">
<pre>''source:''[[here|http://songfei.org/blog/2008/12/30/%E5%8F%98%E9%87%8F%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/]]
小程序测试：
{{#include &lt;stdio.h&gt;

int g=1;

int fun()
{
    int a=2,b=3;
    printf(&quot;In Function fun()\n&quot;);
    printf(&quot;&amp;a=%p\n&amp;b=%p\n&quot;,&amp;a,&amp;b);
    printf(&quot;\n&quot;);
}
 
int main(int argc, char *argv[])
{
    int a=4,b=5,c=6,d=7;
    static f=8;
    printf(&quot;&amp;g=%p\n&amp;d=%p\n&quot;,&amp;g,&amp;d);
    printf(&quot;\n&quot;);
    fun();
    printf(&quot;In Function main()\n&quot;);
    printf(&quot;&amp;a=%p\n&amp;b=%p\n&amp;c=%p\n&amp;d=%p\n&quot;,&amp;a,&amp;b,&amp;c,&amp;d);
    printf(&quot;\n&quot;);
    fun();
    printf(&quot;a=%d\nb=%d\n&quot;,a,b);
    printf(&quot;*(&amp;b+1)=%d\n&quot;,*(&amp;b+1));
    return 0;
}

运行结果如下：

$ ./main
&amp;g=0x80497fc
&amp;d=0xbfd0b994
 
In Function fun()
&amp;a=0xbfd0b974
&amp;b=0xbfd0b970
 
In Function main()
&amp;a=0xbfd0b9a0
&amp;b=0xbfd0b99c
&amp;c=0xbfd0b998
&amp;d=0xbfd0b994
 
In Function fun()
&amp;a=0xbfd0b974
&amp;b=0xbfd0b970
 
a=4
b=5
{{*(&amp;b+1)=4

这里看到了在main()函数中定义的普通变量(auto)在内存中是在栈中存放的

看到了它的地址是倒序的，越先定义的变量，内存地址越在后面

在函数中定义的局部变量在函数执行完后就释放了

所以两次调用fun()分配的变量地址是一样的

更多的资料，参考《unix环境高级编程》里面说：

C程序的存储空间布局

由于历史原因，C程序一直由下列几部分组成：
''正文段''
      这是由CPU执行的机器指令部分。通常，正文段是可共享的，所以即使是经常执行的程序(如文本编辑程序、C编译程序、shell等)在存储器中也只需有一个副本，另外，正文段常常是只读的，以防止程序由于意外事故而修改其自身的指令。

''初始化数据段''
      通常将此段称为数据段，它包含了程序中需赋初值的变量。例如， C程序中任何函数之外的说明：int maxcount = 99;使此变量以初值存放在初始化数据段中。

''非初始化数据段''
      通常将此段称为bss段，这一名称来源于早期汇编程序的一个操作符，意思是“block started by symbol（由符号开始的块）”，在程序开始执行之前，内核将此段初始化为0。函数外的说明：
      long sum[1000] ;使此变量存放在非初始化数据段中。

''栈''
      自动变量以及每次函数调用时所需保存的信息都存放在此段中。每次函数调用时，
      其返回地址、以及调用者的环境信息（例如某些机器寄存器）都存放在栈中。然后，新被调用的函数在栈上为其自动和临时变量分配存储空间。通过以这种方式使用栈， C函数可以递归调用。

''堆''
      通常在堆中进行动态存储分配。由于历史上形成的惯例，堆位于非初始化数据段顶
      和栈底之间。

[img[memory|http://songfei.org/blog/wp-content/uploads/2008/12/memory.gif]]

图中显示了这些段的一种典型安排方式。这是程序的逻辑布局—虽然并不要求一个具体实现一定以这种方式安排其存储空间。</pre>
</div>
<div title="合并排序(merge sort)" modifier="wy" created="200908291620" changecount="1">
<pre>!!!非递归版本
参见《数据结构与算法&lt;交大版&gt;》上的解释
&gt;''关键''：不断增加步长，直至超过整个序列；
&gt;''易错''：
&gt;&gt;''边界问题''：如果最后长度不足一个步长(begin+step&gt;=size)，无法分成两段，那么跳过，作为总会解决的
&gt;&gt;''合并序列''：始终当心边界问题(还是)
代码见这里：[[代码发芽网|http://fayaa.com/code/view/5241/]]</pre>
</div>
<div title="图像处理" modifier="teloon" created="201006101713" modified="201006101736" changecount="3">
<pre>这里的一些讨论：[[C++ - making a graph|http://www.edaboard.com/ftopic95823.html]]，有

!!!画图(plot)
*gnuplot：
&gt;Linux：[[使用''popen''调用|http://coding.derkeiler.com/Archive/C_CPP/comp.lang.cpp/2003-10/4656.html]]
&gt;Windows(Visual studio)：编译，见[[Compiling gnuplot 4.1(CVS) for windows with Visual Studio/MinGW32|http://thinkingfish.wordpress.com/2006/02/09/compiling-gnuplot-41cvs-for-windows-with-visual-studio-2003but-not-full-featured/]]
*Octave：类似Matlab的开源程序
&gt;visual studio集成：下载Windows安装包（[[这里|http://www.math.sfu.ca/~cbm/ta/octave.html]]），再看[[这里|http://octave.1599824.n4.nabble.com/How-to-use-Octave-with-Visual-Studio-2008-td1633294.html]]的讨论
&gt;这里有介绍如何在C\C++中使用：[[howto-octave-c++.ps|http://www.mathias-michel.de/download/howto-octave-c++.ps]]
*[[CGRAPH|http://www.codeguru.com/Cpp/controls/controls/chartingandanaloguecontrols/article.php/c2211/]]：貌似功能不全
&gt;一些语法介绍：[[Octave：矩阵计算的新宠|http://icl.pku.edu.cn/member/yujs/BSDFiles/html/octave.html]]

!!!图像处理
*介绍：
&gt;''imagemagick++'', ''cimg'', ''opencv''：http://mail.ustc.edu.cn/~ahbi/faq.htm
*一些资源
&gt;[[freeprogrammingresources|http://www.freeprogrammingresources.com/imglib.html]]</pre>
</div>
<div title="如何上twitter" modifier="wy" created="201008190417" modified="201008190418" changecount="2">
<pre>*挂代理（GAppEngine，FreeGate等）上首页
*八哥
*官方API，见OneNote中Google App Engine那节
*自写程序，利用第三方API
**[[twitter4j|http://twitter4j.org/en/index.html]]
</pre>
</div>
<div title="如何查找命令的源码" modifier="wy" created="200907241051" modified="200907241110" tags="源码" changecount="2">
<pre>''SRC''：[[here|http://www.unixresources.net/linux/clf/program/archive/00/00/69/38/693804.html]]

1）先查在哪个包，比如Ubuntu下查命令ftp：

&gt;''$ls -l /usr/bin/ftp''
&gt;{{{.../usr/bin/ftp -&gt; /etc/alternatives/ftp}}}

&gt;''$ls -l /etc/alternatives/ftp''
&gt;{{{.../etc/alternatives/ftp -&gt; /usr/bin/netkit-ftp}}}

&gt;''$dpkg -S /usr/bin/netkit-ftp''
&gt;{{{ftp: /usr/bin/netkit-ftp}}}

2）知道了在ftp包里，用apt-get下源码到~目录
&gt;''$apt-get source ftp ''

3) 下载下来后进入目录，用下面命令来查找需要的文件
&gt;''find . -name &quot;COMMAND&quot;''</pre>
</div>
<div title="字符串匹配" modifier="wy" created="200908271303" changecount="1">
<pre>有BF、KMP、BM算法，具体有篇文论比较的
BM算法最为高效和简单，具体实现见AlgorithmGossip
思路：构建一个大小为256的ASCII字符前进表，失配时查找前进表，得到前进的距离。</pre>
</div>
<div title="实时同步小文件" modifier="wy" created="201103020504" modified="201111040513" changecount="2">
<pre>*lsyncd工具
参考张教主的[[文章|http://42qu.com/zuroc/note/12/txt/618]]
*Hash Tree的思想
参照[[大量小文件的实时同步方案|http://blog.daviesliu.net/2008/04/24/sync/]]
文件系统本省就是个树状结构
&gt;''不停地获取根目录的修改时间并顺着目录结构往下找即可''</pre>
</div>
<div title="寻找单个数" modifier="wy" created="200909190627" changecount="1">
<pre>原题见[[YSSY|http://bbs.sjtu.edu.cn/bbstcon,board,C,reid,1253289638.html]]
最后可以扩展到m*n+1规模，方法有三种：
1、partition select
&gt;参照快速排序，任意找一个pivot，删除与pivot相同的点(如果没有，那么pivot就是要找的点)，同时小于pivot的都放在pivot左边，大于pivot的放右边，这样最后左边或右边的长度一个模m为0，另一个模m为1，去掉模m为0的那边；对另一边继续相同的过程；
2、巧妙的位运算
&gt;画出真值表，或状态转换图，构造位转换过程，详见[[这个帖子|http://bbs.sjtu.edu.cn/bbscon,board,C,file,M.1252853693.A.html]]
3、参照m=2的情况，只不过在做位加法的时候用m进制来算
&gt;详见[[这个帖子|http://bbs.sjtu.edu.cn/bbscon,board,C,file,M.1253026038.A.html]]

全部的讨论见这个帖子的讨论：[[3n+1个数，除了一个数都是三个一组出现|http://bbs.sjtu.edu.cn/bbstcon?board=C&amp;reid=1252759776&amp;file=M.1252759776.A&amp;page=1]](2009.09.12,可能会被合集)</pre>
</div>
<div title="工具讨论" modifier="wy" created="200908121038" modified="200908121040" tags="profile 工具" changecount="3">
<pre>同主题阅读：大家都用什么工具来profile C/C++程序
[版面:葵花宝典] [首篇作者：JasonTsai] , 2009年04月29日00:32:37
[分页:1 ]
	JasonTsai
进入未名形象秀
	我的博客
		
	[ 1 ]

发信人: JasonTsai (Jason), 信区: Programming
标 题: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Wed Apr 29 00:32:37 2009)

最近需要分析一个程序的性能瓶颈，所以需要profile这个程序，分析每个function里
花的时间
以前没怎么弄过，请教大家什么工具最方便易用而且准确？gprof如何？

先谢过各位猛将～
--

※ 来源:·WWW 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 70.240.]
	
	[ 2 ]

发信人: TaiYouCai (有才), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Wed Apr 29 10:20:26 2009), 转信

aqtime

【 在 JasonTsai (Jason) 的大作中提到: 】
: 最近需要分析一个程序的性能瓶颈，所以需要profile这个程序，分析每个function里
: 花的时间
: 以前没怎么弄过，请教大家什么工具最方便易用而且准确？gprof如何？
: 先谢过各位猛将～

--

※ 来源:·BBS 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 38.106.]
		
	[ 3 ]

发信人: wdong (cybra), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Wed Apr 29 14:30:34 2009), 转信

gprof对C++基本失效。我以前用过vtune，基本达到目的。不知道aqtime怎么样。

【 在 JasonTsai (Jason) 的大作中提到: 】
: 最近需要分析一个程序的性能瓶颈，所以需要profile这个程序，分析每个function里
: 花的时间
: 以前没怎么弄过，请教大家什么工具最方便易用而且准确？gprof如何？
: 先谢过各位猛将～

--

※ 来源:·BBS 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 128.112.]
	
		
	[ 4 ]

发信人: hubai (泡饭VIII号), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Wed Apr 29 23:23:25 2009)

google profiler
【 在 JasonTsai (Jason) 的大作中提到: 】
: 最近需要分析一个程序的性能瓶颈，所以需要profile这个程序，分析每个function里
: 花的时间
: 以前没怎么弄过，请教大家什么工具最方便易用而且准确？gprof如何？
: 先谢过各位猛将～

--

※ 来源:·WWW 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 97.90.]
	
		
	[ 5 ]

发信人: mlwei (pumpkin), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Fri May 1 00:00:51 2009)

To find which function is using most of the time (hot functions) use gprof.
It'll create a trace file and you can use gprof to generate a report later
on.

For a particular hot function, if you'd like to know whether it is spending
time on memory / floating point or integer instructions, use intel VTune.

If most of the time is spent in memory instructions, cache optimizations are
important (tiling, prefetching).

If there are a lot of floating point instructions, compiling it to 64 bit
binary could help, because that'll allow the processor to use SSE registers
for your your code.

If the code is computationally intensive, you may consider some SIMDization.


【 在 JasonTsai (Jason) 的大作中提到: 】
: 最近需要分析一个程序的性能瓶颈，所以需要profile这个程序，分析每个function里
: 花的时间
: 以前没怎么弄过，请教大家什么工具最方便易用而且准确？gprof如何？
: 先谢过各位猛将～

--

※ 来源:·WWW 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 98.234.]
	
		
	[ 6 ]

发信人: JasonTsai (Jason), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Fri May 1 00:04:15 2009)

Thanks a million!

【 在 mlwei (pumpkin) 的大作中提到: 】
: To find which function is using most of the time (hot functions) use gprof
.
: It'll create a trace file and you can use gprof to generate a report later
: on.
: For a particular hot function, if you'd like to know whether it is
spending
: time on memory / floating point or integer instructions, use intel VTune.
: If most of the time is spent in memory instructions, cache optimizations
are
: important (tiling, prefetching).
: If there are a lot of floating point instructions, compiling it to 64 bit
: binary could help, because that'll allow the processor to use SSE
registers
: for your your code.
: ...................

--

※ 来源:·WWW 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 70.240.]

		
	[ 7 ]

发信人: cosmo2003 (cosmo2003), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Fri May 1 02:44:33 2009)

If using Mac, I found shark to be very useful:

http://developer.apple.com/tools/sharkoptimize.html

【 在 JasonTsai (Jason) 的大作中提到: 】
: 最近需要分析一个程序的性能瓶颈，所以需要profile这个程序，分析每个function里
: 花的时间
: 以前没怎么弄过，请教大家什么工具最方便易用而且准确？gprof如何？
: 先谢过各位猛将～

--

※ 来源:·WWW 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 128.12.]
	
		
	[ 8 ]

发信人: thrust (祝阳阳早日康复), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Fri May 1 13:51:47 2009)

You don't really need 64-bit to enable SSE/2/3. gcc have separate option for
this. 64-bit just enable them by default (as it's also required by ABI).
【 在 mlwei (pumpkin) 的大作中提到: 】
: To find which function is using most of the time (hot functions) use gprof
.
: It'll create a trace file and you can use gprof to generate a report later
: on.
: For a particular hot function, if you'd like to know whether it is
spending
: time on memory / floating point or integer instructions, use intel VTune.
: If most of the time is spent in memory instructions, cache optimizations
are
: important (tiling, prefetching).
: If there are a lot of floating point instructions, compiling it to 64 bit
: binary could help, because that'll allow the processor to use SSE
registers
: for your your code.
: ...................

--

※ 来源:·WWW 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 76.234.]
	
		
	[ 9 ]

发信人: mlwei (pumpkin), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Fri May 1 14:26:55 2009)


【 在 thrust (祝阳阳早日康复) 的大作中提到: 】
: You don't really need 64-bit to enable SSE/2/3. gcc have separate option
for
: this. 64-bit just enable them by default (as it's also required by ABI).

Thanks. good to know


: .
: spending
: are
: registers

--

※ 来源:·WWW 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 216.239.]
	
		
	[ 10 ]

发信人: zhangfei (Leo Kamis), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Sat May 2 12:46:16 2009), 转信

To be frank, this is one most difficult problem.

If in windows platform:
- If it is Intel CPU, intel vtune.
- If it is AMD CPU, AMD's free profiler (forgot the name, codeanalyst?)
- Microsoft's free kernrate tool

If it is windows platform, IO limited or problem is not in your own code (
like
graphic driver problem).
- use system internal's process explorer profiler, give u call stacks.

If it is in Linux
- oprofile
- valgrid?

If you are almost sure where is your problem.
- just use -- timerstart(), ..., timerend(), printf().
in windows, it is queryperformancecounter() and queryperformancefrequency
()


Good luck

【 在 JasonTsai (Jason) 的大作中提到: 】
: 最近需要分析一个程序的性能瓶颈，所以需要profile这个程序，分析每个function里
: 花的时间
: 以前没怎么弄过，请教大家什么工具最方便易用而且准确？gprof如何？
: 先谢过各位猛将～

--

※ 来源:·BBS 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 71.112.]
 
	
		
	[ 11 ]

发信人: shaoyi (一休), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Sun May 31 01:30:42 2009)

xperf非常好，你可以试试。
不过想要profile memory，基本没戏。。。
【 在 JasonTsai (Jason) 的大作中提到: 】
: 最近需要分析一个程序的性能瓶颈，所以需要profile这个程序，分析每个function里
: 花的时间
: 以前没怎么弄过，请教大家什么工具最方便易用而且准确？gprof如何？
: 先谢过各位猛将～

--

※ 来源:·WWW 未名空间站 海外: mitbbs.com 中国: mitbbs.cn·[FROM: 71.231.]
	
		
	[ 12 ]

发信人: cuixue (我是勤劳勇敢聪明熊), 信区: Programming
标 题: Re: 大家都用什么工具来profile C/C++程序
发信站: BBS 未名空间站 (Sun May 31 18:46:14 2009)

On windows, XPerf is also a very good tool.
【 在 zhangfei (Leo Kamis) 的大作中提到: 】
: To be frank, this is one most difficult problem.
: If in windows platform:
: - If it is Intel CPU, intel vtune.
: - If it is AMD CPU, AMD's free profiler (forgot the name, codeanalyst?)
: - Microsoft's free kernrate tool
: If it is windows platform, IO limited or problem is not in your own code (
: like
: graphic driver problem).
: - use system internal's process explorer profiler, give u call stacks.
: If it is in Linux
: ...................</pre>
</div>
<div title="心得" modifier="YourName" created="200908301319" modified="200909011432" changecount="5">
<pre>*算法中的''折半''
在很多算法中都会用到''折半''（或者叫二分）这个技巧，和所有算法一样，在实现时的一个难点就是边界问题。在折半中，low和high的值不断接近，最终不满足''low&lt;=high''（注意@@color(red):有等于@@）的条件，但是跳出循环后，最后定位到的点到底是最后的low的值还是最后high的值呢？
在不满足''low&lt;=high''，即low&gt;high的前一瞬间，low=high，mid=(low+high)/2=low=high，然后分两种情况讨论：（下面假设最终要的是递增序列）
&gt;1、''arr[mid]&gt;value''，则high=mid-1，跳出循环；此时，二分查找的位置就应该在low那个位置；
&gt;2、''arr[mid]&lt;value''，则low=mid+1，跳出循环；此时，二分查找的位置还是应该在low那个位置；
&gt;&gt;需要注意的是：1、这里说的''查找的位置''，指的是第一个不满足有序的点的位置，将点插入那个位置之前要把那个位置以后(@@color(red):包括那个位置@@)的点都往后移一位；(如果你的''“查找的位置”''的定义不同，那也许就不是low，而是high了)2、递减序列也是同理的
&gt;&gt;&gt;具体代码见这里：[[代码发芽网|http://fayaa.com/code/view/5374/]]
*''while循环''
很多算法都涉及循环过程，特别是回溯法。一般，在while的条件里写上最终''跳出循环的条件''，而在while循环体中，每次循环''只做一步''，按照这个思路写的话会顺畅很多。例子如皇后算法，见[[代码发芽网|http://fayaa.com/code/view/5441/]]</pre>
</div>
<div title="快速排序" modifier="wy" created="200908210346" modified="200908310835" changecount="6">
<pre>快速排序根据''参照点不同''主要有三类，一个是总是以''最左边的点''为参照；另一个是总是以''中间点''为参照；第三类是总是以''最右边的点''为参照点（和第一个类似）；根据''指针移动的方向''可以分为两类：一个是''相向''的，即面对面的；另一个是''同一方向的''；（具体见Algorithm Gossip）

这类问题(排序)，特别是递归的时候，最麻烦的就是''边界问题''：
*以最左边的点为参照（相向）
&gt;由于有可能所有右边的点''都小于''参照，那么在++的时候就会数组越界，所以在left和right指针不断++（或{{{--}}}）之前''要判断是否越界''
*以中间点为参照（相向）
&gt;用一个''中间变量保存参照''，所以‘’参照点加入排序‘’。也正因为如此，left和right指针在比较时不会越界，最终肯定会在参照点&quot;相会&quot;；（具体见Algorithm Gossip）&lt;位置指针加减的位置还是很有讲究的，写一遍就知道了&gt;
*同向移动
&gt;由于同向移动时是顺序遍历，所以''边界很好控制''，推荐使用。（具体见Algorithm Gossip）</pre>
</div>
<div title="挂载大于2T硬盘" modifier="wy" created="201103071032" modified="201111040527" changecount="12">
<pre>&lt;&lt;&lt;
because of the limitations of MBR partition tables, which restrict a disk partition's size to a maximum of 2.19 TB (2.19 × 1012 bytes) . GPT allows for a maximum disk and partition size of 9.4 ZB (9.4 × 1021 bytes) .(参考[[wikipedia|http://en.wikipedia.org/wiki/GUID_Partition_Table]])
&lt;&lt;&lt;
&lt;code bash&gt;
[root@localhost ~]# parted /dev/sdb
&lt;parted&gt; mklabel gpt  #这一步是设定你要做的分区的type
&lt;parted&gt; print
&lt;parted&gt;mkpart primary 1 267350 #设置分区容量,单位是M
&lt;parted&gt; print
&lt;parted&gt; quit
[root@localhost ~]# mkfs.ext3 /dev/sdb1
[root@localhost ~]# mount /dev/sdb1 /mnt/xxx
[root@localhost ~]# df -h
&lt;/code&gt;
*Ref
#[[parted管理分区|http://www.turbolinux.com.cn/turbo/wiki/doku.php?id=%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86:parted]]
#[[Linux支持大于2T硬盘总结|http://www.stwind.org/zzchm2/0827.html]]</pre>
</div>
<div title="排序" modifier="wy" created="200908291608" changecount="1">
<pre>[[快速排序]]
[[合并排序(merge sort)]]</pre>
</div>
<div title="推荐安装的软件" modifier="wy" created="201007160333" changecount="1">
<pre>参考一：[[Windows平台|http://sunxiunan.com/?p=1543]]
1，[[WinMerge|http://winmerge.org/]]
2，[[Sysinternals|http://technet.microsoft.com/en-us/sysinternals/default.aspx]]套件，windows开发必备。
3，[[Windbg|http://www.microsoft.com/whdc/Devtools/Debugging/default.mspx]]，windows调试必备。
4，[[Debug Diagnostic Tool|http://www.microsoft.com/downloadS/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&amp;displaylang=en]]，检查memory leak很好用。
5，[[bitnami stacks|http://bitnami.org/stacks]]，如果你搞什么php，ruby，python，mysql之类的web开发，这里面的集成安装包必有一款适合你。不想安装的还可以下载 vmware镜像文件。
6，[[VNC|http://portableapps.com/apps/utilities/teamviewer_portable]]类的软件
7，Picpick，抓屏软件，非常推荐。
8，版本管理工具，可以用subversion或者[[git|http://github.com/guides/using-git-and-github-for-the-windows-for-newbies]]。github算是个不错的选择。我经常把小代码片段贴到gist中。其中 [[visualsvn|http://www.visualsvn.com/]]有免费服务器程序下载。
9，网络相关开发，可以下载抓包工具[[wireshark|http://www.wireshark.org/]]（原名ethereal）。http也可以试试这个Fiddler
10，VMWare虚拟机，最好搞一个，里面装上Debian，玩玩Linux，另外装个干净的windowsXP，压缩起来备用，测试中经常会用到。</pre>
</div>
<div title="播放器可以解码、但停止不动的解决方案" modifier="teloon" created="200902211033" changecount="1">
<pre>安装w32codecs后，理论上就可以播放大部分格式的影片了，但是如果碰到如题的问题，可按照如下步骤解决：
#在中断下播放，查看输出信息
&gt;mplayer *.rmvb 
#针对错误，进行处理。比如我输出的信息其中有一段是：
&gt;Opening audio decoder: [faad] AAC (MPEG2/4 Advanced Audio Coding)
&gt;FAAD: compressed input bitrate missing, assuming 128kbit/s!
    所以，问题处在音频输出上。
#验证问题。此处验证是否是处在audio上，运行
&gt;mplayer *.rmvb -nosound
    结果，电影就能正常播放了，说明问题就是处在音频输出上
#运行一下命令，查看可用的音频输出
&gt;mplayer *.rmvb -ao help
    输出的结果是：
&gt;Available audio output drivers:
&gt;	oss	OSS/ioctl audio output
&gt;	alsa	ALSA-0.9.x-1.x audio output
&gt;	arts	aRts audio output
&gt;	esd	EsounD audio output
&gt;	pulse	PulseAudio audio output
&gt;	jack	JACK audio output
&gt;	nas	NAS audio output
&gt;	sdl	SDLlib audio output
&gt;	openal	OpenAL audio output
&gt;	mpegpes	DVB audio output
&gt;	v4l2	V4L2 MPEG Audio Decoder output
&gt;	null	Null audio output
&gt;	pcm	RAW PCM/WAVE file writer audio output
#一个个尝试，更改mplayer的音频输出(我是在它的图形界面上该的)，最终设为alsa能正常播放了。

Linux下很多问题都能按照这个思路解决。调式，查看信息，控制变量等等都是很有用的方法。</pre>
</div>
<div title="数据库大作业" modifier="wy" created="200908121316" modified="200908121815" changecount="2">
<pre>!!!Index Layer设计
主要有两部分：Heap File和B＋树
Heap File是用来保存record的结构(具体为什么叫heap还有待发掘)，即保存数据库内容的地方

关于heap file可能是这么理解的，我这层维护一个heapfile的结构，里面保存的是record的信息和内容，对record的读和写由heapfile这一层转发，变成对相关page的读和写，我只要传给你tableID(文件名)和pageID(page号)。
总结来看就是
插入：读取上次写的page，看能都装的下，是则跟新page内容并写回，否则向storage申请新页并写回 -&gt; 在B+树中插入新节点，内容是PageID和RID(page中的偏移)
查找：根据B+树查找RID(page中的偏移)和PID ---&gt; 从B+树跟节点取得TableID，和PageID一起向storage读取page  ---&gt;根据RID读到record的内容</pre>
</div>
<div title="数据恢复软件" modifier="YourName" created="201105110241" modified="201105110242" changecount="2">
<pre>windows下参照：[[六款主流数据恢复软件（绿色版）下载|http://hi.baidu.com/zhaodx/blog/item/bad20f46203f08086b63e558.html]]，但恢复前可先用Everything扫一下文件是不是真的删掉了。</pre>
</div>
<div title="文件操作方法" modifier="wy" created="200908180349" modified="200910171506" tags="CPP 文件IO" changecount="9">
<pre>参考：[[这里|http://kangyunqiang.blog.51cto.com/674292/145969]]
1、linux系统函数调用（待测试）：
&gt;{{{int fd = open(&quot;file.txt&quot;, O_RDONLY);}}}
&gt;{{{int i=read(fd, buf, length);}}}
&gt;{{{另：open需要include  &lt;sys/types.h&gt;  &lt;sys/stat.h&gt;  &lt;fcntl.h&gt; ， 而read,write只需要#include   &lt;unistd.h&gt;就行了}}}

2、ANSI C的stdio.h中定义的结构(流式)
&gt;用{{{FILE *fp}}}来定义一个流，以后的操作就都可以在这个流“对象”上了
&gt;{{{fputs(&quot;string&quot; ,fp);}}}
&gt;{{{fgets(buf, len,fp);}}}
&gt;{{{fread(buf,  size, n, fp);}}}
&gt;{{{fwrite(buf,  size, n, fp);}}}
&gt;其他见cplusplus的[[文档|http://www.cplusplus.com/reference/clibrary/cstdio/fgets/]]，它有针对文件和标准输入输出的两套API，但是基本类似

3、CPP的stream类
&gt;打开：{{{fstream file;  file.open(&quot;filename&quot;, ios::in|ios::binary,0)}}}
&gt;文本读写：
&gt;&gt;用流操作符号，还可以格式化{{{file2&lt;&lt;&quot;I Love You&quot;;    file1&lt;&lt;setprecision(5)&lt;&lt;3.1415926}}}
&gt;&gt;读取行：{{{std::getline(file, str)}}}，或者{{{file.getline(charArr, arrLen);}}}；总结见[[这里|http://www.cnblogs.com/JCSU/articles/1190685.html]]
&gt;按字节读：
&gt;&gt;1、一个字节：{{{file.get(); file.put('c');}}}
&gt;&gt;2、多个：{{{file.read(buf,  num);  file.write(buf,  num);}}}
&gt;''注意''：
&gt;&gt;考虑''缓存''，及时''flush''，或者''close''即可。
&gt;&gt;eof的问题，具体见[[这里|http://www.daniweb.com/forums/post155265-18.html]]和[[这里|http://www.daniweb.com/forums/thread159024.html]]；但在VS2008上试了下没问题，不过还是尽量别用eof来判断结束</pre>
</div>
<div title="最小代价生成树" modifier="wy" created="200908281157" modified="200908281504" changecount="6">
<pre>两种方法：
1、''prim''算法
&gt;考虑''点''
&gt;''维护的数据结构''：所有边(edge[NUM*NUM])，已取得的点(u)，待取的点(v)，v中每个点到u的最短距离值(closest[])，每次取得的最小边的值(value)
&gt;''初始情况''：任取一个点
&gt;''演算''：有closest得到最小边(从v到u)的值 -&gt; 将点x从v中取出，放到u中  -&gt; 更新在v中与x有关的点的closest值
&gt;''适用''：稠密图

2、''kruscal''算法
&gt;''考虑边''
&gt;''维护的数据结构''：边(edge struct&lt;x,y,weight&gt;)，边的集合(以边的weight排序的multimap)，DisjointSet类(判断回边)，保存结果(vector按顺序保存)
&gt;''初始情况''：无
&gt;''演算''：不断从multimap中得到最小边，判断是否是回边(DisjointSet结构，用root来代表同一连通分量)，加入result或舍弃
&gt;''适用''：稀疏图
&gt;其他：DisjointSet的简易结构见[[这里|http://www.cppblog.com/lzmagic/archive/2009/04/10/79542.html]]

两者代码见这里：[[代码发芽网|http://fayaa.com/code/view/5310/#]]或者[[githup|http://gist.github.com/176973]]（这两个都是贴代码的地方）</pre>
</div>
<div title="杂记" modifier="wy" created="200908100746" modified="200908191236" changecount="3">
<pre>!!!STL
对于map、set等不允许有重复key或元素的容器来说，insert操作如果遇到重复的，则是''不做任何操作''，而''不是覆盖''

!!!IO
#''cin.get(char*, num);'' 读到num个字符或换行符，如果读到换行符，那么这个''换行符还留在输入buffer''中，用cin.ignore函数去除（见[[这里|http://www.java-samples.com/showtutorial.php?tutorialid=455]]）；如果遇到流错误(failbit或badbit)，那在''ignore之前''，必须''先恢复流''，因为ignore只在流正常的时候忽略字符，见[[这里|http://www.daniweb.com/forums/thread212120.html]]</pre>
</div>
<div title="格式化sprintf" modifier="wy" created="200904131216" modified="200904131222" tags="sprintf" changecount="7">
<pre>''Source:''  [[here|http://blog.chinaitlab.com/html/21/318121-176176.html]]

!!一、格式化数字字符串
sprintf 最常见的应用之一莫过于把整数打印到字符串中，所以，spritnf 在大多数场合可以替代itoa。

如：
//把整数123 打印成一个字符串保存在s 中。
sprintf(s, &quot;%d&quot;, 123); //产生&quot;123&quot;可以指定宽度，不足的左边补空格：
sprintf(s, &quot;%8d,%8d&quot;, 123, 4567); //产生：&quot; {{{     123,    4567}}}&quot;当然也可以左对齐：
sprintf(s, &quot;%-8d,%8d&quot;, 123, 4567); //产生：&quot;{{{123     ,    4567}}}&quot;

也可以按照16 进制打印：
sprintf(s, &quot;%8x&quot;, 4567); //小写16 进制，宽度占8 个位置，右对齐
sprintf(s, &quot;%-8X&quot;, 4568); //大写16 进制，宽度占8 个位置，左对齐

这样，一个整数的16 进制字符串就很容易得到，但我们在打印16 进制内容时，通常想要一种左边补0 的等宽格式，那该怎么做呢？很简单，在表示宽度的数字前面加个0 就可以了。
sprintf(s, &quot;%08X&quot;, 4567); //产生：&quot;000011D7&quot;
上面以&quot;%d&quot;进行的10 进制打印同样也可以使用这种左边补0 的方式。


这里要注意一个符号扩展的问题：比如，假如我们想打印短整数（short）-1 的内存16 进制表示形式，在Win32 平台上，一个short 型占2 个字节，所以我们自然希望用4 个16 进制数字来打印它：
short si = -1;
sprintf(s, &quot;%04X&quot;, si);
产 生&quot;FFFFFFFF&quot;，怎么回事？因为spritnf 是个变参函数，除了前面两个参数之外，后面的参数都不是类型安全的，函数更没有办法仅仅通过一个&quot;%X&quot;就能得知当初函数调用前参数压栈时被压进来的到底 是个4 字节的整数还是个2 字节的短整数，所以采取了统一4 字节的处理方式，导致参数压栈时做了符号扩展，扩展成了32 位的整数-1，打印时4 个位置不够了，就把32 位整数-1 的8 位16 进制都打印出来了。

如果你想看si 的本来面目，那么就应该让编译器做0 扩展而不是符号扩展（扩展时二进制左边补0 而不是补符号位）：
sprintf(s, &quot;%04X&quot;, (unsigned short)si);
就可以了。或者：
unsigned short si = -1;
sprintf(s, &quot;%04X&quot;, si);

sprintf 和printf 还可以按8 进制打印整数字符串，使用&quot;%o&quot;。注意8 进制和16 进制都不会打
印出负数，都是无符号的，实际上也就是变量的内部编码的直接的16 进制或8 进制表示。

!!二、控制浮点数打印格式

浮点数的打印和格式控制是sprintf 的又一大常用功能，浮点数使用格式符&quot;%f&quot;控制，默认保
留小数点后6 位数字，比如：
sprintf(s, &quot;%f&quot;, 3.1415926); //产生&quot;3.141593&quot;
但有时我们希望自己控制打印的宽度和小数位数，这时就应该使用：&quot;%m.nf&quot;格式，其中m 表
示打印的宽度，n 表示小数点后的位数。比如：
sprintf(s, &quot;%10.3f&quot;, 3.1415626); //产生：&quot; 3.142&quot;
sprintf(s, &quot;%-10.3f&quot;, 3.1415626); //产生：&quot;3.142 &quot;
sprintf(s, &quot;%.3f&quot;, 3.1415626); //不指定总宽度，产生：&quot;3.142&quot;

注意一个问题，你猜
int i = 100;
sprintf(s, &quot;%.2f&quot;, i);
会打出什么东东来？&quot;100.00&quot;？对吗？自己试试就知道了，同时也试试下面这个：
sprintf(s, &quot;%.2f&quot;, (double)i);
第一个打出来的肯定不是正确结果，原因跟前面提到的一样，参数压栈时调用者并不知道跟i相对应的格式控制符是个&quot;%f&quot;。而函数执行时函数本身则并不知道当年被压入栈里的是个整数，于是可怜的保存整数i 的那4 个字节就被不由分说地强行作为浮点数格式来解释了，整个乱套了。不过，如果有人有兴趣使用手工编码一个浮点数，那么倒可以使用这种方法来检验一下你手工编排的结果是否正确。

!!三、字符
/Ascii
码对照

我们知道，在C/C++语言中，char 也是一种普通的scalable 类型，除了字长之外，它与short，int，long 这些类型没有本质区别，只不过被大家习惯用来表示字符和字符串而已。（或许当年该把这个类型叫做&quot;byte&quot;，然后现在就可以根据实际情况，使用byte 或short 来把char 通过typedef 定义出来，这样更合适些）于是，使用&quot;%d&quot;或者&quot;%x&quot;打印一个字符，便能得出它的10 进制或16 进制的ASCII 码；反过来，使用&quot;%c&quot;打印一个整数，便可以看到它所对应的ASCII 字符。以下程序段把所有可见字符的ASCII 码对照表打印到屏幕上（这里采用printf，注意&quot;#&quot;与&quot;%X&quot;合用时自动为16 进制数增加&quot;0X&quot;前缀）：
for(int i = 32; i &lt; 127; i++) {
printf(&quot;[ %c ]: %3d 0x%#04X\n&quot;, i, i, i);
}

!!四、连接字符串

sprintf 的格式控制串中既然可以插入各种东西，并最终把它们&quot;连成一串&quot;，自然也就能够连接字符串，从而在许多场合可以替代strcat，但sprintf 能够一次连接多个字符串（自然也可以同时在它们中间插入别的内容，总之非常灵活）。比如：
char* who = &quot;I&quot;;
char* whom = &quot;CSDN&quot;;
sprintf(s, &quot;%s love %s.&quot;, who, whom); //产生：&quot;I love CSDN. &quot;
strcat 只能连接字符串（一段以&quot;结尾的字符数组或叫做字符缓冲，null-terminated-string），但有时我们有两段字符缓冲区，他们并不是以 &quot;结尾。比如许多从第三方库函数中返回的字符数组，从硬件或者网络传输中读进来的字符流，它们未必每一段字符序列后面都有个相应的&quot;来结尾。如果直接 连接，不管是sprintf 还是strcat 肯定会导致非法内存操作，而strncat 也至少要求第一个参数是个null-terminated-string，那该怎么办呢？我们自然会想起前面介绍打印整数和浮点数时可以指定宽度，字符串也一样的。比如：
char a1[] = {'A', 'B', 'C', 'D', 'E', 'F', 'G'};
char a2[] = {'H', 'I', 'J', 'K', 'L', 'M', 'N'};
如果：
sprintf(s, &quot;%s%s&quot;, a1, a2); //Don't do that!
十有八九要出问题了。是否可以改成：
sprintf(s, &quot;%7s%7s&quot;, a1, a2);
也没好到哪儿去，正确的应该是：
sprintf(s, &quot;%.7s%.7s&quot;, a1, a2);//产生：&quot;ABCDEFGHIJKLMN&quot;
这可以类比打印浮点数的&quot;%m.nf&quot;，在&quot;%m.ns&quot;中，m 表示占用宽度（字符串长度不足时补空格，超出了则按照实际宽度打印），n 才表示从相应的字符串中最多取用的字符数。通常在打印字符串时m 没什么大用，还是点号后面的n 用的多。自然，也可以前后都只取部分字符：
sprintf(s, &quot;%.6s%.5s&quot;, a1, a2);//产生：&quot;ABCDEFHIJKL&quot;
在许多时候，我们或许还希望这些格式控制符中用以指定长度信息的数字是动态的，而不是静态指定的，因为许多时候，程序要到运行时才会清楚到底需要取字符数组 中的几个字符，这种动态的宽度/精度设置功能在sprintf 的实现中也被考虑到了，sprintf 采用&quot;*&quot;来占用一个本来需要一个指定宽度或精度的常数数字的位置，同样，而实际的宽度或精度就可以和其它被打印的变量一样被提供出来，于是，上面的例子 可以变成：
sprintf(s, &quot;%.*s%.*s&quot;, 7, a1, 7, a2);
或者：
sprintf(s, &quot;%.*s%.*s&quot;, sizeof(a1), a1, sizeof(a2), a2);
实际上，前面介绍的打印字符、整数、浮点数等都可以动态指定那些常量值，比如：
sprintf(s, &quot;%-*d&quot;, 4, 'A'); //产生&quot;65 &quot;
sprintf(s, &quot;%#0*X&quot;, 8, 128); //产生&quot;0X000080&quot;，&quot;#&quot;产生0X
sprintf(s, &quot;%*.*f&quot;, 10, 2, 3.1415926); //产生&quot; 3.14&quot;

!!五、打印地址信息

有时调试程序时，我们可能想查看某些变量或者成员的地址，由于地址或者指针也不过是个32 位的数，你完全可以使用打印无符号整数的&quot;%u&quot;把他们打印出来：
sprintf(s, &quot;%u&quot;, &amp;i);
不过通常人们还是喜欢使用16 进制而不是10 进制来显示一个地址：
sprintf(s, &quot;%08X&quot;, &amp;i);
然而，这些都是间接的方法，对于地址打印，sprintf 提供了专门的&quot;%p&quot;：
sprintf(s, &quot;%p&quot;, &amp;i);
我觉得它实际上就相当于：
sprintf(s, &quot;%0*x&quot;, 2 * sizeof(void *), &amp;i);
利用sprintf 的返回值
较少有人注意printf/sprintf 函数的返回值，但有时它却是有用的，spritnf 返回了本次函数调用最终打印到字符缓冲区中的字符数目。也就是说每当一次sprinf 调用结束以后，你无须再调用一次strlen 便已经知道了结果字符串的长度。如：int len = sprintf(s, &quot;%d&quot;, i);对于正整数来说，len 便等于整数i 的10 进制位数。下面的是个完整的例子，产生10 个[0, 100)之间的随机数，并将他们打印到一个字符数组s 中，以逗号分隔开。
#include
#include
#include
int main() {
srand(time(0));
char s[64];
int ffset = 0;
for(int i = 0; i &lt; 10; i++) {
offset += sprintf(s + offset, &quot;%d,&quot;, rand() % 100);
}
s[offset - 1] = '\n';//将最后一个逗号换成换行符。
printf(s);
return 0;
}
设想当你从数据库中取出一条记录，然后希望把他们的各个字段按照某种规则连接成一个字符串时，就可以使用这种方法，从理论上讲，他应该比不断的strcat 效率高，因为strcat 每次调用都需要先找到最后的那个''的位置，而在上面给出的例子中，我们每次都利用sprintf 返回值把这个位置直接记下来了。

!!六、使用

sprintf的常见问题

sprintf 是个变参函数，使用时经常出问题，而且只要出问题通常就是能导致程序崩溃的内存访问错误，但好在由sprintf 误用导致的问题虽然严重，却很容易找出，无非就是那么几种情况，通常用眼睛再把出错的代码多看几眼就看出来了。

缓冲区溢出
第一个参数的长度太短了，没的说，给个大点的地方吧。当然也可能是后面的参数的问题，建议变参对应一定要细心，而打印字符串时，尽量使用&quot;%.ns&quot;的形式指定最大字符数。
忘记了第一个参数低级得不能再低级问题，用printf 用得太惯了。//偶就常犯。
变参对应出问题
通常是忘记了提供对应某个格式符的变参，导致以后的参数统统错位，检查检查吧。尤其是对应&quot;*&quot;的那些参数，都提供了吗？不要把一个整数对应一个&quot;%s&quot;，编译器会觉得你欺她太甚了（编译器是obj 和exe 的妈妈，应该是个女的，:P）。

!!七、其他

strftime
sprnitf 还有个不错的表妹：strftime，专门用于格式化时间字符串的，用法跟她表哥很像，也是一大堆格式控制符，只是毕竟小姑娘家心细，她还要调用者指定缓冲区的最大长度，可能是为了在出现问题时可以推卸责任吧。这里举个例子：
time_t t = time(0);
//产生&quot;YYYY-MM-DD hh:mm:ss&quot;格式的字符串。
char s[32];
strftime(s, sizeof(s), &quot;%Y-%m-%d %H:%M:%S&quot;, localtime(&amp;t));
sprintf 在MFC 中也能找到他的知音：CString::Format，strftime 在MFC 中自然也有她的同道：
CTime::Format，这一对由于从面向对象哪里得到了赞助，用以写出的代码更觉优雅</pre>
</div>
<div title="模板库" modifier="wy" created="200908141513" modified="200908141719" tags="模板库" changecount="4">
<pre>!!!模板与多文件工程 (Templates and multiple-file projects)
原文章：[[这里|http://www.prglab.com/cms/pages/c-tutorial/advanced-concepts/templates.php]]
从编译器的角度来看，模板不同于一般的函数或类。它们在需要时才被编译(compiled on demand)，也就是说一个模板的代码直到需要生成一个对象的时候(instantiation)才被编译。当需要instantiation的时候，编译器根据模板为特定的调用数据类型生成一个特殊的函数。

当工程变得越来越大的时候，程序代码通常会被分割为多个源程序文件。在这种情况下，通常接口(interface)和实现 (implementation)是分开的。用一个函数库做例子，接口通常包括所有能被调用的函数的原型定义。它们通常被定义在以.h 为扩展名的头文件 (header file) 中；而实现 (函数的定义) 则在独立的C++代码文件中。

模板这种类似宏(macro-like) 的功能，对多文件工程有一定的限制：函数或类模板的实现 (定义) 必须与原型声明在同一个文件中。也就是说我们''不能再将接口(interface)存储在单独的头文件中''，而''必须''将接口和实现放在使用模板的''同一个文件''中。

回到函数库的例子，如果我们想要建立一个函数模板的库，我们不能再使用头文件(.h) ，取而代之，我们应该生成一个模板文件(template file)，将函数模板的接口和实现 都放在这个文件中 (这种文件没有惯用扩展名，除了不要使用.h扩展名或不要不加任何扩展名)。在一个工程中多次包含同时具有声明和实现的模板文件并不会产生链接错误 (linkage errors)，因为它们只有在需要时才被编译，而兼容模板的编译器应该已经考虑到这种情况，不会生成重复的代码。

--@@color(red):暂时还不清楚怎么构建模板类@@，目前解决办法就把声明和实现放在同一.h文件中吧--
详见STL的源码，它是典型的模板库，我们平时引入的都是如&lt;vector&gt;这样的文件，但看vector文件中存的是什么呢？其实它就是负责引入&lt;str_vector.h&gt;这个头文件，而这个文件里面是模板函数、类的原型加上它们的实现。所以模板声明和实现肯定是要在一起的。STL只不过是重命名了一下，间接导入，这样文件也好管理一些。</pre>
</div>
<div title="汉诺塔(tower of hanoi)" modifier="wy" created="200908240935" modified="200909141333" changecount="3">
<pre>这个问题还是有一定[[故事背景|http://en.wikipedia.org/wiki/Tower_of_Hanoi]]
''递归实现''
问题的递归解答出奇地简单：（假设有a,b,c三个柱子，要从a移到c）
&gt;''归纳基础：''n为1，只要把盘子从a移动到c即可
&gt;''归纳过程：''
&gt;&gt;1、将a上的前n-1个盘子移到b(temp)
&gt;&gt;2、将a的第n个（最底下的）盘子移到c，即这个盘子完成移动
&gt;&gt;3、将b上的n-1个盘子移到c，即递归执行，此时a成了temp
具体解释参考[[这里|http://catouse.com/post/62.html]]

''非递归实现''
盘子的移动时有''规律''的，总结如下：（假设是要从A移动到C）
&gt;总共有两种情况，一种是盘子个数n为偶数的，另一种是n为奇数；想象，将3个柱子排成品字形，如果n是偶数，那么顺序是A、B、C，否则顺序是A、C、B；重复进行如下步骤即可：(以下是''规律''，没有为什么，多移动几次就知道了)
&gt;&gt;1、将最小的盘子(即1号盘子)向右移动
&gt;&gt;2、对剩下的两个柱子，如果我空的，那么把不空的那个柱子上的最顶端的盘子移到空柱子；否则比较两个柱子最上的盘子的值，把小的移到大的那里(本质是维护hanoi的结构——小的要叠在大的上面)
具体解释及程序源代码见[[这里|http://blog.minidx.com/2008/01/30/457.html]]</pre>
</div>
<div title="液晶电视(带网络功能)备选" modifier="YourName" created="201106080438" changecount="1">
<pre>*康佳IS96(7)N
**[[介绍|http://roll.sohu.com/20110217/n303241806.shtml]]
**[[京东|http://search.360buy.com/search?keyword=LC40IS96N&amp;w=1]]
*TCL mitv
**与CNTV合作

@@color(red):Points@@
*是否能看央视和地方台
*网速是否够，是否给力
*是否需要第三方附件（如体感游戏等）
*附加功能（wifi，USB，外置存储格式&lt;FAT?NTFS?&gt;，挂壁&lt;承重墙？&gt;）

@@color(red):Ques@@
*mitv目前是否集成了CNTV
*是否需要外置配件
**[[海尔与搜狐的合作|http://www.cheaa.com/Product/DH/HangQing/2009-4/131095_5.html]]
</pre>
</div>
<div title="用fstab挂载分区" modifier="wy" created="200903150251" modified="201111040537" tags="fstab mount" changecount="8">
<pre>!!!My Configuration
&gt;# /etc/fstab: static file system information.
&gt;#
&gt;# &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
&gt;proc            /proc           proc    defaults        0       0
&gt;# /dev/sda5
&gt;UUID=e11f3e42-bb72-4567-ad87-ef453dfeeb81 /               ext3    relatime,errors=remount-ro 0       1
&gt;# /dev/sda6
&gt;UUID=91c59827-0bb3-4da2-8bd3-fccc197535c2 none            swap    sw              0       0
&gt;# /dev/sdb5
&gt;UUID=48BE-9243 /media/G vfat user,auto,exec,rw,suid,async,umask=007,uid=1000,codepage=936,iocharset=cp936 0    0
&gt;# /dev/sdb6
&gt;UUID=22FA-4B84 /media/H vfat user,auto,exec,rw,suid,async,umask=007,uid=1000,codepage=936,iocharset=utf8 0    0
&gt;# /dev/sdb7
&gt;UUID=DA3B-B89D /media/I vfat user,auto,exec,rw,suid,async,umask=007,uid=1000,codepage=936,iocharset=utf8 0   0 
&gt;# /dev/sdb8
&gt;UUID=917D-25B2 /media/J vfat user,auto,exec,rw,suid,async,umask=007,uid=1000,codepage=936,iocharset=utf8 0   0
&gt;# /dev/sda1
&gt;UUID=40E6-FCD6 /media/C vfat user,auto,exec,rw,suid,async,umask=007,uid=1000,codepage=936,iocharset=utf8 0    0
&gt;# /dev/sda3
&gt;UUID=886C94EE6C94D7F0 /media/D ntfs user,auto,exec,rw,suid,async,umask=007,uid=1000,codepage=936,iocharset=utf8 0    0
&gt;# /dev/sda4
&gt;UUID=0054A3CF54A3C5AE  /media/E ntfs user,auto,exec,rw,suid,async,umask=007,uid=1000,codepage=936,iocharset=utf8 0    0
&gt;/dev/scd0       /media/cdrom0   udf,iso9660 user,noauto,exec,utf8     0    0
''注：iocharset=utf8可可解决中文乱码问题，网上说cp936也行，但对我来说不行。//另//，utf8极其容易写成uft8，很囧的错误''


!!!Some useful command
''Show uuid of each partition''
&gt;ls -al /dev/disk/by-uuid/
''Show the mount information of partitions at present''
&gt;df -h
''Show the format of each partition''
&gt;sudo fdisk -l
''check on more details on the device''
&gt;sudo vol_id /dev/sda3

!!!reference
#[[fstab with uuid|http://linux.byexamples.com/archives/321/fstab-with-uuid/]]
#[[ How to edit and understand /etc/fstab|http://www.tuxfiles.org/linuxhelp/fstab.html#one-two]]
#[[How to mount you NTFS volume|http://www.linux-ntfs.org/doku.php?id=howto:mount]]
#[[iocharset&amp;codepage|http://www.linuxfromscratch.org/lfs/view/6.4/chapter08/fstab.html]]
#[[只有root用户才能挂载的问题|http://hi.baidu.com/aztack/blog/item/e69ac0ce1abd370192457ecd.html]]</pre>
</div>
<div title="相关链接" modifier="YourName" created="200902090414" modified="200902091059" tags="相关链接" changecount="11">
<pre>*''简体中文TiddlyWiki相关网站：''
&gt;TiddlyWiki使用与工具网站：
##以渐进步骤说明，综合了很多资源与问题：[[TiddlyWiki说明书|tiddlywiki.html]]
##以推进TiddlyWiki在大陆的使用为任务的：[[TiddlyWiki入门|http://www.tiddlywiki.cn]]
##一个开源项目研究小组，目前更新较慢：[[TiddlyWiki中文化|http://gf.cs.hit.edu.cn/projects/tiddlywiki]]
##blog的形式讲述TiddlyWiki：[[总而言之，统而言之|http://jiangzhanyong.com/projects/tiddlywiki-chs]]
##最新的简体繁体中文版本下载，以及耐心的版主指点：[[tiddlywiki中文支持google group|http://groups.google.com/group/TiddlyWiki-zh]]
&gt;TiddlyWiki应用相关网站：
##DNN(Dotnetnuke)教程网：[[Dotnetnuke教程|http://dnn.linklib.cn]]
##教你如何做美食，提供订阅服务哦：[[菜谱网|cookbook.linklib.cn]]。
##关于新鲜web2.0/business2.0观察的网站：[[web2.0观察|bs2.linklib.cn]]。
##记录作者学车中考虑的问题和对菜鸟的提示：[[学车记|driver.linklib.cn]]。
##关于头发行业的信息和知识，尤其是定制型真人发：[[定制型真人发/织发补发|hair.linklib.cn]]。
##作者对于硬币收藏和知识研究：[[硬币/分币|coin.linklib.cn]]。
##参与2008奥运，将奥运旗帜送上珠穆朗玛峰：[[奥运旗帜上珠穆朗玛峰|link8848.linklib.cn]]。
*''繁体中文TiddlyWiki相关网站：''
**自然的，Bram Chen的网站被我放在第一位，我从他哪里得到太多的东西，感谢他。[[PrinceTiddlyWiki|ptw.sourceforge.net/]]。
**[[MilchFlasche 的 TiddlyWiki之美|http://linshi.twbbs.org/usr/m/milchflasche/TiddlyWiki.html]]。
**老猫的介绍文章：[[TiddlyWiki真好玩|http://b-oo-k.net/blog/post/1/400]] 和 [[TiddlyWiki安装与使用指南|http://b-oo-k.net/blog/post/1/401]]。
**从这里也得益良多，基于内容的使用指南：[[中文使用教学|http://web.nlhs.tyc.edu.tw/wiki/TiddlyWikiTutorialTW.html]]。
**~TiddlyWiki 的[[中文 google group|http://groups.google.com/group/PrinceTiddlyWiki]]。
*''英文网站：''
**[[TiddlyWiki 官方网站|http://www.tiddlywiki.com]]和[[TiddlyWiki的另一官方网站|http://www.tiddlywiki.org]]
**~TiddlyWiki 的[[英文 google group|http://groups.google.com/group/TiddlyWiki]]。
**官方推荐教学网站：[[TiddlyWikiTutorial|http://www.blogjones.com/TiddlyWikiTutorial.html]]。
**官方推荐 ~TiddlyWiki 好用 Tips 网站：[[TiddlyWikiTips|http://tiddlywikitips.com/]]。
**官方推荐另一个好用的 Tips 网站：[[zRenard's personal web notebook|http://www.zrenard.com/tiddlywiki/tiddlywiki.html]]
**有很多插件的[[Lewcid|ttp://tw.lewcid.org/]]
**教我们将Google Adsense添加到TiddlyWiki的，虽然我用了没有成功：[[Adsense in TiddlyWiki|http://15black.bluedepot.com/twtests/adsense.html]]
**很多好看的主题和皮肤的 [[tiddlythemes|http://tiddlythemes.com/#Home]]
**主页很好看的[[冯正青个人主页|http://knightfeng.org/]] 
*''更多使用或者正在研究TiddlyWiki的人们：''
**&lt;&lt;tiddler TiddlyWikiAdaptations&gt;&gt;
*''更多资源来源：''
**&lt;&lt;tiddler ResourceLinks&gt;&gt;</pre>
</div>
<div title="硬盘分区" modifier="wy" created="200910161458" tags="分区" changecount="1">
<pre>一个硬盘最多能有四个主分区，或者三个主分区+一个扩展分区。所以在刚开始分区的时候，注意
#不要用满上面的限制
#扩展分区尽量大一点，逻辑分区尽量多一点，方便今后更改分区
&gt;这次就遇到有两个主分区+一个很小的扩展分区，然后剩下的那块只能分割成主分区，但他要装linux，需要两个分区，这时就囧了。

参考：[[这里|http://baike.baidu.com/view/55597.htm]]</pre>
</div>
<div title="硬盘安装Linux" modifier="teloon" created="200904251557" modified="200904251623" tags="硬盘安装 install" changecount="5">
<pre>''Reference：''[[here|http://ppsly.blogspot.com/2009/04/zzgrub.html]]

文章的''前提''是在宿主系统是''Windows''，如果是Linux的话就不用装Grub了，因为它默认的启动管理器就是grub。
1、安装WinGrub，详细介绍见[[这里|http://ppsly.blogspot.com/2009/04/zzgrub.html]]和[[这里|#]]，使Grub成为Windows的默认启动管理器
2、下载IOS文件（据说Live CD可能有问题，要用alternative CD，未测试），放到某''FAT32''分区的''根目录''下
3、''仍然''在那个FAT32分区下（另一个说法没强调同一FAT32分区，未测试），建立目录，如linux，从ISO文件中解压vmlinuz和initrd.img到linux目录''不要放其他文件''，否则可能中途退出（未测试）。
4、编辑Wingrub的menu.lst，如c:\boot\grub\menu.lst，代码如下：
&gt;timeout 10
&gt;############################这是第一种写法 
&gt;title fc4install
&gt;root&amp;nbsp; &amp;nbsp; (hd0,1)
&gt;kernel (hd0,1)/linux/vmlinuz 
&gt;initrd (hd0,1)/linux/initrd.img
&gt;
&gt;############################这是第二种格式的写法
&gt;title fc4install
&gt;root&amp;nbsp; &amp;nbsp; (hd0,1)
&gt;kernel /linux/vmlinuz&amp;nbsp;&amp;nbsp;ro root=/dev/hda2
&gt;initrd /linux/initrd.img
&gt;
&gt;#######################
&gt;title WindowsXP
&gt;root (hd0,0)
&gt;makeactive
&gt;chainloader +1</pre>
</div>
<div title="笔&amp;面试题" modifier="teloon" created="200911151300" modified="200911151301" changecount="2">
<pre>[[不用临时变量，交换两个数的值]]</pre>
</div>
<div title="结构体指针+1的问题" modifier="wy" created="200904100241" modified="200904100247" tags="zz C 指针" changecount="9">
<pre>''Source:''[[here|http://songfei.org/blog/2008/12/28/%E5%85%B3%E4%BA%8E%E7%BB%93%E6%9E%84%E4%BD%93%E6%8C%87%E9%92%881%E7%9A%84%E9%97%AE%E9%A2%98/]]
在读Linux 0.11 内核源代码的时候

linux/kernel/sched.c第26行

&gt;void show_task(int nr,struct task_struct * p)
&gt;{
&gt;    int i,j = 4096-sizeof(struct task_struct);
&gt; 
&gt;    printk(&quot;%d: pid=%d, state=%d, &quot;,nr,p-&gt;pid,p-&gt;state);
&gt;    i=0;
&gt;    while (i&lt;j &amp;&amp; !((char *)(p+1))[i])
&gt;        i++;
&gt;    printk(&quot;%d (of %d) chars free in kernel stacknr&quot;,i,j);
&gt;}

这里面出现了((char *)(p+1))[i]表示形式

分析如下：

首先，p是指向 task_struct 结构的一个指针

所以p+1指向 p+sizeof(task_struct) 这个地址

然后把它进行了强制类型转换，转换成为字符型，这时候就可以用[]按字节进行下标访问了。

注意优先级顺序

(char *)(p+1)

和

(char *)p+1

是不一样的。

这里给出一个程序

&gt;栈顶
&gt;.....
&gt;高地址 q——-
&gt;ABCD {{{//}}}(p+1)指向A所在地址 (char*)q+1指向B所在地址
&gt;EFGH
&gt;低地址 p——-
&gt;abcd{{{//}}}(q-1)指向a所在地址
&gt;efgh

测试程序：

&gt;{{#include &lt;stdio.h&gt;
&gt;struct t {
&gt;       char p[10];
&gt;      char p2[10];
&gt;}t1,t2;
&gt;int main(void)
&gt;{
&gt;       struct t *q=&amp;t1;
&gt;       struct t *p=&amp;t2;
&gt;
&gt;       strcpy(q-&gt;p,&quot;ABCD&quot;);
&gt;       strcpy(p-&gt;p,&quot;abcd&quot;);
&gt;       strcpy(q-&gt;p2,&quot;EFGH&quot;);
&gt;       strcpy(p-&gt;p2,&quot;efgh&quot;); 
&gt;       printf(&quot;%sn%sn&quot;, p,(char *)(p+1));
&gt;      {{{//}}}这里第二个参数打印ABCD，正好是前一个结构题
&gt;       printf(&quot;%sn%sn&quot;, q,(char *)q+1);
&gt;       {{{//}}}这里第二个参数打印BCD，说明跳过了一字节
&gt;
&gt;       printf(&quot;%dn&quot;,sizeof(struct t ));
&gt;       printf(&quot;%pn%pn&quot;,q,q+1);
&gt;       {{{//}}}这两个结果为0X14，正好是十进制的20,即结构体的大小
&gt;       return 0;
&gt;}

运行结果：

$ ./a.out
abcd
ABCD
ABCD
BCD
20
0x804a034
0x804a048

那为什么要指向下一个结构单元呢？

这个函数的主要功能是统计内核栈剩余空间大小，用于内核调试

在老版本内核中，内核堆栈是这么定义的：

union task_union 
{
       struct task_struct task;
       unsigned long stack[INIT_TASK_SIZE/sizeof(long)];
};

内核为每个进程分配一个task_struct结构时，实际上分配两个连续的物理页面(8192字节）底部用作task_struct结构(大小约为1K字节)，结构的上面用作内核堆栈(大小约为7K字节)。

上面那段代码是统计unsigned long stack[INIT_TASK_SIZE/sizeof(long)]的为0 的大小的函数。

具体为：

p是task_struct类型的指针，p+1就是p的值加上sizeof(task_struct)，也就是说p+1是指定任务数据结构之后的第一个字节

(char *)(p+1)将p+1转换为char类型指针，那么(p+1)[i]实际就是一个char类型数组的第i个元素了，char占一个字节，因此

{{{!}}}((char*)(p+1))[i] = true的条件是任务数据结构以后第i个字节为0。</pre>
</div>
<div title="编码问题" modifier="YourName" created="201012121018" changecount="1">
<pre>写得相当轻松的，从编码历史入手的[[字符编码方式轻松解读|http://hi.baidu.com/zou_wei/blog/item/f8cf366d90e37cfc43169426.html]]
阮一峰的[[字符编码笔记|http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html]]
</pre>
</div>
<div title="网络安装Linux" modifier="teloon" created="200904251624" modified="200904251636" tags="网络安装 install" changecount="5">
<pre>基本同[[硬盘安装Linux]]
只不过要下载下载的特殊的文件：
*Ubuntu从这个地址：http://ftp.sjtu.edu.cn/ubuntu/dists/gutsy/main/installer-i386/current/images/netboot/ubuntu-installer/i386/
下载linux和initrd.gz这两个文件，分别对应[[硬盘安装Linux]]中的vmlinuz和initrd.img，相应替换即可。
*Fedora从这个地址：http://ftp.sjtu.edu.cn/fedora/linux/releases/8/Fedora/i386/os/isolinux/
下载vmlinuz和initrd.img。

在grub启动时，选择网络安装的启动项，根据提示一步步走。注意的是：
#''不能用无线''；
#IP如果DHCP不成功的话手动配置；
#源''手动选择''：ftp.sjtu.edu.cn（''不要加ftp://''）；
#目录就默认（/ubuntu）</pre>
</div>
<div title="背包问题" modifier="wy" created="200908260906" modified="200908271137" tags="背包" changecount="3">
<pre>思想是''动态规划''，动态规划的本质是''问题可以被不断分解''，''从0开始，保存子问题的解决方案''
有两中形式：
1、包内所装物品价值最大化
&gt;方法是''“每步最优化”''，这每步最优解就是''子问题的解决方案''
&gt;&gt;见AlgorithmGossip上有很通俗、直观的解释。
2、能将包填满
&gt;方法是''“拆分问题，保存结果矩阵”''
&gt;&gt;见《算法引论》P79</pre>
</div>
<div title="自定义STL容器中的比较函数" modifier="wy" created="200908081315" modified="200908130847" tags="STL multimap 比较函数" changecount="7">
<pre>!!!自排序的容器(如map,set等)
两种方法：1、初始化时候指定less方法；2、自定义仿函数
!!!指定less(比较函数)
为什么是只要一个less函数，也就是&quot;&lt;&quot;就可以了呢呢？其实是有道理的。因为只要定义了一个&quot;&lt;&quot;的函数，就可以比较出大于、小于和等于。如下：
&gt;{{{bool less_than(Type &amp;a, Type &amp;b){}}}
&gt;{{{return a&lt;b;}}}
&gt;{{{}}}}
所以，
&gt;if {{{(less_than(x ,y) == true)}}}，then ''x&lt;y''
&gt;else if{{{( less_than(y, x) == true )}}}，then ''x&gt;y''
&gt;else ''x=y''
而STL内部实现的就是less（当然我们也可以自己实现一个库，用的是larger）
&gt;Ref:[[YSSY|http://bbs.sjtu.edu.cn/bbstcon,board,C,reid,1249661588.html]]和[[cplusplus的例子|http://www.cplusplus.com/reference/stl/multimap/multimap/]]和MSDN上的[[文档|http://msdn.microsoft.com/en-us/library/s44w4h2s.aspx]](见最后一段)。

!!!自定义仿函数
其实是个类，英文是Functor，具体介绍可以看《''The C++ Standard Library''》
它的原理是用一个自定的类，只不过里面肯定会重载&quot;''()''&quot;操作符，所以最主要的还是这个重载函数，它实现的其实也是小于运算。
&gt;Ref:[[cppreference的例子|http://www.java2s.com/Code/Cpp/Map-Multimap/Mapcomparison.htm]]和上面''cplusplus''的例子

其实现在看来，两张方法思路是一样的：''一、''在初始化的时候都要有一个''比较类型''(暂且这么叫它)，第一种方法中一般是自己定义的比较函数的类型，用typedef来定义这个类型；第二种方法中这个类型就是Functor了；''二、''都需要一个比较函数，第一种是直接定义的，在初始化的时候赋给它；第二种不用初始化赋值，why?因为这个函数已经包含在类型(Functor)中了

两种方法都实现的例子:[[这里|http://blog.csdn.net/tenglongxun2/archive/2009/07/31/4396915.aspx]]

@@color(blue):跟新理解@@：如内部排序时，调用比较函数时，比较函数的两个对象分别是A、B(按出现的顺序)，那么，''它不管你是什么比较函数''(大于、还是小于等)，如果比较函数返回true，那么它在容器中就按照A、B顺序(即原顺序)排；如果返回false就按B、A排；这样的效果就是，如果我们定义的是小于函数，那么结果它''正好''是小于的效果(当然也是故意这么设计的)。

!!!序列容器vector,list等
这些容器在排序时，需要显式地调用--algorithm中的--（vector没有自带sort，但是list是自带sort函数的，只需传入一个compare函数）sort排序函数。所以要自定义比较函数的时候只需给sort传入第三个参数(比较函数或Functor''实例对象'')。

!!!其它
实际上STL自带有两个比较函数类(functor)，分别是默认的less(不指定即可)和greater，两者都是模板类，使用时要指定类型，如''less&lt;int&gt;()''。而这两个functor具体调用的应该是''&lt;'',''&gt;'',''==''操作符，所以可以在类中重载&lt;或&gt;或==操作符，同样达到自定义的效果。具体见《数据结构与算法C++版》窦延平等 交大出版社版P316。</pre>
</div>
<div title="装箱算法bin-packing" modifier="wy" created="200908111010" tags="装箱 packing" changecount="1">
<pre>问题描述见[[这里|http://en.wikipedia.org/wiki/Bin_packing_problem]]
与操作系统中的内存分配算法类似，有如下几种方法：
#First Fit
#Next Fit
#Worst Fit
#Best Fit
#First Fit
……
具体可以见[[这里|http://www.developerfusion.com/article/5540/bin-packing/]]的一系列文章

更复杂是2D装箱算法：
问题描述见[[这里|http://www.cs.sunysb.edu/~algorith/files/bin-packing.shtml]]，相关资源见[[豆瓣|http://www.douban.com/note/34766741/]]</pre>
</div>
<div title="评价标准(Evaluation)" modifier="YourName" created="201012090856" changecount="1">
<pre>*@@bgcolor(#66cc33):P(precision), R(Recall), F(F-measure)@@
参考''Ref1''
*@@bgcolor(#66cc33):AP(Average Precision)@@
它是针对某一个查询q来说，公式如下（参考''Ref1''）
&gt;[img[http://upload.wikimedia.org/math/f/3/4/f347083708617f471ef1129d5dd1c66c.png]]
&gt;&gt;@@''r''@@是结果的rank值（排名）
&gt;&gt;@@''N''@@为检索返回的结果个数
&gt;&gt;@@''rel()''@@是一个''二值''（0,1）函数（结果与查询相关则为1）
&gt;&gt;@@''P(r)''@@的值如下，是当前的在''当前排名之前''的Precision值
&gt;&gt;&gt;[img[http://upload.wikimedia.org/math/e/c/0/ec00cb72e09fa467eaf610b2226f25c8.png]]
{{{
这个指标的评价的是：''Average of precision at each relevant document retrieved''
}}}
举个例子（或者见''Ref3''的8.4.1小节）来说：搜索语句q：''上海交通大学''。返回下面这样一个排序列表（共获取5个结果）
| !排名(rank) | !获取的结果文档 | !是否相关 |
| 1 | a1 | 0 |
| 2 | a2 | 1 |
| 3 | a3 | 0 |
| 4 | a4 | 0 |
| 5 | a5 | 1 |
则''{{{ AP = ( 0/1*0 + 1/2*1 + 1/3*0 + 1/4*0 + 2/5*1 ) / 5}}}''
{{{
这个指标评价的是：检索任务要找到尽量多的相关文档
}}}
*@@bgcolor(#66cc33):MAP(Mean Average Precision)@@
他是对于Q个查询q，计算这Q个AP的平均值，公式如下，不解释：
&gt;[img[http://upload.wikimedia.org/math/9/8/f/98f072c60e0dc953b943b99d019729b3.png]]
{{{
这个指标评价的是：基于检索池的相关性判断。常用于对整个检索任务评价其检索出相关文档的能力。
}}}
*@@bgcolor(#66cc33):MRR(Mean Reciprocal Rank)@@
''Reciprocal Rank''定义为第一个相关文档的排名的倒数，公式如下，另参考''Ref2''
&gt;[img[http://upload.wikimedia.org/math/2/d/7/2d7879c5c9fa7ac7d39c5620d18a1026.png]]
{{{
该指标对排序位置十分敏感，表示的把第一个答案排在尽量前面的能力
}}}
*@@bgcolor(#66cc33):P@10@@
它表示的是在某个排序位置（如10）上的准确率，这个指标有下面两个考虑（更多参考''Ref3''）
{{{
1.该指标评价的是：检索任务是要在某排序位置上找出尽可能相关的文档，而不是找到尽可能多的文档；
2.在某排序位置上，一个检索结果的准确率比另一个说，那么他的召回率也更高的。
}}}
*@@bgcolor(#66cc33):召回率增加0.1时精度的变化，插值(Interpolation)法@@
它是在P-R图上的改进（因为不同检索结果的P-R图形状不一样，没比较价值），公式如下
&gt;[img[http://nlp.stanford.edu/IR-book/html/htmledition/img536.png]]
然后构建11点插值P-R图（11-point Interpolated Average Precision 见''Ref4''），他们的形状是类似的，具体的例子参见''Ref3''的8.4.2小节和''Ref4''。
{{{
1. 该指标评价的是：各个检索结果之间的P-R曲线宏观对比；
2. 将各条插值后的P-R曲线做平均，得出一条平均的P-R曲线，用于评价整个检索任务（见Ref3的8.4.2小节）；
3. 宏平均(Macroaverage)和微平均(Microaverage)（见Ref3的8.4.2小节页脚的注释）
}}}
*@@bgcolor(#66cc33):DCG(Discounted Cumulative Gain)@@
公式如下，参考''Ref1''和''Ref3''的8.4.3小节
&gt;[img[http://upload.wikimedia.org/math/d/f/5/df5560ab4a13fbe3a4bd3b07b61f7d75.png]]
便于平均多个查询的评价值，需要对结果进行归一化，归一化因数是一个理想化的DCG，参考''Ref1''和''Ref3''的8.4.3小节，公式如下
&gt;[img[http://upload.wikimedia.org/math/c/6/6/c66e4f0c861568bbcdaa22b86446b8a0.png]]
该指标基于假设
{{{
1. 高相关性的文档比边缘相关的文档要有用得多；
2. 相关文档排序越靠后，对用户的价值越低（体现在公式中的衰减因子log(i)）
}}}
*@@bgcolor(#66cc33):Reference@@
Ref1：[[IR@Wikipedia|http://en.wikipedia.org/wiki/Information_retrieval]]
Ref2：[[MRR@Wikipedia|http://en.wikipedia.org/wiki/Mean_reciprocal_rank]]
Ref3：《搜索引擎：信息检索实践》or 《Search Engines Information Retrieval in Practice》
Ref4：[[Evaluation of ranked retrieval results|http://nlp.stanford.edu/IR-book/html/htmledition/evaluation-of-ranked-retrieval-results-1.html#fig:trec-11-point]]</pre>
</div>
<div title="调用python" modifier="wy" created="200908110344" modified="200908110350" tags="python 混合编程" changecount="3">
<pre>1、具体的例子
一步步的教程，前面的引子比较有趣，狂点[[这里|http://www.codeproject.com/KB/library/py_embed.aspx]]
较简单的：见[[这里|http://coredump.blog.bokee.net/bloggermodule/blog_printEntry.do?id=909014]]（或者[[这里|http://coredump.blog.bokee.net/bloggermodule/blog_printEntry.do?id=909014]]一样的）
稍微复杂的：见[[CodeProject|http://www.codeproject.com/KB/cpp/embedpython_1.aspx]]上
更复杂的的关于multi thread：上面那篇文章的[[姊妹篇|http://www.codeproject.com/KB/cpp/embedpython_2.aspx]]

2、调用python方法的集中分类
见[[这里|http://blog.csdn.net/jzp_cn/archive/2005/10/24/515034.aspx]]</pre>
</div>
<div title="转录软件（语音识别）" modifier="YourName" created="201105130507" changecount="1">
<pre>在线版本：http://www.voicebase.com
某个研究机构的（需要申请，支持中文）：http://www.vocapia.com/technos.html
微软的接口：[[Speech SDK 5.1|http://www.microsoft.com/downloads/en/details.aspx?FamilyID=5e86ec97-40a7-453f-b0ee-6583171b4530&amp;displaylang=en#Top]]</pre>
</div>
<div title="配置vsftpd" modifier="wy" created="200908121819" modified="200908121821" tags="ftp" changecount="2">
<pre>按照[[这里|http://zustytq.blog.ubuntu.org.cn/2007/09/21/vsftp%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/]]配置就好了
用户上传后，那个用户无法下载（因为上传后文件属性是600），需要server端的人手动设置他的mod为555才行。

下次搞个下载目录，用户不能上传，看看怎么弄。

参考：很全(太全)的[[教程|http://linux.chinaitlab.com/server/725476.html]]，[[参数详细(太详细)的作用|http://blog.163.com/mike_homis/blog/static/20104948200951604542326/]]</pre>
</div>
<div title="重新(Reload)加载Bash环境变量" modifier="teloon" created="201005191409" modified="201005191410" changecount="2">
<pre>src:[[Reloading profile - how to reload Unix profile|http://www.ivorde.ro/Reloading_profile__how_to_reload_Unix_profile-76.html]]
Use the following command to reload a unix profile (/etc/profile, ~/.profile, ~/.bash_profile ...):
&gt;{{{$ . ~/.profile}}}
&gt;{{{$ . /etc/profile}}}

Notice: . (dot) is a command that originates from source command. On some unix flavours (FreeBSD 6 for example) source command works still:
&gt;{{{$ source ~/.profile}}}
&gt;{{{$ source /etc/profile}}}</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[
//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkIncrementalSearch: true,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayInstrumentation: false,
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8",
	txtTheme: ""
	};
config.optionsDesc = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {defaultView: "text"},
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "http://www.tiddlywiki.com/upgrade/",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: config.userAgent.indexOf("gecko") != -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(config.browser.isBadSafari) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
	],
	currBrowser: null,
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|'
};

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki", action: saveChanges},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<\%0>>",
	macroErrorDetails: "Error while executing macro <<\%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'desc', title: "Description", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Reveal further commands"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	openError: "There were problems fetching the tiddlywiki file",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.upgrade,{
	wizardTitle: "Upgrade TiddlyWiki core code",
	step1Title: "Update or repair this TiddlyWiki to the latest release",
	step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", display:null, className:'notChanged'},
		changedServer: {text: "Changed on server", display:null, className:'changedServer'},
		changedLocally: {text: "Changed while unplugged", display:null, className:'changedLocally'},
		changedBoth: {text: "Changed while unplugged and on server", display:null, className:'changedBoth'},
		notFound: {text: "Not found on server", display:null, className:'notFound'},
		putToServer: {text: "Saved update on server", display:null, className:'putToServer'},
		gotFromServer: {text: "Retrieved update from server", display:null, className:'gotFromServer'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "http://www.tiddlywiki.com/",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
	});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});

//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = (config.browser.isSafari || config.browser.isOpera) && (document.location.toString().substr(0,4) != "http");

// Starting up
function main()
{
	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	loadShadowTiddlers();
	t2 = new Date();
	store.loadFromDiv("storeArea","store",true);
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins();
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = !readOnly;
	t6 = new Date();
	for(var m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	t7 = new Date();
	store.notifyAll();
	t8 = new Date();
	restart();
	refreshDisplay();
	t9 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2-t1) + " ms");
		displayMessage("LoadFromDiv " + (t3-t2) + " ms");
		displayMessage("LoadPlugins " + (t5-t4) + " ms");
		displayMessage("Macro init " + (t7-t6) + " ms");
		displayMessage("Notify " + (t8-t7) + " ms");
		displayMessage("Restart " + (t9-t8) + " ms");
		displayMessage("Total: " + (t10-t0) + " ms");
	}
	startingUp = false;
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
	delete shadows;
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers("systemConfig");
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	for(var i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			for(var i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0],10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1],10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2],10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler) {
			var tiddlerElem = story.findContainingTiddler(place);
			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
			window.place = place;
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		} else {
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURIComponent(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var i=1; i<params.length; i++) {
		var p = config.paramifiers[params[i].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[i].value);
		else {
			var h = config.optionHandlers[params[i].name.substr(0,3)];
			if(h && h.set instanceof Function)
				h.set(params[i].name,params[i].value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
			story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly) {
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(v) {
		story.switchTheme(v);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent= {
	onstart: function(v) {
		var titles=[];
		var tiddlers=store.getTiddlers("modified","excludeLists").reverse();
		for(var i=0; i<v && i<tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null,titles);
	}
};

config.paramifiers.filter = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers(v),null,false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if(s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow");
					theRow.onmouseover = function() {addClass(this,"hoverRow");};
					theRow.onmouseout = function() {removeClass(this,"hoverRow");};
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if(!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w)
	{
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w)
	{
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,decodeURIComponent(link),false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,decodeURIComponent(text),false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
			w.outputText(w.output,w.matchStart+1,w.nextMatch);
			return;
		}
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				addClass(e,"imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3]) {
				img.title = lookaheadMatch[3];
				img.setAttribute("alt",lookaheadMatch[3]);
			}
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if(styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\\\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var t0 = new Date();
		wikifier.subWikify(output);
		if(tiddler && config.options.chkDisplayInstrumentation)
			displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"pre");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		if(!tiddler)
			tiddler = new Tiddler("temp");
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikify(e);
		html = e.innerHTML;
		removeNode(e);
	}
	return html;
}

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = getPlainText(e);
	removeNode(e);
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

//--
//-- Macro definitions
//--

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	createTiddlyElement(place,"span",null,null,text);
};

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,formatVersion());
};

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] || "all";
	var list = document.createElement("ul");
	place.appendChild(list);
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		createTiddlyLink(li,typeof results[t] == "string" ? results[t] : results[t].title,true);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	var results = [];
	if(filter) {
		var tiddlers = store.filterTiddlers(filter);
		for(var t=0; t<tiddlers.length; t++)
			results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
	}
};

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] || "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	var dateFormat = params[2] || this.dateFormat;
	for(var t=tiddlers.length-1; t>=last; t--) {
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay) {
			var ul = document.createElement("ul");
			place.appendChild(ul);
			createTiddlyElement(ul,"li",null,"listTitle",tiddler[field].formatString(dateFormat));
			lastDay = theDay;
		}
		createTiddlyElement(ul,"li",null,"listLink").appendChild(createTiddlyLink(place,tiddler.title,true));
	}
};

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className);
	if(!args) {
		wrapper.setAttribute("refresh","content");
		wrapper.setAttribute("tiddler",tiddlerName);
	}
	var text = store.getTiddlerText(tiddlerName);
	if(text) {
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.indexOf(tiddlerName) !== -1)
			return;
		stack.push(tiddlerName);
		try {
			var n = args ? Math.min(args.length,9) : 0;
			for(var i=0; i<n; i++) {
				var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
				text = text.replace(placeholderRE,args[i]);
			}
			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
		} finally {
			stack.pop();
		}
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName,params)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0],null,params[1],params[2]);
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++) {
		createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
		if(t<tiddler.tags.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	ul.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
	if(!readOnly)
		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var e = ev || window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie || "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	params = paramString.parseParams("color");
	var locolors = [], hicolors = [];
	for(var t=2; t<params.length; t++) {
		var c = params[t].value;
		if(params[t].name == "snap") {
			hicolors[hicolors.length-1] = c;
		} else {
			locolors.push(c);
			hicolors.push(c);
		}
	}
	drawGradient(panel,params[1].value != "vert",locolors,hicolors);
	if(wikifier)
		wikifier.subWikify(panel,">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var names = params[0].split(".");
		var lookupMessage = function(root,nameIndex) {
				if(names[nameIndex] in root) {
					if(nameIndex < names.length-1)
						return (lookupMessage(root[names[nameIndex]],nameIndex+1));
					else
						return root[names[nameIndex]];
				} else
					return null;
			};
		var m = lookupMessage(config,0);
		if(m == null)
			m = lookupMessage(window,0);
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};


config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value,place,highlightHack,tiddler);
	},
	link: function(value,place,params,wikifier,paramString,tiddler) {
		createTiddlyLink(place,value,true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if(params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value,place,highlightHack,tiddler);
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if(handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			e.setAttribute("edit",field);
			e.setAttribute("type","text");
			e.value = store.getValue(tiddler,field) || defVal;
			e.setAttribute("size","40");
			e.setAttribute("autocomplete","off");
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			e.value = v = store.getValue(tiddler,field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags(this.getAttribute("tags"));
	if(tags.length == 0)
		createTiddlyText(createTiddlyElement(popup,"li"),lingo.popupNone);
	for(var t=0; t<tags.length; t++) {
		var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag",tags[t][0]);
		tag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",tiddler.title);
		btn.setAttribute("tags",params[0]);
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};

//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string" && story.getTiddlerField(title,"text"))
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
	var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
	if(params[0])
		txt.value = params[0];
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
	place.appendChild(txt);
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var e = ev || window.event;
	switch(e.keyCode) {
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			config.macros.search.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(config.macros.search.timeout)
					clearTimeout(config.macros.search.timeout);
				var txt = this;
				config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
			}
		} else {
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			removeNode(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
		}
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
	if(typeof commandName != "string") {
		var c = null;
		for(var t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd;
			switch(command.type) {
			case "popup":
				cmd = this.onClickPopup;
				break;
			case "command":
			default:
				cmd = this.onClickCommand;
				break;
			}
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			if(className)
				addClass(btn,className);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyText || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyTooltip || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	var tiddler = store.fetchTiddler(title);
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
	var children = place.getElementsByTagName("a");
	for(var t=0; t<children.length; t++) {
		var c = children[t];
		if(hasClass(c,className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	removeNode(this);
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++) {
		var c = params[t];
		switch(c) {
		case '>':
			var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
			addClass(btn,"moreCommand");
			var e = createTiddlyElement(place,"span",null,"moreCommand");
			e.style.display = "none";
			place = e;
			break;
		default:
			var className = "";
			switch(c.substr(0,1)) {
			case "+":
				className = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				className = "cancelCommand";
				c = c.substr(1);
				break;
			}
			if(c in config.commands)
				this.createCommand(place,c,tiddler,className);
			break;
		}
	}
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	story.focusTiddler(title,config.options.txtEditorFocus||"text");
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if(deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	for(var r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields['server.host'];
	var serverWorkspace = tiddler.fields['server.workspace'];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = config.commands.syncing.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = config.commands.syncing.currServerMarker + caption;
		} else {
			caption = config.commands.syncing.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			"server.type": serverType,
			"server.host": this.getAttribute("server.host"),
			"server.workspace": this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,"server",null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var items = [];
	store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	for(var i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c,10) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changeCount = this.fields['changecount'];
	if(changeCount === undefined)
		changeCount = 0;
	return changeCount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
	this.assign(title,text,modifier,modified,tags,created,fields);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var text = this.text;
	// remove 'quoted' text before scanning tiddler source
	text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
		replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
		replace(/"""((?:.|\n)*?)"""/g,"").
		replace(/\<nowiki\>((?:.|\n)*?)\<\/nowiki\>/g,"").
		replace(/\<html\>((?:.|\n)*?)\<\/html\>/g,"").
		replace(/\<script((?:.|\n)*?)\<\/script\>/g,"");
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier;
	if(!modifier)
		modifier = config.messages.subtitleUnknown;
	var modified = this.modified;
	if(modified)
		modified = modified.toLocaleString();
	else
		modified = config.messages.subtitleUnknown;
	return config.messages.tiddlerLinkTooltip.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki() object contains Tiddler()s
//--

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
	if(typeof config.shadowTiddlers[title] == "string")
		return config.shadowTiddlers[title];
	else
		return "";
};

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		if(!section)
			return tiddler.text;
		var re = new RegExp("(^!{1,6}" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(tiddler.text);
		if(match) {
			var t = tiddler.text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(this.isShadowTiddler(title))
		return this.getShadowTiddlerText(title);
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	var m = this.slicesRE.exec(text);
	while(m) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
		m = this.slicesRE.exec(text);
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for(var i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		tiddler.incChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title,true);
	this.setDirty(true);
};

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		created = created || tiddler.created; // Preserve created date
		this.deleteTiddler(title);
	} else {
		created = created || modified;
		tiddler = new Tiddler();
	}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var candidates = this.reverseLookup("tags",excludeTag,!!match);
	var results = [];
	for(var t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(var c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		for(var n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers) {
		if(this.isShadowTiddler(t))
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == 'string') ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
	var results = [];
	if(filter) {
		var tiddler;
		var re = /([^\s\[\]]+)|(?:\[([ \w]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;
		var match = re.exec(filter);
		while(match) {
			if(match[1] || match[4]) {
				var title = match[1] || match[4];
				tiddler = this.fetchTiddler(title);
				if(tiddler) {
					results.pushUnique(tiddler);
				} else if(this.isShadowTiddler(title)) {
					tiddler = new Tiddler();
					tiddler.set(title,this.getTiddlerText(title));
					results.pushUnique(tiddler);
				} else {
					results.pushUnique(new Tiddler(title));
				}
			} else if(match[2]) {
				switch(match[2]) {
					case "tag":
						var matched = this.getTaggedTiddlers(match[3]);
						for(var m = 0; m < matched.length; m++)
							results.pushUnique(matched[m]);
						break;
					case "sort":
						results = this.sortTiddlers(results,match[3]);
						break;
				}
			}
			match = re.exec(filter);
		}
	}
	return results;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
	var asc = +1;
	switch(field.substr(0,1)) {
	case "-":
		asc = -1;
		// Note: this fall-through is intentional
		/*jsl:fallthru*/
	case "+":
		field = field.substr(1);
		break;
	}
	if(TiddlyWiki.standardFieldAccess[field])
		tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
	else
		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
	return tiddlers;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by '.'
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp('^'+fieldName+'\\.');
				var dirty = false;
				for(var n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	fieldName = fieldName.toLowerCase();
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		return accessor.get(t);
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
		result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
		if(result)
			return result;
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		var id = this.idPrefix + title;
		return id==this.container ? this.idPrefix + "_" + title : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
	var place = this.getContainer();
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle)
			this.closeTiddler(title,true);
		else
			this.refreshTiddler(title,template,false,customFields);
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
		case "top":
			before = place.firstChild;
			break;
		case "bottom":
			before = null;
			break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)
{
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : (fields || {});
	var serverType = tiddler.getServerType();
	var host = tiddler.fields['server.host'];
	var workspace = tiddler.fields['server.workspace'];
	if(!serverType || !host)
		return null;
	var sm = new SyncMachine(serverType,{
			start: function() {
				return this.openHost(host,"openWorkspace");
			},
			openWorkspace: function() {
				return this.openWorkspace(workspace,"getTiddler");
			},
			getTiddler: function() {
				return this.getTiddler(title,"onGetTiddler");
			},
			onGetTiddler: function(context) {
				var tiddler = context.tiddler;
				if(tiddler && tiddler.text) {
					var downloaded = new Date();
					if(!tiddler.created)
						tiddler.created = downloaded;
					if(!tiddler.modified)
						tiddler.modified = tiddler.created;
					store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
					autoSaveChanges();
				}
				delete this;
				return true;
			},
			error: function(message) {
				displayMessage("Error loading missing tiddler from %0: %1".format([host,message]));
			}
		});
	sm.go();
	return config.messages.loadingMissingTiddler.format([title,serverType,host,workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					var tags = [];
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText || text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(store.tiddlerExists(title)) {
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
			} else {
				addClass(tiddlerElem,store.isShadowTiddler(title) ? "shadow" : "missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
			forceReflow();
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = document.createElement("div");
	w.style.display = "none";
	place.appendChild(w);
	for(var t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	var e = this.getContainer().firstChild;
	while(e) {
		var template = e.getAttribute("template");
		if(template && e.getAttribute("dirty") != "true") {
			this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
		}
		e = e.nextSibling;
	}
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	if(window.addClass instanceof Function)
		addClass(this,"selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	if(window.removeClass instanceof Function)
		removeClass(this,"selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	}
	return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
	case 9: // Tab
		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
			replaceSelection(target,String.fromCharCode(9));
			consume = true;
		}
		if(config.isOpera) {
			target.onblur = function() {
				this.focus();
				this.onblur = null;
			};
		}
		break;
	case 13: // Ctrl-Enter
	case 10: // Ctrl-Enter on IE PC
	case 77: // Ctrl-Enter is "M" on some platforms
		if(e.ctrlKey) {
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
			consume = true;
		}
		break;
	case 27: // Escape
		blurElement(this);
		config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
		consume = true;
		break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = this.getTiddler(title);
	var e = null;
	if(tiddlerElem ) {
		var children = tiddlerElem.getElementsByTagName("*");
		for(var t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = this.getTiddlerField(title,field);
	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			removeNode(tiddlerElem);
			forceReflow();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	this.displayTiddlers(null,matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = this.getTiddler(title);
	if(e) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		if(!tiddler)
			return false;
		for(var n in fields) {
			if(store.getValue(title,n) != fields[n])
				return true;
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title || title;
		if(!store.tiddlerExists(newTitle))
			newTitle = newTitle.trim();
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.tiddlerId(newTitle);
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		var extendedFields = store.tiddlerExists(newTitle) ? store.fetchTiddler(newTitle).fields : (newTitle!=title && store.tiddlerExists(title) ? store.fetchTiddler(title).fields : merge({},config.defaultCustomFields));
		for(var n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode)
		return;

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};

	var getSlice = function(theme,slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
		r = r || store.getTiddlerSlice(theme,slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
			r = theme + r;
		return isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i,name,theme,slice) {
		var newName = getSlice(theme,slice);
		if(name!=newName && store.namedNotifications[i].name==name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	for(var i=0; i<config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
		case "PageTemplate":
			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
			break;
		case "StyleSheet":
			removeStyleSheet(config.refresherData.styleSheet);
			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
			break;
		case "ColorPalette":
			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
			break;
		default:
			break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOptionCookie("txtTheme");
	}
};

//--
//-- Backstage
//--

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = document.getElementById("backstageToolbar");
		this.button = document.getElementById("backstageButton");
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function(e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function(e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			btn.setAttribute("task",taskName);
			addClass(btn,task.action ? "backstageAction" : "backstageTask");
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		this.showButton.style.display = "none";
		this.hideButton.style.display = "block";
		config.options.chkBackstage = true;
		saveOptionCookie("chkBackstage");
		addClass(this.content,"backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOptionCookie("chkBackstage");
			removeClass(this.content,"backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		displayMessage(task);
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e)
			{
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
			}
		if(tabName == backstage.currTabName)
			return;
		if(backstage.currTabElem) {
			removeClass(this.currTabElem,"backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			addClass(tabElem,"backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		removeChildren(backstage.panelBody);
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			removeClass(backstage.currTabElem,"backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		 } else {
			backstage.panel.style.display = "none";
			backstage.cloak.style.display = "none";
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	var place = wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	wizard.addStep(this.step1Title,this.step1Html);
	var s = wizard.getElement("selTypes");
	for(var t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel ? config.adaptors[t].serverLabel : t);
		e.value = t;
	}
	if(config.defaultAdaptor)
		s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = config.macros.importTiddlers.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = config.macros.importTiddlers.onBrowseChange;
	fileInput.onkeyup = config.macros.importTiddlers.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: config.macros.importTiddlers.onOpen}]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(this.txtPath.value.length)
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var tagged = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(this.value);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
	if(!v||!v.length)
		return v;
	v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
	var u;
	var t = v.split(":");
	var p = t[1]||t[0]; // remove drive letter (if any)
	if (t[1] && (t[0]=="http"||t[0]=="https"||t[0]=="file")) {
		u = v;
	} else if(p.substr(0,1)=="/") {
		u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
	} else {
		var c = document.location.href.replace(/\\/g,"/");
		var pos = c.lastIndexOf("/");
		if (pos!=-1)
			c = c.substr(0,pos); // remove filename
		u = c + "/" + p;
	}
	return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	var ret = adaptor.openHost(url,null,wizard,config.macros.importTiddlers.onOpenHost);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	var ret = adaptor.getWorkspaceList(context,wizard,config.macros.importTiddlers.onGetWorkspaceList);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context",context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length==1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		var ret = context.adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
		if(ret !== true)
			displayMessage(ret);
		wizard.setValue("workspace",workspace);
		wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
		return;
	}
	wizard.addStep(config.macros.importTiddlers.step2Title,config.macros.importTiddlers.step2Html);
	var s = wizard.getElement("selWorkspace");
	s.onchange = config.macros.importTiddlers.onWorkspaceChange;
	for(var t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var list = workspaceList.parseParams("workspace",null,false,true);
		for(var n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: config.macros.importTiddlers.openLabel, tooltip: config.macros.importTiddlers.openPrompt, onClick: config.macros.importTiddlers.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = wizard.getValue("context");
	var ret = adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var ret = adaptor.getTiddlerList(context,wizard,config.macros.importTiddlers.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	if(context.status !== true) {
		wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.errorGettingTiddlerList);
		return;
	}
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		for(var n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(config.macros.importTiddlers.step3Title,config.macros.importTiddlers.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,config.macros.importTiddlers.listViewTemplate);
	wizard.setValue("listView",listView);
	wizard.setValue("context",context);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = config.macros.importTiddlers.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel},
			{caption: config.macros.importTiddlers.importLabel, tooltip: config.macros.importTiddlers.importPrompt, onClick: config.macros.importTiddlers.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = config.macros.importTiddlers.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,config.macros.importTiddlers.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		config.macros.importTiddlers.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(config.macros.importTiddlers.step4Title.format([rowNames.length]),config.macros.importTiddlers.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}
		],config.macros.importTiddlers.statusDoingImport);
	var wizardContext = wizard.getValue("context");
	var tiddlers = wizardContext ? wizardContext.tiddlers : [];
	for(t=0; t<rowNames.length; t++) {
		var context = {
			allowSynchronous:true,
			tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
		};
		adaptor.getTiddler(rowNames[t],context,wizard,config.macros.importTiddlers.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: config.macros.importTiddlers.doneLabel, tooltip: config.macros.importTiddlers.donePrompt, onClick: config.macros.importTiddlers.onClose}
			],config.macros.importTiddlers.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(window.location.protocol != "file:") {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}
	var localPath = getLocalPath(document.location.toString());
	var backupPath = getBackupPath(localPath,me.backupExtension);
	w.setValue("backupPath",backupPath);
	w.setButtons([],me.statusPreparingBackup);
	var original = loadOriginal(localPath);
	w.setButtons([],me.statusSavingBackup);
	var backup = config.browser.isIE ? ieCopyFile(backupPath,localPath) : saveFile(backupPath,original);
	if(backup != true) {
		w.setButtons([],me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}
	w.setButtons([],me.statusLoadingCore);
	var load = loadRemoteFile(me.source,me.onLoadCore,w);
	if(typeof load == "string") {
		w.setButtons([],me.errorLoadingCore);
		alert(me.errorLoadingCore);
		return false;
	}
	return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
	var me = config.macros.upgrade;
	var w = params;
	var errMsg;
	if(!status)
		errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer)
		errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([],errMsg);
		alert(errMsg);
		return;
	}
	var onStartUpgrade = function(e) {
		w.setButtons([],me.statusSavingCore);
		var localPath = getLocalPath(document.location.toString());
		saveFile(localPath,responseText);
		w.setButtons([],me.statusReloadingCore);
		var backupPath = w.getValue("backupPath");
		var newLoc = document.location.toString() + '?time=' + new Date().convertToYYYYMMDDHHMM() + '#upgrade:[[' + encodeURI(backupPath) + ']]';
		window.setTimeout(function () {window.location = newLoc;},10);
	};
	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title,me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return  m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
	var importStore = new TiddlyWiki();
	var tw = loadFile(path);
	if(window.netscape !== undefined)
		tw = convertUTF8ToUnicode(tw);
	importStore.importTiddlyWiki(tw);
	importStore.forEachTiddler(function(title,tiddler) {
		if(!store.getTiddler(title)) {
			store.addTiddler(tiddler);
		}
	});
	refreshDisplay();
	saveChanges(); //# To create appropriate Markup* sections
	alert(config.messages.upgradeDone.format([formatVersion()]));
	window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf('?'));
}

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	currSync.syncTasks = this.createSyncTasks(currSync.syncList);
	this.preProcessSyncableTiddlers(currSync.syncList);
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers(currSync.syncList);
	wizard.setButtons([{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}]);
};

config.macros.sync.getSyncableTiddlers = function()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		if(syncItem.serverType && syncItem.serverHost) {
			syncItem.serverWorkspace = tiddler.fields['server.workspace'];
			syncItem.tiddler = tiddler;
			syncItem.title = tiddler.title;
			syncItem.isTouched = tiddler.isTouched();
			syncItem.selected = syncItem.isTouched;
			syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
			syncItem.status = syncItem.syncStatus.text;
			list.push(syncItem);
		}
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		si.serverUrl = si.syncTask.syncMachine.generateTiddlerInfo(si.tiddler).uri;
	}
};

config.macros.sync.processSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		if(si.syncStatus.display)
			si.rowElement.style.display = si.syncStatus.display;
		if(si.syncStatus.className)
			si.rowElement.className = si.syncStatus.className;
	}
};

config.macros.sync.createSyncTasks = function(syncList)
{
	var syncTasks = [];
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		var r = null;
		for(var j=0; j<syncTasks.length; j++) {
			var cst = syncTasks[j];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r) {
			si.syncTask = r;
			r.syncItems.push(si);
		} else {
			si.syncTask = this.createSyncTask(si);
			syncTasks.push(si.syncTask);
		}
	}
	return syncTasks;
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];
	st.syncMachine = new SyncMachine(st.serverType,{
		start: function() {
			return this.openHost(st.serverHost,"openWorkspace");
		},
		openWorkspace: function() {
			return this.openWorkspace(st.serverWorkspace,"getTiddlerList");
		},
		getTiddlerList: function() {
			return this.getTiddlerList("onGetTiddlerList");
		},
		onGetTiddlerList: function(context) {
			var tiddlers = context.tiddlers;
			for(var i=0; i<st.syncItems.length; i++) {
				var si = st.syncItems[i];
				var f = tiddlers.findByField("title",si.title);
				if(f !== null) {
					if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
						si.syncStatus = config.macros.sync.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
					}
				} else {
					si.syncStatus = config.macros.sync.syncStatusList.notFound;
				}
				config.macros.sync.updateSyncStatus(si);
			}
		},
		getTiddler: function(title) {
			return this.getTiddler(title,"onGetTiddler");
		},
		onGetTiddler: function(context) {
			var tiddler = context.tiddler;
			var syncItem = st.syncItems.findByField("title",tiddler.title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
				syncItem.syncStatus = config.macros.sync.syncStatusList.gotFromServer;
				config.macros.sync.updateSyncStatus(syncItem);
			}
		},
		putTiddler: function(tiddler) {
			return this.putTiddler(tiddler,"onPutTiddler");
		},
		onPutTiddler: function(context) {
			var title = context.title;
			var syncItem = st.syncItems.findByField("title",title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.resetTiddler(title);
				if(context.status) {
					syncItem.syncStatus = config.macros.sync.syncStatusList.putToServer;
					config.macros.sync.updateSyncStatus(syncItem);
				}
			}
		}
	});
	st.syncMachine.go();
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	removeChildren(e);
	createTiddlyText(e,syncItem.syncStatus.text);
	if(syncItem.syncStatus.display)
		syncItem.rowElement.style.display = syncItem.syncStatus.display;
	if(syncItem.syncStatus.className)
		syncItem.rowElement.className = syncItem.syncStatus.className;
};

config.macros.sync.doSync = function(e)
{
	var rowNames = ListView.getSelectedRows(currSync.listView);
	var sl = config.macros.sync.syncStatusList;
	for(var i=0; i<currSync.syncList.length; i++) {
		var si = currSync.syncList[i];
		if(rowNames.indexOf(si.title) != -1) {
			var r = true;
			switch(si.syncStatus) {
			case sl.changedServer:
				r = si.syncTask.syncMachine.go("getTiddler",si.title);
				break;
			case sl.notFound:
			case sl.changedLocally:
			case sl.changedBoth:
				r = si.syncTask.syncMachine.go("putTiddler",si.tiddler);
				break;
			default:
				break;
			}
			if(!r)
				displayMessage("Error in doSync: " + r);
		}
	}
	return false;
};

function SyncMachine(serverType,steps)
{
	this.serverType = serverType;
	this.adaptor = new config.adaptors[serverType]();
	this.steps = steps;
}

SyncMachine.prototype.go = function(step,context)
{
	var r = context ? context.status : null;
	if(typeof r == "string") {
		this.invokeError(r);
		return r;
	}
	var h = this.steps[step ? step : "start"];
	if(!h)
		return null;
	r = h.call(this,context);
	if(typeof r == "string")
		this.invokeError(r);
	return r;
};

SyncMachine.prototype.invokeError = function(message)
{
	if(this.steps.error)
		this.steps.error(message);
};

SyncMachine.prototype.openHost = function(host,nextStep)
{
	var me = this;
	return me.adaptor.openHost(host,null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.getWorkspaceList = function(nextStep)
{
	var me = this;
	return me.adaptor.getWorkspaceList(null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.openWorkspace = function(workspace,nextStep)
{
	var me = this;
	return me.adaptor.openWorkspace(workspace,null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.getTiddlerList = function(nextStep)
{
	var me = this;
	return me.adaptor.getTiddlerList(null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.generateTiddlerInfo = function(tiddler)
{
	return this.adaptor.generateTiddlerInfo(tiddler);
};

SyncMachine.prototype.getTiddler = function(title,nextStep)
{
	var me = this;
	return me.adaptor.getTiddler(title,null,null,function(context) {me.go(nextStep,context);});
};

SyncMachine.prototype.putTiddler = function(tiddler,nextStep)
{
	var me = this;
	if(me.adaptor.putTiddler)
		return me.adaptor.putTiddler(tiddler,null,null,function(context) {me.go(nextStep,context);});
	return false;
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(listWrapper);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
		p.desc = store.getTiddlerSlice(p.tiddler.title,"Description");
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);
		wizard.setValue("listView",listView);
		wizard.setButtons([
				{caption: config.macros.plugins.removeLabel, tooltip: config.macros.plugins.removePrompt, onClick: config.macros.plugins.doRemoveTag},
				{caption: config.macros.plugins.deleteLabel, tooltip: config.macros.plugins.deletePrompt, onClick: config.macros.plugins.doDelete}
			]);
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		for(var t=0; t<rowNames.length; t++)
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			for(var t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		removeChildren(msgArea);
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.indexOf(title) != -1) {
			removeChildren(e);
			wikify(store.getTiddlerText(title,""),e,null,store.fetchTiddler(title));
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = createTiddlyElement(document.body,"div");
	stash.style.display = "none";
	var display = story.getContainer();
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};
	if(!title || !isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div",story.containerId());
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	removeNode(stash);
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	var st = wikifyPlain("SiteTitle");
	var ss = wikifyPlain("SiteSubtitle");
	return st + ((st == "" || ss == "") ? "" : " - ") + ss;
}

function refreshStyles(title,doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Options stuff
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? "true" : "false";},
		set: function(name,value) {config.options[name] = value == "true";}
	}
};

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++) {
		var p = cookies[c].indexOf("=");
		if(p != -1) {
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			var optType = name.substr(0,3);
			if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
				config.optionHandlers[optType].set(name,value);
		}
	}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].get)
		c += config.optionHandlers[optType].get(name);
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

function removeCookie(name)
{
	document.cookie = name + "=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;";
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));});
}


config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute("type",typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute("option",opt);
	c.className = className || typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute("title",config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != "no")
		createTiddlyText(place,config.optionsDesc[opt] || opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute("option");
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: "input",
		valueField: "value",
		eventName: "onchange",
		className: "txtOptionInput",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: "input",
		valueField: "checked",
		eventName: "onclick",
		className: "chkOptionInput",
		typeValue: "checkbox",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
	config.options[opt] = value;
	saveOptionCookie(opt);
	var nodes = document.getElementsByTagName(elementType);
	for(var t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute("option");
		if(opt == optNode && nodes[t]!=elem)
			nodes[t][valueField] = value;
	}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var opt = (params[1] && params[1].name == "anon") ? params[1].value : getParam(params,"name",null);
	var className = (params[2] && params[2].name == "anon") ? params[2].value : getParam(params,"class",null);
	var desc = getParam(params,"desc","no");
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var showUnknown = getParam(params,"showUnknown","no");
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var chkUnknown = wizard.getElement("chkUnknown");
	chkUnknown.checked = showUnknown == "yes";
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue("listWrapper",listWrapper);
	this.refreshOptions(listWrapper,showUnknown == "yes");
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var opts = [];
	for(var n in config.options) {
		var opt = {};
		opt.option = "";
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,"no");
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue("listWrapper");
	removeChildren(listWrapper);
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
	return loadFile(localPath);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	var t0 = new Date();
	var originalPath = document.location.toString();
	if(originalPath.substr(0,5) != "file:") {
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	var original = loadOriginal(localPath);
	if(original == null) {
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	saveMain(localPath,original,posDiv);
	if(config.options.chkSaveBackups)
		saveBackup(localPath,original);
	if(config.options.chkSaveEmptyTemplate)
		saveEmpty(localPath,original,posDiv);
	if(config.options.chkGenerateAnRssFeed && saveRss instanceof Function)
		saveRss(localPath);
	if(config.options.chkDisplayInstrumentation)
		displayMessage("saveChanges " + (new Date()-t0) + " ms");
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv,localPath);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function saveBackup(localPath,original)
{
	var backupPath = getBackupPath(localPath);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(backup)
		displayMessage(config.messages.backupSaved,"file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
	var emptyPath,p;
	if((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";
	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath,empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved,"file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath,title,extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
	if(title)
		backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
		displayMessage(config.messages.rssSaved,"file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
	var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
	s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
	for(var i=0; i<tiddler.tags.length; i++)
		s += "<category>" + tiddler.tags[i] + "</category>\n";
	s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
	s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
	return s;
};

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for(var i=tiddlers.length-1; i>=n; i--) {
		s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
	return config.browser.isOpera || !window.netscape ? convertUnicodeToHtmlEntities(s) : mozConvertUnicodeToUTF8(s);
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
	return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

function copyFile(dest,source)
{
	return config.browser.isIE ? ieCopyFile(dest,source) : false;
}

function saveFile(fileUrl,content)
{
	var r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	return r;
}

function loadFile(fileUrl)
{
	var r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

function ieCreatePath(path)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}

	var pos = path.lastIndexOf("\\");
	if(pos==-1)
		pos = path.lastIndexOf("/");
	if(pos!=-1)
		path = path.substring(0,pos+1);

	var scan = [path];
	var parent = fso.GetParentFolderName(path);
	while(parent && !fso.FolderExists(parent)) {
		scan.push(parent);
		parent = fso.GetParentFolderName(parent);
	}

	for(i=scan.length-1;i>=0;i--) {
		if(!fso.FolderExists(scan[i])) {
			fso.CreateFolder(scan[i]);
		}
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	ieCreatePath(filePath);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	ieCreatePath(dest);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x20|0x02,00004,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,00004,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			var contents = sInputStream.read(sInputStream.available());
			sInputStream.close();
			inputStream.close();
			return contents;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	return i > 0 ? url.substring(i-1) : url;
}

function javaSaveFile(filePath,content)
{
	try {
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
	} catch(ex) {
	}
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	try {
		if(document.applets["TiddlySaver"])
			return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
	} catch(ex) {
	}
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
	} catch(ex) {
		return null;
	}
	return content.join("\n");
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host)
		return '';
	host = host.trim();
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length-1) == '/')
		host = host.substr(0,host.length-1);
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host ? host.replace(/^http:\/\//,'').replace(/\/$/,'') : '';
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {context.callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	this.workspace = workspace;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
	context = this.setContext(context,userParams,callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		var ret = context.complete(context,context.userParams);
	} else {
		ret = loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
		if(typeof ret != "string")
			ret = true;
	}
	return ret;
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
		}
		for(var i=0; i<context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	return context.adaptor.store ?
		context.complete(context,context.userParams) :
		loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	t.fields['server.type'] = FileAdaptor.serverType;
	t.fields['server.host'] = AdaptorBase.minHostName(context.host);
	t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
	context.tiddler = t;
	context.status = true;
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context,userParams);
	} else {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	delete this.store;
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- Remote HTTP requests
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
	var x = null;
	try {
		x = new XMLHttpRequest(); //# Modern
	} catch(ex) {
		try {
			x = new ActiveXObject("Msxml2.XMLHTTP"); //# IE 6
		} catch(ex2) {
		}
	}
	if(!x)
		return "Can't create XMLHttpRequest object";
	x.onreadystatechange = function() {
		try {
			var status = x.status;
		} catch(ex) {
			status = false;
		}
		if(x.readyState == 4 && callback && (status !== undefined)) {
			if([0, 200, 201, 204, 207].contains(status))
				callback(true,params,x.responseText,url,x);
			else
				callback(false,params,null,url,x);
			x.onreadystatechange = function(){};
			x = null;
		}
	};
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	try {
		if(!allowCache)
			url = url + (url.indexOf("?") < 0 ? "?" : "&") + "nocache=" + Math.random();
		x.open(type,url,true,username,password);
		if(data)
			x.setRequestHeader("Content-Type", contentType || "application/x-www-form-urlencoded");
		if(x.overrideMimeType)
			x.setRequestHeader("Connection", "close");
		if(headers) {
			for(var n in headers)
				x.setRequestHeader(n,headers[n]);
		}
		x.setRequestHeader("X-Requested-With", "TiddlyWiki " + formatVersion());
		x.send(data);
	} catch(ex) {
		return exceptionText(ex);
	}
	return x;
}

// included for compatibility
function getXMLHttpRequest()
{
	try {
		var x = new XMLHttpRequest(); // Modern
	} catch(ex) {
		try {
			x = new ActiveXObject("Msxml2.XMLHTTP"); // IE 6
		} catch (ex2) {
			return null;
		}
	}
	return x;
}

// included for compatibility
function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

//--
//-- TiddlyWiki-specific utility functions
//--

function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision + (v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
	var a = ["major","minor","revision"];
	for(var i = 0; i<a.length; i++) {
		var x1 = v1[a[i]] || 0;
		var x2 = v2[a[i]] || 0;
		if(x1<x2)
			return 1;
		if(x1>x2)
			return -1;
	}
	x1 = v1.beta || 9999;
	x2 = v2.beta || 9999;
	if(x1<x2)
		return 1;
	return x1 > x2 ? -1 : 0;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
	var btn = document.createElement("a");
	if(action) {
		btn.onclick = action;
		btn.setAttribute("href","javascript:;");
	}
	if(tooltip)
		btn.setAttribute("title",tooltip);
	if(text)
		btn.appendChild(document.createTextNode(text));
	btn.className = className || "button";
	if(id)
		btn.id = id;
	if(attribs) {
		for(var i in attribs) {
			btn.setAttribute(i,attribs[i]);
		}
	}
	if(parent)
		parent.appendChild(btn);
	if(accessKey)
		btn.setAttribute("accessKey",accessKey);
	return btn;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,className);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
		} else {
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
		}
	}
	if(typeof config.annotations[title]=="string")
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

function createExternalLink(place,url)
{
	var link = document.createElement("a");
	link.className = "externalLink";
	link.href = url;
	link.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	place.appendChild(link);
	return link;
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
	btn.setAttribute("tag",tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler",excludeTiddler);
	return btn;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	story.displayTiddlers(this,tiddlers);
	return false;
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for(var i in src) {
		if(!preserveExisting || dst[i] === undefined)
			dst[i] = src[i];
	}
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description || e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(!g.browsers[b]() && b < g.browsers.length-1)
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}

if(!window.console) {
	console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
	case "-tw-vertScroll":
		window.scrollTo(findScrollX(),value);
		break;
	case "-tw-horizScroll":
		window.scrollTo(value,findScrollY());
		break;
	default:
		element.style[style] = value;
		break;
	}
};

Morpher.prototype.stop = function()
{
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
			case undefined:
			case "style":
				var v = p.start + (p.end-p.start) * progress;
				this.assignStyle(this.element,p.style,template.format([v]));
				break;
			case "color":
				break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {removeNode(element);};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var left = findPosX(element);
	var width = element.scrollWidth;
	var height = element.scrollHeight;
	var winWidth = findWindowWidth();
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
		case "all":
			c = function(element,properties) {removeNode(element);};
			break;
		case "children":
			c = function(element,properties) {removeChildren(element);};
			break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,className)
{
	var stackPosition = this.find(root,"popup");
	Popup.remove(stackPosition+1);
	var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign,halign,offset)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup,valign,halign,offset);
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
	if(!offset)
		var offset = {x:0,y:0};
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == 'right') ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == 'top') ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == 'right')
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var pos = -1;
	for (var t=this.stack.length-1; t>=0; t--) {
		if(isDescendant(e,this.stack[t].popup))
			pos = t;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) var pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		removeNode(p.popup);
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	if(this.formElem)
		this.formElem[name] = value;
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? this.formElem[name] : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
};

Wizard.prototype.clear = function()
{
	removeChildren(this.bodyElem);
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	removeChildren(this.footElem);
	for(var t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	removeChildren(this.bodyElem);
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className || "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(c,columnTemplate,t);
			if(columnTemplate.className)
				addClass(c,columnTemplate.className);
		}
	}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++) {
		var rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
				if(columnTemplate.className)
					addClass(c,columnTemplate.className);
			}
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<config.messages.sizeTemplates.length-1 && v<config.messages.sizeTemplates[t].unit)
					t++;
				createTiddlyText(place,config.messages.sizeTemplates[t].template.format([Math.round(v/config.messages.sizeTemplates[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createTiddlyText(createExternalLink(place,v),c || v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				for(var t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
//--

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
};

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++) {
		if(this[t][field] == value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for(var i = 0; i<items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
	var scope = thisObj || window;
	var a = [];
	for(var i=0, j=this.length; i < j; ++i) {
		a.push(fn.call(scope,this[i],i,this));
	}
	return a;
};}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1) {
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
String.prototype.toJSONString = function()
{
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++) {
		if(p[t].value)
			n.pushUnique(p[t].value,unique);
	}
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var r = {};
	for(var t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var r = [];
	for(var t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
	t = t.replace(/\\/g,"");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4);
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	var hh = d.substr(8,2) || "00";
	var mm = d.substr(10,2) || "00";
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(hh,10),
			parseInt(mm,10),0,0));
};

//--
//-- Crypto functions and associated conversion routines
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	var be=[];
	var len=Math.floor(str.length/4);
	var i, j;
	for(i=0, j=0; i<len; i++, j+=4) {
		be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
	}
	while(j<str.length) {
		be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
		j++;
	}
	return be;
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	var str='';
	for(var i=0;i<be.length*32;i+=8) {
		str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
	}
	return str;
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	var hex='0123456789ABCDEF';
	var str='';
	for(var i=0;i<be.length*4;i++) {
		str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
	}
	return str;
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return Crypto.be32sToHex(Crypto.sha1Str(str));
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return Crypto.sha1(Crypto.strToBe32s(str),str.length);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	// Add 32-bit integers, wrapping at 32 bits
	function add32(a,b)
	{
		var lsw=(a&0xFFFF)+(b&0xFFFF);
		var msw=(a>>16)+(b>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	}
	function AA(a,b,c,d,e)
	{
		b=(b>>>27)|(b<<5);
		var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
		var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	}
	function RR(w,j)
	{
		var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
		return (n>>>31)|(n<<1);
	}

	var len=blen*8;
	x[len>>5] |= 0x80 << (24-len%32);
	x[((len+64>>9)<<4)+15]=len;
	var w=new Array(80);

	var k1=0x5A827999;
	var k2=0x6ED9EBA1;
	var k3=0x8F1BBCDC;
	var k4=0xCA62C1D6;

	var h0=0x67452301;
	var h1=0xEFCDAB89;
	var h2=0x98BADCFE;
	var h3=0x10325476;
	var h4=0xC3D2E1F0;

	for(var i=0;i<x.length;i+=16) {
		var j=0;
		var t;
		var a=h0;
		var b=h1;
		var c=h2;
		var d=h3;
		var e=h4;
		while(j<16) {
			w[j]=x[i+j];
			t=AA(e,a,d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		while(j<20) {
			w[j]=RR(w,j);
			t=AA(e,a,d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		while(j<40) {
			w[j]=RR(w,j);
			t=AA(e,a,b^c^d,w[j],k2);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		while(j<60) {
			w[j]=RR(w,j);
			t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		while(j<80) {
			w[j]=RR(w,j);
			t=AA(e,a,b^c^d,w[j],k4);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
		}
		h0=add32(h0,a);
		h1=add32(h1,b);
		h2=add32(h2,c);
		h3=add32(h3,d);
		h4=add32(h4,e);
	}
	return [h0,h1,h2,h3,h4];
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	return "#" + ("0" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,locolors,hicolors)
{
	if(!hicolors)
		hicolors = locolors;
	for(var t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var p = t/100*(locolors.length-1);
		var hc = hicolors[Math.floor(p)];
		if(typeof hc == "string")
			hc = new RGB(hc);
		var lc = locolors[Math.ceil(p)];
		if(typeof lc == "string")
			lc = new RGB(lc);
		bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
	}
}

function createTiddlyText(parent,text)
{
	return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,parent);
	return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
	var e = document.createElement(element);
	if(className != null)
		e.className = className;
	if(id != null)
		e.setAttribute("id",id);
	if(text != null)
		e.appendChild(document.createTextNode(text));
	if(attribs) {
		for(var n in attribs) {
			e.setAttribute(n,attribs[n]);
		}
	}
	if(parent != null)
		parent.appendChild(e);
	return e;
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj['e'+type+fn] = fn;
		obj[type+fn] = function(){obj['e'+type+fn](window.event);};
		obj.attachEvent('on'+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent('on'+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}

function addClass(e,className)
{
	var currClass = e.className.split(" ");
	if(currClass.indexOf(className) == -1)
		e.className += " " + className;
}

function removeClass(e,className)
{
	var currClass = e.className.split(" ");
	var i = currClass.indexOf(className);
	while(i != -1) {
		currClass.splice(i,1);
		i = currClass.indexOf(className);
	}
	e.className = currClass.join(" ");
}

function hasClass(e,className)
{
	if(e.className && e.className.split(" ").indexOf(className) != -1) {
		return true;
	}
	return false;
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !hasClass(e,value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e && e.hasChildNodes())
		removeNode(e.firstChild);
}

// Remove a node and all it's children
function removeNode(e)
{
	scrubNode(e);
	e.parentNode.removeChild(e);
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		for(var t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== 'style' && (typeof e[n] === 'function' || (typeof e[n] === 'object' && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id,doc)
{
	if(!id)
		id = "customStyleSheet";
	if(!doc)
		doc = document;
	var n = doc.getElementById(id);
	if(doc.createStyleSheet) {
		// Test for IE's non-standard createStyleSheet method
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
	} else {
		if(n) {
			n.replaceChild(doc.createTextNode(s),n.firstChild);
		} else {
			n = doc.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(doc.createTextNode(s));
			doc.getElementsByTagName("head")[0].appendChild(n);
		}
	}
}

function removeStyleSheet(id)
{
	var e = document.getElementById(id);
	if(e)
		e.parentNode.removeChild(e);
}

// Force the browser to do a document reflow when needed to workaround browser bugs
function forceReflow()
{
	if(config.browser.isGecko) {
		setStylesheet("body {top:0px;margin-top:0px;}","forceReflow");
		setTimeout(function() {setStylesheet("","forceReflow");},1);
	}
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split('\n').length;
		var thisline = e.value.substr(0,e.selectionStart).split('\n').length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart('character', -text.length);
				range.select();
			}
		}
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(safeMode && store.isShadowTiddler(title))
		return;
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for(var t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for(var t = 0; t < tiddlers.length; t++) {
		if(!tiddlers[t].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[t]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if(node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMM(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var attrs = node.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if(!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created;
		var modified = tiddler.modified;
		var attributes = tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//]]>
</script>
<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
	return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
